<!DOCTYPE html>
<html>
<head>
<meta content="IE=Edge" http-equiv="X-UA-Compatible"/>
<title>Zabbix</title>
<title>zabbix.php?action=dashboard.view</title>
<meta content="Zabbix SIA" name="Author"/>
<meta charset="utf-8"/>
<link href="images/general/zabbix.ico" rel="shortcut icon"/>
<link href="data:text/css,/%2A%20CSS%20Document%20%2A/%0A%40import%20%22styles/default.css%22%3B%0A%40import%20%22styles/color.css%22%3B%0A%40import%20%22styles/icon.css%22%3B%0A%40import%20%22styles/blocks.css%22%3B%0A%40import%20%22styles/screen.css%22%3B%0A" rel="stylesheet" type="text/css"/><!--URL:css.css-->
<link href="data:text/css,/%2A%0A%2A%2A%20Zabbix%0A%2A%2A%20Copyright%20%28C%29%202000-2011%20Zabbix%20SIA%0A%2A%2A%0A%2A%2A%20This%20program%20is%20free%20software%3B%20you%20can%20redistribute%20it%20and/or%20modify%0A%2A%2A%20it%20under%20the%20terms%20of%20the%20GNU%20General%20Public%20License%20as%20published%20by%0A%2A%2A%20the%20Free%20Software%20Foundation%3B%20either%20version%202%20of%20the%20License%2C%20or%0A%2A%2A%20%28at%20your%20option%29%20any%20later%20version.%0A%2A%2A%0A%2A%2A%20This%20program%20is%20distributed%20in%20the%20hope%20that%20it%20will%20be%20useful%2C%0A%2A%2A%20but%20WITHOUT%20ANY%20WARRANTY%3B%20without%20even%20the%20implied%20warranty%20of%0A%2A%2A%20MERCHANTABILITY%20or%20FITNESS%20FOR%20A%20PARTICULAR%20PURPOSE.%20%20See%20the%0A%2A%2A%20GNU%20General%20Public%20License%20for%20more%20details.%0A%2A%2A%0A%2A%2A%20You%20should%20have%20received%20a%20copy%20of%20the%20GNU%20General%20Public%20License%0A%2A%2A%20along%20with%20this%20program%3B%20if%20not%2C%20write%20to%20the%20Free%20Software%0A%2A%2A%20Foundation%2C%20Inc.%2C%2051%20Franklin%20Street%2C%20Fifth%20Floor%2C%20Boston%2C%20MA%20%2002110-1301%2C%20USA.%0A%2A%2A/%0A%40import%20%22jquery-ui.css%22%3B%0A%0A.unknown%2C%20a.unknown%20%7B%20color%3A%20%23777%3B%20%7D%0Aa.unknown%3Ahover%20%7B%20color%3A%20%23999%3B%20%7D%0A%0Atable.filter%20%7B%20background%3A%20white%3B%20border%3A%201px%20solid%20%23EEE%3B%20%7D%0Atable.filter%20tr%20td%20%7B%20border%3A%201px%20solid%20%23EEE%3B%20%7D%0A%0Aul.formlist%20li.new%20%7B%20background%3A%20%23EEFFEE%3B%20%7D%0A%0A.dropArea%20%7B%20background-color%3A%20%23FFB%3B%20%7D%0A.dropHereText%20%7B%20color%3A%20%235481AB%3B%20%7D%0A%0Atable.ack_msgs%20tr.msg%20%7B%20background-color%3A%20%23F8F8F8%3B%20%7D%0A%0A.ui-widget-content%20a.on%20%7B%20color%3A%20%23EE0000%3B%20%7D%0A.ui-widget-content%20a.on%3Ahover%20%7B%20color%3A%20%23CC4444%3B%20%7D%0A" rel="stylesheet" type="text/css"/><!--URL:styles/themes/originalblue/main.css-->
<!--[if lte IE 7]>
	<link rel="stylesheet" type="text/css" href="styles/ie.css" />
<![endif]-->
<script src="data:text/x-js;base64,LyoKKiogWmFiYml4CioqIENvcHlyaWdodCAoQykgMjAwMC0yMDEyIFphYmJpeCBTSUEKKioKKiogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKKiogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKKiogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMiBvZiB0aGUgTGljZW5zZSwgb3IKKiogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KKioKKiogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCioqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCioqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gU2VlIHRoZQoqKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoqKgoqKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQoqKiBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQoqKiBGb3VuZGF0aW9uLCBJbmMuLCA1MSBGcmFua2xpbiBTdHJlZXQsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BICAwMjExMC0xMzAxLCBVU0EuCioqLwoKCnZhciBhZ3QgPSBuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCksCglPUCA9IChhZ3QuaW5kZXhPZignb3BlcmEnKSAhPSAtMSkgJiYgd2luZG93Lm9wZXJhLAoJSUUgPSAoYWd0LmluZGV4T2YoJ21zaWUnKSAhPSAtMSkgJiYgZG9jdW1lbnQuYWxsICYmICFPUCwKCUlFMTAgPSAoYWd0LmluZGV4T2YoJ21zaWUgMTAuMCcpICE9IC0xKSAmJiBkb2N1bWVudC5hbGwgJiYgIU9QLAoJSUU5ID0gKGFndC5pbmRleE9mKCdtc2llIDkuMCcpICE9IC0xKSAmJiBkb2N1bWVudC5hbGwgJiYgIU9QLAoJSUU4ID0gKGFndC5pbmRleE9mKCdtc2llIDguMCcpICE9IC0xKSAmJiBkb2N1bWVudC5hbGwgJiYgIU9QLAoJSUU3ID0gKGFndC5pbmRleE9mKCdtc2llIDcuMCcpICE9IC0xKSAmJiBkb2N1bWVudC5hbGwgJiYgIU9QLAoJSUU2ID0gKGFndC5pbmRleE9mKCdtc2llIDYuMCcpICE9IC0xKSAmJiBkb2N1bWVudC5hbGwgJiYgIU9QLAoJQ1IgPSAoYWd0LmluZGV4T2YoJ2Nocm9tZScpICE9IC0xKSwKCVNGID0gKGFndC5pbmRleE9mKCdzYWZhcmknKSAhPSAtMSkgJiYgIUNSLAoJV0sgPSAoYWd0LmluZGV4T2YoJ2FwcGxld2Via2l0JykgIT0gLTEpLAoJS1EgPSAoYWd0LmluZGV4T2YoJ2todG1sJykgIT0gLTEpICYmICFXSywKCUdLID0gKGFndC5pbmRleE9mKCdnZWNrbycpICE9IC0xKSAmJiAhS1EgJiYgIVdLLAoJTUMgPSAoYWd0LmluZGV4T2YoJ21hYycpICE9IC0xKTsKCi8vIHJlZGlyZWN0IG91dGRhdGVkIGJyb3dzZXIgdG8gd2FybmluZyBwYWdlCmlmIChkb2N1bWVudC5jb29raWUuaW5kZXhPZignYnJvd3Nlcndhcm5pbmdfaWdub3JlJykgPCAwKSB7CglpZiAoSUU2IHx8IElFNyB8fCBLUSkgewoJCXdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKCdicm93c2Vyd2FybmluZy5waHAnKTsKCX0KfQo=" type="text/javascript"></script><!--URL:js/browsers.js-->
<script type="text/javascript">var PHP_TZ_OFFSET = -10800;</script>
<script src="data:text/javascript; charset=UTF-8;base64,aWYgKHR5cGVvZihsb2NhbGUpID09ICJ1bmRlZmluZWQiKSB7IHZhciBsb2NhbGUgPSB7fTsgfQpsb2NhbGVbJ1NfTUFYX0NPT0tJRV9TSVpFX1JFQUNIRUQnXSA9ICdXZSBhcmUgc29ycnksIHRoZSBtYXhpbXVtIHBvc3NpYmxlIG51bWJlciBvZiBlbGVtZW50cyB0byByZW1lbWJlciBoYXMgYmVlbiByZWFjaGVkLic7bG9jYWxlWydTX0NMT1NFJ10gPSAnQ2xvc2UnO2xvY2FsZVsnU19OT19FTEVNRU5UU19TRUxFQ1RFRCddID0gJ05vIGVsZW1lbnRzIHNlbGVjdGVkISc7bG9jYWxlWydET19ZT1VfUkVQTEFDRV9DT05ESVRJT05BTF9FWFBSRVNTSU9OX1EnXSA9ICdEbyB5b3Ugd2lzaCB0byByZXBsYWNlIHRoZSBjb25kaXRpb25hbCBleHByZXNzaW9uPyc7bG9jYWxlWydTX0lOU0VSVF9NQUNSTyddID0gJ0luc2VydCBtYWNybyc7bG9jYWxlWydTX0NSRUFURV9MT0dfVFJJR0dFUiddID0gJ0NyZWF0ZSB0cmlnZ2VyJztsb2NhbGVbJ1NfREVMRVRFJ10gPSAnRGVsZXRlJztsb2NhbGVbJ1NfREVMRVRFX0tFWVdPUkRfUSddID0gJ0RlbGV0ZSBrZXl3b3JkPyc7bG9jYWxlWydTX0RFTEVURV9FWFBSRVNTSU9OX1EnXSA9ICdEZWxldGUgZXhwcmVzc2lvbj8nO2xvY2FsZVsnU2ltcGxlIGdyYXBocyddID0gJ1NpbXBsZSBncmFwaHMnO2xvY2FsZVsnSGlzdG9yeSddID0gJ0hpc3RvcnknO2xvY2FsZVsnSGlzdG9yeSBhbmQgc2ltcGxlIGdyYXBocyddID0gJ0hpc3RvcnkgYW5kIHNpbXBsZSBncmFwaHMnO2xvY2FsZVsnVHJpZ2dlcnMnXSA9ICdUcmlnZ2Vycyc7bG9jYWxlWydFdmVudHMnXSA9ICdFdmVudHMnO2xvY2FsZVsnSG9zdCBzY3JlZW5zJ10gPSAnSG9zdCBzY3JlZW5zJztsb2NhbGVbJ0dvIHRvJ10gPSAnR28gdG8nO2xvY2FsZVsnTGF0ZXN0IGRhdGEnXSA9ICdMYXRlc3QgZGF0YSc7bG9jYWxlWydTY3JpcHRzJ10gPSAnU2NyaXB0cyc7bG9jYWxlWydIb3N0IGludmVudG9yaWVzJ10gPSAnSG9zdCBpbnZlbnRvcmllcyc7bG9jYWxlWydBZGQgc2VydmljZSddID0gJ0FkZCBzZXJ2aWNlJztsb2NhbGVbJ0VkaXQgc2VydmljZSddID0gJ0VkaXQgc2VydmljZSc7bG9jYWxlWydEZWxldGUgc2VydmljZSddID0gJ0RlbGV0ZSBzZXJ2aWNlJztsb2NhbGVbJ0RlbGV0ZSB0aGUgc2VsZWN0ZWQgc2VydmljZT8nXSA9ICdEZWxldGUgdGhlIHNlbGVjdGVkIHNlcnZpY2U/JzsvKiAgUHJvdG90eXBlIEphdmFTY3JpcHQgZnJhbWV3b3JrLCB2ZXJzaW9uIDEuNi4xCiAqICAoYykgMjAwNS0yMDA5IFNhbSBTdGVwaGVuc29uCiAqCiAqICBQcm90b3R5cGUgaXMgZnJlZWx5IGRpc3RyaWJ1dGFibGUgdW5kZXIgdGhlIHRlcm1zIG9mIGFuIE1JVC1zdHlsZSBsaWNlbnNlLgogKiAgRm9yIGRldGFpbHMsIHNlZSB0aGUgUHJvdG90eXBlIHdlYiBzaXRlOiBodHRwOi8vd3d3LnByb3RvdHlwZWpzLm9yZy8KICoKICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgp2YXIgUHJvdG90eXBlID0gewogIFZlcnNpb246ICcxLjYuMScsCgogIEJyb3dzZXI6IChmdW5jdGlvbigpewogICAgdmFyIHVhID0gbmF2aWdhdG9yLnVzZXJBZ2VudDsKICAgIHZhciBpc09wZXJhID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHdpbmRvdy5vcGVyYSkgPT0gJ1tvYmplY3QgT3BlcmFdJzsKICAgIHJldHVybiB7CiAgICAgIElFOiAgICAgICAgICAgICAhIXdpbmRvdy5hdHRhY2hFdmVudCAmJiAhaXNPcGVyYSwKICAgICAgT3BlcmE6ICAgICAgICAgIGlzT3BlcmEsCiAgICAgIFdlYktpdDogICAgICAgICB1YS5pbmRleE9mKCdBcHBsZVdlYktpdC8nKSA+IC0xLAogICAgICBHZWNrbzogICAgICAgICAgdWEuaW5kZXhPZignR2Vja28nKSA+IC0xICYmIHVhLmluZGV4T2YoJ0tIVE1MJykgPT09IC0xLAogICAgICBNb2JpbGVTYWZhcmk6ICAgL0FwcGxlLipNb2JpbGUuKlNhZmFyaS8udGVzdCh1YSkKICAgIH0KICB9KSgpLAoKICBCcm93c2VyRmVhdHVyZXM6IHsKICAgIFhQYXRoOiAhIWRvY3VtZW50LmV2YWx1YXRlLAogICAgU2VsZWN0b3JzQVBJOiAhIWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IsCiAgICBFbGVtZW50RXh0ZW5zaW9uczogKGZ1bmN0aW9uKCkgewogICAgICB2YXIgY29uc3RydWN0b3IgPSB3aW5kb3cuRWxlbWVudCB8fCB3aW5kb3cuSFRNTEVsZW1lbnQ7CiAgICAgIHJldHVybiAhIShjb25zdHJ1Y3RvciAmJiBjb25zdHJ1Y3Rvci5wcm90b3R5cGUpOwogICAgfSkoKSwKICAgIFNwZWNpZmljRWxlbWVudEV4dGVuc2lvbnM6IChmdW5jdGlvbigpIHsKICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuSFRNTERpdkVsZW1lbnQgIT09ICd1bmRlZmluZWQnKQogICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICB2YXIgZm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKTsKICAgICAgdmFyIGlzU3VwcG9ydGVkID0gZmFsc2U7CgogICAgICBpZiAoZGl2WydfX3Byb3RvX18nXSAmJiAoZGl2WydfX3Byb3RvX18nXSAhPT0gZm9ybVsnX19wcm90b19fJ10pKSB7CiAgICAgICAgaXNTdXBwb3J0ZWQgPSB0cnVlOwogICAgICB9CgogICAgICBkaXYgPSBmb3JtID0gbnVsbDsKCiAgICAgIHJldHVybiBpc1N1cHBvcnRlZDsKICAgIH0pKCkKICB9LAoKICBTY3JpcHRGcmFnbWVudDogJzxzY3JpcHRbXj5dKj4oPzpcXHMqPCEtLSkqKFtcXFNcXHNdKj8pKD86LS0+XFxzKikqPFwvc2NyaXB0PicsCi8vIG9yaWdpbmFsOgovLyAgU2NyaXB0RnJhZ21lbnQ6ICc8c2NyaXB0W14+XSo+KFtcXFNcXHNdKj8pPFwvc2NyaXB0PicsCiAgSlNPTkZpbHRlcjogL15cL1wqLXNlY3VyZS0oW1xzXFNdKilcKlwvXHMqJC8sCgogIGVtcHR5RnVuY3Rpb246IGZ1bmN0aW9uKCkgeyB9LAogIEs6IGZ1bmN0aW9uKHgpIHsgcmV0dXJuIHggfQp9OwoKaWYgKFByb3RvdHlwZS5Ccm93c2VyLk1vYmlsZVNhZmFyaSkKICBQcm90b3R5cGUuQnJvd3NlckZlYXR1cmVzLlNwZWNpZmljRWxlbWVudEV4dGVuc2lvbnMgPSBmYWxzZTsKCgp2YXIgQWJzdHJhY3QgPSB7IH07CgoKdmFyIFRyeSA9IHsKICB0aGVzZTogZnVuY3Rpb24oKSB7CiAgICB2YXIgcmV0dXJuVmFsdWU7CgogICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB2YXIgbGFtYmRhID0gYXJndW1lbnRzW2ldOwogICAgICB0cnkgewogICAgICAgIHJldHVyblZhbHVlID0gbGFtYmRhKCk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0gY2F0Y2ggKGUpIHsgfQogICAgfQoKICAgIHJldHVybiByZXR1cm5WYWx1ZTsKICB9Cn07CgovKiBCYXNlZCBvbiBBbGV4IEFybmVsbCdzIGluaGVyaXRhbmNlIGltcGxlbWVudGF0aW9uLiAqLwoKdmFyIENsYXNzID0gKGZ1bmN0aW9uKCkgewogIGZ1bmN0aW9uIHN1YmNsYXNzKCkge307CiAgZnVuY3Rpb24gY3JlYXRlKCkgewogICAgdmFyIHBhcmVudCA9IG51bGwsIHByb3BlcnRpZXMgPSAkQShhcmd1bWVudHMpOwogICAgaWYgKE9iamVjdC5pc0Z1bmN0aW9uKHByb3BlcnRpZXNbMF0pKQogICAgICBwYXJlbnQgPSBwcm9wZXJ0aWVzLnNoaWZ0KCk7CgogICAgZnVuY3Rpb24ga2xhc3MoKSB7CiAgICAgIHRoaXMuaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfQoKICAgIE9iamVjdC5leHRlbmQoa2xhc3MsIENsYXNzLk1ldGhvZHMpOwogICAga2xhc3Muc3VwZXJjbGFzcyA9IHBhcmVudDsKICAgIGtsYXNzLnN1YmNsYXNzZXMgPSBbXTsKCiAgICBpZiAocGFyZW50KSB7CiAgICAgIHN1YmNsYXNzLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7CiAgICAgIGtsYXNzLnByb3RvdHlwZSA9IG5ldyBzdWJjbGFzczsKICAgICAgcGFyZW50LnN1YmNsYXNzZXMucHVzaChrbGFzcyk7CiAgICB9CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wZXJ0aWVzLmxlbmd0aDsgaSsrKQogICAgICBrbGFzcy5hZGRNZXRob2RzKHByb3BlcnRpZXNbaV0pOwoKICAgIGlmICgha2xhc3MucHJvdG90eXBlLmluaXRpYWxpemUpCiAgICAgIGtsYXNzLnByb3RvdHlwZS5pbml0aWFsaXplID0gUHJvdG90eXBlLmVtcHR5RnVuY3Rpb247CgogICAga2xhc3MucHJvdG90eXBlLmNvbnN0cnVjdG9yID0ga2xhc3M7CiAgICByZXR1cm4ga2xhc3M7CiAgfQoKICBmdW5jdGlvbiBhZGRNZXRob2RzKHNvdXJjZSkgewogICAgdmFyIGFuY2VzdG9yICAgPSB0aGlzLnN1cGVyY2xhc3MgJiYgdGhpcy5zdXBlcmNsYXNzLnByb3RvdHlwZTsKICAgIHZhciBwcm9wZXJ0aWVzID0gT2JqZWN0LmtleXMoc291cmNlKTsKCiAgICBpZiAoIU9iamVjdC5rZXlzKHsgdG9TdHJpbmc6IHRydWUgfSkubGVuZ3RoKSB7CiAgICAgIGlmIChzb3VyY2UudG9TdHJpbmcgIT0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZykKICAgICAgICBwcm9wZXJ0aWVzLnB1c2goInRvU3RyaW5nIik7CiAgICAgIGlmIChzb3VyY2UudmFsdWVPZiAhPSBPYmplY3QucHJvdG90eXBlLnZhbHVlT2YpCiAgICAgICAgcHJvcGVydGllcy5wdXNoKCJ2YWx1ZU9mIik7CiAgICB9CgogICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IHByb3BlcnRpZXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHByb3BlcnR5ID0gcHJvcGVydGllc1tpXSwgdmFsdWUgPSBzb3VyY2VbcHJvcGVydHldOwogICAgICBpZiAoYW5jZXN0b3IgJiYgT2JqZWN0LmlzRnVuY3Rpb24odmFsdWUpICYmCiAgICAgICAgICB2YWx1ZS5hcmd1bWVudE5hbWVzKCkuZmlyc3QoKSA9PSAiJHN1cGVyIikgewogICAgICAgIHZhciBtZXRob2QgPSB2YWx1ZTsKICAgICAgICB2YWx1ZSA9IChmdW5jdGlvbihtKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7IHJldHVybiBhbmNlc3RvclttXS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9OwogICAgICAgIH0pKHByb3BlcnR5KS53cmFwKG1ldGhvZCk7CgogICAgICAgIHZhbHVlLnZhbHVlT2YgPSBtZXRob2QudmFsdWVPZi5iaW5kKG1ldGhvZCk7CiAgICAgICAgdmFsdWUudG9TdHJpbmcgPSBtZXRob2QudG9TdHJpbmcuYmluZChtZXRob2QpOwogICAgICB9CiAgICAgIHRoaXMucHJvdG90eXBlW3Byb3BlcnR5XSA9IHZhbHVlOwogICAgfQoKICAgIHJldHVybiB0aGlzOwogIH0KCiAgcmV0dXJuIHsKICAgIGNyZWF0ZTogY3JlYXRlLAogICAgTWV0aG9kczogewogICAgICBhZGRNZXRob2RzOiBhZGRNZXRob2RzCiAgICB9CgogIH07Cn0pKCk7CihmdW5jdGlvbigpIHsKCiAgdmFyIF90b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7CgogIGZ1bmN0aW9uIGV4dGVuZChkZXN0aW5hdGlvbiwgc291cmNlKSB7CiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzb3VyY2UpCiAgICAgIGRlc3RpbmF0aW9uW3Byb3BlcnR5XSA9IHNvdXJjZVtwcm9wZXJ0eV07CiAgICByZXR1cm4gZGVzdGluYXRpb247CiAgfQoKICBmdW5jdGlvbiBpbnNwZWN0KG9iamVjdCkgewogICAgdHJ5IHsKICAgICAgaWYgKGlzVW5kZWZpbmVkKG9iamVjdCkpIHJldHVybiAndW5kZWZpbmVkJzsKICAgICAgaWYgKG9iamVjdCA9PT0gbnVsbCkgcmV0dXJuICdudWxsJzsKICAgICAgcmV0dXJuIG9iamVjdC5pbnNwZWN0ID8gb2JqZWN0Lmluc3BlY3QoKSA6IFN0cmluZyhvYmplY3QpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBpZiAoZSBpbnN0YW5jZW9mIFJhbmdlRXJyb3IpIHJldHVybiAnLi4uJzsKICAgICAgdGhyb3cgZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHRvSlNPTihvYmplY3QpIHsKICAgIHZhciB0eXBlID0gdHlwZW9mIG9iamVjdDsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICd1bmRlZmluZWQnOgogICAgICBjYXNlICdmdW5jdGlvbic6CiAgICAgIGNhc2UgJ3Vua25vd24nOiByZXR1cm47CiAgICAgIGNhc2UgJ2Jvb2xlYW4nOiByZXR1cm4gb2JqZWN0LnRvU3RyaW5nKCk7CiAgICB9CgoJaWYgKG9iamVjdCA9PT0gbnVsbCkgcmV0dXJuICdudWxsJzsKCWlmIChvYmplY3QudG9KU09OKSByZXR1cm4gb2JqZWN0LnRvSlNPTigpOwoJaWYgKGlzRWxlbWVudChvYmplY3QpKSByZXR1cm47CgogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGZvciAodmFyIHByb3BlcnR5IGluIG9iamVjdCkgewogICAgICB2YXIgdmFsdWUgPSB0b0pTT04ob2JqZWN0W3Byb3BlcnR5XSk7CiAgICAgIGlmICghaXNVbmRlZmluZWQodmFsdWUpKQogICAgICAgIHJlc3VsdHMucHVzaChwcm9wZXJ0eS50b0pTT04oKSArICc6ICcgKyB2YWx1ZSk7CiAgICB9CgogICAgcmV0dXJuICd7JyArIHJlc3VsdHMuam9pbignLCAnKSArICd9JzsKICB9CgogIGZ1bmN0aW9uIHRvUXVlcnlTdHJpbmcob2JqZWN0KSB7CiAgICByZXR1cm4gJEgob2JqZWN0KS50b1F1ZXJ5U3RyaW5nKCk7CiAgfQoKICBmdW5jdGlvbiB0b0hUTUwob2JqZWN0KSB7CiAgICByZXR1cm4gb2JqZWN0ICYmIG9iamVjdC50b0hUTUwgPyBvYmplY3QudG9IVE1MKCkgOiBTdHJpbmcuaW50ZXJwcmV0KG9iamVjdCk7CiAgfQoKICBmdW5jdGlvbiBrZXlzKG9iamVjdCkgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGZvciAodmFyIHByb3BlcnR5IGluIG9iamVjdCkKICAgICAgcmVzdWx0cy5wdXNoKHByb3BlcnR5KTsKICAgIHJldHVybiByZXN1bHRzOwogIH0KCiAgZnVuY3Rpb24gdmFsdWVzKG9iamVjdCkgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGZvciAodmFyIHByb3BlcnR5IGluIG9iamVjdCkKICAgICAgcmVzdWx0cy5wdXNoKG9iamVjdFtwcm9wZXJ0eV0pOwogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICBmdW5jdGlvbiBjbG9uZShvYmplY3QpIHsKICAgIHJldHVybiBleHRlbmQoeyB9LCBvYmplY3QpOwogIH0KCiAgZnVuY3Rpb24gaXNFbGVtZW50KG9iamVjdCkgewogICAgcmV0dXJuICEhKG9iamVjdCAmJiBvYmplY3Qubm9kZVR5cGUgPT0gMSk7CiAgfQoKICBmdW5jdGlvbiBpc0FycmF5KG9iamVjdCkgewoJaWYoSUUpCgkJaWYoX3RvU3RyaW5nLmNhbGwob2JqZWN0KSA9PSAiW29iamVjdCBBcnJheV0iKSByZXR1cm4gdHJ1ZTsKCQllbHNlIGlmKGlzX2FycmF5KG9iamVjdCkpIHJldHVybiB0cnVlOwoJCWVsc2UgcmV0dXJuIGZhbHNlOwoJZWxzZQoJCXJldHVybiBfdG9TdHJpbmcuY2FsbChvYmplY3QpID09ICJbb2JqZWN0IEFycmF5XSI7CiAgfQoKCiAgZnVuY3Rpb24gaXNIYXNoKG9iamVjdCkgewogICAgcmV0dXJuIG9iamVjdCBpbnN0YW5jZW9mIEhhc2g7CiAgfQoKICBmdW5jdGlvbiBpc0Z1bmN0aW9uKG9iamVjdCkgewogICAgcmV0dXJuIHR5cGVvZiBvYmplY3QgPT09ICJmdW5jdGlvbiI7CiAgfQoKICBmdW5jdGlvbiBpc1N0cmluZyhvYmplY3QpIHsKICAgIHJldHVybiBfdG9TdHJpbmcuY2FsbChvYmplY3QpID09ICJbb2JqZWN0IFN0cmluZ10iOwogIH0KCiAgZnVuY3Rpb24gaXNOdW1iZXIob2JqZWN0KSB7CiAgICByZXR1cm4gX3RvU3RyaW5nLmNhbGwob2JqZWN0KSA9PSAiW29iamVjdCBOdW1iZXJdIjsKICB9CgogIGZ1bmN0aW9uIGlzVW5kZWZpbmVkKG9iamVjdCkgewogICAgcmV0dXJuIHR5cGVvZiBvYmplY3QgPT09ICJ1bmRlZmluZWQiOwogIH0KCiAgZXh0ZW5kKE9iamVjdCwgewogICAgZXh0ZW5kOiAgICAgICAgZXh0ZW5kLAogICAgaW5zcGVjdDogICAgICAgaW5zcGVjdCwKICAgIHRvSlNPTjogICAgICAgIHRvSlNPTiwKICAgIHRvUXVlcnlTdHJpbmc6IHRvUXVlcnlTdHJpbmcsCiAgICB0b0hUTUw6ICAgICAgICB0b0hUTUwsCiAgICBrZXlzOiAgICAgICAgICBrZXlzLAogICAgdmFsdWVzOiAgICAgICAgdmFsdWVzLAogICAgY2xvbmU6ICAgICAgICAgY2xvbmUsCiAgICBpc0VsZW1lbnQ6ICAgICBpc0VsZW1lbnQsCiAgICBpc0FycmF5OiAgICAgICBpc0FycmF5LAogICAgaXNIYXNoOiAgICAgICAgaXNIYXNoLAogICAgaXNGdW5jdGlvbjogICAgaXNGdW5jdGlvbiwKICAgIGlzU3RyaW5nOiAgICAgIGlzU3RyaW5nLAogICAgaXNOdW1iZXI6ICAgICAgaXNOdW1iZXIsCiAgICBpc1VuZGVmaW5lZDogICBpc1VuZGVmaW5lZAogIH0pOwp9KSgpOwpPYmplY3QuZXh0ZW5kKEZ1bmN0aW9uLnByb3RvdHlwZSwgKGZ1bmN0aW9uKCkgewogIHZhciBzbGljZSA9IEFycmF5LnByb3RvdHlwZS5zbGljZTsKCiAgZnVuY3Rpb24gdXBkYXRlKGFycmF5LCBhcmdzKSB7CiAgICB2YXIgYXJyYXlMZW5ndGggPSBhcnJheS5sZW5ndGgsIGxlbmd0aCA9IGFyZ3MubGVuZ3RoOwogICAgd2hpbGUgKGxlbmd0aC0tKSBhcnJheVthcnJheUxlbmd0aCArIGxlbmd0aF0gPSBhcmdzW2xlbmd0aF07CiAgICByZXR1cm4gYXJyYXk7CiAgfQoKICBmdW5jdGlvbiBtZXJnZShhcnJheSwgYXJncykgewogICAgYXJyYXkgPSBzbGljZS5jYWxsKGFycmF5LCAwKTsKICAgIHJldHVybiB1cGRhdGUoYXJyYXksIGFyZ3MpOwogIH0KCiAgZnVuY3Rpb24gYXJndW1lbnROYW1lcygpIHsKICAgIHZhciBuYW1lcyA9IHRoaXMudG9TdHJpbmcoKS5tYXRjaCgvXltcc1woXSpmdW5jdGlvblteKF0qXCgoW14pXSopXCkvKVsxXQogICAgICAucmVwbGFjZSgvXC9cLy4qP1tcclxuXXxcL1wqKD86LnxbXHJcbl0pKj9cKlwvL2csICcnKQogICAgICAucmVwbGFjZSgvXHMrL2csICcnKS5zcGxpdCgnLCcpOwogICAgcmV0dXJuIG5hbWVzLmxlbmd0aCA9PSAxICYmICFuYW1lc1swXSA/IFtdIDogbmFtZXM7CiAgfQoKICBmdW5jdGlvbiBiaW5kKGNvbnRleHQpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMiAmJiBPYmplY3QuaXNVbmRlZmluZWQoYXJndW1lbnRzWzBdKSkgcmV0dXJuIHRoaXM7CiAgICB2YXIgX19tZXRob2QgPSB0aGlzLCBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgYSA9IG1lcmdlKGFyZ3MsIGFyZ3VtZW50cyk7CiAgICAgIHJldHVybiBfX21ldGhvZC5hcHBseShjb250ZXh0LCBhKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGJpbmRBc0V2ZW50TGlzdGVuZXIoY29udGV4dCkgewogICAgdmFyIF9fbWV0aG9kID0gdGhpcywgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHJldHVybiBmdW5jdGlvbihldmVudCkgewogICAgICB2YXIgYSA9IHVwZGF0ZShbZXZlbnQgfHwgd2luZG93LmV2ZW50XSwgYXJncyk7CiAgICAgIHJldHVybiBfX21ldGhvZC5hcHBseShjb250ZXh0LCBhKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGN1cnJ5KCkgewogICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gdGhpczsKICAgIHZhciBfX21ldGhvZCA9IHRoaXMsIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhID0gbWVyZ2UoYXJncywgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIF9fbWV0aG9kLmFwcGx5KHRoaXMsIGEpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZGVsYXkodGltZW91dCkgewogICAgdmFyIF9fbWV0aG9kID0gdGhpcywgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHRpbWVvdXQgPSB0aW1lb3V0ICogMTAwMAogICAgcmV0dXJuIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gX19tZXRob2QuYXBwbHkoX19tZXRob2QsIGFyZ3MpOwogICAgfSwgdGltZW91dCk7CiAgfQoKICBmdW5jdGlvbiBkZWZlcigpIHsKICAgIHZhciBhcmdzID0gdXBkYXRlKFswLjAxXSwgYXJndW1lbnRzKTsKICAgIHJldHVybiB0aGlzLmRlbGF5LmFwcGx5KHRoaXMsIGFyZ3MpOwogIH0KCiAgZnVuY3Rpb24gd3JhcCh3cmFwcGVyKSB7CiAgICB2YXIgX19tZXRob2QgPSB0aGlzOwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgYSA9IHVwZGF0ZShbX19tZXRob2QuYmluZCh0aGlzKV0sIGFyZ3VtZW50cyk7CiAgICAgIHJldHVybiB3cmFwcGVyLmFwcGx5KHRoaXMsIGEpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gbWV0aG9kaXplKCkgewogICAgaWYgKHRoaXMuX21ldGhvZGl6ZWQpIHJldHVybiB0aGlzLl9tZXRob2RpemVkOwogICAgdmFyIF9fbWV0aG9kID0gdGhpczsKICAgIHJldHVybiB0aGlzLl9tZXRob2RpemVkID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBhID0gdXBkYXRlKFt0aGlzXSwgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIF9fbWV0aG9kLmFwcGx5KG51bGwsIGEpOwogICAgfTsKICB9CgogIHJldHVybiB7CiAgICBhcmd1bWVudE5hbWVzOiAgICAgICBhcmd1bWVudE5hbWVzLAogICAgYmluZDogICAgICAgICAgICAgICAgYmluZCwKICAgIGJpbmRBc0V2ZW50TGlzdGVuZXI6IGJpbmRBc0V2ZW50TGlzdGVuZXIsCiAgICBjdXJyeTogICAgICAgICAgICAgICBjdXJyeSwKICAgIGRlbGF5OiAgICAgICAgICAgICAgIGRlbGF5LAogICAgZGVmZXI6ICAgICAgICAgICAgICAgZGVmZXIsCiAgICB3cmFwOiAgICAgICAgICAgICAgICB3cmFwLAogICAgbWV0aG9kaXplOiAgICAgICAgICAgbWV0aG9kaXplCiAgfQp9KSgpKTsKCgpEYXRlLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbigpIHsKICByZXR1cm4gJyInICsgdGhpcy5nZXRVVENGdWxsWWVhcigpICsgJy0nICsKICAgICh0aGlzLmdldFVUQ01vbnRoKCkgKyAxKS50b1BhZGRlZFN0cmluZygyKSArICctJyArCiAgICB0aGlzLmdldFVUQ0RhdGUoKS50b1BhZGRlZFN0cmluZygyKSArICdUJyArCiAgICB0aGlzLmdldFVUQ0hvdXJzKCkudG9QYWRkZWRTdHJpbmcoMikgKyAnOicgKwogICAgdGhpcy5nZXRVVENNaW51dGVzKCkudG9QYWRkZWRTdHJpbmcoMikgKyAnOicgKwogICAgdGhpcy5nZXRVVENTZWNvbmRzKCkudG9QYWRkZWRTdHJpbmcoMikgKyAnWiInOwp9OwoKClJlZ0V4cC5wcm90b3R5cGUubWF0Y2ggPSBSZWdFeHAucHJvdG90eXBlLnRlc3Q7CgpSZWdFeHAuZXNjYXBlID0gZnVuY3Rpb24oc3RyKSB7CiAgcmV0dXJuIFN0cmluZyhzdHIpLnJlcGxhY2UoLyhbLiorP149IToke30oKXxbXF1cL1xcXSkvZywgJ1xcJDEnKTsKfTsKdmFyIFBlcmlvZGljYWxFeGVjdXRlciA9IENsYXNzLmNyZWF0ZSh7CiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oY2FsbGJhY2ssIGZyZXF1ZW5jeSkgewogICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrOwogICAgdGhpcy5mcmVxdWVuY3kgPSBmcmVxdWVuY3k7CiAgICB0aGlzLmN1cnJlbnRseUV4ZWN1dGluZyA9IGZhbHNlOwoKICAgIHRoaXMucmVnaXN0ZXJDYWxsYmFjaygpOwogIH0sCgogIHJlZ2lzdGVyQ2FsbGJhY2s6IGZ1bmN0aW9uKCkgewogICAgdGhpcy50aW1lciA9IHNldEludGVydmFsKHRoaXMub25UaW1lckV2ZW50LmJpbmQodGhpcyksIHRoaXMuZnJlcXVlbmN5ICogMTAwMCk7CiAgfSwKCiAgZXhlY3V0ZTogZnVuY3Rpb24oKSB7CiAgICB0aGlzLmNhbGxiYWNrKHRoaXMpOwogIH0sCgogIHN0b3A6IGZ1bmN0aW9uKCkgewogICAgaWYgKCF0aGlzLnRpbWVyKSByZXR1cm47CiAgICBjbGVhckludGVydmFsKHRoaXMudGltZXIpOwogICAgdGhpcy50aW1lciA9IG51bGw7CiAgfSwKCiAgb25UaW1lckV2ZW50OiBmdW5jdGlvbigpIHsKICAgIGlmICghdGhpcy5jdXJyZW50bHlFeGVjdXRpbmcpIHsKICAgICAgdHJ5IHsKICAgICAgICB0aGlzLmN1cnJlbnRseUV4ZWN1dGluZyA9IHRydWU7CiAgICAgICAgdGhpcy5leGVjdXRlKCk7CiAgICAgICAgdGhpcy5jdXJyZW50bHlFeGVjdXRpbmcgPSBmYWxzZTsKICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAgdGhpcy5jdXJyZW50bHlFeGVjdXRpbmcgPSBmYWxzZTsKICAgICAgICB0aHJvdyBlOwogICAgICB9CiAgICB9CiAgfQp9KTsKT2JqZWN0LmV4dGVuZChTdHJpbmcsIHsKICBpbnRlcnByZXQ6IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/ICcnIDogU3RyaW5nKHZhbHVlKTsKICB9LAogIHNwZWNpYWxDaGFyOiB7CiAgICAnXGInOiAnXFxiJywKICAgICdcdCc6ICdcXHQnLAogICAgJ1xuJzogJ1xcbicsCiAgICAnXGYnOiAnXFxmJywKICAgICdccic6ICdcXHInLAogICAgJ1xcJzogJ1xcXFwnCiAgfQp9KTsKCk9iamVjdC5leHRlbmQoU3RyaW5nLnByb3RvdHlwZSwgKGZ1bmN0aW9uKCkgewoKICBmdW5jdGlvbiBwcmVwYXJlUmVwbGFjZW1lbnQocmVwbGFjZW1lbnQpIHsKICAgIGlmIChPYmplY3QuaXNGdW5jdGlvbihyZXBsYWNlbWVudCkpIHJldHVybiByZXBsYWNlbWVudDsKICAgIHZhciB0ZW1wbGF0ZSA9IG5ldyBUZW1wbGF0ZShyZXBsYWNlbWVudCk7CiAgICByZXR1cm4gZnVuY3Rpb24obWF0Y2gpIHsgcmV0dXJuIHRlbXBsYXRlLmV2YWx1YXRlKG1hdGNoKSB9OwogIH0KCiAgZnVuY3Rpb24gZ3N1YihwYXR0ZXJuLCByZXBsYWNlbWVudCkgewogICAgdmFyIHJlc3VsdCA9ICcnLCBzb3VyY2UgPSB0aGlzLCBtYXRjaDsKICAgIHJlcGxhY2VtZW50ID0gcHJlcGFyZVJlcGxhY2VtZW50KHJlcGxhY2VtZW50KTsKCiAgICBpZiAoT2JqZWN0LmlzU3RyaW5nKHBhdHRlcm4pKQogICAgICBwYXR0ZXJuID0gUmVnRXhwLmVzY2FwZShwYXR0ZXJuKTsKCiAgICBpZiAoIShwYXR0ZXJuLmxlbmd0aCB8fCBwYXR0ZXJuLnNvdXJjZSkpIHsKICAgICAgcmVwbGFjZW1lbnQgPSByZXBsYWNlbWVudCgnJyk7CiAgICAgIHJldHVybiByZXBsYWNlbWVudCArIHNvdXJjZS5zcGxpdCgnJykuam9pbihyZXBsYWNlbWVudCkgKyByZXBsYWNlbWVudDsKICAgIH0KCiAgICB3aGlsZSAoc291cmNlLmxlbmd0aCA+IDApIHsKICAgICAgaWYgKG1hdGNoID0gc291cmNlLm1hdGNoKHBhdHRlcm4pKSB7CiAgICAgICAgcmVzdWx0ICs9IHNvdXJjZS5zbGljZSgwLCBtYXRjaC5pbmRleCk7CiAgICAgICAgcmVzdWx0ICs9IFN0cmluZy5pbnRlcnByZXQocmVwbGFjZW1lbnQobWF0Y2gpKTsKICAgICAgICBzb3VyY2UgID0gc291cmNlLnNsaWNlKG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXN1bHQgKz0gc291cmNlLCBzb3VyY2UgPSAnJzsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIGZ1bmN0aW9uIHN1YihwYXR0ZXJuLCByZXBsYWNlbWVudCwgY291bnQpIHsKICAgIHJlcGxhY2VtZW50ID0gcHJlcGFyZVJlcGxhY2VtZW50KHJlcGxhY2VtZW50KTsKICAgIGNvdW50ID0gT2JqZWN0LmlzVW5kZWZpbmVkKGNvdW50KSA/IDEgOiBjb3VudDsKCiAgICByZXR1cm4gdGhpcy5nc3ViKHBhdHRlcm4sIGZ1bmN0aW9uKG1hdGNoKSB7CiAgICAgIGlmICgtLWNvdW50IDwgMCkgcmV0dXJuIG1hdGNoWzBdOwogICAgICByZXR1cm4gcmVwbGFjZW1lbnQobWF0Y2gpOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBzY2FuKHBhdHRlcm4sIGl0ZXJhdG9yKSB7CiAgICB0aGlzLmdzdWIocGF0dGVybiwgaXRlcmF0b3IpOwogICAgcmV0dXJuIFN0cmluZyh0aGlzKTsKICB9CgogIGZ1bmN0aW9uIHRydW5jYXRlKGxlbmd0aCwgdHJ1bmNhdGlvbikgewogICAgbGVuZ3RoID0gbGVuZ3RoIHx8IDMwOwogICAgdHJ1bmNhdGlvbiA9IE9iamVjdC5pc1VuZGVmaW5lZCh0cnVuY2F0aW9uKSA/ICcuLi4nIDogdHJ1bmNhdGlvbjsKICAgIHJldHVybiB0aGlzLmxlbmd0aCA+IGxlbmd0aCA/CiAgICAgIHRoaXMuc2xpY2UoMCwgbGVuZ3RoIC0gdHJ1bmNhdGlvbi5sZW5ndGgpICsgdHJ1bmNhdGlvbiA6IFN0cmluZyh0aGlzKTsKICB9CgogIGZ1bmN0aW9uIHN0cmlwKCkgewogICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvXlxzKy8sICcnKS5yZXBsYWNlKC9ccyskLywgJycpOwogIH0KCiAgZnVuY3Rpb24gc3RyaXBUYWdzKCkgewogICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvPFx3KyhccysoIlteIl0qInwnW14nXSonfFtePl0pKyk/Pnw8XC9cdys+L2dpLCAnJyk7CiAgfQoKICBmdW5jdGlvbiBzdHJpcFNjcmlwdHMoKSB7CiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKG5ldyBSZWdFeHAoUHJvdG90eXBlLlNjcmlwdEZyYWdtZW50LCAnaW1nJyksICcnKTsKICB9CgogIGZ1bmN0aW9uIGV4dHJhY3RTY3JpcHRzKCkgewogICAgdmFyIG1hdGNoQWxsID0gbmV3IFJlZ0V4cChQcm90b3R5cGUuU2NyaXB0RnJhZ21lbnQsICdpbWcnKTsKICAgIHZhciBtYXRjaE9uZSA9IG5ldyBSZWdFeHAoUHJvdG90eXBlLlNjcmlwdEZyYWdtZW50LCAnaW0nKTsKICAgIHJldHVybiAodGhpcy5tYXRjaChtYXRjaEFsbCkgfHwgW10pLm1hcChmdW5jdGlvbihzY3JpcHRUYWcpIHsKICAgICAgcmV0dXJuIChzY3JpcHRUYWcubWF0Y2gobWF0Y2hPbmUpIHx8IFsnJywgJyddKVsxXTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gZXZhbFNjcmlwdHMoKSB7CiAgICByZXR1cm4gdGhpcy5leHRyYWN0U2NyaXB0cygpLm1hcChmdW5jdGlvbihzY3JpcHQpIHsgcmV0dXJuIGV2YWwoc2NyaXB0KSB9KTsKICB9CgogIGZ1bmN0aW9uIGVzY2FwZUhUTUwoKSB7CiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC8mL2csJyZhbXA7JykucmVwbGFjZSgvPC9nLCcmbHQ7JykucmVwbGFjZSgvPi9nLCcmZ3Q7JykucmVwbGFjZSgvXCIvZywnJnF1b3Q7JykucmVwbGFjZSgvXCcvZywnJmFwb3M7Jyk7CiAgfQoKICBmdW5jdGlvbiB1bmVzY2FwZUhUTUwoKSB7CiAgICByZXR1cm4gdGhpcy5zdHJpcFRhZ3MoKS5yZXBsYWNlKC8mbHQ7L2csJzwnKS5yZXBsYWNlKC8mZ3Q7L2csJz4nKS5yZXBsYWNlKC8mYW1wOy9nLCcmJykucmVwbGFjZSgvJnF1b3Q7L2csJyInKS5yZXBsYWNlKC8mYXBvczsvZywnXCcnKTsKICB9CgoKICBmdW5jdGlvbiB0b1F1ZXJ5UGFyYW1zKHNlcGFyYXRvcikgewogICAgdmFyIG1hdGNoID0gdGhpcy5zdHJpcCgpLm1hdGNoKC8oW14/I10qKSgjLiopPyQvKTsKICAgIGlmICghbWF0Y2gpIHJldHVybiB7IH07CgogICAgcmV0dXJuIG1hdGNoWzFdLnNwbGl0KHNlcGFyYXRvciB8fCAnJicpLmluamVjdCh7IH0sIGZ1bmN0aW9uKGhhc2gsIHBhaXIpIHsKICAgICAgaWYgKChwYWlyID0gcGFpci5zcGxpdCgnPScpKVswXSkgewogICAgICAgIHZhciBrZXkgPSBkZWNvZGVVUklDb21wb25lbnQocGFpci5zaGlmdCgpKTsKICAgICAgICB2YXIgdmFsdWUgPSBwYWlyLmxlbmd0aCA+IDEgPyBwYWlyLmpvaW4oJz0nKSA6IHBhaXJbMF07CiAgICAgICAgaWYgKHZhbHVlICE9IHVuZGVmaW5lZCkgdmFsdWUgPSBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpOwoKICAgICAgICBpZiAoa2V5IGluIGhhc2gpIHsKICAgICAgICAgIGlmICghT2JqZWN0LmlzQXJyYXkoaGFzaFtrZXldKSkgaGFzaFtrZXldID0gW2hhc2hba2V5XV07CiAgICAgICAgICBoYXNoW2tleV0ucHVzaCh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaGFzaFtrZXldID0gdmFsdWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGhhc2g7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHRvQXJyYXkoKSB7CiAgICByZXR1cm4gdGhpcy5zcGxpdCgnJyk7CiAgfQoKICBmdW5jdGlvbiBzdWNjKCkgewogICAgcmV0dXJuIHRoaXMuc2xpY2UoMCwgdGhpcy5sZW5ndGggLSAxKSArCiAgICAgIFN0cmluZy5mcm9tQ2hhckNvZGUodGhpcy5jaGFyQ29kZUF0KHRoaXMubGVuZ3RoIC0gMSkgKyAxKTsKICB9CgogIGZ1bmN0aW9uIHRpbWVzKGNvdW50KSB7CiAgICByZXR1cm4gY291bnQgPCAxID8gJycgOiBuZXcgQXJyYXkoY291bnQgKyAxKS5qb2luKHRoaXMpOwogIH0KCiAgZnVuY3Rpb24gY2FtZWxpemUoKSB7CiAgICB2YXIgcGFydHMgPSB0aGlzLnNwbGl0KCctJyksIGxlbiA9IHBhcnRzLmxlbmd0aDsKICAgIGlmIChsZW4gPT0gMSkgcmV0dXJuIHBhcnRzWzBdOwoKICAgIHZhciBjYW1lbGl6ZWQgPSB0aGlzLmNoYXJBdCgwKSA9PSAnLScKICAgICAgPyBwYXJ0c1swXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHBhcnRzWzBdLnN1YnN0cmluZygxKQogICAgICA6IHBhcnRzWzBdOwoKICAgIGZvciAodmFyIGkgPSAxOyBpIDwgbGVuOyBpKyspCiAgICAgIGNhbWVsaXplZCArPSBwYXJ0c1tpXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHBhcnRzW2ldLnN1YnN0cmluZygxKTsKCiAgICByZXR1cm4gY2FtZWxpemVkOwogIH0KCiAgZnVuY3Rpb24gY2FwaXRhbGl6ZSgpIHsKICAgIHJldHVybiB0aGlzLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdGhpcy5zdWJzdHJpbmcoMSkudG9Mb3dlckNhc2UoKTsKICB9CgogIGZ1bmN0aW9uIHVuZGVyc2NvcmUoKSB7CiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKC86Oi9nLCAnLycpCiAgICAgICAgICAgICAgIC5yZXBsYWNlKC8oW0EtWl0rKShbQS1aXVthLXpdKS9nLCAnJDFfJDInKQogICAgICAgICAgICAgICAucmVwbGFjZSgvKFthLXpcZF0pKFtBLVpdKS9nLCAnJDFfJDInKQogICAgICAgICAgICAgICAucmVwbGFjZSgvLS9nLCAnXycpCiAgICAgICAgICAgICAgIC50b0xvd2VyQ2FzZSgpOwogIH0KCiAgZnVuY3Rpb24gZGFzaGVyaXplKCkgewogICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvXy9nLCAnLScpOwogIH0KCiAgZnVuY3Rpb24gaW5zcGVjdCh1c2VEb3VibGVRdW90ZXMpIHsKICAgIHZhciBlc2NhcGVkU3RyaW5nID0gdGhpcy5yZXBsYWNlKC9bXHgwMC1ceDFmXFxdL2csIGZ1bmN0aW9uKGNoYXJhY3RlcikgewogICAgICBpZiAoY2hhcmFjdGVyIGluIFN0cmluZy5zcGVjaWFsQ2hhcikgewogICAgICAgIHJldHVybiBTdHJpbmcuc3BlY2lhbENoYXJbY2hhcmFjdGVyXTsKICAgICAgfQogICAgICByZXR1cm4gJ1xcdTAwJyArIGNoYXJhY3Rlci5jaGFyQ29kZUF0KCkudG9QYWRkZWRTdHJpbmcoMiwgMTYpOwogICAgfSk7CiAgICBpZiAodXNlRG91YmxlUXVvdGVzKSByZXR1cm4gJyInICsgZXNjYXBlZFN0cmluZy5yZXBsYWNlKC8iL2csICdcXCInKSArICciJzsKICAgIHJldHVybiAiJyIgKyBlc2NhcGVkU3RyaW5nLnJlcGxhY2UoLycvZywgJ1xcXCcnKSArICInIjsKICB9CgogIGZ1bmN0aW9uIHRvSlNPTigpIHsKICAgIHJldHVybiB0aGlzLmluc3BlY3QodHJ1ZSk7CiAgfQoKICBmdW5jdGlvbiB1bmZpbHRlckpTT04oZmlsdGVyKSB7CiAgICByZXR1cm4gdGhpcy5yZXBsYWNlKGZpbHRlciB8fCBQcm90b3R5cGUuSlNPTkZpbHRlciwgJyQxJyk7CiAgfQoKICBmdW5jdGlvbiBpc0pTT04oKSB7CiAgICB2YXIgc3RyID0gdGhpczsKICAgIGlmIChzdHIuYmxhbmsoKSkgcmV0dXJuIGZhbHNlOwogICAgc3RyID0gdGhpcy5yZXBsYWNlKC9cXC4vZywgJ0AnKS5yZXBsYWNlKC8iW14iXFxcblxyXSoiL2csICcnKTsKICAgIHJldHVybiAoL15bLDp7fVxbXF0wLTkuXC0rRWFlZmxuci11IFxuXHJcdF0qJC8pLnRlc3Qoc3RyKTsKICB9CgogIGZ1bmN0aW9uIGV2YWxKU09OKHNhbml0aXplKSB7CiAgICB2YXIganNvbiA9IHRoaXMudW5maWx0ZXJKU09OKCk7CiAgICB0cnkgewogICAgICBpZiAoIXNhbml0aXplIHx8IGpzb24uaXNKU09OKCkpIHJldHVybiBldmFsKCcoJyArIGpzb24gKyAnKScpOwogICAgfSBjYXRjaCAoZSkgeyB9CiAgICB0aHJvdyBuZXcgU3ludGF4RXJyb3IoJ0JhZGx5IGZvcm1lZCBKU09OIHN0cmluZzogJyArIHRoaXMuaW5zcGVjdCgpKTsKICB9CgogIGZ1bmN0aW9uIGluY2x1ZGUocGF0dGVybikgewogICAgcmV0dXJuIHRoaXMuaW5kZXhPZihwYXR0ZXJuKSA+IC0xOwogIH0KCiAgZnVuY3Rpb24gc3RhcnRzV2l0aChwYXR0ZXJuKSB7CiAgICByZXR1cm4gdGhpcy5pbmRleE9mKHBhdHRlcm4pID09PSAwOwogIH0KCiAgZnVuY3Rpb24gZW5kc1dpdGgocGF0dGVybikgewogICAgdmFyIGQgPSB0aGlzLmxlbmd0aCAtIHBhdHRlcm4ubGVuZ3RoOwogICAgcmV0dXJuIGQgPj0gMCAmJiB0aGlzLmxhc3RJbmRleE9mKHBhdHRlcm4pID09PSBkOwogIH0KCiAgZnVuY3Rpb24gZW1wdHkoKSB7CiAgICByZXR1cm4gdGhpcyA9PSAnJzsKICB9CgogIGZ1bmN0aW9uIGJsYW5rKCkgewogICAgcmV0dXJuIC9eXHMqJC8udGVzdCh0aGlzKTsKICB9CgogIGZ1bmN0aW9uIGludGVycG9sYXRlKG9iamVjdCwgcGF0dGVybikgewogICAgcmV0dXJuIG5ldyBUZW1wbGF0ZSh0aGlzLCBwYXR0ZXJuKS5ldmFsdWF0ZShvYmplY3QpOwogIH0KCiAgcmV0dXJuIHsKICAgIGdzdWI6ICAgICAgICAgICBnc3ViLAogICAgc3ViOiAgICAgICAgICAgIHN1YiwKICAgIHNjYW46ICAgICAgICAgICBzY2FuLAogICAgdHJ1bmNhdGU6ICAgICAgIHRydW5jYXRlLAogICAgc3RyaXA6ICAgICAgICAgIFN0cmluZy5wcm90b3R5cGUudHJpbSA/IFN0cmluZy5wcm90b3R5cGUudHJpbSA6IHN0cmlwLAogICAgc3RyaXBUYWdzOiAgICAgIHN0cmlwVGFncywKICAgIHN0cmlwU2NyaXB0czogICBzdHJpcFNjcmlwdHMsCiAgICBleHRyYWN0U2NyaXB0czogZXh0cmFjdFNjcmlwdHMsCiAgICBldmFsU2NyaXB0czogICAgZXZhbFNjcmlwdHMsCiAgICBlc2NhcGVIVE1MOiAgICAgZXNjYXBlSFRNTCwKICAgIHVuZXNjYXBlSFRNTDogICB1bmVzY2FwZUhUTUwsCiAgICB0b1F1ZXJ5UGFyYW1zOiAgdG9RdWVyeVBhcmFtcywKICAgIHBhcnNlUXVlcnk6ICAgICB0b1F1ZXJ5UGFyYW1zLAogICAgdG9BcnJheTogICAgICAgIHRvQXJyYXksCiAgICBzdWNjOiAgICAgICAgICAgc3VjYywKICAgIHRpbWVzOiAgICAgICAgICB0aW1lcywKICAgIGNhbWVsaXplOiAgICAgICBjYW1lbGl6ZSwKICAgIGNhcGl0YWxpemU6ICAgICBjYXBpdGFsaXplLAogICAgdW5kZXJzY29yZTogICAgIHVuZGVyc2NvcmUsCiAgICBkYXNoZXJpemU6ICAgICAgZGFzaGVyaXplLAogICAgaW5zcGVjdDogICAgICAgIGluc3BlY3QsCiAgICB0b0pTT046ICAgICAgICAgdG9KU09OLAogICAgdW5maWx0ZXJKU09OOiAgIHVuZmlsdGVySlNPTiwKICAgIGlzSlNPTjogICAgICAgICBpc0pTT04sCiAgICBldmFsSlNPTjogICAgICAgZXZhbEpTT04sCiAgICBpbmNsdWRlOiAgICAgICAgaW5jbHVkZSwKICAgIHN0YXJ0c1dpdGg6ICAgICBzdGFydHNXaXRoLAogICAgZW5kc1dpdGg6ICAgICAgIGVuZHNXaXRoLAogICAgZW1wdHk6ICAgICAgICAgIGVtcHR5LAogICAgYmxhbms6ICAgICAgICAgIGJsYW5rLAogICAgaW50ZXJwb2xhdGU6ICAgIGludGVycG9sYXRlCiAgfTsKfSkoKSk7Cgp2YXIgVGVtcGxhdGUgPSBDbGFzcy5jcmVhdGUoewogIGluaXRpYWxpemU6IGZ1bmN0aW9uKHRlbXBsYXRlLCBwYXR0ZXJuKSB7CiAgICB0aGlzLnRlbXBsYXRlID0gdGVtcGxhdGUudG9TdHJpbmcoKTsKICAgIHRoaXMucGF0dGVybiA9IHBhdHRlcm4gfHwgVGVtcGxhdGUuUGF0dGVybjsKICB9LAoKICBldmFsdWF0ZTogZnVuY3Rpb24ob2JqZWN0KSB7CiAgICBpZiAob2JqZWN0ICYmIE9iamVjdC5pc0Z1bmN0aW9uKG9iamVjdC50b1RlbXBsYXRlUmVwbGFjZW1lbnRzKSkKICAgICAgb2JqZWN0ID0gb2JqZWN0LnRvVGVtcGxhdGVSZXBsYWNlbWVudHMoKTsKCiAgICByZXR1cm4gdGhpcy50ZW1wbGF0ZS5nc3ViKHRoaXMucGF0dGVybiwgZnVuY3Rpb24obWF0Y2gpIHsKICAgICAgaWYgKG9iamVjdCA9PSBudWxsKSByZXR1cm4gKG1hdGNoWzFdICsgJycpOwoKICAgICAgdmFyIGJlZm9yZSA9IG1hdGNoWzFdIHx8ICcnOwogICAgICBpZiAoYmVmb3JlID09ICdcXCcpIHJldHVybiBtYXRjaFsyXTsKCiAgICAgIHZhciBjdHggPSBvYmplY3QsIGV4cHIgPSBtYXRjaFszXTsKCgkgIHZhciBjdHggPSBvYmplY3QsIGV4cHIgPSBtYXRjaFszXSwgbm90RXNjSFRNTCA9IGV4cHIuc3RhcnRzV2l0aCgnKicpOwoJICBpZihub3RFc2NIVE1MKSBleHByID0gZXhwci5zdWJzdHJpbmcoMSk7CgogICAgICB2YXIgcGF0dGVybiA9IC9eKFteLltdK3xcWygoPzouKj9bXlxcXSk/KVxdKShcLnxcW3wkKS87CiAgICAgIG1hdGNoID0gcGF0dGVybi5leGVjKGV4cHIpOwogICAgICBpZiAobWF0Y2ggPT0gbnVsbCkgcmV0dXJuIGJlZm9yZTsKCiAgICAgIHdoaWxlIChtYXRjaCAhPSBudWxsKSB7CiAgICAgICAgdmFyIGNvbXAgPSBtYXRjaFsxXS5zdGFydHNXaXRoKCdbJykgPyBtYXRjaFsyXS5yZXBsYWNlKC9cXFxcXS9nLCAnXScpIDogbWF0Y2hbMV07CiAgICAgICAgY3R4ID0gY3R4W2NvbXBdOwogICAgICAgIGlmIChudWxsID09IGN0eCB8fCAnJyA9PSBtYXRjaFszXSkgYnJlYWs7CiAgICAgICAgZXhwciA9IGV4cHIuc3Vic3RyaW5nKCdbJyA9PSBtYXRjaFszXSA/IG1hdGNoWzFdLmxlbmd0aCA6IG1hdGNoWzBdLmxlbmd0aCk7CiAgICAgICAgbWF0Y2ggPSBwYXR0ZXJuLmV4ZWMoZXhwcik7CiAgICAgIH0KCgkgIGN0eCA9IFN0cmluZy5pbnRlcnByZXQoY3R4KTsKCSAgcmV0dXJuIGJlZm9yZSArIChub3RFc2NIVE1MID8gY3R4IDogY3R4LmVzY2FwZUhUTUwoKSk7CiAgICB9KTsKICB9Cn0pOwpUZW1wbGF0ZS5QYXR0ZXJuID0gLyhefC58XHJ8XG4pKCNceyguKj8pXH0pLzsKCnZhciAkYnJlYWsgPSB7IH07Cgp2YXIgRW51bWVyYWJsZSA9IChmdW5jdGlvbigpIHsKICBmdW5jdGlvbiBlYWNoKGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICB2YXIgaW5kZXggPSAwOwogICAgdHJ5IHsKICAgICAgdGhpcy5fZWFjaChmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4KyspOwogICAgICB9KTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaWYgKGUgIT0gJGJyZWFrKSB0aHJvdyBlOwogICAgfQogICAgcmV0dXJuIHRoaXM7CiAgfQoKICBmdW5jdGlvbiBlYWNoU2xpY2UobnVtYmVyLCBpdGVyYXRvciwgY29udGV4dCkgewogICAgdmFyIGluZGV4ID0gLW51bWJlciwgc2xpY2VzID0gW10sIGFycmF5ID0gdGhpcy50b0FycmF5KCk7CiAgICBpZiAobnVtYmVyIDwgMSkgcmV0dXJuIGFycmF5OwogICAgd2hpbGUgKChpbmRleCArPSBudW1iZXIpIDwgYXJyYXkubGVuZ3RoKQogICAgICBzbGljZXMucHVzaChhcnJheS5zbGljZShpbmRleCwgaW5kZXgrbnVtYmVyKSk7CiAgICByZXR1cm4gc2xpY2VzLmNvbGxlY3QoaXRlcmF0b3IsIGNvbnRleHQpOwogIH0KCiAgZnVuY3Rpb24gYWxsKGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpdGVyYXRvciA9IGl0ZXJhdG9yIHx8IFByb3RvdHlwZS5LOwogICAgdmFyIHJlc3VsdCA9IHRydWU7CiAgICB0aGlzLmVhY2goZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7CiAgICAgIHJlc3VsdCA9IHJlc3VsdCAmJiAhIWl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4KTsKICAgICAgaWYgKCFyZXN1bHQpIHRocm93ICRicmVhazsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIGZ1bmN0aW9uIGFueShpdGVyYXRvciwgY29udGV4dCkgewogICAgaXRlcmF0b3IgPSBpdGVyYXRvciB8fCBQcm90b3R5cGUuSzsKICAgIHZhciByZXN1bHQgPSBmYWxzZTsKICAgIHRoaXMuZWFjaChmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHsKICAgICAgaWYgKHJlc3VsdCA9ICEhaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgpKQogICAgICAgIHRocm93ICRicmVhazsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIGZ1bmN0aW9uIGNvbGxlY3QoaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGl0ZXJhdG9yID0gaXRlcmF0b3IgfHwgUHJvdG90eXBlLks7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgewogICAgICByZXN1bHRzLnB1c2goaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgpKTsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICBmdW5jdGlvbiBkZXRlY3QoaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIHZhciByZXN1bHQgPSBudWxsOwogICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgewogICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgpKSB7CiAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgdGhyb3cgJGJyZWFrOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICBmdW5jdGlvbiBmaW5kQWxsKGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgewogICAgICBpZiAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgpKQogICAgICAgIHJlc3VsdHMucHVzaCh2YWx1ZSk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHRzOwogIH0KCiAgZnVuY3Rpb24gZ3JlcChmaWx0ZXIsIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpdGVyYXRvciA9IGl0ZXJhdG9yIHx8IFByb3RvdHlwZS5LOwogICAgdmFyIHJlc3VsdHMgPSBbXTsKCiAgICBpZiAoT2JqZWN0LmlzU3RyaW5nKGZpbHRlcikpCiAgICAgIGZpbHRlciA9IG5ldyBSZWdFeHAoUmVnRXhwLmVzY2FwZShmaWx0ZXIpKTsKCiAgICB0aGlzLmVhY2goZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7CiAgICAgIGlmIChmaWx0ZXIubWF0Y2godmFsdWUpKQogICAgICAgIHJlc3VsdHMucHVzaChpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCkpOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0czsKICB9CgogIGZ1bmN0aW9uIGluY2x1ZGUob2JqZWN0KSB7CiAgICBpZiAoT2JqZWN0LmlzRnVuY3Rpb24odGhpcy5pbmRleE9mKSkKICAgICAgaWYgKHRoaXMuaW5kZXhPZihvYmplY3QpICE9IC0xKSByZXR1cm4gdHJ1ZTsKCiAgICB2YXIgZm91bmQgPSBmYWxzZTsKICAgIHRoaXMuZWFjaChmdW5jdGlvbih2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT0gb2JqZWN0KSB7CiAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIHRocm93ICRicmVhazsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gZm91bmQ7CiAgfQoKICBmdW5jdGlvbiBpbkdyb3Vwc09mKG51bWJlciwgZmlsbFdpdGgpIHsKICAgIGZpbGxXaXRoID0gT2JqZWN0LmlzVW5kZWZpbmVkKGZpbGxXaXRoKSA/IG51bGwgOiBmaWxsV2l0aDsKICAgIHJldHVybiB0aGlzLmVhY2hTbGljZShudW1iZXIsIGZ1bmN0aW9uKHNsaWNlKSB7CiAgICAgIHdoaWxlKHNsaWNlLmxlbmd0aCA8IG51bWJlcikgc2xpY2UucHVzaChmaWxsV2l0aCk7CiAgICAgIHJldHVybiBzbGljZTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gaW5qZWN0KG1lbW8sIGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICB0aGlzLmVhY2goZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7CiAgICAgIG1lbW8gPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG1lbW8sIHZhbHVlLCBpbmRleCk7CiAgICB9KTsKICAgIHJldHVybiBtZW1vOwogIH0KCiAgZnVuY3Rpb24gaW52b2tlKG1ldGhvZCkgewogICAgdmFyIGFyZ3MgPSAkQShhcmd1bWVudHMpLnNsaWNlKDEpOwogICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHJldHVybiB2YWx1ZVttZXRob2RdLmFwcGx5KHZhbHVlLCBhcmdzKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gbWF4KGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpdGVyYXRvciA9IGl0ZXJhdG9yIHx8IFByb3RvdHlwZS5LOwogICAgdmFyIHJlc3VsdDsKICAgIHRoaXMuZWFjaChmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHsKICAgICAgdmFsdWUgPSBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCk7CiAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCB8fCB2YWx1ZSA+PSByZXN1bHQpCiAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICBmdW5jdGlvbiBtaW4oaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIGl0ZXJhdG9yID0gaXRlcmF0b3IgfHwgUHJvdG90eXBlLks7CiAgICB2YXIgcmVzdWx0OwogICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgewogICAgICB2YWx1ZSA9IGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4KTsKICAgICAgaWYgKHJlc3VsdCA9PSBudWxsIHx8IHZhbHVlIDwgcmVzdWx0KQogICAgICAgIHJlc3VsdCA9IHZhbHVlOwogICAgfSk7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgZnVuY3Rpb24gcGFydGl0aW9uKGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICBpdGVyYXRvciA9IGl0ZXJhdG9yIHx8IFByb3RvdHlwZS5LOwogICAgdmFyIHRydWVzID0gW10sIGZhbHNlcyA9IFtdOwogICAgdGhpcy5lYWNoKGZ1bmN0aW9uKHZhbHVlLCBpbmRleCkgewogICAgICAoaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgpID8KICAgICAgICB0cnVlcyA6IGZhbHNlcykucHVzaCh2YWx1ZSk7CiAgICB9KTsKICAgIHJldHVybiBbdHJ1ZXMsIGZhbHNlc107CiAgfQoKICBmdW5jdGlvbiBwbHVjayhwcm9wZXJ0eSkgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIHRoaXMuZWFjaChmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXN1bHRzLnB1c2godmFsdWVbcHJvcGVydHldKTsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICBmdW5jdGlvbiByZWplY3QoaXRlcmF0b3IsIGNvbnRleHQpIHsKICAgIHZhciByZXN1bHRzID0gW107CiAgICB0aGlzLmVhY2goZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7CiAgICAgIGlmICghaXRlcmF0b3IuY2FsbChjb250ZXh0LCB2YWx1ZSwgaW5kZXgpKQogICAgICAgIHJlc3VsdHMucHVzaCh2YWx1ZSk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHRzOwogIH0KCiAgZnVuY3Rpb24gc29ydEJ5KGl0ZXJhdG9yLCBjb250ZXh0KSB7CiAgICByZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgIGNyaXRlcmlhOiBpdGVyYXRvci5jYWxsKGNvbnRleHQsIHZhbHVlLCBpbmRleCkKICAgICAgfTsKICAgIH0pLnNvcnQoZnVuY3Rpb24obGVmdCwgcmlnaHQpIHsKICAgICAgdmFyIGEgPSBsZWZ0LmNyaXRlcmlhLCBiID0gcmlnaHQuY3JpdGVyaWE7CiAgICAgIHJldHVybiBhIDwgYiA/IC0xIDogYSA+IGIgPyAxIDogMDsKICAgIH0pLnBsdWNrKCd2YWx1ZScpOwogIH0KCiAgZnVuY3Rpb24gdG9BcnJheSgpIHsKICAgIHJldHVybiB0aGlzLm1hcCgpOwogIH0KCiAgZnVuY3Rpb24gemlwKCkgewogICAgdmFyIGl0ZXJhdG9yID0gUHJvdG90eXBlLkssIGFyZ3MgPSAkQShhcmd1bWVudHMpOwogICAgaWYgKE9iamVjdC5pc0Z1bmN0aW9uKGFyZ3MubGFzdCgpKSkKICAgICAgaXRlcmF0b3IgPSBhcmdzLnBvcCgpOwoKICAgIHZhciBjb2xsZWN0aW9ucyA9IFt0aGlzXS5jb25jYXQoYXJncykubWFwKCRBKTsKICAgIHJldHVybiB0aGlzLm1hcChmdW5jdGlvbih2YWx1ZSwgaW5kZXgpIHsKICAgICAgcmV0dXJuIGl0ZXJhdG9yKGNvbGxlY3Rpb25zLnBsdWNrKGluZGV4KSk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHNpemUoKSB7CiAgICByZXR1cm4gdGhpcy50b0FycmF5KCkubGVuZ3RoOwogIH0KCiAgZnVuY3Rpb24gaW5zcGVjdCgpIHsKICAgIHJldHVybiAnIzxFbnVtZXJhYmxlOicgKyB0aGlzLnRvQXJyYXkoKS5pbnNwZWN0KCkgKyAnPic7CiAgfQoKCgoKCgoKCgogIHJldHVybiB7CiAgICBlYWNoOiAgICAgICBlYWNoLAogICAgZWFjaFNsaWNlOiAgZWFjaFNsaWNlLAogICAgYWxsOiAgICAgICAgYWxsLAogICAgZXZlcnk6ICAgICAgYWxsLAogICAgYW55OiAgICAgICAgYW55LAogICAgc29tZTogICAgICAgYW55LAogICAgY29sbGVjdDogICAgY29sbGVjdCwKICAgIG1hcDogICAgICAgIGNvbGxlY3QsCiAgICBkZXRlY3Q6ICAgICBkZXRlY3QsCiAgICBmaW5kQWxsOiAgICBmaW5kQWxsLAogICAgc2VsZWN0OiAgICAgZmluZEFsbCwKICAgIGZpbHRlcjogICAgIGZpbmRBbGwsCiAgICBncmVwOiAgICAgICBncmVwLAogICAgaW5jbHVkZTogICAgaW5jbHVkZSwKICAgIG1lbWJlcjogICAgIGluY2x1ZGUsCiAgICBpbkdyb3Vwc09mOiBpbkdyb3Vwc09mLAogICAgaW5qZWN0OiAgICAgaW5qZWN0LAogICAgaW52b2tlOiAgICAgaW52b2tlLAogICAgbWF4OiAgICAgICAgbWF4LAogICAgbWluOiAgICAgICAgbWluLAogICAgcGFydGl0aW9uOiAgcGFydGl0aW9uLAogICAgcGx1Y2s6ICAgICAgcGx1Y2ssCiAgICByZWplY3Q6ICAgICByZWplY3QsCiAgICBzb3J0Qnk6ICAgICBzb3J0QnksCiAgICB0b0FycmF5OiAgICB0b0FycmF5LAogICAgZW50cmllczogICAgdG9BcnJheSwKICAgIHppcDogICAgICAgIHppcCwKICAgIHNpemU6ICAgICAgIHNpemUsCiAgICBpbnNwZWN0OiAgICBpbnNwZWN0LAogICAgZmluZDogICAgICAgZGV0ZWN0CiAgfTsKfSkoKTsKZnVuY3Rpb24gJEEoaXRlcmFibGUpIHsKICBpZiAoIWl0ZXJhYmxlKSByZXR1cm4gW107CiAgaWYgKCd0b0FycmF5JyBpbiBPYmplY3QoaXRlcmFibGUpKSByZXR1cm4gaXRlcmFibGUudG9BcnJheSgpOwogIHZhciBsZW5ndGggPSBpdGVyYWJsZS5sZW5ndGggfHwgMCwgcmVzdWx0cyA9IG5ldyBBcnJheShsZW5ndGgpOwogIHdoaWxlIChsZW5ndGgtLSkgcmVzdWx0c1tsZW5ndGhdID0gaXRlcmFibGVbbGVuZ3RoXTsKICByZXR1cm4gcmVzdWx0czsKfQoKZnVuY3Rpb24gJHcoc3RyaW5nKSB7CiAgaWYgKCFPYmplY3QuaXNTdHJpbmcoc3RyaW5nKSkgcmV0dXJuIFtdOwogIHN0cmluZyA9IHN0cmluZy5zdHJpcCgpOwogIHJldHVybiBzdHJpbmcgPyBzdHJpbmcuc3BsaXQoL1xzKy8pIDogW107Cn0KCkFycmF5LmZyb20gPSAkQTsKCgooZnVuY3Rpb24oKSB7CiAgdmFyIGFycmF5UHJvdG8gPSBBcnJheS5wcm90b3R5cGUsCiAgICAgIHNsaWNlID0gYXJyYXlQcm90by5zbGljZSwKICAgICAgX2VhY2ggPSBhcnJheVByb3RvLmZvckVhY2g7IC8vIHVzZSBuYXRpdmUgYnJvd3NlciBKUyAxLjYgaW1wbGVtZW50YXRpb24gaWYgYXZhaWxhYmxlCgogIGZ1bmN0aW9uIGVhY2goaXRlcmF0b3IpIHsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSB0aGlzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKQogICAgICBpdGVyYXRvcih0aGlzW2ldKTsKICB9CiAgaWYgKCFfZWFjaCkgX2VhY2ggPSBlYWNoOwoKICBmdW5jdGlvbiBjbGVhcigpIHsKICAgIHRoaXMubGVuZ3RoID0gMDsKICAgIHJldHVybiB0aGlzOwogIH0KCiAgZnVuY3Rpb24gZmlyc3QoKSB7CiAgICByZXR1cm4gdGhpc1swXTsKICB9CgogIGZ1bmN0aW9uIGxhc3QoKSB7CiAgICByZXR1cm4gdGhpc1t0aGlzLmxlbmd0aCAtIDFdOwogIH0KCiAgZnVuY3Rpb24gY29tcGFjdCgpIHsKICAgIHJldHVybiB0aGlzLnNlbGVjdChmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gdmFsdWUgIT0gbnVsbDsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gZmxhdHRlbigpIHsKICAgIHJldHVybiB0aGlzLmluamVjdChbXSwgZnVuY3Rpb24oYXJyYXksIHZhbHVlKSB7CiAgICAgIGlmIChPYmplY3QuaXNBcnJheSh2YWx1ZSkpCiAgICAgICAgcmV0dXJuIGFycmF5LmNvbmNhdCh2YWx1ZS5mbGF0dGVuKCkpOwogICAgICBhcnJheS5wdXNoKHZhbHVlKTsKICAgICAgcmV0dXJuIGFycmF5OwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiB3aXRob3V0KCkgewogICAgdmFyIHZhbHVlcyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsKICAgIHJldHVybiB0aGlzLnNlbGVjdChmdW5jdGlvbih2YWx1ZSkgewogICAgICByZXR1cm4gIXZhbHVlcy5pbmNsdWRlKHZhbHVlKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gcmV2ZXJzZShpbmxpbmUpIHsKICAgIHJldHVybiAoaW5saW5lICE9PSBmYWxzZSA/IHRoaXMgOiB0aGlzLnRvQXJyYXkoKSkuX3JldmVyc2UoKTsKICB9CgogIGZ1bmN0aW9uIHVuaXEoc29ydGVkKSB7CiAgICByZXR1cm4gdGhpcy5pbmplY3QoW10sIGZ1bmN0aW9uKGFycmF5LCB2YWx1ZSwgaW5kZXgpIHsKICAgICAgaWYgKDAgPT0gaW5kZXggfHwgKHNvcnRlZCA/IGFycmF5Lmxhc3QoKSAhPSB2YWx1ZSA6ICFhcnJheS5pbmNsdWRlKHZhbHVlKSkpCiAgICAgICAgYXJyYXkucHVzaCh2YWx1ZSk7CiAgICAgIHJldHVybiBhcnJheTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gaW50ZXJzZWN0KGFycmF5KSB7CiAgICByZXR1cm4gdGhpcy51bmlxKCkuZmluZEFsbChmdW5jdGlvbihpdGVtKSB7CiAgICAgIHJldHVybiBhcnJheS5kZXRlY3QoZnVuY3Rpb24odmFsdWUpIHsgcmV0dXJuIGl0ZW0gPT09IHZhbHVlIH0pOwogICAgfSk7CiAgfQoKCiAgZnVuY3Rpb24gY2xvbmUoKSB7CiAgICByZXR1cm4gc2xpY2UuY2FsbCh0aGlzLCAwKTsKICB9CgogIGZ1bmN0aW9uIHNpemUoKSB7CiAgICByZXR1cm4gdGhpcy5sZW5ndGg7CiAgfQoKICBmdW5jdGlvbiBpbnNwZWN0KCkgewogICAgcmV0dXJuICdbJyArIHRoaXMubWFwKE9iamVjdC5pbnNwZWN0KS5qb2luKCcsICcpICsgJ10nOwogIH0KCiAgZnVuY3Rpb24gdG9KU09OKCkgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIHRoaXMuZWFjaChmdW5jdGlvbihvYmplY3QpIHsKICAgICAgdmFyIHZhbHVlID0gT2JqZWN0LnRvSlNPTihvYmplY3QpOwogICAgICBpZiAoIU9iamVjdC5pc1VuZGVmaW5lZCh2YWx1ZSkpIHJlc3VsdHMucHVzaCh2YWx1ZSk7CiAgICB9KTsKICAgIHJldHVybiAnWycgKyByZXN1bHRzLmpvaW4oJywgJykgKyAnXSc7CiAgfQoKICBmdW5jdGlvbiBpbmRleE9mKGl0ZW0sIGkpIHsKICAgIGkgfHwgKGkgPSAwKTsKICAgIHZhciBsZW5ndGggPSB0aGlzLmxlbmd0aDsKICAgIGlmIChpIDwgMCkgaSA9IGxlbmd0aCArIGk7CiAgICBmb3IgKDsgaSA8IGxlbmd0aDsgaSsrKQogICAgICBpZiAodGhpc1tpXSA9PT0gaXRlbSkgcmV0dXJuIGk7CiAgICByZXR1cm4gLTE7CiAgfQoKICBmdW5jdGlvbiBsYXN0SW5kZXhPZihpdGVtLCBpKSB7CiAgICBpID0gaXNOYU4oaSkgPyB0aGlzLmxlbmd0aCA6IChpIDwgMCA/IHRoaXMubGVuZ3RoICsgaSA6IGkpICsgMTsKICAgIHZhciBuID0gdGhpcy5zbGljZSgwLCBpKS5yZXZlcnNlKCkuaW5kZXhPZihpdGVtKTsKICAgIHJldHVybiAobiA8IDApID8gbiA6IGkgLSBuIC0gMTsKICB9CgogIGZ1bmN0aW9uIGNvbmNhdCgpIHsKICAgIHZhciBhcnJheSA9IHNsaWNlLmNhbGwodGhpcywgMCksIGl0ZW07CiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIGl0ZW0gPSBhcmd1bWVudHNbaV07CiAgICAgIGlmIChPYmplY3QuaXNBcnJheShpdGVtKSAmJiAhKCdjYWxsZWUnIGluIGl0ZW0pKSB7CiAgICAgICAgZm9yICh2YXIgaiA9IDAsIGFycmF5TGVuZ3RoID0gaXRlbS5sZW5ndGg7IGogPCBhcnJheUxlbmd0aDsgaisrKQogICAgICAgICAgYXJyYXkucHVzaChpdGVtW2pdKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhcnJheS5wdXNoKGl0ZW0pOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gYXJyYXk7CiAgfQoKICBPYmplY3QuZXh0ZW5kKGFycmF5UHJvdG8sIEVudW1lcmFibGUpOwoKICBpZiAoIWFycmF5UHJvdG8uX3JldmVyc2UpCiAgICBhcnJheVByb3RvLl9yZXZlcnNlID0gYXJyYXlQcm90by5yZXZlcnNlOwoKICBPYmplY3QuZXh0ZW5kKGFycmF5UHJvdG8sIHsKICAgIF9lYWNoOiAgICAgX2VhY2gsCiAgICBjbGVhcjogICAgIGNsZWFyLAogICAgZmlyc3Q6ICAgICBmaXJzdCwKICAgIGxhc3Q6ICAgICAgbGFzdCwKICAgIGNvbXBhY3Q6ICAgY29tcGFjdCwKICAgIGZsYXR0ZW46ICAgZmxhdHRlbiwKICAgIHdpdGhvdXQ6ICAgd2l0aG91dCwKICAgIHJldmVyc2U6ICAgcmV2ZXJzZSwKICAgIHVuaXE6ICAgICAgdW5pcSwKICAgIGludGVyc2VjdDogaW50ZXJzZWN0LAogICAgY2xvbmU6ICAgICBjbG9uZSwKICAgIHRvQXJyYXk6ICAgY2xvbmUsCiAgICBzaXplOiAgICAgIHNpemUsCiAgICBpbnNwZWN0OiAgIGluc3BlY3QsCiAgICB0b0pTT046ICAgIHRvSlNPTgogIH0pOwoKICB2YXIgQ09OQ0FUX0FSR1VNRU5UU19CVUdHWSA9IChmdW5jdGlvbigpIHsKICAgIHJldHVybiBbXS5jb25jYXQoYXJndW1lbnRzKVswXVswXSAhPT0gMTsKICB9KSgxLDIpCgogIGlmIChDT05DQVRfQVJHVU1FTlRTX0JVR0dZKSBhcnJheVByb3RvLmNvbmNhdCA9IGNvbmNhdDsKCiAgaWYgKCFhcnJheVByb3RvLmluZGV4T2YpIGFycmF5UHJvdG8uaW5kZXhPZiA9IGluZGV4T2Y7CiAgaWYgKCFhcnJheVByb3RvLmxhc3RJbmRleE9mKSBhcnJheVByb3RvLmxhc3RJbmRleE9mID0gbGFzdEluZGV4T2Y7Cn0pKCk7CmZ1bmN0aW9uICRIKG9iamVjdCkgewogIHJldHVybiBuZXcgSGFzaChvYmplY3QpOwp9OwoKdmFyIEhhc2ggPSBDbGFzcy5jcmVhdGUoRW51bWVyYWJsZSwgKGZ1bmN0aW9uKCkgewogIGZ1bmN0aW9uIGluaXRpYWxpemUob2JqZWN0KSB7CiAgICB0aGlzLl9vYmplY3QgPSBPYmplY3QuaXNIYXNoKG9iamVjdCkgPyBvYmplY3QudG9PYmplY3QoKSA6IE9iamVjdC5jbG9uZShvYmplY3QpOwogIH0KCiAgZnVuY3Rpb24gX2VhY2goaXRlcmF0b3IpIHsKICAgIGZvciAodmFyIGtleSBpbiB0aGlzLl9vYmplY3QpIHsKICAgICAgdmFyIHZhbHVlID0gdGhpcy5fb2JqZWN0W2tleV0sIHBhaXIgPSBba2V5LCB2YWx1ZV07CiAgICAgIHBhaXIua2V5ID0ga2V5OwogICAgICBwYWlyLnZhbHVlID0gdmFsdWU7CiAgICAgIGl0ZXJhdG9yKHBhaXIpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gc2V0KGtleSwgdmFsdWUpIHsKICAgIHJldHVybiB0aGlzLl9vYmplY3Rba2V5XSA9IHZhbHVlOwogIH0KCiAgZnVuY3Rpb24gZ2V0KGtleSkgewogICAgaWYgKHRoaXMuX29iamVjdFtrZXldICE9PSBPYmplY3QucHJvdG90eXBlW2tleV0pCiAgICAgIHJldHVybiB0aGlzLl9vYmplY3Rba2V5XTsKICB9CgogIGZ1bmN0aW9uIHVuc2V0KGtleSkgewogICAgdmFyIHZhbHVlID0gdGhpcy5fb2JqZWN0W2tleV07CiAgICBkZWxldGUgdGhpcy5fb2JqZWN0W2tleV07CiAgICByZXR1cm4gdmFsdWU7CiAgfQoKICBmdW5jdGlvbiB0b09iamVjdCgpIHsKICAgIHJldHVybiBPYmplY3QuY2xvbmUodGhpcy5fb2JqZWN0KTsKICB9CgogIGZ1bmN0aW9uIGtleXMoKSB7CiAgICByZXR1cm4gdGhpcy5wbHVjaygna2V5Jyk7CiAgfQoKICBmdW5jdGlvbiB2YWx1ZXMoKSB7CiAgICByZXR1cm4gdGhpcy5wbHVjaygndmFsdWUnKTsKICB9CgogIGZ1bmN0aW9uIGluZGV4KHZhbHVlKSB7CiAgICB2YXIgbWF0Y2ggPSB0aGlzLmRldGVjdChmdW5jdGlvbihwYWlyKSB7CiAgICAgIHJldHVybiBwYWlyLnZhbHVlID09PSB2YWx1ZTsKICAgIH0pOwogICAgcmV0dXJuIG1hdGNoICYmIG1hdGNoLmtleTsKICB9CgogIGZ1bmN0aW9uIG1lcmdlKG9iamVjdCkgewogICAgcmV0dXJuIHRoaXMuY2xvbmUoKS51cGRhdGUob2JqZWN0KTsKICB9CgogIGZ1bmN0aW9uIHVwZGF0ZShvYmplY3QpIHsKICAgIHJldHVybiBuZXcgSGFzaChvYmplY3QpLmluamVjdCh0aGlzLCBmdW5jdGlvbihyZXN1bHQsIHBhaXIpIHsKICAgICAgcmVzdWx0LnNldChwYWlyLmtleSwgcGFpci52YWx1ZSk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHRvUXVlcnlQYWlyKGtleSwgdmFsdWUpIHsKICAgIGlmIChPYmplY3QuaXNVbmRlZmluZWQodmFsdWUpKSByZXR1cm4ga2V5OwogICAgcmV0dXJuIGtleSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudChTdHJpbmcuaW50ZXJwcmV0KHZhbHVlKSk7CiAgfQoKICBmdW5jdGlvbiB0b1F1ZXJ5U3RyaW5nKCkgewogICAgcmV0dXJuIHRoaXMuaW5qZWN0KFtdLCBmdW5jdGlvbihyZXN1bHRzLCBwYWlyKSB7CiAgICAgIHZhciBrZXkgPSBlbmNvZGVVUklDb21wb25lbnQocGFpci5rZXkpLCB2YWx1ZXMgPSBwYWlyLnZhbHVlOwoKICAgICAgaWYgKHZhbHVlcyAmJiB0eXBlb2YgdmFsdWVzID09ICdvYmplY3QnKSB7CiAgICAgICAgaWYgKE9iamVjdC5pc0FycmF5KHZhbHVlcykpCiAgICAgICAgICByZXR1cm4gcmVzdWx0cy5jb25jYXQodmFsdWVzLm1hcCh0b1F1ZXJ5UGFpci5jdXJyeShrZXkpKS5qb2luKCcmJykpOwogICAgICB9IGVsc2UgcmVzdWx0cy5wdXNoKHRvUXVlcnlQYWlyKGtleSwgdmFsdWVzKSk7CiAgICAgIHJldHVybiByZXN1bHRzOwogICAgfSkuam9pbignJicpOwogIH0KCiAgZnVuY3Rpb24gaW5zcGVjdCgpIHsKICAgIHJldHVybiAnIzxIYXNoOnsnICsgdGhpcy5tYXAoZnVuY3Rpb24ocGFpcikgewogICAgICByZXR1cm4gcGFpci5tYXAoT2JqZWN0Lmluc3BlY3QpLmpvaW4oJzogJyk7CiAgICB9KS5qb2luKCcsICcpICsgJ30+JzsKICB9CgogIGZ1bmN0aW9uIHRvSlNPTigpIHsKICAgIHJldHVybiBPYmplY3QudG9KU09OKHRoaXMudG9PYmplY3QoKSk7CiAgfQoKICBmdW5jdGlvbiBjbG9uZSgpIHsKICAgIHJldHVybiBuZXcgSGFzaCh0aGlzKTsKICB9CgogIHJldHVybiB7CiAgICBpbml0aWFsaXplOiAgICAgICAgICAgICBpbml0aWFsaXplLAogICAgX2VhY2g6ICAgICAgICAgICAgICAgICAgX2VhY2gsCiAgICBzZXQ6ICAgICAgICAgICAgICAgICAgICBzZXQsCiAgICBnZXQ6ICAgICAgICAgICAgICAgICAgICBnZXQsCiAgICB1bnNldDogICAgICAgICAgICAgICAgICB1bnNldCwKICAgIHRvT2JqZWN0OiAgICAgICAgICAgICAgIHRvT2JqZWN0LAogICAgdG9UZW1wbGF0ZVJlcGxhY2VtZW50czogdG9PYmplY3QsCiAgICBrZXlzOiAgICAgICAgICAgICAgICAgICBrZXlzLAogICAgdmFsdWVzOiAgICAgICAgICAgICAgICAgdmFsdWVzLAogICAgaW5kZXg6ICAgICAgICAgICAgICAgICAgaW5kZXgsCiAgICBtZXJnZTogICAgICAgICAgICAgICAgICBtZXJnZSwKICAgIHVwZGF0ZTogICAgICAgICAgICAgICAgIHVwZGF0ZSwKICAgIHRvUXVlcnlTdHJpbmc6ICAgICAgICAgIHRvUXVlcnlTdHJpbmcsCiAgICBpbnNwZWN0OiAgICAgICAgICAgICAgICBpbnNwZWN0LAogICAgdG9KU09OOiAgICAgICAgICAgICAgICAgdG9KU09OLAogICAgY2xvbmU6ICAgICAgICAgICAgICAgICAgY2xvbmUKICB9Owp9KSgpKTsKCkhhc2guZnJvbSA9ICRIOwpPYmplY3QuZXh0ZW5kKE51bWJlci5wcm90b3R5cGUsIChmdW5jdGlvbigpIHsKICBmdW5jdGlvbiB0b0NvbG9yUGFydCgpIHsKICAgIHJldHVybiB0aGlzLnRvUGFkZGVkU3RyaW5nKDIsIDE2KTsKICB9CgogIGZ1bmN0aW9uIHN1Y2MoKSB7CiAgICByZXR1cm4gdGhpcyArIDE7CiAgfQoKICBmdW5jdGlvbiB0aW1lcyhpdGVyYXRvciwgY29udGV4dCkgewogICAgJFIoMCwgdGhpcywgdHJ1ZSkuZWFjaChpdGVyYXRvciwgY29udGV4dCk7CiAgICByZXR1cm4gdGhpczsKICB9CgogIGZ1bmN0aW9uIHRvUGFkZGVkU3RyaW5nKGxlbmd0aCwgcmFkaXgpIHsKICAgIHZhciBzdHJpbmcgPSB0aGlzLnRvU3RyaW5nKHJhZGl4IHx8IDEwKTsKICAgIHJldHVybiAnMCcudGltZXMobGVuZ3RoIC0gc3RyaW5nLmxlbmd0aCkgKyBzdHJpbmc7CiAgfQoKICBmdW5jdGlvbiB0b0pTT04oKSB7CiAgICByZXR1cm4gaXNGaW5pdGUodGhpcykgPyB0aGlzLnRvU3RyaW5nKCkgOiAnbnVsbCc7CiAgfQoKICBmdW5jdGlvbiBhYnMoKSB7CiAgICByZXR1cm4gTWF0aC5hYnModGhpcyk7CiAgfQoKICBmdW5jdGlvbiByb3VuZCgpIHsKICAgIHJldHVybiBNYXRoLnJvdW5kKHRoaXMpOwogIH0KCiAgZnVuY3Rpb24gY2VpbCgpIHsKICAgIHJldHVybiBNYXRoLmNlaWwodGhpcyk7CiAgfQoKICBmdW5jdGlvbiBmbG9vcigpIHsKICAgIHJldHVybiBNYXRoLmZsb29yKHRoaXMpOwogIH0KCiAgcmV0dXJuIHsKICAgIHRvQ29sb3JQYXJ0OiAgICB0b0NvbG9yUGFydCwKICAgIHN1Y2M6ICAgICAgICAgICBzdWNjLAogICAgdGltZXM6ICAgICAgICAgIHRpbWVzLAogICAgdG9QYWRkZWRTdHJpbmc6IHRvUGFkZGVkU3RyaW5nLAogICAgdG9KU09OOiAgICAgICAgIHRvSlNPTiwKICAgIGFiczogICAgICAgICAgICBhYnMsCiAgICByb3VuZDogICAgICAgICAgcm91bmQsCiAgICBjZWlsOiAgICAgICAgICAgY2VpbCwKICAgIGZsb29yOiAgICAgICAgICBmbG9vcgogIH07Cn0pKCkpOwoKZnVuY3Rpb24gJFIoc3RhcnQsIGVuZCwgZXhjbHVzaXZlKSB7CiAgcmV0dXJuIG5ldyBPYmplY3RSYW5nZShzdGFydCwgZW5kLCBleGNsdXNpdmUpOwp9Cgp2YXIgT2JqZWN0UmFuZ2UgPSBDbGFzcy5jcmVhdGUoRW51bWVyYWJsZSwgKGZ1bmN0aW9uKCkgewogIGZ1bmN0aW9uIGluaXRpYWxpemUoc3RhcnQsIGVuZCwgZXhjbHVzaXZlKSB7CiAgICB0aGlzLnN0YXJ0ID0gc3RhcnQ7CiAgICB0aGlzLmVuZCA9IGVuZDsKICAgIHRoaXMuZXhjbHVzaXZlID0gZXhjbHVzaXZlOwogIH0KCiAgZnVuY3Rpb24gX2VhY2goaXRlcmF0b3IpIHsKICAgIHZhciB2YWx1ZSA9IHRoaXMuc3RhcnQ7CiAgICB3aGlsZSAodGhpcy5pbmNsdWRlKHZhbHVlKSkgewogICAgICBpdGVyYXRvcih2YWx1ZSk7CiAgICAgIHZhbHVlID0gdmFsdWUuc3VjYygpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5jbHVkZSh2YWx1ZSkgewogICAgaWYgKHZhbHVlIDwgdGhpcy5zdGFydCkKICAgICAgcmV0dXJuIGZhbHNlOwogICAgaWYgKHRoaXMuZXhjbHVzaXZlKQogICAgICByZXR1cm4gdmFsdWUgPCB0aGlzLmVuZDsKICAgIHJldHVybiB2YWx1ZSA8PSB0aGlzLmVuZDsKICB9CgogIHJldHVybiB7CiAgICBpbml0aWFsaXplOiBpbml0aWFsaXplLAogICAgX2VhY2g6ICAgICAgX2VhY2gsCiAgICBpbmNsdWRlOiAgICBpbmNsdWRlCiAgfTsKfSkoKSk7CgoKCnZhciBBamF4ID0gewogIGdldFRyYW5zcG9ydDogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gVHJ5LnRoZXNlKAogICAgICBmdW5jdGlvbigpIHtyZXR1cm4gbmV3IFhNTEh0dHBSZXF1ZXN0KCl9LAogICAgICBmdW5jdGlvbigpIHtyZXR1cm4gbmV3IEFjdGl2ZVhPYmplY3QoJ01zeG1sMi5YTUxIVFRQJyl9LAogICAgICBmdW5jdGlvbigpIHtyZXR1cm4gbmV3IEFjdGl2ZVhPYmplY3QoJ01pY3Jvc29mdC5YTUxIVFRQJyl9CiAgICApIHx8IGZhbHNlOwogIH0sCgogIGFjdGl2ZVJlcXVlc3RDb3VudDogMAp9OwoKQWpheC5SZXNwb25kZXJzID0gewogIHJlc3BvbmRlcnM6IFtdLAoKICBfZWFjaDogZnVuY3Rpb24oaXRlcmF0b3IpIHsKICAgIHRoaXMucmVzcG9uZGVycy5fZWFjaChpdGVyYXRvcik7CiAgfSwKCiAgcmVnaXN0ZXI6IGZ1bmN0aW9uKHJlc3BvbmRlcikgewogICAgaWYgKCF0aGlzLmluY2x1ZGUocmVzcG9uZGVyKSkKICAgICAgdGhpcy5yZXNwb25kZXJzLnB1c2gocmVzcG9uZGVyKTsKICB9LAoKICB1bnJlZ2lzdGVyOiBmdW5jdGlvbihyZXNwb25kZXIpIHsKICAgIHRoaXMucmVzcG9uZGVycyA9IHRoaXMucmVzcG9uZGVycy53aXRob3V0KHJlc3BvbmRlcik7CiAgfSwKCiAgZGlzcGF0Y2g6IGZ1bmN0aW9uKGNhbGxiYWNrLCByZXF1ZXN0LCB0cmFuc3BvcnQsIGpzb24pIHsKICAgIHRoaXMuZWFjaChmdW5jdGlvbihyZXNwb25kZXIpIHsKICAgICAgaWYgKE9iamVjdC5pc0Z1bmN0aW9uKHJlc3BvbmRlcltjYWxsYmFja10pKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJlc3BvbmRlcltjYWxsYmFja10uYXBwbHkocmVzcG9uZGVyLCBbcmVxdWVzdCwgdHJhbnNwb3J0LCBqc29uXSk7CiAgICAgICAgfSBjYXRjaCAoZSkgeyB9CiAgICAgIH0KICAgIH0pOwogIH0KfTsKCk9iamVjdC5leHRlbmQoQWpheC5SZXNwb25kZXJzLCBFbnVtZXJhYmxlKTsKCkFqYXguUmVzcG9uZGVycy5yZWdpc3Rlcih7CiAgb25DcmVhdGU6ICAgZnVuY3Rpb24oKSB7IEFqYXguYWN0aXZlUmVxdWVzdENvdW50KysgfSwKICBvbkNvbXBsZXRlOiBmdW5jdGlvbigpIHsgQWpheC5hY3RpdmVSZXF1ZXN0Q291bnQtLSB9Cn0pOwpBamF4LkJhc2UgPSBDbGFzcy5jcmVhdGUoewogIGluaXRpYWxpemU6IGZ1bmN0aW9uKG9wdGlvbnMpIHsKICAgIHRoaXMub3B0aW9ucyA9IHsKICAgICAgbWV0aG9kOiAgICAgICAncG9zdCcsCiAgICAgIGFzeW5jaHJvbm91czogdHJ1ZSwKICAgICAgY29udGVudFR5cGU6ICAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJywKICAgICAgZW5jb2Rpbmc6ICAgICAnVVRGLTgnLAogICAgICBwYXJhbWV0ZXJzOiAgICcnLAogICAgICBldmFsSlNPTjogICAgIHRydWUsCiAgICAgIGV2YWxKUzogICAgICAgdHJ1ZQogICAgfTsKICAgIE9iamVjdC5leHRlbmQodGhpcy5vcHRpb25zLCBvcHRpb25zIHx8IHsgfSk7CgogICAgdGhpcy5vcHRpb25zLm1ldGhvZCA9IHRoaXMub3B0aW9ucy5tZXRob2QudG9Mb3dlckNhc2UoKTsKCiAgICBpZiAoT2JqZWN0LmlzU3RyaW5nKHRoaXMub3B0aW9ucy5wYXJhbWV0ZXJzKSkKICAgICAgdGhpcy5vcHRpb25zLnBhcmFtZXRlcnMgPSB0aGlzLm9wdGlvbnMucGFyYW1ldGVycy50b1F1ZXJ5UGFyYW1zKCk7CiAgICBlbHNlIGlmIChPYmplY3QuaXNIYXNoKHRoaXMub3B0aW9ucy5wYXJhbWV0ZXJzKSkKICAgICAgdGhpcy5vcHRpb25zLnBhcmFtZXRlcnMgPSB0aGlzLm9wdGlvbnMucGFyYW1ldGVycy50b09iamVjdCgpOwogIH0KfSk7CkFqYXguUmVxdWVzdCA9IENsYXNzLmNyZWF0ZShBamF4LkJhc2UsIHsKICBfY29tcGxldGU6IGZhbHNlLAoKICBpbml0aWFsaXplOiBmdW5jdGlvbigkc3VwZXIsIHVybCwgb3B0aW9ucykgewogICAgJHN1cGVyKG9wdGlvbnMpOwogICAgdGhpcy50cmFuc3BvcnQgPSBBamF4LmdldFRyYW5zcG9ydCgpOwogICAgdGhpcy5yZXF1ZXN0KHVybCk7CiAgfSwKCiAgcmVxdWVzdDogZnVuY3Rpb24odXJsKSB7CiAgICB0aGlzLnVybCA9IHVybDsKICAgIHRoaXMubWV0aG9kID0gdGhpcy5vcHRpb25zLm1ldGhvZDsKICAgIHZhciBwYXJhbXMgPSBPYmplY3QuY2xvbmUodGhpcy5vcHRpb25zLnBhcmFtZXRlcnMpOwoKICAgIGlmICghWydnZXQnLCAncG9zdCddLmluY2x1ZGUodGhpcy5tZXRob2QpKSB7CiAgICAgIHBhcmFtc1snX21ldGhvZCddID0gdGhpcy5tZXRob2Q7CiAgICAgIHRoaXMubWV0aG9kID0gJ3Bvc3QnOwogICAgfQoKICAgIHRoaXMucGFyYW1ldGVycyA9IHBhcmFtczsKCiAgICBpZiAocGFyYW1zID0gT2JqZWN0LnRvUXVlcnlTdHJpbmcocGFyYW1zKSkgewogICAgICBpZiAodGhpcy5tZXRob2QgPT0gJ2dldCcpCiAgICAgICAgdGhpcy51cmwgKz0gKHRoaXMudXJsLmluY2x1ZGUoJz8nKSA/ICcmJyA6ICc/JykgKyBwYXJhbXM7CiAgICAgIGVsc2UgaWYgKC9Lb25xdWVyb3J8U2FmYXJpfEtIVE1MLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKQogICAgICAgIHBhcmFtcyArPSAnJl89JzsKICAgIH0KCiAgICB0cnkgewogICAgICB2YXIgcmVzcG9uc2UgPSBuZXcgQWpheC5SZXNwb25zZSh0aGlzKTsKICAgICAgaWYgKHRoaXMub3B0aW9ucy5vbkNyZWF0ZSkgdGhpcy5vcHRpb25zLm9uQ3JlYXRlKHJlc3BvbnNlKTsKICAgICAgQWpheC5SZXNwb25kZXJzLmRpc3BhdGNoKCdvbkNyZWF0ZScsIHRoaXMsIHJlc3BvbnNlKTsKCiAgICAgIHRoaXMudHJhbnNwb3J0Lm9wZW4odGhpcy5tZXRob2QudG9VcHBlckNhc2UoKSwgdGhpcy51cmwsCiAgICAgICAgdGhpcy5vcHRpb25zLmFzeW5jaHJvbm91cyk7CgogICAgICBpZiAodGhpcy5vcHRpb25zLmFzeW5jaHJvbm91cykgdGhpcy5yZXNwb25kVG9SZWFkeVN0YXRlLmJpbmQodGhpcykuZGVmZXIoMSk7CgogICAgICB0aGlzLnRyYW5zcG9ydC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSB0aGlzLm9uU3RhdGVDaGFuZ2UuYmluZCh0aGlzKTsKICAgICAgdGhpcy5zZXRSZXF1ZXN0SGVhZGVycygpOwoKICAgICAgdGhpcy5ib2R5ID0gdGhpcy5tZXRob2QgPT0gJ3Bvc3QnID8gKHRoaXMub3B0aW9ucy5wb3N0Qm9keSB8fCBwYXJhbXMpIDogbnVsbDsKICAgICAgdGhpcy50cmFuc3BvcnQuc2VuZCh0aGlzLmJvZHkpOwoKICAgICAgLyogRm9yY2UgRmlyZWZveCB0byBoYW5kbGUgcmVhZHkgc3RhdGUgNCBmb3Igc3luY2hyb25vdXMgcmVxdWVzdHMgKi8KICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuYXN5bmNocm9ub3VzICYmIHRoaXMudHJhbnNwb3J0Lm92ZXJyaWRlTWltZVR5cGUpCiAgICAgICAgdGhpcy5vblN0YXRlQ2hhbmdlKCk7CgogICAgfQogICAgY2F0Y2ggKGUpIHsKICAgICAgdGhpcy5kaXNwYXRjaEV4Y2VwdGlvbihlKTsKICAgIH0KICB9LAoKICBvblN0YXRlQ2hhbmdlOiBmdW5jdGlvbigpIHsKICAgIHZhciByZWFkeVN0YXRlID0gdGhpcy50cmFuc3BvcnQucmVhZHlTdGF0ZTsKICAgIGlmIChyZWFkeVN0YXRlID4gMSAmJiAhKChyZWFkeVN0YXRlID09IDQpICYmIHRoaXMuX2NvbXBsZXRlKSkKICAgICAgdGhpcy5yZXNwb25kVG9SZWFkeVN0YXRlKHRoaXMudHJhbnNwb3J0LnJlYWR5U3RhdGUpOwogIH0sCgogIHNldFJlcXVlc3RIZWFkZXJzOiBmdW5jdGlvbigpIHsKICAgIHZhciBoZWFkZXJzID0gewogICAgICAnWC1SZXF1ZXN0ZWQtV2l0aCc6ICdYTUxIdHRwUmVxdWVzdCcsCiAgICAgICdYLVByb3RvdHlwZS1WZXJzaW9uJzogUHJvdG90eXBlLlZlcnNpb24sCiAgICAgICdBY2NlcHQnOiAndGV4dC9qYXZhc2NyaXB0LCB0ZXh0L2h0bWwsIGFwcGxpY2F0aW9uL3htbCwgdGV4dC94bWwsICovKicKICAgIH07CgogICAgaWYgKHRoaXMubWV0aG9kID09ICdwb3N0JykgewogICAgICBoZWFkZXJzWydDb250ZW50LXR5cGUnXSA9IHRoaXMub3B0aW9ucy5jb250ZW50VHlwZSArCiAgICAgICAgKHRoaXMub3B0aW9ucy5lbmNvZGluZyA/ICc7IGNoYXJzZXQ9JyArIHRoaXMub3B0aW9ucy5lbmNvZGluZyA6ICcnKTsKCiAgICAgIC8qIEZvcmNlICJDb25uZWN0aW9uOiBjbG9zZSIgZm9yIG9sZGVyIE1vemlsbGEgYnJvd3NlcnMgdG8gd29yawogICAgICAgKiBhcm91bmQgYSBidWcgd2hlcmUgWE1MSHR0cFJlcXVlc3Qgc2VuZHMgYW4gaW5jb3JyZWN0CiAgICAgICAqIENvbnRlbnQtbGVuZ3RoIGhlYWRlci4gU2VlIE1vemlsbGEgQnVnemlsbGEgIzI0NjY1MS4KICAgICAgICovCiAgICAgIGlmICh0aGlzLnRyYW5zcG9ydC5vdmVycmlkZU1pbWVUeXBlICYmCiAgICAgICAgICAobmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvR2Vja29cLyhcZHs0fSkvKSB8fCBbMCwyMDA1XSlbMV0gPCAyMDA1KQogICAgICAgICAgICBoZWFkZXJzWydDb25uZWN0aW9uJ10gPSAnY2xvc2UnOwogICAgfQoKICAgIGlmICh0eXBlb2YgdGhpcy5vcHRpb25zLnJlcXVlc3RIZWFkZXJzID09ICdvYmplY3QnKSB7CiAgICAgIHZhciBleHRyYXMgPSB0aGlzLm9wdGlvbnMucmVxdWVzdEhlYWRlcnM7CgogICAgICBpZiAoT2JqZWN0LmlzRnVuY3Rpb24oZXh0cmFzLnB1c2gpKQogICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBleHRyYXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpICs9IDIpCiAgICAgICAgICBoZWFkZXJzW2V4dHJhc1tpXV0gPSBleHRyYXNbaSsxXTsKICAgICAgZWxzZQogICAgICAgICRIKGV4dHJhcykuZWFjaChmdW5jdGlvbihwYWlyKSB7IGhlYWRlcnNbcGFpci5rZXldID0gcGFpci52YWx1ZSB9KTsKICAgIH0KCiAgICBmb3IgKHZhciBuYW1lIGluIGhlYWRlcnMpCiAgICAgIHRoaXMudHJhbnNwb3J0LnNldFJlcXVlc3RIZWFkZXIobmFtZSwgaGVhZGVyc1tuYW1lXSk7CiAgfSwKCiAgc3VjY2VzczogZnVuY3Rpb24oKSB7CiAgICB2YXIgc3RhdHVzID0gdGhpcy5nZXRTdGF0dXMoKTsKICAgIHJldHVybiAhc3RhdHVzIHx8IChzdGF0dXMgPj0gMjAwICYmIHN0YXR1cyA8IDMwMCk7CiAgfSwKCiAgZ2V0U3RhdHVzOiBmdW5jdGlvbigpIHsKICAgIHRyeSB7CiAgICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydC5zdGF0dXMgfHwgMDsKICAgIH0gY2F0Y2ggKGUpIHsgcmV0dXJuIDAgfQogIH0sCgogIHJlc3BvbmRUb1JlYWR5U3RhdGU6IGZ1bmN0aW9uKHJlYWR5U3RhdGUpIHsKICAgIHZhciBzdGF0ZSA9IEFqYXguUmVxdWVzdC5FdmVudHNbcmVhZHlTdGF0ZV0sIHJlc3BvbnNlID0gbmV3IEFqYXguUmVzcG9uc2UodGhpcyk7CiAgICBpZiAoc3RhdGUgPT0gJ0NvbXBsZXRlJykgewogICAgICB0cnkgewogICAgICAgIHRoaXMuX2NvbXBsZXRlID0gdHJ1ZTsKICAgICAgICAodGhpcy5vcHRpb25zWydvbicgKyByZXNwb25zZS5zdGF0dXNdCiAgICAgICAgIHx8IHRoaXMub3B0aW9uc1snb24nICsgKHRoaXMuc3VjY2VzcygpID8gJ1N1Y2Nlc3MnIDogJ0ZhaWx1cmUnKV0KICAgICAgICAgfHwgUHJvdG90eXBlLmVtcHR5RnVuY3Rpb24pKHJlc3BvbnNlLCByZXNwb25zZS5oZWFkZXJKU09OKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHRoaXMuZGlzcGF0Y2hFeGNlcHRpb24oZSk7CiAgICAgIH0KCiAgICAgIHZhciBjb250ZW50VHlwZSA9IHJlc3BvbnNlLmdldEhlYWRlcignQ29udGVudC10eXBlJyk7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMuZXZhbEpTID09ICdmb3JjZScKICAgICAgICAgIHx8ICh0aGlzLm9wdGlvbnMuZXZhbEpTICYmIHRoaXMuaXNTYW1lT3JpZ2luKCkgJiYgY29udGVudFR5cGUKICAgICAgICAgICYmIGNvbnRlbnRUeXBlLm1hdGNoKC9eXHMqKHRleHR8YXBwbGljYXRpb24pXC8oeC0pPyhqYXZhfGVjbWEpc2NyaXB0KDsuKik/XHMqJC9pKSkpCiAgICAgICAgdGhpcy5ldmFsUmVzcG9uc2UoKTsKICAgIH0KCiAgICB0cnkgewogICAgICAodGhpcy5vcHRpb25zWydvbicgKyBzdGF0ZV0gfHwgUHJvdG90eXBlLmVtcHR5RnVuY3Rpb24pKHJlc3BvbnNlLCByZXNwb25zZS5oZWFkZXJKU09OKTsKICAgICAgQWpheC5SZXNwb25kZXJzLmRpc3BhdGNoKCdvbicgKyBzdGF0ZSwgdGhpcywgcmVzcG9uc2UsIHJlc3BvbnNlLmhlYWRlckpTT04pOwogICAgfSBjYXRjaCAoZSkgewogICAgICB0aGlzLmRpc3BhdGNoRXhjZXB0aW9uKGUpOwogICAgfQoKICAgIGlmIChzdGF0ZSA9PSAnQ29tcGxldGUnKSB7CiAgICAgIHRoaXMudHJhbnNwb3J0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IFByb3RvdHlwZS5lbXB0eUZ1bmN0aW9uOwogICAgfQogIH0sCgogIGlzU2FtZU9yaWdpbjogZnVuY3Rpb24oKSB7CiAgICB2YXIgbSA9IHRoaXMudXJsLm1hdGNoKC9eXHMqaHR0cHM/OlwvXC9bXlwvXSovKTsKICAgIHJldHVybiAhbSB8fCAobVswXSA9PSAnI3twcm90b2NvbH0vLyN7ZG9tYWlufSN7cG9ydH0nLmludGVycG9sYXRlKHsKICAgICAgcHJvdG9jb2w6IGxvY2F0aW9uLnByb3RvY29sLAogICAgICBkb21haW46IGRvY3VtZW50LmRvbWFpbiwKICAgICAgcG9ydDogbG9jYXRpb24ucG9ydCA/ICc6JyArIGxvY2F0aW9uLnBvcnQgOiAnJwogICAgfSkpOwogIH0sCgogIGdldEhlYWRlcjogZnVuY3Rpb24obmFtZSkgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIHRoaXMudHJhbnNwb3J0LmdldFJlc3BvbnNlSGVhZGVyKG5hbWUpIHx8IG51bGw7CiAgICB9IGNhdGNoIChlKSB7IHJldHVybiBudWxsOyB9CiAgfSwKCiAgZXZhbFJlc3BvbnNlOiBmdW5jdGlvbigpIHsKICAgIHRyeSB7CiAgICAgIHJldHVybiBldmFsKCh0aGlzLnRyYW5zcG9ydC5yZXNwb25zZVRleHQgfHwgJycpLnVuZmlsdGVySlNPTigpKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgdGhpcy5kaXNwYXRjaEV4Y2VwdGlvbihlKTsKICAgIH0KICB9LAoKICBkaXNwYXRjaEV4Y2VwdGlvbjogZnVuY3Rpb24oZXhjZXB0aW9uKSB7CiAgICAodGhpcy5vcHRpb25zLm9uRXhjZXB0aW9uIHx8IFByb3RvdHlwZS5lbXB0eUZ1bmN0aW9uKSh0aGlzLCBleGNlcHRpb24pOwogICAgQWpheC5SZXNwb25kZXJzLmRpc3BhdGNoKCdvbkV4Y2VwdGlvbicsIHRoaXMsIGV4Y2VwdGlvbik7CiAgfQp9KTsKCkFqYXguUmVxdWVzdC5FdmVudHMgPQogIFsnVW5pbml0aWFsaXplZCcsICdMb2FkaW5nJywgJ0xvYWRlZCcsICdJbnRlcmFjdGl2ZScsICdDb21wbGV0ZSddOwoKCgoKCgoKCkFqYXguUmVzcG9uc2UgPSBDbGFzcy5jcmVhdGUoewogIGluaXRpYWxpemU6IGZ1bmN0aW9uKHJlcXVlc3QpewogICAgdGhpcy5yZXF1ZXN0ID0gcmVxdWVzdDsKICAgIHZhciB0cmFuc3BvcnQgID0gdGhpcy50cmFuc3BvcnQgID0gcmVxdWVzdC50cmFuc3BvcnQsCiAgICAgICAgcmVhZHlTdGF0ZSA9IHRoaXMucmVhZHlTdGF0ZSA9IHRyYW5zcG9ydC5yZWFkeVN0YXRlOwoKICAgIGlmKChyZWFkeVN0YXRlID4gMiAmJiAhUHJvdG90eXBlLkJyb3dzZXIuSUUpIHx8IHJlYWR5U3RhdGUgPT0gNCkgewogICAgICB0aGlzLnN0YXR1cyAgICAgICA9IHRoaXMuZ2V0U3RhdHVzKCk7CiAgICAgIHRoaXMuc3RhdHVzVGV4dCAgID0gdGhpcy5nZXRTdGF0dXNUZXh0KCk7CiAgICAgIHRoaXMucmVzcG9uc2VUZXh0ID0gU3RyaW5nLmludGVycHJldCh0cmFuc3BvcnQucmVzcG9uc2VUZXh0KTsKICAgICAgdGhpcy5oZWFkZXJKU09OICAgPSB0aGlzLl9nZXRIZWFkZXJKU09OKCk7CiAgICB9CgogICAgaWYocmVhZHlTdGF0ZSA9PSA0KSB7CiAgICAgIHZhciB4bWwgPSB0cmFuc3BvcnQucmVzcG9uc2VYTUw7CiAgICAgIHRoaXMucmVzcG9uc2VYTUwgID0gT2JqZWN0LmlzVW5kZWZpbmVkKHhtbCkgPyBudWxsIDogeG1sOwogICAgICB0aGlzLnJlc3BvbnNlSlNPTiA9IHRoaXMuX2dldFJlc3BvbnNlSlNPTigpOwogICAgfQogIH0sCgogIHN0YXR1czogICAgICAwLAoKICBzdGF0dXNUZXh0OiAnJywKCiAgZ2V0U3RhdHVzOiBBamF4LlJlcXVlc3QucHJvdG90eXBlLmdldFN0YXR1cywKCiAgZ2V0U3RhdHVzVGV4dDogZnVuY3Rpb24oKSB7CiAgICB0cnkgewogICAgICByZXR1cm4gdGhpcy50cmFuc3BvcnQuc3RhdHVzVGV4dCB8fCAnJzsKICAgIH0gY2F0Y2ggKGUpIHsgcmV0dXJuICcnIH0KICB9LAoKICBnZXRIZWFkZXI6IEFqYXguUmVxdWVzdC5wcm90b3R5cGUuZ2V0SGVhZGVyLAoKICBnZXRBbGxIZWFkZXJzOiBmdW5jdGlvbigpIHsKICAgIHRyeSB7CiAgICAgIHJldHVybiB0aGlzLmdldEFsbFJlc3BvbnNlSGVhZGVycygpOwogICAgfSBjYXRjaCAoZSkgeyByZXR1cm4gbnVsbCB9CiAgfSwKCiAgZ2V0UmVzcG9uc2VIZWFkZXI6IGZ1bmN0aW9uKG5hbWUpIHsKICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydC5nZXRSZXNwb25zZUhlYWRlcihuYW1lKTsKICB9LAoKICBnZXRBbGxSZXNwb25zZUhlYWRlcnM6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRoaXMudHJhbnNwb3J0LmdldEFsbFJlc3BvbnNlSGVhZGVycygpOwogIH0sCgogIF9nZXRIZWFkZXJKU09OOiBmdW5jdGlvbigpIHsKICAgIHZhciBqc29uID0gdGhpcy5nZXRIZWFkZXIoJ1gtSlNPTicpOwogICAgaWYgKCFqc29uKSByZXR1cm4gbnVsbDsKICAgIGpzb24gPSBkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKGpzb24pKTsKICAgIHRyeSB7CiAgICAgIHJldHVybiBqc29uLmV2YWxKU09OKHRoaXMucmVxdWVzdC5vcHRpb25zLnNhbml0aXplSlNPTiB8fAogICAgICAgICF0aGlzLnJlcXVlc3QuaXNTYW1lT3JpZ2luKCkpOwogICAgfSBjYXRjaCAoZSkgewogICAgICB0aGlzLnJlcXVlc3QuZGlzcGF0Y2hFeGNlcHRpb24oZSk7CiAgICB9CiAgfSwKCiAgX2dldFJlc3BvbnNlSlNPTjogZnVuY3Rpb24oKSB7CiAgICB2YXIgb3B0aW9ucyA9IHRoaXMucmVxdWVzdC5vcHRpb25zOwogICAgaWYgKCFvcHRpb25zLmV2YWxKU09OIHx8IChvcHRpb25zLmV2YWxKU09OICE9ICdmb3JjZScgJiYKICAgICAgISh0aGlzLmdldEhlYWRlcignQ29udGVudC10eXBlJykgfHwgJycpLmluY2x1ZGUoJ2FwcGxpY2F0aW9uL2pzb24nKSkgfHwKICAgICAgICB0aGlzLnJlc3BvbnNlVGV4dC5ibGFuaygpKQogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICB0cnkgewogICAgICByZXR1cm4gdGhpcy5yZXNwb25zZVRleHQuZXZhbEpTT04ob3B0aW9ucy5zYW5pdGl6ZUpTT04gfHwKICAgICAgICAhdGhpcy5yZXF1ZXN0LmlzU2FtZU9yaWdpbigpKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgdGhpcy5yZXF1ZXN0LmRpc3BhdGNoRXhjZXB0aW9uKGUpOwogICAgfQogIH0KfSk7CgpBamF4LlVwZGF0ZXIgPSBDbGFzcy5jcmVhdGUoQWpheC5SZXF1ZXN0LCB7CiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oJHN1cGVyLCBjb250YWluZXIsIHVybCwgb3B0aW9ucykgewogICAgdGhpcy5jb250YWluZXIgPSB7CiAgICAgIHN1Y2Nlc3M6IChjb250YWluZXIuc3VjY2VzcyB8fCBjb250YWluZXIpLAogICAgICBmYWlsdXJlOiAoY29udGFpbmVyLmZhaWx1cmUgfHwgKGNvbnRhaW5lci5zdWNjZXNzID8gbnVsbCA6IGNvbnRhaW5lcikpCiAgICB9OwoKICAgIG9wdGlvbnMgPSBPYmplY3QuY2xvbmUob3B0aW9ucyk7CiAgICB2YXIgb25Db21wbGV0ZSA9IG9wdGlvbnMub25Db21wbGV0ZTsKICAgIG9wdGlvbnMub25Db21wbGV0ZSA9IChmdW5jdGlvbihyZXNwb25zZSwganNvbikgewogICAgICB0aGlzLnVwZGF0ZUNvbnRlbnQocmVzcG9uc2UucmVzcG9uc2VUZXh0KTsKICAgICAgaWYgKE9iamVjdC5pc0Z1bmN0aW9uKG9uQ29tcGxldGUpKSBvbkNvbXBsZXRlKHJlc3BvbnNlLCBqc29uKTsKICAgIH0pLmJpbmQodGhpcyk7CgogICAgJHN1cGVyKHVybCwgb3B0aW9ucyk7CiAgfSwKCiAgdXBkYXRlQ29udGVudDogZnVuY3Rpb24ocmVzcG9uc2VUZXh0KSB7CiAgICB2YXIgcmVjZWl2ZXIgPSB0aGlzLmNvbnRhaW5lclt0aGlzLnN1Y2Nlc3MoKSA/ICdzdWNjZXNzJyA6ICdmYWlsdXJlJ10sCiAgICAgICAgb3B0aW9ucyA9IHRoaXMub3B0aW9uczsKCiAgICBpZiAoIW9wdGlvbnMuZXZhbFNjcmlwdHMpIHJlc3BvbnNlVGV4dCA9IHJlc3BvbnNlVGV4dC5zdHJpcFNjcmlwdHMoKTsKCiAgICBpZiAocmVjZWl2ZXIgPSAkKHJlY2VpdmVyKSkgewogICAgICBpZiAob3B0aW9ucy5pbnNlcnRpb24pIHsKICAgICAgICBpZiAoT2JqZWN0LmlzU3RyaW5nKG9wdGlvbnMuaW5zZXJ0aW9uKSkgewogICAgICAgICAgdmFyIGluc2VydGlvbiA9IHsgfTsgaW5zZXJ0aW9uW29wdGlvbnMuaW5zZXJ0aW9uXSA9IHJlc3BvbnNlVGV4dDsKICAgICAgICAgIHJlY2VpdmVyLmluc2VydChpbnNlcnRpb24pOwogICAgICAgIH0KICAgICAgICBlbHNlIG9wdGlvbnMuaW5zZXJ0aW9uKHJlY2VpdmVyLCByZXNwb25zZVRleHQpOwogICAgICB9CiAgICAgIGVsc2UgcmVjZWl2ZXIudXBkYXRlKHJlc3BvbnNlVGV4dCk7CiAgICB9CiAgfQp9KTsKCkFqYXguUGVyaW9kaWNhbFVwZGF0ZXIgPSBDbGFzcy5jcmVhdGUoQWpheC5CYXNlLCB7CiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oJHN1cGVyLCBjb250YWluZXIsIHVybCwgb3B0aW9ucykgewogICAgJHN1cGVyKG9wdGlvbnMpOwogICAgdGhpcy5vbkNvbXBsZXRlID0gdGhpcy5vcHRpb25zLm9uQ29tcGxldGU7CgogICAgdGhpcy5mcmVxdWVuY3kgPSAodGhpcy5vcHRpb25zLmZyZXF1ZW5jeSB8fCAyKTsKICAgIHRoaXMuZGVjYXkgPSAodGhpcy5vcHRpb25zLmRlY2F5IHx8IDEpOwoKICAgIHRoaXMudXBkYXRlciA9IHsgfTsKICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyOwogICAgdGhpcy51cmwgPSB1cmw7CgogICAgdGhpcy5zdGFydCgpOwogIH0sCgogIHN0YXJ0OiBmdW5jdGlvbigpIHsKICAgIHRoaXMub3B0aW9ucy5vbkNvbXBsZXRlID0gdGhpcy51cGRhdGVDb21wbGV0ZS5iaW5kKHRoaXMpOwogICAgdGhpcy5vblRpbWVyRXZlbnQoKTsKICB9LAoKICBzdG9wOiBmdW5jdGlvbigpIHsKICAgIHRoaXMudXBkYXRlci5vcHRpb25zLm9uQ29tcGxldGUgPSB1bmRlZmluZWQ7CiAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcik7CiAgICAodGhpcy5vbkNvbXBsZXRlIHx8IFByb3RvdHlwZS5lbXB0eUZ1bmN0aW9uKS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH0sCgogIHVwZGF0ZUNvbXBsZXRlOiBmdW5jdGlvbihyZXNwb25zZSkgewogICAgaWYgKHRoaXMub3B0aW9ucy5kZWNheSkgewogICAgICB0aGlzLmRlY2F5ID0gKHJlc3BvbnNlLnJlc3BvbnNlVGV4dCA9PSB0aGlzLmxhc3RUZXh0ID8KICAgICAgICB0aGlzLmRlY2F5ICogdGhpcy5vcHRpb25zLmRlY2F5IDogMSk7CgogICAgICB0aGlzLmxhc3RUZXh0ID0gcmVzcG9uc2UucmVzcG9uc2VUZXh0OwogICAgfQogICAgdGhpcy50aW1lciA9IHRoaXMub25UaW1lckV2ZW50LmJpbmQodGhpcykuZGVsYXkodGhpcy5kZWNheSAqIHRoaXMuZnJlcXVlbmN5KTsKICB9LAoKICBvblRpbWVyRXZlbnQ6IGZ1bmN0aW9uKCkgewogICAgdGhpcy51cGRhdGVyID0gbmV3IEFqYXguVXBkYXRlcih0aGlzLmNvbnRhaW5lciwgdGhpcy51cmwsIHRoaXMub3B0aW9ucyk7CiAgfQp9KTsKCgoKZnVuY3Rpb24gJChlbGVtZW50KSB7CiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7CiAgICBmb3IgKHZhciBpID0gMCwgZWxlbWVudHMgPSBbXSwgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKQogICAgICBlbGVtZW50cy5wdXNoKCQoYXJndW1lbnRzW2ldKSk7CiAgICByZXR1cm4gZWxlbWVudHM7CiAgfQogIGlmIChPYmplY3QuaXNTdHJpbmcoZWxlbWVudCkpCiAgICBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudCk7CiAgcmV0dXJuIEVsZW1lbnQuZXh0ZW5kKGVsZW1lbnQpOwp9CgppZiAoUHJvdG90eXBlLkJyb3dzZXJGZWF0dXJlcy5YUGF0aCkgewogIGRvY3VtZW50Ll9nZXRFbGVtZW50c0J5WFBhdGggPSBmdW5jdGlvbihleHByZXNzaW9uLCBwYXJlbnRFbGVtZW50KSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgdmFyIHF1ZXJ5ID0gZG9jdW1lbnQuZXZhbHVhdGUoZXhwcmVzc2lvbiwgJChwYXJlbnRFbGVtZW50KSB8fCBkb2N1bWVudCwKICAgICAgbnVsbCwgWFBhdGhSZXN1bHQuT1JERVJFRF9OT0RFX1NOQVBTSE9UX1RZUEUsIG51bGwpOwogICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IHF1ZXJ5LnNuYXBzaG90TGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspCiAgICAgIHJlc3VsdHMucHVzaChFbGVtZW50LmV4dGVuZChxdWVyeS5zbmFwc2hvdEl0ZW0oaSkpKTsKICAgIHJldHVybiByZXN1bHRzOwogIH07Cn0KCi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKaWYgKCF3aW5kb3cuTm9kZSkgdmFyIE5vZGUgPSB7IH07CgppZiAoIU5vZGUuRUxFTUVOVF9OT0RFKSB7CiAgT2JqZWN0LmV4dGVuZChOb2RlLCB7CiAgICBFTEVNRU5UX05PREU6IDEsCiAgICBBVFRSSUJVVEVfTk9ERTogMiwKICAgIFRFWFRfTk9ERTogMywKICAgIENEQVRBX1NFQ1RJT05fTk9ERTogNCwKICAgIEVOVElUWV9SRUZFUkVOQ0VfTk9ERTogNSwKICAgIEVOVElUWV9OT0RFOiA2LAogICAgUFJPQ0VTU0lOR19JTlNUUlVDVElPTl9OT0RFOiA3LAogICAgQ09NTUVOVF9OT0RFOiA4LAogICAgRE9DVU1FTlRfTk9ERTogOSwKICAgIERPQ1VNRU5UX1RZUEVfTk9ERTogMTAsCiAgICBET0NVTUVOVF9GUkFHTUVOVF9OT0RFOiAxMSwKICAgIE5PVEFUSU9OX05PREU6IDEyCiAgfSk7Cn0KCgooZnVuY3Rpb24oZ2xvYmFsKSB7CgogIHZhciBTRVRBVFRSSUJVVEVfSUdOT1JFU19OQU1FID0gKGZ1bmN0aW9uKCl7CiAgICB2YXIgZWxGb3JtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZm9ybSIpOwogICAgdmFyIGVsSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwogICAgdmFyIHJvb3QgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICBlbElucHV0LnNldEF0dHJpYnV0ZSgibmFtZSIsICJ0ZXN0Iik7CiAgICBlbEZvcm0uYXBwZW5kQ2hpbGQoZWxJbnB1dCk7CiAgICByb290LmFwcGVuZENoaWxkKGVsRm9ybSk7CiAgICB2YXIgaXNCdWdneSA9IGVsRm9ybS5lbGVtZW50cwogICAgICA/ICh0eXBlb2YgZWxGb3JtLmVsZW1lbnRzLnRlc3QgPT0gInVuZGVmaW5lZCIpCiAgICAgIDogbnVsbDsKICAgIHJvb3QucmVtb3ZlQ2hpbGQoZWxGb3JtKTsKICAgIGVsRm9ybSA9IGVsSW5wdXQgPSBudWxsOwogICAgcmV0dXJuIGlzQnVnZ3k7CiAgfSkoKTsKCiAgdmFyIGVsZW1lbnQgPSBnbG9iYWwuRWxlbWVudDsKICBnbG9iYWwuRWxlbWVudCA9IGZ1bmN0aW9uKHRhZ05hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIGF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVzIHx8IHsgfTsKICAgIHRhZ05hbWUgPSB0YWdOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICB2YXIgY2FjaGUgPSBFbGVtZW50LmNhY2hlOwogICAgaWYgKFNFVEFUVFJJQlVURV9JR05PUkVTX05BTUUgJiYgYXR0cmlidXRlcy5uYW1lKSB7CiAgICAgIHRhZ05hbWUgPSAnPCcgKyB0YWdOYW1lICsgJyBuYW1lPSInICsgYXR0cmlidXRlcy5uYW1lICsgJyI+JzsKICAgICAgZGVsZXRlIGF0dHJpYnV0ZXMubmFtZTsKICAgICAgcmV0dXJuIEVsZW1lbnQud3JpdGVBdHRyaWJ1dGUoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWdOYW1lKSwgYXR0cmlidXRlcyk7CiAgICB9CiAgICBpZiAoIWNhY2hlW3RhZ05hbWVdKSBjYWNoZVt0YWdOYW1lXSA9IEVsZW1lbnQuZXh0ZW5kKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnTmFtZSkpOwogICAgcmV0dXJuIEVsZW1lbnQud3JpdGVBdHRyaWJ1dGUoY2FjaGVbdGFnTmFtZV0uY2xvbmVOb2RlKGZhbHNlKSwgYXR0cmlidXRlcyk7CiAgfTsKICBPYmplY3QuZXh0ZW5kKGdsb2JhbC5FbGVtZW50LCBlbGVtZW50IHx8IHsgfSk7CiAgaWYgKGVsZW1lbnQpIGdsb2JhbC5FbGVtZW50LnByb3RvdHlwZSA9IGVsZW1lbnQucHJvdG90eXBlOwp9KSh0aGlzKTsKCkVsZW1lbnQuY2FjaGUgPSB7IH07CkVsZW1lbnQuaWRDb3VudGVyID0gMTsKCkVsZW1lbnQuTWV0aG9kcyA9IHsKICB2aXNpYmxlOiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICByZXR1cm4gJChlbGVtZW50KS5zdHlsZS5kaXNwbGF5ICE9ICdub25lJzsKICB9LAoKICB0b2dnbGU6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwogICAgRWxlbWVudFtFbGVtZW50LnZpc2libGUoZWxlbWVudCkgPyAnaGlkZScgOiAnc2hvdyddKGVsZW1lbnQpOwogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfSwKCgogIGhpZGU6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwogICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfSwKCiAgc2hvdzogZnVuY3Rpb24oZWxlbWVudCkgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAoZWxlbWVudC50YWdOYW1lID09ICdzcGFuJyk/J2lubGluZSc6J2Jsb2NrJzsKLy8gb3JpZ2luYWw6Ci8vICAgIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICcnOwogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfSwKCiAgcmVtb3ZlOiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICBlbGVtZW50ID0gJChlbGVtZW50KTsKICAgIGVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbGVtZW50KTsKICAgIHJldHVybiBlbGVtZW50OwogIH0sCgogIHVwZGF0ZTogKGZ1bmN0aW9uKCl7CgogICAgdmFyIFNFTEVDVF9FTEVNRU5UX0lOTkVSSFRNTF9CVUdHWSA9IChmdW5jdGlvbigpewogICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKSwKICAgICAgICAgIGlzQnVnZ3kgPSB0cnVlOwogICAgICBlbC5pbm5lckhUTUwgPSAiPG9wdGlvbiB2YWx1ZT1cInRlc3RcIj50ZXN0PC9vcHRpb24+IjsKICAgICAgaWYgKGVsLm9wdGlvbnMgJiYgZWwub3B0aW9uc1swXSkgewogICAgICAgIGlzQnVnZ3kgPSBlbC5vcHRpb25zWzBdLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgIT09ICJPUFRJT04iOwogICAgICB9CiAgICAgIGVsID0gbnVsbDsKICAgICAgcmV0dXJuIGlzQnVnZ3k7CiAgICB9KSgpOwoKICAgIHZhciBUQUJMRV9FTEVNRU5UX0lOTkVSSFRNTF9CVUdHWSA9IChmdW5jdGlvbigpewogICAgICB0cnkgewogICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRhYmxlIik7CiAgICAgICAgaWYgKGVsICYmIGVsLnRCb2RpZXMpIHsKICAgICAgICAgIGVsLmlubmVySFRNTCA9ICI8dGJvZHk+PHRyPjx0ZD50ZXN0PC90ZD48L3RyPjwvdGJvZHk+IjsKICAgICAgICAgIHZhciBpc0J1Z2d5ID0gdHlwZW9mIGVsLnRCb2RpZXNbMF0gPT0gInVuZGVmaW5lZCI7CiAgICAgICAgICBlbCA9IG51bGw7CiAgICAgICAgICByZXR1cm4gaXNCdWdneTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfSkoKTsKCiAgICB2YXIgU0NSSVBUX0VMRU1FTlRfUkVKRUNUU19URVhUTk9ERV9BUFBFTkRJTkcgPSAoZnVuY3Rpb24gKCkgewogICAgICB2YXIgcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpLAogICAgICAgICAgaXNCdWdneSA9IGZhbHNlOwogICAgICB0cnkgewogICAgICAgIHMuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIiIpKTsKICAgICAgICBpc0J1Z2d5ID0gIXMuZmlyc3RDaGlsZCB8fAogICAgICAgICAgcy5maXJzdENoaWxkICYmIHMuZmlyc3RDaGlsZC5ub2RlVHlwZSAhPT0gMzsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGlzQnVnZ3kgPSB0cnVlOwogICAgICB9CiAgICAgIHMgPSBudWxsOwogICAgICByZXR1cm4gaXNCdWdneTsKICAgIH0pKCk7CgogICAgZnVuY3Rpb24gdXBkYXRlKGVsZW1lbnQsIGNvbnRlbnQpIHsKICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CgogICAgICBpZiAoY29udGVudCAmJiBjb250ZW50LnRvRWxlbWVudCkKICAgICAgICBjb250ZW50ID0gY29udGVudC50b0VsZW1lbnQoKTsKCiAgICAgIGlmIChPYmplY3QuaXNFbGVtZW50KGNvbnRlbnQpKQogICAgICAgIHJldHVybiBlbGVtZW50LnVwZGF0ZSgpLmluc2VydChjb250ZW50KTsKCiAgICAgIGNvbnRlbnQgPSBPYmplY3QudG9IVE1MKGNvbnRlbnQpOwoKICAgICAgdmFyIHRhZ05hbWUgPSBlbGVtZW50LnRhZ05hbWUudG9VcHBlckNhc2UoKTsKCiAgICAgIGlmICh0YWdOYW1lID09PSAnU0NSSVBUJyAmJiBTQ1JJUFRfRUxFTUVOVF9SRUpFQ1RTX1RFWFROT0RFX0FQUEVORElORykgewogICAgICAgIGVsZW1lbnQudGV4dCA9IGNvbnRlbnQ7CiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7CiAgICAgIH0KCiAgICAgIGlmIChTRUxFQ1RfRUxFTUVOVF9JTk5FUkhUTUxfQlVHR1kgfHwgVEFCTEVfRUxFTUVOVF9JTk5FUkhUTUxfQlVHR1kpIHsKICAgICAgICBpZiAodGFnTmFtZSBpbiBFbGVtZW50Ll9pbnNlcnRpb25UcmFuc2xhdGlvbnMudGFncykgewogICAgICAgICAgd2hpbGUgKGVsZW1lbnQuZmlyc3RDaGlsZCkgewogICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNoaWxkKGVsZW1lbnQuZmlyc3RDaGlsZCk7CiAgICAgICAgICB9CiAgICAgICAgICBFbGVtZW50Ll9nZXRDb250ZW50RnJvbUFub255bW91c0VsZW1lbnQodGFnTmFtZSwgY29udGVudC5zdHJpcFNjcmlwdHMoKSkKICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24obm9kZSkgewogICAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQobm9kZSkKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgZWxlbWVudC5pbm5lckhUTUwgPSBjb250ZW50LnN0cmlwU2NyaXB0cygpOwogICAgICAgIH0KICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICBlbGVtZW50LmlubmVySFRNTCA9IGNvbnRlbnQuc3RyaXBTY3JpcHRzKCk7CiAgICAgIH0KCiAgICAgIGNvbnRlbnQuZXZhbFNjcmlwdHMuYmluZChjb250ZW50KS5kZWZlcigpOwogICAgICByZXR1cm4gZWxlbWVudDsKICAgIH0KCiAgICByZXR1cm4gdXBkYXRlOwogIH0pKCksCgogIHJlcGxhY2U6IGZ1bmN0aW9uKGVsZW1lbnQsIGNvbnRlbnQpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwogICAgaWYgKGNvbnRlbnQgJiYgY29udGVudC50b0VsZW1lbnQpIGNvbnRlbnQgPSBjb250ZW50LnRvRWxlbWVudCgpOwogICAgZWxzZSBpZiAoIU9iamVjdC5pc0VsZW1lbnQoY29udGVudCkpIHsKICAgICAgY29udGVudCA9IE9iamVjdC50b0hUTUwoY29udGVudCk7CiAgICAgIHZhciByYW5nZSA9IGVsZW1lbnQub3duZXJEb2N1bWVudC5jcmVhdGVSYW5nZSgpOwogICAgICByYW5nZS5zZWxlY3ROb2RlKGVsZW1lbnQpOwogICAgICBjb250ZW50LmV2YWxTY3JpcHRzLmJpbmQoY29udGVudCkuZGVmZXIoKTsKICAgICAgY29udGVudCA9IHJhbmdlLmNyZWF0ZUNvbnRleHR1YWxGcmFnbWVudChjb250ZW50LnN0cmlwU2NyaXB0cygpKTsKICAgIH0KICAgIGVsZW1lbnQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoY29udGVudCwgZWxlbWVudCk7CiAgICByZXR1cm4gZWxlbWVudDsKICB9LAoKICBpbnNlcnQ6IGZ1bmN0aW9uKGVsZW1lbnQsIGluc2VydGlvbnMpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwoKICAgIGlmIChPYmplY3QuaXNTdHJpbmcoaW5zZXJ0aW9ucykgfHwgT2JqZWN0LmlzTnVtYmVyKGluc2VydGlvbnMpIHx8CiAgICAgICAgT2JqZWN0LmlzRWxlbWVudChpbnNlcnRpb25zKSB8fCAoaW5zZXJ0aW9ucyAmJiAoaW5zZXJ0aW9ucy50b0VsZW1lbnQgfHwgaW5zZXJ0aW9ucy50b0hUTUwpKSkKICAgICAgICAgIGluc2VydGlvbnMgPSB7Ym90dG9tOmluc2VydGlvbnN9OwoKICAgIHZhciBjb250ZW50LCBpbnNlcnQsIHRhZ05hbWUsIGNoaWxkTm9kZXM7CgogICAgZm9yICh2YXIgcG9zaXRpb24gaW4gaW5zZXJ0aW9ucykgewogICAgICBjb250ZW50ICA9IGluc2VydGlvbnNbcG9zaXRpb25dOwogICAgICBwb3NpdGlvbiA9IHBvc2l0aW9uLnRvTG93ZXJDYXNlKCk7CiAgICAgIGluc2VydCA9IEVsZW1lbnQuX2luc2VydGlvblRyYW5zbGF0aW9uc1twb3NpdGlvbl07CgogICAgICBpZiAoY29udGVudCAmJiBjb250ZW50LnRvRWxlbWVudCkgY29udGVudCA9IGNvbnRlbnQudG9FbGVtZW50KCk7CiAgICAgIGlmIChPYmplY3QuaXNFbGVtZW50KGNvbnRlbnQpKSB7CiAgICAgICAgaW5zZXJ0KGVsZW1lbnQsIGNvbnRlbnQpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICBjb250ZW50ID0gT2JqZWN0LnRvSFRNTChjb250ZW50KTsKCiAgICAgIHRhZ05hbWUgPSAoKHBvc2l0aW9uID09ICdiZWZvcmUnIHx8IHBvc2l0aW9uID09ICdhZnRlcicpCiAgICAgICAgPyBlbGVtZW50LnBhcmVudE5vZGUgOiBlbGVtZW50KS50YWdOYW1lLnRvVXBwZXJDYXNlKCk7CgogICAgICBjaGlsZE5vZGVzID0gRWxlbWVudC5fZ2V0Q29udGVudEZyb21Bbm9ueW1vdXNFbGVtZW50KHRhZ05hbWUsIGNvbnRlbnQuc3RyaXBTY3JpcHRzKCkpOwoKICAgICAgaWYgKHBvc2l0aW9uID09ICd0b3AnIHx8IHBvc2l0aW9uID09ICdhZnRlcicpIGNoaWxkTm9kZXMucmV2ZXJzZSgpOwogICAgICBjaGlsZE5vZGVzLmVhY2goaW5zZXJ0LmN1cnJ5KGVsZW1lbnQpKTsKCiAgICAgIGNvbnRlbnQuZXZhbFNjcmlwdHMuYmluZChjb250ZW50KS5kZWZlcigpOwogICAgfQoKICAgIHJldHVybiBlbGVtZW50OwogIH0sCgogIHdyYXA6IGZ1bmN0aW9uKGVsZW1lbnQsIHdyYXBwZXIsIGF0dHJpYnV0ZXMpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwogICAgaWYgKE9iamVjdC5pc0VsZW1lbnQod3JhcHBlcikpCiAgICAgICQod3JhcHBlcikud3JpdGVBdHRyaWJ1dGUoYXR0cmlidXRlcyB8fCB7IH0pOwogICAgZWxzZSBpZiAoT2JqZWN0LmlzU3RyaW5nKHdyYXBwZXIpKSB3cmFwcGVyID0gbmV3IEVsZW1lbnQod3JhcHBlciwgYXR0cmlidXRlcyk7CiAgICBlbHNlIHdyYXBwZXIgPSBuZXcgRWxlbWVudCgnZGl2Jywgd3JhcHBlcik7CiAgICBpZiAoZWxlbWVudC5wYXJlbnROb2RlKQogICAgICBlbGVtZW50LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKHdyYXBwZXIsIGVsZW1lbnQpOwogICAgd3JhcHBlci5hcHBlbmRDaGlsZChlbGVtZW50KTsKICAgIHJldHVybiB3cmFwcGVyOwogIH0sCgogIGluc3BlY3Q6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwogICAgdmFyIHJlc3VsdCA9ICc8JyArIGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgJEgoeydpZCc6ICdpZCcsICdjbGFzc05hbWUnOiAnY2xhc3MnfSkuZWFjaChmdW5jdGlvbihwYWlyKSB7CiAgICAgIHZhciBwcm9wZXJ0eSA9IHBhaXIuZmlyc3QoKSwgYXR0cmlidXRlID0gcGFpci5sYXN0KCk7CiAgICAgIHZhciB2YWx1ZSA9IChlbGVtZW50W3Byb3BlcnR5XSB8fCAnJykudG9TdHJpbmcoKTsKICAgICAgaWYgKHZhbHVlKSByZXN1bHQgKz0gJyAnICsgYXR0cmlidXRlICsgJz0nICsgdmFsdWUuaW5zcGVjdCh0cnVlKTsKICAgIH0pOwogICAgcmV0dXJuIHJlc3VsdCArICc+JzsKICB9LAoKICByZWN1cnNpdmVseUNvbGxlY3Q6IGZ1bmN0aW9uKGVsZW1lbnQsIHByb3BlcnR5KSB7CiAgICBlbGVtZW50ID0gJChlbGVtZW50KTsKICAgIHZhciBlbGVtZW50cyA9IFtdOwogICAgd2hpbGUgKGVsZW1lbnQgPSBlbGVtZW50W3Byb3BlcnR5XSkKICAgICAgaWYgKGVsZW1lbnQubm9kZVR5cGUgPT0gMSkKICAgICAgICBlbGVtZW50cy5wdXNoKEVsZW1lbnQuZXh0ZW5kKGVsZW1lbnQpKTsKICAgIHJldHVybiBlbGVtZW50czsKICB9LAoKICBhbmNlc3RvcnM6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIHJldHVybiBFbGVtZW50LnJlY3Vyc2l2ZWx5Q29sbGVjdChlbGVtZW50LCAncGFyZW50Tm9kZScpOwogIH0sCgogIGRlc2NlbmRhbnRzOiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICByZXR1cm4gRWxlbWVudC5zZWxlY3QoZWxlbWVudCwgIioiKTsKICB9LAoKICBmaXJzdERlc2NlbmRhbnQ6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpLmZpcnN0Q2hpbGQ7CiAgICB3aGlsZSAoZWxlbWVudCAmJiBlbGVtZW50Lm5vZGVUeXBlICE9IDEpIGVsZW1lbnQgPSBlbGVtZW50Lm5leHRTaWJsaW5nOwogICAgcmV0dXJuICQoZWxlbWVudCk7CiAgfSwKCiAgaW1tZWRpYXRlRGVzY2VuZGFudHM6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIGlmICghKGVsZW1lbnQgPSAkKGVsZW1lbnQpLmZpcnN0Q2hpbGQpKSByZXR1cm4gW107CiAgICB3aGlsZSAoZWxlbWVudCAmJiBlbGVtZW50Lm5vZGVUeXBlICE9IDEpIGVsZW1lbnQgPSBlbGVtZW50Lm5leHRTaWJsaW5nOwogICAgaWYgKGVsZW1lbnQpIHJldHVybiBbZWxlbWVudF0uY29uY2F0KCQoZWxlbWVudCkubmV4dFNpYmxpbmdzKCkpOwogICAgcmV0dXJuIFtdOwogIH0sCgogIHByZXZpb3VzU2libGluZ3M6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIHJldHVybiBFbGVtZW50LnJlY3Vyc2l2ZWx5Q29sbGVjdChlbGVtZW50LCAncHJldmlvdXNTaWJsaW5nJyk7CiAgfSwKCiAgbmV4dFNpYmxpbmdzOiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICByZXR1cm4gRWxlbWVudC5yZWN1cnNpdmVseUNvbGxlY3QoZWxlbWVudCwgJ25leHRTaWJsaW5nJyk7CiAgfSwKCiAgc2libGluZ3M6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwogICAgcmV0dXJuIEVsZW1lbnQucHJldmlvdXNTaWJsaW5ncyhlbGVtZW50KS5yZXZlcnNlKCkKICAgICAgLmNvbmNhdChFbGVtZW50Lm5leHRTaWJsaW5ncyhlbGVtZW50KSk7CiAgfSwKCiAgbWF0Y2g6IGZ1bmN0aW9uKGVsZW1lbnQsIHNlbGVjdG9yKSB7CiAgICBpZiAoT2JqZWN0LmlzU3RyaW5nKHNlbGVjdG9yKSkKICAgICAgc2VsZWN0b3IgPSBuZXcgU2VsZWN0b3Ioc2VsZWN0b3IpOwogICAgcmV0dXJuIHNlbGVjdG9yLm1hdGNoKCQoZWxlbWVudCkpOwogIH0sCgogIHVwOiBmdW5jdGlvbihlbGVtZW50LCBleHByZXNzaW9uLCBpbmRleCkgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSByZXR1cm4gJChlbGVtZW50LnBhcmVudE5vZGUpOwogICAgdmFyIGFuY2VzdG9ycyA9IEVsZW1lbnQuYW5jZXN0b3JzKGVsZW1lbnQpOwogICAgcmV0dXJuIE9iamVjdC5pc051bWJlcihleHByZXNzaW9uKSA/IGFuY2VzdG9yc1tleHByZXNzaW9uXSA6CiAgICAgIFNlbGVjdG9yLmZpbmRFbGVtZW50KGFuY2VzdG9ycywgZXhwcmVzc2lvbiwgaW5kZXgpOwogIH0sCgogIGRvd246IGZ1bmN0aW9uKGVsZW1lbnQsIGV4cHJlc3Npb24sIGluZGV4KSB7CiAgICBlbGVtZW50ID0gJChlbGVtZW50KTsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHJldHVybiBFbGVtZW50LmZpcnN0RGVzY2VuZGFudChlbGVtZW50KTsKICAgIHJldHVybiBPYmplY3QuaXNOdW1iZXIoZXhwcmVzc2lvbikgPyBFbGVtZW50LmRlc2NlbmRhbnRzKGVsZW1lbnQpW2V4cHJlc3Npb25dIDoKICAgICAgRWxlbWVudC5zZWxlY3QoZWxlbWVudCwgZXhwcmVzc2lvbilbaW5kZXggfHwgMF07CiAgfSwKCiAgcHJldmlvdXM6IGZ1bmN0aW9uKGVsZW1lbnQsIGV4cHJlc3Npb24sIGluZGV4KSB7CiAgICBlbGVtZW50ID0gJChlbGVtZW50KTsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHJldHVybiAkKFNlbGVjdG9yLmhhbmRsZXJzLnByZXZpb3VzRWxlbWVudFNpYmxpbmcoZWxlbWVudCkpOwogICAgdmFyIHByZXZpb3VzU2libGluZ3MgPSBFbGVtZW50LnByZXZpb3VzU2libGluZ3MoZWxlbWVudCk7CiAgICByZXR1cm4gT2JqZWN0LmlzTnVtYmVyKGV4cHJlc3Npb24pID8gcHJldmlvdXNTaWJsaW5nc1tleHByZXNzaW9uXSA6CiAgICAgIFNlbGVjdG9yLmZpbmRFbGVtZW50KHByZXZpb3VzU2libGluZ3MsIGV4cHJlc3Npb24sIGluZGV4KTsKICB9LAoKICBuZXh0OiBmdW5jdGlvbihlbGVtZW50LCBleHByZXNzaW9uLCBpbmRleCkgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxKSByZXR1cm4gJChTZWxlY3Rvci5oYW5kbGVycy5uZXh0RWxlbWVudFNpYmxpbmcoZWxlbWVudCkpOwogICAgdmFyIG5leHRTaWJsaW5ncyA9IEVsZW1lbnQubmV4dFNpYmxpbmdzKGVsZW1lbnQpOwogICAgcmV0dXJuIE9iamVjdC5pc051bWJlcihleHByZXNzaW9uKSA/IG5leHRTaWJsaW5nc1tleHByZXNzaW9uXSA6CiAgICAgIFNlbGVjdG9yLmZpbmRFbGVtZW50KG5leHRTaWJsaW5ncywgZXhwcmVzc2lvbiwgaW5kZXgpOwogIH0sCgoKICBzZWxlY3Q6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHJldHVybiBTZWxlY3Rvci5maW5kQ2hpbGRFbGVtZW50cyhlbGVtZW50LCBhcmdzKTsKICB9LAoKICBhZGphY2VudDogZnVuY3Rpb24oZWxlbWVudCkgewogICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgcmV0dXJuIFNlbGVjdG9yLmZpbmRDaGlsZEVsZW1lbnRzKGVsZW1lbnQucGFyZW50Tm9kZSwgYXJncykud2l0aG91dChlbGVtZW50KTsKICB9LAoKICBpZGVudGlmeTogZnVuY3Rpb24oZWxlbWVudCkgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICB2YXIgaWQgPSBFbGVtZW50LnJlYWRBdHRyaWJ1dGUoZWxlbWVudCwgJ2lkJyk7CiAgICBpZiAoaWQpIHJldHVybiBpZDsKICAgIGRvIHsgaWQgPSAnYW5vbnltb3VzX2VsZW1lbnRfJyArIEVsZW1lbnQuaWRDb3VudGVyKysgfSB3aGlsZSAoJChpZCkpOwogICAgRWxlbWVudC53cml0ZUF0dHJpYnV0ZShlbGVtZW50LCAnaWQnLCBpZCk7CiAgICByZXR1cm4gaWQ7CiAgfSwKCiAgcmVhZEF0dHJpYnV0ZTogZnVuY3Rpb24oZWxlbWVudCwgbmFtZSkgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICBpZiAoUHJvdG90eXBlLkJyb3dzZXIuSUUpIHsKICAgICAgdmFyIHQgPSBFbGVtZW50Ll9hdHRyaWJ1dGVUcmFuc2xhdGlvbnMucmVhZDsKICAgICAgaWYgKHQudmFsdWVzW25hbWVdKSByZXR1cm4gdC52YWx1ZXNbbmFtZV0oZWxlbWVudCwgbmFtZSk7CiAgICAgIGlmICh0Lm5hbWVzW25hbWVdKSBuYW1lID0gdC5uYW1lc1tuYW1lXTsKICAgICAgaWYgKG5hbWUuaW5jbHVkZSgnOicpKSB7CiAgICAgICAgcmV0dXJuICghZWxlbWVudC5hdHRyaWJ1dGVzIHx8ICFlbGVtZW50LmF0dHJpYnV0ZXNbbmFtZV0pID8gbnVsbCA6CiAgICAgICAgIGVsZW1lbnQuYXR0cmlidXRlc1tuYW1lXS52YWx1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGVsZW1lbnQuZ2V0QXR0cmlidXRlKG5hbWUpOwogIH0sCgogIHdyaXRlQXR0cmlidXRlOiBmdW5jdGlvbihlbGVtZW50LCBuYW1lLCB2YWx1ZSkgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICB2YXIgYXR0cmlidXRlcyA9IHsgfSwgdCA9IEVsZW1lbnQuX2F0dHJpYnV0ZVRyYW5zbGF0aW9ucy53cml0ZTsKCiAgICBpZiAodHlwZW9mIG5hbWUgPT0gJ29iamVjdCcpIGF0dHJpYnV0ZXMgPSBuYW1lOwogICAgZWxzZSBhdHRyaWJ1dGVzW25hbWVdID0gT2JqZWN0LmlzVW5kZWZpbmVkKHZhbHVlKSA/IHRydWUgOiB2YWx1ZTsKCiAgICBmb3IgKHZhciBhdHRyIGluIGF0dHJpYnV0ZXMpIHsKICAgICAgbmFtZSA9IHQubmFtZXNbYXR0cl0gfHwgYXR0cjsKICAgICAgdmFsdWUgPSBhdHRyaWJ1dGVzW2F0dHJdOwogICAgICBpZiAodC52YWx1ZXNbYXR0cl0pIG5hbWUgPSB0LnZhbHVlc1thdHRyXShlbGVtZW50LCB2YWx1ZSk7CiAgICAgIGlmICh2YWx1ZSA9PT0gZmFsc2UgfHwgdmFsdWUgPT09IG51bGwpCiAgICAgICAgZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUobmFtZSk7CiAgICAgIGVsc2UgaWYgKHZhbHVlID09PSB0cnVlKQogICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKG5hbWUsIG5hbWUpOwogICAgICBlbHNlIGVsZW1lbnQuc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKTsKICAgIH0KICAgIHJldHVybiBlbGVtZW50OwogIH0sCgogIGdldEhlaWdodDogZnVuY3Rpb24oZWxlbWVudCkgewogICAgcmV0dXJuIEVsZW1lbnQuZ2V0RGltZW5zaW9ucyhlbGVtZW50KS5oZWlnaHQ7CiAgfSwKCiAgZ2V0V2lkdGg6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIHJldHVybiBFbGVtZW50LmdldERpbWVuc2lvbnMoZWxlbWVudCkud2lkdGg7CiAgfSwKCiAgY2xhc3NOYW1lczogZnVuY3Rpb24oZWxlbWVudCkgewogICAgcmV0dXJuIG5ldyBFbGVtZW50LkNsYXNzTmFtZXMoZWxlbWVudCk7CiAgfSwKCiAgaGFzQ2xhc3NOYW1lOiBmdW5jdGlvbihlbGVtZW50LCBjbGFzc05hbWUpIHsKICAgIGlmICghKGVsZW1lbnQgPSAkKGVsZW1lbnQpKSkgcmV0dXJuOwogICAgdmFyIGVsZW1lbnRDbGFzc05hbWUgPSBlbGVtZW50LmNsYXNzTmFtZTsKICAgIHJldHVybiAoZWxlbWVudENsYXNzTmFtZS5sZW5ndGggPiAwICYmIChlbGVtZW50Q2xhc3NOYW1lID09IGNsYXNzTmFtZSB8fAogICAgICBuZXcgUmVnRXhwKCIoXnxcXHMpIiArIGNsYXNzTmFtZSArICIoXFxzfCQpIikudGVzdChlbGVtZW50Q2xhc3NOYW1lKSkpOwogIH0sCgogIGFkZENsYXNzTmFtZTogZnVuY3Rpb24oZWxlbWVudCwgY2xhc3NOYW1lKSB7CiAgICBpZiAoIShlbGVtZW50ID0gJChlbGVtZW50KSkpIHJldHVybjsKICAgIGlmICghRWxlbWVudC5oYXNDbGFzc05hbWUoZWxlbWVudCwgY2xhc3NOYW1lKSkKICAgICAgZWxlbWVudC5jbGFzc05hbWUgKz0gKGVsZW1lbnQuY2xhc3NOYW1lID8gJyAnIDogJycpICsgY2xhc3NOYW1lOwogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfSwKCiAgcmVtb3ZlQ2xhc3NOYW1lOiBmdW5jdGlvbihlbGVtZW50LCBjbGFzc05hbWUpIHsKICAgIGlmICghKGVsZW1lbnQgPSAkKGVsZW1lbnQpKSkgcmV0dXJuOwogICAgZWxlbWVudC5jbGFzc05hbWUgPSBlbGVtZW50LmNsYXNzTmFtZS5yZXBsYWNlKAogICAgICBuZXcgUmVnRXhwKCIoXnxcXHMrKSIgKyBjbGFzc05hbWUgKyAiKFxccyt8JCkiKSwgJyAnKS5zdHJpcCgpOwogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfSwKCiAgdG9nZ2xlQ2xhc3NOYW1lOiBmdW5jdGlvbihlbGVtZW50LCBjbGFzc05hbWUpIHsKICAgIGlmICghKGVsZW1lbnQgPSAkKGVsZW1lbnQpKSkgcmV0dXJuOwogICAgcmV0dXJuIEVsZW1lbnRbRWxlbWVudC5oYXNDbGFzc05hbWUoZWxlbWVudCwgY2xhc3NOYW1lKSA/CiAgICAgICdyZW1vdmVDbGFzc05hbWUnIDogJ2FkZENsYXNzTmFtZSddKGVsZW1lbnQsIGNsYXNzTmFtZSk7CiAgfSwKCiAgY2xlYW5XaGl0ZXNwYWNlOiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICBlbGVtZW50ID0gJChlbGVtZW50KTsKICAgIHZhciBub2RlID0gZWxlbWVudC5maXJzdENoaWxkOwogICAgd2hpbGUgKG5vZGUpIHsKICAgICAgdmFyIG5leHROb2RlID0gbm9kZS5uZXh0U2libGluZzsKICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT0gMyAmJiAhL1xTLy50ZXN0KG5vZGUubm9kZVZhbHVlKSkKICAgICAgICBlbGVtZW50LnJlbW92ZUNoaWxkKG5vZGUpOwogICAgICBub2RlID0gbmV4dE5vZGU7CiAgICB9CiAgICByZXR1cm4gZWxlbWVudDsKICB9LAoKICBlbXB0eTogZnVuY3Rpb24oZWxlbWVudCkgewogICAgcmV0dXJuICQoZWxlbWVudCkuaW5uZXJIVE1MLmJsYW5rKCk7CiAgfSwKCiAgZGVzY2VuZGFudE9mOiBmdW5jdGlvbihlbGVtZW50LCBhbmNlc3RvcikgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCksIGFuY2VzdG9yID0gJChhbmNlc3Rvcik7CgogICAgaWYgKGVsZW1lbnQuY29tcGFyZURvY3VtZW50UG9zaXRpb24pCiAgICAgIHJldHVybiAoZWxlbWVudC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihhbmNlc3RvcikgJiA4KSA9PT0gODsKCiAgICBpZiAoYW5jZXN0b3IuY29udGFpbnMpCiAgICAgIHJldHVybiBhbmNlc3Rvci5jb250YWlucyhlbGVtZW50KSAmJiBhbmNlc3RvciAhPT0gZWxlbWVudDsKCiAgICB3aGlsZSAoZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSkKICAgICAgaWYgKGVsZW1lbnQgPT0gYW5jZXN0b3IpIHJldHVybiB0cnVlOwoKICAgIHJldHVybiBmYWxzZTsKICB9LAoKICBzY3JvbGxUbzogZnVuY3Rpb24oZWxlbWVudCkgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICB2YXIgcG9zID0gRWxlbWVudC5jdW11bGF0aXZlT2Zmc2V0KGVsZW1lbnQpOwogICAgd2luZG93LnNjcm9sbFRvKHBvc1swXSwgcG9zWzFdKTsKICAgIHJldHVybiBlbGVtZW50OwogIH0sCgogIGdldFN0eWxlOiBmdW5jdGlvbihlbGVtZW50LCBzdHlsZSkgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICBzdHlsZSA9IHN0eWxlID09ICdmbG9hdCcgPyAnY3NzRmxvYXQnIDogc3R5bGUuY2FtZWxpemUoKTsKICAgIHZhciB2YWx1ZSA9IGVsZW1lbnQuc3R5bGVbc3R5bGVdOwogICAgaWYgKCF2YWx1ZSB8fCB2YWx1ZSA9PSAnYXV0bycpIHsKICAgICAgdmFyIGNzcyA9IGRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCwgbnVsbCk7CiAgICAgIHZhbHVlID0gY3NzID8gY3NzW3N0eWxlXSA6IG51bGw7CiAgICB9CiAgICBpZiAoc3R5bGUgPT0gJ29wYWNpdHknKSByZXR1cm4gdmFsdWUgPyBwYXJzZUZsb2F0KHZhbHVlKSA6IDEuMDsKICAgIHJldHVybiB2YWx1ZSA9PSAnYXV0bycgPyBudWxsIDogdmFsdWU7CiAgfSwKCiAgZ2V0T3BhY2l0eTogZnVuY3Rpb24oZWxlbWVudCkgewogICAgcmV0dXJuICQoZWxlbWVudCkuZ2V0U3R5bGUoJ29wYWNpdHknKTsKICB9LAoKICBzZXRTdHlsZTogZnVuY3Rpb24oZWxlbWVudCwgc3R5bGVzKSB7CiAgICBlbGVtZW50ID0gJChlbGVtZW50KTsKICAgIHZhciBlbGVtZW50U3R5bGUgPSBlbGVtZW50LnN0eWxlLCBtYXRjaDsKICAgIGlmIChPYmplY3QuaXNTdHJpbmcoc3R5bGVzKSkgewogICAgICBlbGVtZW50LnN0eWxlLmNzc1RleHQgKz0gJzsnICsgc3R5bGVzOwogICAgICByZXR1cm4gc3R5bGVzLmluY2x1ZGUoJ29wYWNpdHknKSA/CiAgICAgICAgZWxlbWVudC5zZXRPcGFjaXR5KHN0eWxlcy5tYXRjaCgvb3BhY2l0eTpccyooXGQ/XC4/XGQqKS8pWzFdKSA6IGVsZW1lbnQ7CiAgICB9CiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzdHlsZXMpCiAgICAgIGlmIChwcm9wZXJ0eSA9PSAnb3BhY2l0eScpIGVsZW1lbnQuc2V0T3BhY2l0eShzdHlsZXNbcHJvcGVydHldKTsKICAgICAgZWxzZQogICAgICAgIGVsZW1lbnRTdHlsZVsocHJvcGVydHkgPT0gJ2Zsb2F0JyB8fCBwcm9wZXJ0eSA9PSAnY3NzRmxvYXQnKSA/CiAgICAgICAgICAoT2JqZWN0LmlzVW5kZWZpbmVkKGVsZW1lbnRTdHlsZS5zdHlsZUZsb2F0KSA/ICdjc3NGbG9hdCcgOiAnc3R5bGVGbG9hdCcpIDoKICAgICAgICAgICAgcHJvcGVydHldID0gc3R5bGVzW3Byb3BlcnR5XTsKCiAgICByZXR1cm4gZWxlbWVudDsKICB9LAoKICBzZXRPcGFjaXR5OiBmdW5jdGlvbihlbGVtZW50LCB2YWx1ZSkgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICBlbGVtZW50LnN0eWxlLm9wYWNpdHkgPSAodmFsdWUgPT0gMSB8fCB2YWx1ZSA9PT0gJycpID8gJycgOgogICAgICAodmFsdWUgPCAwLjAwMDAxKSA/IDAgOiB2YWx1ZTsKICAgIHJldHVybiBlbGVtZW50OwogIH0sCgogIGdldERpbWVuc2lvbnM6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwogICAgdmFyIGRpc3BsYXkgPSBFbGVtZW50LmdldFN0eWxlKGVsZW1lbnQsICdkaXNwbGF5Jyk7CiAgICBpZiAoZGlzcGxheSAhPSAnbm9uZScgJiYgZGlzcGxheSAhPSBudWxsKSAvLyBTYWZhcmkgYnVnCiAgICAgIHJldHVybiB7d2lkdGg6IGVsZW1lbnQub2Zmc2V0V2lkdGgsIGhlaWdodDogZWxlbWVudC5vZmZzZXRIZWlnaHR9OwoKICAgIHZhciBlbHMgPSBlbGVtZW50LnN0eWxlOwogICAgdmFyIG9yaWdpbmFsVmlzaWJpbGl0eSA9IGVscy52aXNpYmlsaXR5OwogICAgdmFyIG9yaWdpbmFsUG9zaXRpb24gPSBlbHMucG9zaXRpb247CiAgICB2YXIgb3JpZ2luYWxEaXNwbGF5ID0gZWxzLmRpc3BsYXk7CiAgICBlbHMudmlzaWJpbGl0eSA9ICdoaWRkZW4nOwogICAgaWYgKG9yaWdpbmFsUG9zaXRpb24gIT0gJ2ZpeGVkJykgLy8gU3dpdGNoaW5nIGZpeGVkIHRvIGFic29sdXRlIGNhdXNlcyBpc3N1ZXMgaW4gU2FmYXJpCiAgICAgIGVscy5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CiAgICBlbHMuZGlzcGxheSA9ICdibG9jayc7CiAgICB2YXIgb3JpZ2luYWxXaWR0aCA9IGVsZW1lbnQuY2xpZW50V2lkdGg7CiAgICB2YXIgb3JpZ2luYWxIZWlnaHQgPSBlbGVtZW50LmNsaWVudEhlaWdodDsKICAgIGVscy5kaXNwbGF5ID0gb3JpZ2luYWxEaXNwbGF5OwogICAgZWxzLnBvc2l0aW9uID0gb3JpZ2luYWxQb3NpdGlvbjsKICAgIGVscy52aXNpYmlsaXR5ID0gb3JpZ2luYWxWaXNpYmlsaXR5OwogICAgcmV0dXJuIHt3aWR0aDogb3JpZ2luYWxXaWR0aCwgaGVpZ2h0OiBvcmlnaW5hbEhlaWdodH07CiAgfSwKCiAgbWFrZVBvc2l0aW9uZWQ6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwogICAgdmFyIHBvcyA9IEVsZW1lbnQuZ2V0U3R5bGUoZWxlbWVudCwgJ3Bvc2l0aW9uJyk7CiAgICBpZiAocG9zID09ICdzdGF0aWMnIHx8ICFwb3MpIHsKICAgICAgZWxlbWVudC5fbWFkZVBvc2l0aW9uZWQgPSB0cnVlOwogICAgICBlbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJzsKICAgICAgaWYgKFByb3RvdHlwZS5Ccm93c2VyLk9wZXJhKSB7CiAgICAgICAgZWxlbWVudC5zdHlsZS50b3AgPSAwOwogICAgICAgIGVsZW1lbnQuc3R5bGUubGVmdCA9IDA7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBlbGVtZW50OwogIH0sCgogIHVuZG9Qb3NpdGlvbmVkOiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICBlbGVtZW50ID0gJChlbGVtZW50KTsKICAgIGlmIChlbGVtZW50Ll9tYWRlUG9zaXRpb25lZCkgewogICAgICBlbGVtZW50Ll9tYWRlUG9zaXRpb25lZCA9IHVuZGVmaW5lZDsKICAgICAgZWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9CiAgICAgICAgZWxlbWVudC5zdHlsZS50b3AgPQogICAgICAgIGVsZW1lbnQuc3R5bGUubGVmdCA9CiAgICAgICAgZWxlbWVudC5zdHlsZS5ib3R0b20gPQogICAgICAgIGVsZW1lbnQuc3R5bGUucmlnaHQgPSAnJzsKICAgIH0KICAgIHJldHVybiBlbGVtZW50OwogIH0sCgogIG1ha2VDbGlwcGluZzogZnVuY3Rpb24oZWxlbWVudCkgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICBpZiAoZWxlbWVudC5fb3ZlcmZsb3cpIHJldHVybiBlbGVtZW50OwogICAgZWxlbWVudC5fb3ZlcmZsb3cgPSBFbGVtZW50LmdldFN0eWxlKGVsZW1lbnQsICdvdmVyZmxvdycpIHx8ICdhdXRvJzsKICAgIGlmIChlbGVtZW50Ll9vdmVyZmxvdyAhPT0gJ2hpZGRlbicpCiAgICAgIGVsZW1lbnQuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJzsKICAgIHJldHVybiBlbGVtZW50OwogIH0sCgogIHVuZG9DbGlwcGluZzogZnVuY3Rpb24oZWxlbWVudCkgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICBpZiAoIWVsZW1lbnQuX292ZXJmbG93KSByZXR1cm4gZWxlbWVudDsKICAgIGVsZW1lbnQuc3R5bGUub3ZlcmZsb3cgPSBlbGVtZW50Ll9vdmVyZmxvdyA9PSAnYXV0bycgPyAnJyA6IGVsZW1lbnQuX292ZXJmbG93OwogICAgZWxlbWVudC5fb3ZlcmZsb3cgPSBudWxsOwogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfSwKCiAgY3VtdWxhdGl2ZU9mZnNldDogZnVuY3Rpb24oZWxlbWVudCkgewogICAgdmFyIHZhbHVlVCA9IDAsIHZhbHVlTCA9IDA7CiAgICBkbyB7CiAgICAgIHZhbHVlVCArPSBlbGVtZW50Lm9mZnNldFRvcCAgfHwgMDsKICAgICAgdmFsdWVMICs9IGVsZW1lbnQub2Zmc2V0TGVmdCB8fCAwOwogICAgICBlbGVtZW50ID0gZWxlbWVudC5vZmZzZXRQYXJlbnQ7CiAgICB9IHdoaWxlIChlbGVtZW50KTsKICAgIHJldHVybiBFbGVtZW50Ll9yZXR1cm5PZmZzZXQodmFsdWVMLCB2YWx1ZVQpOwogIH0sCgogIHBvc2l0aW9uZWRPZmZzZXQ6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIHZhciB2YWx1ZVQgPSAwLCB2YWx1ZUwgPSAwOwogICAgZG8gewogICAgICB2YWx1ZVQgKz0gZWxlbWVudC5vZmZzZXRUb3AgIHx8IDA7CiAgICAgIHZhbHVlTCArPSBlbGVtZW50Lm9mZnNldExlZnQgfHwgMDsKICAgICAgZWxlbWVudCA9IGVsZW1lbnQub2Zmc2V0UGFyZW50OwogICAgICBpZiAoZWxlbWVudCkgewogICAgICAgIGlmIChlbGVtZW50LnRhZ05hbWUudG9VcHBlckNhc2UoKSA9PSAnQk9EWScpIGJyZWFrOwogICAgICAgIHZhciBwID0gRWxlbWVudC5nZXRTdHlsZShlbGVtZW50LCAncG9zaXRpb24nKTsKICAgICAgICBpZiAocCAhPT0gJ3N0YXRpYycpIGJyZWFrOwogICAgICB9CiAgICB9IHdoaWxlIChlbGVtZW50KTsKICAgIHJldHVybiBFbGVtZW50Ll9yZXR1cm5PZmZzZXQodmFsdWVMLCB2YWx1ZVQpOwogIH0sCgogIGFic29sdXRpemU6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwogICAgaWYgKEVsZW1lbnQuZ2V0U3R5bGUoZWxlbWVudCwgJ3Bvc2l0aW9uJykgPT0gJ2Fic29sdXRlJykgcmV0dXJuIGVsZW1lbnQ7CgogICAgdmFyIG9mZnNldHMgPSBFbGVtZW50LnBvc2l0aW9uZWRPZmZzZXQoZWxlbWVudCk7CiAgICB2YXIgdG9wICAgICA9IG9mZnNldHNbMV07CiAgICB2YXIgbGVmdCAgICA9IG9mZnNldHNbMF07CiAgICB2YXIgd2lkdGggICA9IGVsZW1lbnQuY2xpZW50V2lkdGg7CiAgICB2YXIgaGVpZ2h0ICA9IGVsZW1lbnQuY2xpZW50SGVpZ2h0OwoKICAgIGVsZW1lbnQuX29yaWdpbmFsTGVmdCAgID0gbGVmdCAtIHBhcnNlRmxvYXQoZWxlbWVudC5zdHlsZS5sZWZ0ICB8fCAwKTsKICAgIGVsZW1lbnQuX29yaWdpbmFsVG9wICAgID0gdG9wICAtIHBhcnNlRmxvYXQoZWxlbWVudC5zdHlsZS50b3AgfHwgMCk7CiAgICBlbGVtZW50Ll9vcmlnaW5hbFdpZHRoICA9IGVsZW1lbnQuc3R5bGUud2lkdGg7CiAgICBlbGVtZW50Ll9vcmlnaW5hbEhlaWdodCA9IGVsZW1lbnQuc3R5bGUuaGVpZ2h0OwoKICAgIGVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwogICAgZWxlbWVudC5zdHlsZS50b3AgICAgPSB0b3AgKyAncHgnOwogICAgZWxlbWVudC5zdHlsZS5sZWZ0ICAgPSBsZWZ0ICsgJ3B4JzsKICAgIGVsZW1lbnQuc3R5bGUud2lkdGggID0gd2lkdGggKyAncHgnOwogICAgZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBoZWlnaHQgKyAncHgnOwogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfSwKCiAgcmVsYXRpdml6ZTogZnVuY3Rpb24oZWxlbWVudCkgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICBpZiAoRWxlbWVudC5nZXRTdHlsZShlbGVtZW50LCAncG9zaXRpb24nKSA9PSAncmVsYXRpdmUnKSByZXR1cm4gZWxlbWVudDsKCiAgICBlbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJzsKICAgIHZhciB0b3AgID0gcGFyc2VGbG9hdChlbGVtZW50LnN0eWxlLnRvcCAgfHwgMCkgLSAoZWxlbWVudC5fb3JpZ2luYWxUb3AgfHwgMCk7CiAgICB2YXIgbGVmdCA9IHBhcnNlRmxvYXQoZWxlbWVudC5zdHlsZS5sZWZ0IHx8IDApIC0gKGVsZW1lbnQuX29yaWdpbmFsTGVmdCB8fCAwKTsKCiAgICBlbGVtZW50LnN0eWxlLnRvcCAgICA9IHRvcCArICdweCc7CiAgICBlbGVtZW50LnN0eWxlLmxlZnQgICA9IGxlZnQgKyAncHgnOwogICAgZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBlbGVtZW50Ll9vcmlnaW5hbEhlaWdodDsKICAgIGVsZW1lbnQuc3R5bGUud2lkdGggID0gZWxlbWVudC5fb3JpZ2luYWxXaWR0aDsKICAgIHJldHVybiBlbGVtZW50OwogIH0sCgogIGN1bXVsYXRpdmVTY3JvbGxPZmZzZXQ6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIHZhciB2YWx1ZVQgPSAwLCB2YWx1ZUwgPSAwOwogICAgZG8gewogICAgICB2YWx1ZVQgKz0gZWxlbWVudC5zY3JvbGxUb3AgIHx8IDA7CiAgICAgIHZhbHVlTCArPSBlbGVtZW50LnNjcm9sbExlZnQgfHwgMDsKICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZTsKICAgIH0gd2hpbGUgKGVsZW1lbnQpOwogICAgcmV0dXJuIEVsZW1lbnQuX3JldHVybk9mZnNldCh2YWx1ZUwsIHZhbHVlVCk7CiAgfSwKCiAgZ2V0T2Zmc2V0UGFyZW50OiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICBpZiAoZWxlbWVudC5vZmZzZXRQYXJlbnQpIHJldHVybiAkKGVsZW1lbnQub2Zmc2V0UGFyZW50KTsKICAgIGlmIChlbGVtZW50ID09IGRvY3VtZW50LmJvZHkpIHJldHVybiAkKGVsZW1lbnQpOwoKICAgIHdoaWxlICgoZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSkgJiYgZWxlbWVudCAhPSBkb2N1bWVudC5ib2R5KQogICAgICBpZiAoRWxlbWVudC5nZXRTdHlsZShlbGVtZW50LCAncG9zaXRpb24nKSAhPSAnc3RhdGljJykKICAgICAgICByZXR1cm4gJChlbGVtZW50KTsKCiAgICByZXR1cm4gJChkb2N1bWVudC5ib2R5KTsKICB9LAoKICB2aWV3cG9ydE9mZnNldDogZnVuY3Rpb24oZm9yRWxlbWVudCkgewogICAgdmFyIHZhbHVlVCA9IDAsIHZhbHVlTCA9IDA7CgogICAgdmFyIGVsZW1lbnQgPSBmb3JFbGVtZW50OwogICAgZG8gewogICAgICB2YWx1ZVQgKz0gZWxlbWVudC5vZmZzZXRUb3AgIHx8IDA7CiAgICAgIHZhbHVlTCArPSBlbGVtZW50Lm9mZnNldExlZnQgfHwgMDsKCiAgICAgIGlmIChlbGVtZW50Lm9mZnNldFBhcmVudCA9PSBkb2N1bWVudC5ib2R5ICYmCiAgICAgICAgRWxlbWVudC5nZXRTdHlsZShlbGVtZW50LCAncG9zaXRpb24nKSA9PSAnYWJzb2x1dGUnKSBicmVhazsKCiAgICB9IHdoaWxlIChlbGVtZW50ID0gZWxlbWVudC5vZmZzZXRQYXJlbnQpOwoKICAgIGVsZW1lbnQgPSBmb3JFbGVtZW50OwogICAgZG8gewogICAgICBpZiAoIVByb3RvdHlwZS5Ccm93c2VyLk9wZXJhIHx8IChlbGVtZW50LnRhZ05hbWUgJiYgKGVsZW1lbnQudGFnTmFtZS50b1VwcGVyQ2FzZSgpID09ICdCT0RZJykpKSB7CiAgICAgICAgdmFsdWVUIC09IGVsZW1lbnQuc2Nyb2xsVG9wICB8fCAwOwogICAgICAgIHZhbHVlTCAtPSBlbGVtZW50LnNjcm9sbExlZnQgfHwgMDsKICAgICAgfQogICAgfSB3aGlsZSAoZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSk7CgogICAgcmV0dXJuIEVsZW1lbnQuX3JldHVybk9mZnNldCh2YWx1ZUwsIHZhbHVlVCk7CiAgfSwKCiAgY2xvbmVQb3NpdGlvbjogZnVuY3Rpb24oZWxlbWVudCwgc291cmNlKSB7CiAgICB2YXIgb3B0aW9ucyA9IE9iamVjdC5leHRlbmQoewogICAgICBzZXRMZWZ0OiAgICB0cnVlLAogICAgICBzZXRUb3A6ICAgICB0cnVlLAogICAgICBzZXRXaWR0aDogICB0cnVlLAogICAgICBzZXRIZWlnaHQ6ICB0cnVlLAogICAgICBvZmZzZXRUb3A6ICAwLAogICAgICBvZmZzZXRMZWZ0OiAwCiAgICB9LCBhcmd1bWVudHNbMl0gfHwgeyB9KTsKCiAgICBzb3VyY2UgPSAkKHNvdXJjZSk7CiAgICB2YXIgcCA9IEVsZW1lbnQudmlld3BvcnRPZmZzZXQoc291cmNlKTsKCiAgICBlbGVtZW50ID0gJChlbGVtZW50KTsKICAgIHZhciBkZWx0YSA9IFswLCAwXTsKICAgIHZhciBwYXJlbnQgPSBudWxsOwogICAgaWYgKEVsZW1lbnQuZ2V0U3R5bGUoZWxlbWVudCwgJ3Bvc2l0aW9uJykgPT0gJ2Fic29sdXRlJykgewogICAgICBwYXJlbnQgPSBFbGVtZW50LmdldE9mZnNldFBhcmVudChlbGVtZW50KTsKICAgICAgZGVsdGEgPSBFbGVtZW50LnZpZXdwb3J0T2Zmc2V0KHBhcmVudCk7CiAgICB9CgogICAgaWYgKHBhcmVudCA9PSBkb2N1bWVudC5ib2R5KSB7CiAgICAgIGRlbHRhWzBdIC09IGRvY3VtZW50LmJvZHkub2Zmc2V0TGVmdDsKICAgICAgZGVsdGFbMV0gLT0gZG9jdW1lbnQuYm9keS5vZmZzZXRUb3A7CiAgICB9CgogICAgaWYgKG9wdGlvbnMuc2V0TGVmdCkgICBlbGVtZW50LnN0eWxlLmxlZnQgID0gKHBbMF0gLSBkZWx0YVswXSArIG9wdGlvbnMub2Zmc2V0TGVmdCkgKyAncHgnOwogICAgaWYgKG9wdGlvbnMuc2V0VG9wKSAgICBlbGVtZW50LnN0eWxlLnRvcCAgID0gKHBbMV0gLSBkZWx0YVsxXSArIG9wdGlvbnMub2Zmc2V0VG9wKSArICdweCc7CiAgICBpZiAob3B0aW9ucy5zZXRXaWR0aCkgIGVsZW1lbnQuc3R5bGUud2lkdGggPSBzb3VyY2Uub2Zmc2V0V2lkdGggKyAncHgnOwogICAgaWYgKG9wdGlvbnMuc2V0SGVpZ2h0KSBlbGVtZW50LnN0eWxlLmhlaWdodCA9IHNvdXJjZS5vZmZzZXRIZWlnaHQgKyAncHgnOwogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfQp9OwoKT2JqZWN0LmV4dGVuZChFbGVtZW50Lk1ldGhvZHMsIHsKICBnZXRFbGVtZW50c0J5U2VsZWN0b3I6IEVsZW1lbnQuTWV0aG9kcy5zZWxlY3QsCgogIGNoaWxkRWxlbWVudHM6IEVsZW1lbnQuTWV0aG9kcy5pbW1lZGlhdGVEZXNjZW5kYW50cwp9KTsKCkVsZW1lbnQuX2F0dHJpYnV0ZVRyYW5zbGF0aW9ucyA9IHsKICB3cml0ZTogewogICAgbmFtZXM6IHsKICAgICAgY2xhc3NOYW1lOiAnY2xhc3MnLAogICAgICBodG1sRm9yOiAgICdmb3InCiAgICB9LAogICAgdmFsdWVzOiB7IH0KICB9Cn07CgppZiAoUHJvdG90eXBlLkJyb3dzZXIuT3BlcmEpIHsKICBFbGVtZW50Lk1ldGhvZHMuZ2V0U3R5bGUgPSBFbGVtZW50Lk1ldGhvZHMuZ2V0U3R5bGUud3JhcCgKICAgIGZ1bmN0aW9uKHByb2NlZWQsIGVsZW1lbnQsIHN0eWxlKSB7CiAgICAgIHN3aXRjaCAoc3R5bGUpIHsKICAgICAgICBjYXNlICdsZWZ0JzogY2FzZSAndG9wJzogY2FzZSAncmlnaHQnOiBjYXNlICdib3R0b20nOgogICAgICAgICAgaWYgKHByb2NlZWQoZWxlbWVudCwgJ3Bvc2l0aW9uJykgPT09ICdzdGF0aWMnKSByZXR1cm4gbnVsbDsKICAgICAgICBjYXNlICdoZWlnaHQnOiBjYXNlICd3aWR0aCc6CiAgICAgICAgICBpZiAoIUVsZW1lbnQudmlzaWJsZShlbGVtZW50KSkgcmV0dXJuIG51bGw7CgogICAgICAgICAgdmFyIGRpbSA9IHBhcnNlSW50KHByb2NlZWQoZWxlbWVudCwgc3R5bGUpLCAxMCk7CgogICAgICAgICAgaWYgKGRpbSAhPT0gZWxlbWVudFsnb2Zmc2V0JyArIHN0eWxlLmNhcGl0YWxpemUoKV0pCiAgICAgICAgICAgIHJldHVybiBkaW0gKyAncHgnOwoKICAgICAgICAgIHZhciBwcm9wZXJ0aWVzOwogICAgICAgICAgaWYgKHN0eWxlID09PSAnaGVpZ2h0JykgewogICAgICAgICAgICBwcm9wZXJ0aWVzID0gWydib3JkZXItdG9wLXdpZHRoJywgJ3BhZGRpbmctdG9wJywKICAgICAgICAgICAgICdwYWRkaW5nLWJvdHRvbScsICdib3JkZXItYm90dG9tLXdpZHRoJ107CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcHJvcGVydGllcyA9IFsnYm9yZGVyLWxlZnQtd2lkdGgnLCAncGFkZGluZy1sZWZ0JywKICAgICAgICAgICAgICdwYWRkaW5nLXJpZ2h0JywgJ2JvcmRlci1yaWdodC13aWR0aCddOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHByb3BlcnRpZXMuaW5qZWN0KGRpbSwgZnVuY3Rpb24obWVtbywgcHJvcGVydHkpIHsKICAgICAgICAgICAgdmFyIHZhbCA9IHByb2NlZWQoZWxlbWVudCwgcHJvcGVydHkpOwogICAgICAgICAgICByZXR1cm4gdmFsID09PSBudWxsID8gbWVtbyA6IG1lbW8gLSBwYXJzZUludCh2YWwsIDEwKTsKICAgICAgICAgIH0pICsgJ3B4JzsKICAgICAgICBkZWZhdWx0OiByZXR1cm4gcHJvY2VlZChlbGVtZW50LCBzdHlsZSk7CiAgICAgIH0KICAgIH0KICApOwoKICBFbGVtZW50Lk1ldGhvZHMucmVhZEF0dHJpYnV0ZSA9IEVsZW1lbnQuTWV0aG9kcy5yZWFkQXR0cmlidXRlLndyYXAoCiAgICBmdW5jdGlvbihwcm9jZWVkLCBlbGVtZW50LCBhdHRyaWJ1dGUpIHsKICAgICAgaWYgKGF0dHJpYnV0ZSA9PT0gJ3RpdGxlJykgcmV0dXJuIGVsZW1lbnQudGl0bGU7CiAgICAgIHJldHVybiBwcm9jZWVkKGVsZW1lbnQsIGF0dHJpYnV0ZSk7CiAgICB9CiAgKTsKfQoKZWxzZSBpZiAoUHJvdG90eXBlLkJyb3dzZXIuSUUpIHsKICBFbGVtZW50Lk1ldGhvZHMuZ2V0T2Zmc2V0UGFyZW50ID0gRWxlbWVudC5NZXRob2RzLmdldE9mZnNldFBhcmVudC53cmFwKAogICAgZnVuY3Rpb24ocHJvY2VlZCwgZWxlbWVudCkgewogICAgICBlbGVtZW50ID0gJChlbGVtZW50KTsKICAgICAgdHJ5IHsgZWxlbWVudC5vZmZzZXRQYXJlbnQgfQogICAgICBjYXRjaChlKSB7IHJldHVybiAkKGRvY3VtZW50LmJvZHkpIH0KICAgICAgdmFyIHBvc2l0aW9uID0gZWxlbWVudC5nZXRTdHlsZSgncG9zaXRpb24nKTsKICAgICAgaWYgKHBvc2l0aW9uICE9PSAnc3RhdGljJykgcmV0dXJuIHByb2NlZWQoZWxlbWVudCk7CiAgICAgIGVsZW1lbnQuc2V0U3R5bGUoeyBwb3NpdGlvbjogJ3JlbGF0aXZlJyB9KTsKICAgICAgdmFyIHZhbHVlID0gcHJvY2VlZChlbGVtZW50KTsKICAgICAgZWxlbWVudC5zZXRTdHlsZSh7IHBvc2l0aW9uOiBwb3NpdGlvbiB9KTsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICk7CgogICR3KCdwb3NpdGlvbmVkT2Zmc2V0IHZpZXdwb3J0T2Zmc2V0JykuZWFjaChmdW5jdGlvbihtZXRob2QpIHsKICAgIEVsZW1lbnQuTWV0aG9kc1ttZXRob2RdID0gRWxlbWVudC5NZXRob2RzW21ldGhvZF0ud3JhcCgKICAgICAgZnVuY3Rpb24ocHJvY2VlZCwgZWxlbWVudCkgewogICAgICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwogICAgICAgIHRyeSB7IGVsZW1lbnQub2Zmc2V0UGFyZW50IH0KICAgICAgICBjYXRjaChlKSB7IHJldHVybiBFbGVtZW50Ll9yZXR1cm5PZmZzZXQoMCwwKSB9CiAgICAgICAgdmFyIHBvc2l0aW9uID0gZWxlbWVudC5nZXRTdHlsZSgncG9zaXRpb24nKTsKICAgICAgICBpZiAocG9zaXRpb24gIT09ICdzdGF0aWMnKSByZXR1cm4gcHJvY2VlZChlbGVtZW50KTsKICAgICAgICB2YXIgb2Zmc2V0UGFyZW50ID0gZWxlbWVudC5nZXRPZmZzZXRQYXJlbnQoKTsKICAgICAgICBpZiAob2Zmc2V0UGFyZW50ICYmIG9mZnNldFBhcmVudC5nZXRTdHlsZSgncG9zaXRpb24nKSA9PT0gJ2ZpeGVkJykKICAgICAgICAgIG9mZnNldFBhcmVudC5zZXRTdHlsZSh7IHpvb206IDEgfSk7CiAgICAgICAgZWxlbWVudC5zZXRTdHlsZSh7IHBvc2l0aW9uOiAncmVsYXRpdmUnIH0pOwogICAgICAgIHZhciB2YWx1ZSA9IHByb2NlZWQoZWxlbWVudCk7CiAgICAgICAgZWxlbWVudC5zZXRTdHlsZSh7IHBvc2l0aW9uOiBwb3NpdGlvbiB9KTsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH0KICAgICk7CiAgfSk7CgogIEVsZW1lbnQuTWV0aG9kcy5jdW11bGF0aXZlT2Zmc2V0ID0gRWxlbWVudC5NZXRob2RzLmN1bXVsYXRpdmVPZmZzZXQud3JhcCgKICAgIGZ1bmN0aW9uKHByb2NlZWQsIGVsZW1lbnQpIHsKICAgICAgdHJ5IHsgZWxlbWVudC5vZmZzZXRQYXJlbnQgfQogICAgICBjYXRjaChlKSB7IHJldHVybiBFbGVtZW50Ll9yZXR1cm5PZmZzZXQoMCwwKSB9CiAgICAgIHJldHVybiBwcm9jZWVkKGVsZW1lbnQpOwogICAgfQogICk7CgogIEVsZW1lbnQuTWV0aG9kcy5nZXRTdHlsZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIHN0eWxlKSB7CiAgICBlbGVtZW50ID0gJChlbGVtZW50KTsKICAgIHN0eWxlID0gKHN0eWxlID09ICdmbG9hdCcgfHwgc3R5bGUgPT0gJ2Nzc0Zsb2F0JykgPyAnc3R5bGVGbG9hdCcgOiBzdHlsZS5jYW1lbGl6ZSgpOwogICAgdmFyIHZhbHVlID0gZWxlbWVudC5zdHlsZVtzdHlsZV07CiAgICBpZiAoIXZhbHVlICYmIGVsZW1lbnQuY3VycmVudFN0eWxlKSB2YWx1ZSA9IGVsZW1lbnQuY3VycmVudFN0eWxlW3N0eWxlXTsKCiAgICBpZiAoc3R5bGUgPT0gJ29wYWNpdHknKSB7CiAgICAgIGlmICh2YWx1ZSA9IChlbGVtZW50LmdldFN0eWxlKCdmaWx0ZXInKSB8fCAnJykubWF0Y2goL2FscGhhXChvcGFjaXR5PSguKilcKS8pKQogICAgICAgIGlmICh2YWx1ZVsxXSkgcmV0dXJuIHBhcnNlRmxvYXQodmFsdWVbMV0pIC8gMTAwOwogICAgICByZXR1cm4gMS4wOwogICAgfQoKICAgIGlmICh2YWx1ZSA9PSAnYXV0bycpIHsKICAgICAgaWYgKChzdHlsZSA9PSAnd2lkdGgnIHx8IHN0eWxlID09ICdoZWlnaHQnKSAmJiAoZWxlbWVudC5nZXRTdHlsZSgnZGlzcGxheScpICE9ICdub25lJykpCiAgICAgICAgcmV0dXJuIGVsZW1lbnRbJ29mZnNldCcgKyBzdHlsZS5jYXBpdGFsaXplKCldICsgJ3B4JzsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICByZXR1cm4gdmFsdWU7CiAgfTsKCiAgRWxlbWVudC5NZXRob2RzLnNldE9wYWNpdHkgPSBmdW5jdGlvbihlbGVtZW50LCB2YWx1ZSkgewogICAgZnVuY3Rpb24gc3RyaXBBbHBoYShmaWx0ZXIpewogICAgICByZXR1cm4gZmlsdGVyLnJlcGxhY2UoL2FscGhhXChbXlwpXSpcKS9naSwnJyk7CiAgICB9CiAgICBlbGVtZW50ID0gJChlbGVtZW50KTsKICAgIHZhciBjdXJyZW50U3R5bGUgPSBlbGVtZW50LmN1cnJlbnRTdHlsZTsKICAgIGlmICgoY3VycmVudFN0eWxlICYmICFjdXJyZW50U3R5bGUuaGFzTGF5b3V0KSB8fAogICAgICAoIWN1cnJlbnRTdHlsZSAmJiBlbGVtZW50LnN0eWxlLnpvb20gPT0gJ25vcm1hbCcpKQogICAgICAgIGVsZW1lbnQuc3R5bGUuem9vbSA9IDE7CgogICAgdmFyIGZpbHRlciA9IGVsZW1lbnQuZ2V0U3R5bGUoJ2ZpbHRlcicpLCBzdHlsZSA9IGVsZW1lbnQuc3R5bGU7CiAgICBpZiAodmFsdWUgPT0gMSB8fCB2YWx1ZSA9PT0gJycpIHsKICAgICAgKGZpbHRlciA9IHN0cmlwQWxwaGEoZmlsdGVyKSkgPwogICAgICAgIHN0eWxlLmZpbHRlciA9IGZpbHRlciA6IHN0eWxlLnJlbW92ZUF0dHJpYnV0ZSgnZmlsdGVyJyk7CiAgICAgIHJldHVybiBlbGVtZW50OwogICAgfSBlbHNlIGlmICh2YWx1ZSA8IDAuMDAwMDEpIHZhbHVlID0gMDsKICAgIHN0eWxlLmZpbHRlciA9IHN0cmlwQWxwaGEoZmlsdGVyKSArCiAgICAgICdhbHBoYShvcGFjaXR5PScgKyAodmFsdWUgKiAxMDApICsgJyknOwogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfTsKCiAgRWxlbWVudC5fYXR0cmlidXRlVHJhbnNsYXRpb25zID0gKGZ1bmN0aW9uKCl7CgogICAgdmFyIGNsYXNzUHJvcCA9ICdjbGFzc05hbWUnOwogICAgdmFyIGZvclByb3AgPSAnZm9yJzsKCiAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCiAgICBlbC5zZXRBdHRyaWJ1dGUoY2xhc3NQcm9wLCAneCcpOwoKICAgIGlmIChlbC5jbGFzc05hbWUgIT09ICd4JykgewogICAgICBlbC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3gnKTsKICAgICAgaWYgKGVsLmNsYXNzTmFtZSA9PT0gJ3gnKSB7CiAgICAgICAgY2xhc3NQcm9wID0gJ2NsYXNzJzsKICAgICAgfQogICAgfQogICAgZWwgPSBudWxsOwoKICAgIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTsKICAgIGVsLnNldEF0dHJpYnV0ZShmb3JQcm9wLCAneCcpOwogICAgaWYgKGVsLmh0bWxGb3IgIT09ICd4JykgewogICAgICBlbC5zZXRBdHRyaWJ1dGUoJ2h0bWxGb3InLCAneCcpOwogICAgICBpZiAoZWwuaHRtbEZvciA9PT0gJ3gnKSB7CiAgICAgICAgZm9yUHJvcCA9ICdodG1sRm9yJzsKICAgICAgfQogICAgfQogICAgZWwgPSBudWxsOwoKICAgIHJldHVybiB7CiAgICAgIHJlYWQ6IHsKICAgICAgICBuYW1lczogewogICAgICAgICAgJ2NsYXNzJzogICAgICBjbGFzc1Byb3AsCiAgICAgICAgICAnY2xhc3NOYW1lJzogIGNsYXNzUHJvcCwKICAgICAgICAgICdmb3InOiAgICAgICAgZm9yUHJvcCwKICAgICAgICAgICdodG1sRm9yJzogICAgZm9yUHJvcAogICAgICAgIH0sCiAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICBfZ2V0QXR0cjogZnVuY3Rpb24oZWxlbWVudCwgYXR0cmlidXRlKSB7CiAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpOwogICAgICAgICAgfSwKICAgICAgICAgIF9nZXRBdHRyMjogZnVuY3Rpb24oZWxlbWVudCwgYXR0cmlidXRlKSB7CiAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUsIDIpOwogICAgICAgICAgfSwKICAgICAgICAgIF9nZXRBdHRyTm9kZTogZnVuY3Rpb24oZWxlbWVudCwgYXR0cmlidXRlKSB7CiAgICAgICAgICAgIHZhciBub2RlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGVOb2RlKGF0dHJpYnV0ZSk7CiAgICAgICAgICAgIHJldHVybiBub2RlID8gbm9kZS52YWx1ZSA6ICIiOwogICAgICAgICAgfSwKICAgICAgICAgIF9nZXRFdjogKGZ1bmN0aW9uKCl7CgogICAgICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgZWwub25jbGljayA9IFByb3RvdHlwZS5lbXB0eUZ1bmN0aW9uOwogICAgICAgICAgICB2YXIgdmFsdWUgPSBlbC5nZXRBdHRyaWJ1dGUoJ29uY2xpY2snKTsKICAgICAgICAgICAgdmFyIGY7CgogICAgICAgICAgICBpZiAoU3RyaW5nKHZhbHVlKS5pbmRleE9mKCd7JykgPiAtMSkgewogICAgICAgICAgICAgIGYgPSBmdW5jdGlvbihlbGVtZW50LCBhdHRyaWJ1dGUpIHsKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSk7CiAgICAgICAgICAgICAgICBpZiAoIWF0dHJpYnV0ZSkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGUudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZS5zcGxpdCgneycpWzFdOwogICAgICAgICAgICAgICAgYXR0cmlidXRlID0gYXR0cmlidXRlLnNwbGl0KCd9JylbMF07CiAgICAgICAgICAgICAgICByZXR1cm4gYXR0cmlidXRlLnN0cmlwKCk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA9PT0gJycpIHsKICAgICAgICAgICAgICBmID0gZnVuY3Rpb24oZWxlbWVudCwgYXR0cmlidXRlKSB7CiAgICAgICAgICAgICAgICBhdHRyaWJ1dGUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpOwogICAgICAgICAgICAgICAgaWYgKCFhdHRyaWJ1dGUpIHJldHVybiBudWxsOwogICAgICAgICAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZS5zdHJpcCgpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWwgPSBudWxsOwogICAgICAgICAgICByZXR1cm4gZjsKICAgICAgICAgIH0pKCksCiAgICAgICAgICBfZmxhZzogZnVuY3Rpb24oZWxlbWVudCwgYXR0cmlidXRlKSB7CiAgICAgICAgICAgIHJldHVybiAkKGVsZW1lbnQpLmhhc0F0dHJpYnV0ZShhdHRyaWJ1dGUpID8gYXR0cmlidXRlIDogbnVsbDsKICAgICAgICAgIH0sCiAgICAgICAgICBzdHlsZTogZnVuY3Rpb24oZWxlbWVudCkgewogICAgICAgICAgICByZXR1cm4gZWxlbWVudC5zdHlsZS5jc3NUZXh0LnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICB9LAogICAgICAgICAgdGl0bGU6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQudGl0bGU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSkoKTsKCiAgRWxlbWVudC5fYXR0cmlidXRlVHJhbnNsYXRpb25zLndyaXRlID0gewogICAgbmFtZXM6IE9iamVjdC5leHRlbmQoewogICAgICBjZWxscGFkZGluZzogJ2NlbGxQYWRkaW5nJywKICAgICAgY2VsbHNwYWNpbmc6ICdjZWxsU3BhY2luZycKICAgIH0sIEVsZW1lbnQuX2F0dHJpYnV0ZVRyYW5zbGF0aW9ucy5yZWFkLm5hbWVzKSwKICAgIHZhbHVlczogewogICAgICBjaGVja2VkOiBmdW5jdGlvbihlbGVtZW50LCB2YWx1ZSkgewogICAgICAgIGVsZW1lbnQuY2hlY2tlZCA9ICEhdmFsdWU7CiAgICAgIH0sCgogICAgICBzdHlsZTogZnVuY3Rpb24oZWxlbWVudCwgdmFsdWUpIHsKICAgICAgICBlbGVtZW50LnN0eWxlLmNzc1RleHQgPSB2YWx1ZSA/IHZhbHVlIDogJyc7CiAgICAgIH0KICAgIH0KICB9OwoKICBFbGVtZW50Ll9hdHRyaWJ1dGVUcmFuc2xhdGlvbnMuaGFzID0ge307CgogICR3KCdjb2xTcGFuIHJvd1NwYW4gdkFsaWduIGRhdGVUaW1lIGFjY2Vzc0tleSB0YWJJbmRleCAnICsKICAgICAgJ2VuY1R5cGUgbWF4TGVuZ3RoIHJlYWRPbmx5IGxvbmdEZXNjIGZyYW1lQm9yZGVyJykuZWFjaChmdW5jdGlvbihhdHRyKSB7CiAgICBFbGVtZW50Ll9hdHRyaWJ1dGVUcmFuc2xhdGlvbnMud3JpdGUubmFtZXNbYXR0ci50b0xvd2VyQ2FzZSgpXSA9IGF0dHI7CiAgICBFbGVtZW50Ll9hdHRyaWJ1dGVUcmFuc2xhdGlvbnMuaGFzW2F0dHIudG9Mb3dlckNhc2UoKV0gPSBhdHRyOwogIH0pOwoKICAoZnVuY3Rpb24odikgewogICAgT2JqZWN0LmV4dGVuZCh2LCB7CiAgICAgIGhyZWY6ICAgICAgICB2Ll9nZXRBdHRyMiwKICAgICAgc3JjOiAgICAgICAgIHYuX2dldEF0dHIyLAogICAgICB0eXBlOiAgICAgICAgdi5fZ2V0QXR0ciwKICAgICAgYWN0aW9uOiAgICAgIHYuX2dldEF0dHJOb2RlLAogICAgICBkaXNhYmxlZDogICAgdi5fZmxhZywKICAgICAgY2hlY2tlZDogICAgIHYuX2ZsYWcsCiAgICAgIHJlYWRvbmx5OiAgICB2Ll9mbGFnLAogICAgICBtdWx0aXBsZTogICAgdi5fZmxhZywKICAgICAgb25sb2FkOiAgICAgIHYuX2dldEV2LAogICAgICBvbnVubG9hZDogICAgdi5fZ2V0RXYsCiAgICAgIG9uY2xpY2s6ICAgICB2Ll9nZXRFdiwKICAgICAgb25kYmxjbGljazogIHYuX2dldEV2LAogICAgICBvbm1vdXNlZG93bjogdi5fZ2V0RXYsCiAgICAgIG9ubW91c2V1cDogICB2Ll9nZXRFdiwKICAgICAgb25tb3VzZW92ZXI6IHYuX2dldEV2LAogICAgICBvbm1vdXNlbW92ZTogdi5fZ2V0RXYsCiAgICAgIG9ubW91c2VvdXQ6ICB2Ll9nZXRFdiwKICAgICAgb25mb2N1czogICAgIHYuX2dldEV2LAogICAgICBvbmJsdXI6ICAgICAgdi5fZ2V0RXYsCiAgICAgIG9ua2V5cHJlc3M6ICB2Ll9nZXRFdiwKICAgICAgb25rZXlkb3duOiAgIHYuX2dldEV2LAogICAgICBvbmtleXVwOiAgICAgdi5fZ2V0RXYsCiAgICAgIG9uc3VibWl0OiAgICB2Ll9nZXRFdiwKICAgICAgb25yZXNldDogICAgIHYuX2dldEV2LAogICAgICBvbnNlbGVjdDogICAgdi5fZ2V0RXYsCiAgICAgIG9uY2hhbmdlOiAgICB2Ll9nZXRFdgogICAgfSk7CiAgfSkoRWxlbWVudC5fYXR0cmlidXRlVHJhbnNsYXRpb25zLnJlYWQudmFsdWVzKTsKCiAgaWYgKFByb3RvdHlwZS5Ccm93c2VyRmVhdHVyZXMuRWxlbWVudEV4dGVuc2lvbnMpIHsKICAgIChmdW5jdGlvbigpIHsKICAgICAgZnVuY3Rpb24gX2Rlc2NlbmRhbnRzKGVsZW1lbnQpIHsKICAgICAgICB2YXIgbm9kZXMgPSBlbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCcqJyksIHJlc3VsdHMgPSBbXTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbm9kZTsgbm9kZSA9IG5vZGVzW2ldOyBpKyspCiAgICAgICAgICBpZiAobm9kZS50YWdOYW1lICE9PSAiISIpIC8vIEZpbHRlciBvdXQgY29tbWVudCBub2Rlcy4KICAgICAgICAgICAgcmVzdWx0cy5wdXNoKG5vZGUpOwogICAgICAgIHJldHVybiByZXN1bHRzOwogICAgICB9CgogICAgICBFbGVtZW50Lk1ldGhvZHMuZG93biA9IGZ1bmN0aW9uKGVsZW1lbnQsIGV4cHJlc3Npb24sIGluZGV4KSB7CiAgICAgICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSkgcmV0dXJuIGVsZW1lbnQuZmlyc3REZXNjZW5kYW50KCk7CiAgICAgICAgcmV0dXJuIE9iamVjdC5pc051bWJlcihleHByZXNzaW9uKSA/IF9kZXNjZW5kYW50cyhlbGVtZW50KVtleHByZXNzaW9uXSA6CiAgICAgICAgICBFbGVtZW50LnNlbGVjdChlbGVtZW50LCBleHByZXNzaW9uKVtpbmRleCB8fCAwXTsKICAgICAgfQogICAgfSkoKTsKICB9Cgp9CgplbHNlIGlmIChQcm90b3R5cGUuQnJvd3Nlci5HZWNrbyAmJiAvcnY6MVwuOFwuMC8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkgewogIEVsZW1lbnQuTWV0aG9kcy5zZXRPcGFjaXR5ID0gZnVuY3Rpb24oZWxlbWVudCwgdmFsdWUpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwogICAgZWxlbWVudC5zdHlsZS5vcGFjaXR5ID0gKHZhbHVlID09IDEpID8gMC45OTk5OTkgOgogICAgICAodmFsdWUgPT09ICcnKSA/ICcnIDogKHZhbHVlIDwgMC4wMDAwMSkgPyAwIDogdmFsdWU7CiAgICByZXR1cm4gZWxlbWVudDsKICB9Owp9CgplbHNlIGlmIChQcm90b3R5cGUuQnJvd3Nlci5XZWJLaXQpIHsKICBFbGVtZW50Lk1ldGhvZHMuc2V0T3BhY2l0eSA9IGZ1bmN0aW9uKGVsZW1lbnQsIHZhbHVlKSB7CiAgICBlbGVtZW50ID0gJChlbGVtZW50KTsKICAgIGVsZW1lbnQuc3R5bGUub3BhY2l0eSA9ICh2YWx1ZSA9PSAxIHx8IHZhbHVlID09PSAnJykgPyAnJyA6CiAgICAgICh2YWx1ZSA8IDAuMDAwMDEpID8gMCA6IHZhbHVlOwoKICAgIGlmICh2YWx1ZSA9PSAxKQogICAgICBpZihlbGVtZW50LnRhZ05hbWUudG9VcHBlckNhc2UoKSA9PSAnSU1HJyAmJiBlbGVtZW50LndpZHRoKSB7CiAgICAgICAgZWxlbWVudC53aWR0aCsrOyBlbGVtZW50LndpZHRoLS07CiAgICAgIH0gZWxzZSB0cnkgewogICAgICAgIHZhciBuID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJyAnKTsKICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKG4pOwogICAgICAgIGVsZW1lbnQucmVtb3ZlQ2hpbGQobik7CiAgICAgIH0gY2F0Y2ggKGUpIHsgfQoKICAgIHJldHVybiBlbGVtZW50OwogIH07CgogIEVsZW1lbnQuTWV0aG9kcy5jdW11bGF0aXZlT2Zmc2V0ID0gZnVuY3Rpb24oZWxlbWVudCkgewogICAgdmFyIHZhbHVlVCA9IDAsIHZhbHVlTCA9IDA7CiAgICBkbyB7CiAgICAgIHZhbHVlVCArPSBlbGVtZW50Lm9mZnNldFRvcCAgfHwgMDsKICAgICAgdmFsdWVMICs9IGVsZW1lbnQub2Zmc2V0TGVmdCB8fCAwOwogICAgICBpZiAoZWxlbWVudC5vZmZzZXRQYXJlbnQgPT0gZG9jdW1lbnQuYm9keSkKICAgICAgICBpZiAoRWxlbWVudC5nZXRTdHlsZShlbGVtZW50LCAncG9zaXRpb24nKSA9PSAnYWJzb2x1dGUnKSBicmVhazsKCiAgICAgIGVsZW1lbnQgPSBlbGVtZW50Lm9mZnNldFBhcmVudDsKICAgIH0gd2hpbGUgKGVsZW1lbnQpOwoKICAgIHJldHVybiBFbGVtZW50Ll9yZXR1cm5PZmZzZXQodmFsdWVMLCB2YWx1ZVQpOwogIH07Cn0KCmlmICgnb3V0ZXJIVE1MJyBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHsKICBFbGVtZW50Lk1ldGhvZHMucmVwbGFjZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIGNvbnRlbnQpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwoKICAgIGlmIChjb250ZW50ICYmIGNvbnRlbnQudG9FbGVtZW50KSBjb250ZW50ID0gY29udGVudC50b0VsZW1lbnQoKTsKICAgIGlmIChPYmplY3QuaXNFbGVtZW50KGNvbnRlbnQpKSB7CiAgICAgIGVsZW1lbnQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoY29udGVudCwgZWxlbWVudCk7CiAgICAgIHJldHVybiBlbGVtZW50OwogICAgfQoKICAgIGNvbnRlbnQgPSBPYmplY3QudG9IVE1MKGNvbnRlbnQpOwogICAgdmFyIHBhcmVudCA9IGVsZW1lbnQucGFyZW50Tm9kZSwgdGFnTmFtZSA9IHBhcmVudC50YWdOYW1lLnRvVXBwZXJDYXNlKCk7CgogICAgaWYgKEVsZW1lbnQuX2luc2VydGlvblRyYW5zbGF0aW9ucy50YWdzW3RhZ05hbWVdKSB7CiAgICAgIHZhciBuZXh0U2libGluZyA9IGVsZW1lbnQubmV4dCgpOwogICAgICB2YXIgZnJhZ21lbnRzID0gRWxlbWVudC5fZ2V0Q29udGVudEZyb21Bbm9ueW1vdXNFbGVtZW50KHRhZ05hbWUsIGNvbnRlbnQuc3RyaXBTY3JpcHRzKCkpOwogICAgICBwYXJlbnQucmVtb3ZlQ2hpbGQoZWxlbWVudCk7CiAgICAgIGlmIChuZXh0U2libGluZykKICAgICAgICBmcmFnbWVudHMuZWFjaChmdW5jdGlvbihub2RlKSB7IHBhcmVudC5pbnNlcnRCZWZvcmUobm9kZSwgbmV4dFNpYmxpbmcpIH0pOwogICAgICBlbHNlCiAgICAgICAgZnJhZ21lbnRzLmVhY2goZnVuY3Rpb24obm9kZSkgeyBwYXJlbnQuYXBwZW5kQ2hpbGQobm9kZSkgfSk7CiAgICB9CiAgICBlbHNlIGVsZW1lbnQub3V0ZXJIVE1MID0gY29udGVudC5zdHJpcFNjcmlwdHMoKTsKCiAgICBjb250ZW50LmV2YWxTY3JpcHRzLmJpbmQoY29udGVudCkuZGVmZXIoKTsKICAgIHJldHVybiBlbGVtZW50OwogIH07Cn0KCkVsZW1lbnQuX3JldHVybk9mZnNldCA9IGZ1bmN0aW9uKGwsIHQpIHsKICB2YXIgcmVzdWx0ID0gW2wsIHRdOwogIHJlc3VsdC5sZWZ0ID0gbDsKICByZXN1bHQudG9wID0gdDsKICByZXR1cm4gcmVzdWx0Owp9OwoKRWxlbWVudC5fZ2V0Q29udGVudEZyb21Bbm9ueW1vdXNFbGVtZW50ID0gZnVuY3Rpb24odGFnTmFtZSwgaHRtbCkgewogIHZhciBkaXYgPSBuZXcgRWxlbWVudCgnZGl2JyksIHQgPSBFbGVtZW50Ll9pbnNlcnRpb25UcmFuc2xhdGlvbnMudGFnc1t0YWdOYW1lXTsKICBpZiAodCkgewogICAgZGl2LmlubmVySFRNTCA9IHRbMF0gKyBodG1sICsgdFsxXTsKICAgIHRbMl0udGltZXMoZnVuY3Rpb24oKSB7IGRpdiA9IGRpdi5maXJzdENoaWxkIH0pOwogIH0gZWxzZSBkaXYuaW5uZXJIVE1MID0gaHRtbDsKICByZXR1cm4gJEEoZGl2LmNoaWxkTm9kZXMpOwp9OwoKRWxlbWVudC5faW5zZXJ0aW9uVHJhbnNsYXRpb25zID0gewogIGJlZm9yZTogZnVuY3Rpb24oZWxlbWVudCwgbm9kZSkgewogICAgZWxlbWVudC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShub2RlLCBlbGVtZW50KTsKICB9LAogIHRvcDogZnVuY3Rpb24oZWxlbWVudCwgbm9kZSkgewogICAgZWxlbWVudC5pbnNlcnRCZWZvcmUobm9kZSwgZWxlbWVudC5maXJzdENoaWxkKTsKICB9LAogIGJvdHRvbTogZnVuY3Rpb24oZWxlbWVudCwgbm9kZSkgewogICAgZWxlbWVudC5hcHBlbmRDaGlsZChub2RlKTsKICB9LAogIGFmdGVyOiBmdW5jdGlvbihlbGVtZW50LCBub2RlKSB7CiAgICBlbGVtZW50LnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5vZGUsIGVsZW1lbnQubmV4dFNpYmxpbmcpOwogIH0sCiAgdGFnczogewogICAgVEFCTEU6ICBbJzx0YWJsZT4nLCAgICAgICAgICAgICAgICAnPC90YWJsZT4nLCAgICAgICAgICAgICAgICAgICAxXSwKICAgIFRCT0RZOiAgWyc8dGFibGU+PHRib2R5PicsICAgICAgICAgJzwvdGJvZHk+PC90YWJsZT4nLCAgICAgICAgICAgMl0sCiAgICBUUjogICAgIFsnPHRhYmxlPjx0Ym9keT48dHI+JywgICAgICc8L3RyPjwvdGJvZHk+PC90YWJsZT4nLCAgICAgIDNdLAogICAgVEQ6ICAgICBbJzx0YWJsZT48dGJvZHk+PHRyPjx0ZD4nLCAnPC90ZD48L3RyPjwvdGJvZHk+PC90YWJsZT4nLCA0XSwKICAgIFNFTEVDVDogWyc8c2VsZWN0PicsICAgICAgICAgICAgICAgJzwvc2VsZWN0PicsICAgICAgICAgICAgICAgICAgMV0KICB9Cn07CgooZnVuY3Rpb24oKSB7CiAgdmFyIHRhZ3MgPSBFbGVtZW50Ll9pbnNlcnRpb25UcmFuc2xhdGlvbnMudGFnczsKICBPYmplY3QuZXh0ZW5kKHRhZ3MsIHsKICAgIFRIRUFEOiB0YWdzLlRCT0RZLAogICAgVEZPT1Q6IHRhZ3MuVEJPRFksCiAgICBUSDogICAgdGFncy5URAogIH0pOwp9KSgpOwoKRWxlbWVudC5NZXRob2RzLlNpbXVsYXRlZCA9IHsKICBoYXNBdHRyaWJ1dGU6IGZ1bmN0aW9uKGVsZW1lbnQsIGF0dHJpYnV0ZSkgewogICAgYXR0cmlidXRlID0gRWxlbWVudC5fYXR0cmlidXRlVHJhbnNsYXRpb25zLmhhc1thdHRyaWJ1dGVdIHx8IGF0dHJpYnV0ZTsKICAgIHZhciBub2RlID0gJChlbGVtZW50KS5nZXRBdHRyaWJ1dGVOb2RlKGF0dHJpYnV0ZSk7CiAgICByZXR1cm4gISEobm9kZSAmJiBub2RlLnNwZWNpZmllZCk7CiAgfQp9OwoKRWxlbWVudC5NZXRob2RzLkJ5VGFnID0geyB9OwoKT2JqZWN0LmV4dGVuZChFbGVtZW50LCBFbGVtZW50Lk1ldGhvZHMpOwoKKGZ1bmN0aW9uKGRpdikgewoKICBpZiAoIVByb3RvdHlwZS5Ccm93c2VyRmVhdHVyZXMuRWxlbWVudEV4dGVuc2lvbnMgJiYgZGl2WydfX3Byb3RvX18nXSkgewogICAgd2luZG93LkhUTUxFbGVtZW50ID0geyB9OwogICAgd2luZG93LkhUTUxFbGVtZW50LnByb3RvdHlwZSA9IGRpdlsnX19wcm90b19fJ107CiAgICBQcm90b3R5cGUuQnJvd3NlckZlYXR1cmVzLkVsZW1lbnRFeHRlbnNpb25zID0gdHJ1ZTsKICB9CgogIGRpdiA9IG51bGw7Cgp9KShkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSkKCkVsZW1lbnQuZXh0ZW5kID0gKGZ1bmN0aW9uKCkgewoKICBmdW5jdGlvbiBjaGVja0RlZmljaWVuY3kodGFnTmFtZSkgewogICAgaWYgKHR5cGVvZiB3aW5kb3cuRWxlbWVudCAhPSAndW5kZWZpbmVkJykgewogICAgICB2YXIgcHJvdG8gPSB3aW5kb3cuRWxlbWVudC5wcm90b3R5cGU7CiAgICAgIGlmIChwcm90bykgewogICAgICAgIHZhciBpZCA9ICdfJyArIChNYXRoLnJhbmRvbSgpKycnKS5zbGljZSgyKTsKICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpOwogICAgICAgIHByb3RvW2lkXSA9ICd4JzsKICAgICAgICB2YXIgaXNCdWdneSA9IChlbFtpZF0gIT09ICd4Jyk7CiAgICAgICAgZGVsZXRlIHByb3RvW2lkXTsKICAgICAgICBlbCA9IG51bGw7CiAgICAgICAgcmV0dXJuIGlzQnVnZ3k7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIGV4dGVuZEVsZW1lbnRXaXRoKGVsZW1lbnQsIG1ldGhvZHMpIHsKICAgIGZvciAodmFyIHByb3BlcnR5IGluIG1ldGhvZHMpIHsKICAgICAgdmFyIHZhbHVlID0gbWV0aG9kc1twcm9wZXJ0eV07CiAgICAgIGlmIChPYmplY3QuaXNGdW5jdGlvbih2YWx1ZSkgJiYgIShwcm9wZXJ0eSBpbiBlbGVtZW50KSkKICAgICAgICBlbGVtZW50W3Byb3BlcnR5XSA9IHZhbHVlLm1ldGhvZGl6ZSgpOwogICAgfQogIH0KCiAgdmFyIEhUTUxPQkpFQ1RFTEVNRU5UX1BST1RPVFlQRV9CVUdHWSA9IGNoZWNrRGVmaWNpZW5jeSgnb2JqZWN0Jyk7CgogIGlmIChQcm90b3R5cGUuQnJvd3NlckZlYXR1cmVzLlNwZWNpZmljRWxlbWVudEV4dGVuc2lvbnMpIHsKICAgIGlmIChIVE1MT0JKRUNURUxFTUVOVF9QUk9UT1RZUEVfQlVHR1kpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgICAgICBpZiAoZWxlbWVudCAmJiB0eXBlb2YgZWxlbWVudC5fZXh0ZW5kZWRCeVByb3RvdHlwZSA9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgdmFyIHQgPSBlbGVtZW50LnRhZ05hbWU7CiAgICAgICAgICBpZiAodCAmJiAoL14oPzpvYmplY3R8YXBwbGV0fGVtYmVkKSQvaS50ZXN0KHQpKSkgewogICAgICAgICAgICBleHRlbmRFbGVtZW50V2l0aChlbGVtZW50LCBFbGVtZW50Lk1ldGhvZHMpOwogICAgICAgICAgICBleHRlbmRFbGVtZW50V2l0aChlbGVtZW50LCBFbGVtZW50Lk1ldGhvZHMuU2ltdWxhdGVkKTsKICAgICAgICAgICAgZXh0ZW5kRWxlbWVudFdpdGgoZWxlbWVudCwgRWxlbWVudC5NZXRob2RzLkJ5VGFnW3QudG9VcHBlckNhc2UoKV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZWxlbWVudDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIFByb3RvdHlwZS5LOwogIH0KCiAgdmFyIE1ldGhvZHMgPSB7IH0sIEJ5VGFnID0gRWxlbWVudC5NZXRob2RzLkJ5VGFnOwoKICB2YXIgZXh0ZW5kID0gT2JqZWN0LmV4dGVuZChmdW5jdGlvbihlbGVtZW50KSB7CiAgICBpZiAoIWVsZW1lbnQgfHwgdHlwZW9mIGVsZW1lbnQuX2V4dGVuZGVkQnlQcm90b3R5cGUgIT0gJ3VuZGVmaW5lZCcgfHwKICAgICAgICBlbGVtZW50Lm5vZGVUeXBlICE9IDEgfHwgZWxlbWVudCA9PSB3aW5kb3cpIHJldHVybiBlbGVtZW50OwoKICAgIHZhciBtZXRob2RzID0gT2JqZWN0LmNsb25lKE1ldGhvZHMpLAogICAgICAgIHRhZ05hbWUgPSBlbGVtZW50LnRhZ05hbWUudG9VcHBlckNhc2UoKTsKCiAgICBpZiAoQnlUYWdbdGFnTmFtZV0pIE9iamVjdC5leHRlbmQobWV0aG9kcywgQnlUYWdbdGFnTmFtZV0pOwoKICAgIGV4dGVuZEVsZW1lbnRXaXRoKGVsZW1lbnQsIG1ldGhvZHMpOwoKICAgIGVsZW1lbnQuX2V4dGVuZGVkQnlQcm90b3R5cGUgPSBQcm90b3R5cGUuZW1wdHlGdW5jdGlvbjsKICAgIHJldHVybiBlbGVtZW50OwoKICB9LCB7CiAgICByZWZyZXNoOiBmdW5jdGlvbigpIHsKICAgICAgaWYgKCFQcm90b3R5cGUuQnJvd3NlckZlYXR1cmVzLkVsZW1lbnRFeHRlbnNpb25zKSB7CiAgICAgICAgT2JqZWN0LmV4dGVuZChNZXRob2RzLCBFbGVtZW50Lk1ldGhvZHMpOwogICAgICAgIE9iamVjdC5leHRlbmQoTWV0aG9kcywgRWxlbWVudC5NZXRob2RzLlNpbXVsYXRlZCk7CiAgICAgIH0KICAgIH0KICB9KTsKCiAgZXh0ZW5kLnJlZnJlc2goKTsKICByZXR1cm4gZXh0ZW5kOwp9KSgpOwoKRWxlbWVudC5oYXNBdHRyaWJ1dGUgPSBmdW5jdGlvbihlbGVtZW50LCBhdHRyaWJ1dGUpIHsKICBpZiAoZWxlbWVudC5oYXNBdHRyaWJ1dGUpIHJldHVybiBlbGVtZW50Lmhhc0F0dHJpYnV0ZShhdHRyaWJ1dGUpOwogIHJldHVybiBFbGVtZW50Lk1ldGhvZHMuU2ltdWxhdGVkLmhhc0F0dHJpYnV0ZShlbGVtZW50LCBhdHRyaWJ1dGUpOwp9OwoKRWxlbWVudC5hZGRNZXRob2RzID0gZnVuY3Rpb24obWV0aG9kcykgewogIHZhciBGID0gUHJvdG90eXBlLkJyb3dzZXJGZWF0dXJlcywgVCA9IEVsZW1lbnQuTWV0aG9kcy5CeVRhZzsKCiAgaWYgKCFtZXRob2RzKSB7CiAgICBPYmplY3QuZXh0ZW5kKEZvcm0sIEZvcm0uTWV0aG9kcyk7CiAgICBPYmplY3QuZXh0ZW5kKEZvcm0uRWxlbWVudCwgRm9ybS5FbGVtZW50Lk1ldGhvZHMpOwogICAgT2JqZWN0LmV4dGVuZChFbGVtZW50Lk1ldGhvZHMuQnlUYWcsIHsKICAgICAgIkZPUk0iOiAgICAgT2JqZWN0LmNsb25lKEZvcm0uTWV0aG9kcyksCiAgICAgICJJTlBVVCI6ICAgIE9iamVjdC5jbG9uZShGb3JtLkVsZW1lbnQuTWV0aG9kcyksCiAgICAgICJTRUxFQ1QiOiAgIE9iamVjdC5jbG9uZShGb3JtLkVsZW1lbnQuTWV0aG9kcyksCiAgICAgICJURVhUQVJFQSI6IE9iamVjdC5jbG9uZShGb3JtLkVsZW1lbnQuTWV0aG9kcykKICAgIH0pOwogIH0KCiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMikgewogICAgdmFyIHRhZ05hbWUgPSBtZXRob2RzOwogICAgbWV0aG9kcyA9IGFyZ3VtZW50c1sxXTsKICB9CgogIGlmICghdGFnTmFtZSkgT2JqZWN0LmV4dGVuZChFbGVtZW50Lk1ldGhvZHMsIG1ldGhvZHMgfHwgeyB9KTsKICBlbHNlIHsKICAgIGlmIChPYmplY3QuaXNBcnJheSh0YWdOYW1lKSkgdGFnTmFtZS5lYWNoKGV4dGVuZCk7CiAgICBlbHNlIGV4dGVuZCh0YWdOYW1lKTsKICB9CgogIGZ1bmN0aW9uIGV4dGVuZCh0YWdOYW1lKSB7CiAgICB0YWdOYW1lID0gdGFnTmFtZS50b1VwcGVyQ2FzZSgpOwogICAgaWYgKCFFbGVtZW50Lk1ldGhvZHMuQnlUYWdbdGFnTmFtZV0pCiAgICAgIEVsZW1lbnQuTWV0aG9kcy5CeVRhZ1t0YWdOYW1lXSA9IHsgfTsKICAgIE9iamVjdC5leHRlbmQoRWxlbWVudC5NZXRob2RzLkJ5VGFnW3RhZ05hbWVdLCBtZXRob2RzKTsKICB9CgogIGZ1bmN0aW9uIGNvcHkobWV0aG9kcywgZGVzdGluYXRpb24sIG9ubHlJZkFic2VudCkgewogICAgb25seUlmQWJzZW50ID0gb25seUlmQWJzZW50IHx8IGZhbHNlOwogICAgZm9yICh2YXIgcHJvcGVydHkgaW4gbWV0aG9kcykgewogICAgICB2YXIgdmFsdWUgPSBtZXRob2RzW3Byb3BlcnR5XTsKICAgICAgaWYgKCFPYmplY3QuaXNGdW5jdGlvbih2YWx1ZSkpIGNvbnRpbnVlOwogICAgICBpZiAoIW9ubHlJZkFic2VudCB8fCAhKHByb3BlcnR5IGluIGRlc3RpbmF0aW9uKSkKICAgICAgICBkZXN0aW5hdGlvbltwcm9wZXJ0eV0gPSB2YWx1ZS5tZXRob2RpemUoKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGZpbmRET01DbGFzcyh0YWdOYW1lKSB7CiAgICB2YXIga2xhc3M7CiAgICB2YXIgdHJhbnMgPSB7CiAgICAgICJPUFRHUk9VUCI6ICJPcHRHcm91cCIsICJURVhUQVJFQSI6ICJUZXh0QXJlYSIsICJQIjogIlBhcmFncmFwaCIsCiAgICAgICJGSUVMRFNFVCI6ICJGaWVsZFNldCIsICJVTCI6ICJVTGlzdCIsICJPTCI6ICJPTGlzdCIsICJETCI6ICJETGlzdCIsCiAgICAgICJESVIiOiAiRGlyZWN0b3J5IiwgIkgxIjogIkhlYWRpbmciLCAiSDIiOiAiSGVhZGluZyIsICJIMyI6ICJIZWFkaW5nIiwKICAgICAgIkg0IjogIkhlYWRpbmciLCAiSDUiOiAiSGVhZGluZyIsICJINiI6ICJIZWFkaW5nIiwgIlEiOiAiUXVvdGUiLAogICAgICAiSU5TIjogIk1vZCIsICJERUwiOiAiTW9kIiwgIkEiOiAiQW5jaG9yIiwgIklNRyI6ICJJbWFnZSIsICJDQVBUSU9OIjoKICAgICAgIlRhYmxlQ2FwdGlvbiIsICJDT0wiOiAiVGFibGVDb2wiLCAiQ09MR1JPVVAiOiAiVGFibGVDb2wiLCAiVEhFQUQiOgogICAgICAiVGFibGVTZWN0aW9uIiwgIlRGT09UIjogIlRhYmxlU2VjdGlvbiIsICJUQk9EWSI6ICJUYWJsZVNlY3Rpb24iLCAiVFIiOgogICAgICAiVGFibGVSb3ciLCAiVEgiOiAiVGFibGVDZWxsIiwgIlREIjogIlRhYmxlQ2VsbCIsICJGUkFNRVNFVCI6CiAgICAgICJGcmFtZVNldCIsICJJRlJBTUUiOiAiSUZyYW1lIgogICAgfTsKICAgIGlmICh0cmFuc1t0YWdOYW1lXSkga2xhc3MgPSAnSFRNTCcgKyB0cmFuc1t0YWdOYW1lXSArICdFbGVtZW50JzsKICAgIGlmICh3aW5kb3dba2xhc3NdKSByZXR1cm4gd2luZG93W2tsYXNzXTsKICAgIGtsYXNzID0gJ0hUTUwnICsgdGFnTmFtZSArICdFbGVtZW50JzsKICAgIGlmICh3aW5kb3dba2xhc3NdKSByZXR1cm4gd2luZG93W2tsYXNzXTsKICAgIGtsYXNzID0gJ0hUTUwnICsgdGFnTmFtZS5jYXBpdGFsaXplKCkgKyAnRWxlbWVudCc7CiAgICBpZiAod2luZG93W2tsYXNzXSkgcmV0dXJuIHdpbmRvd1trbGFzc107CgogICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZ05hbWUpOwogICAgdmFyIHByb3RvID0gZWxlbWVudFsnX19wcm90b19fJ10gfHwgZWxlbWVudC5jb25zdHJ1Y3Rvci5wcm90b3R5cGU7CiAgICBlbGVtZW50ID0gbnVsbDsKICAgIHJldHVybiBwcm90bzsKICB9CgogIHZhciBlbGVtZW50UHJvdG90eXBlID0gd2luZG93LkhUTUxFbGVtZW50ID8gSFRNTEVsZW1lbnQucHJvdG90eXBlIDoKICAgRWxlbWVudC5wcm90b3R5cGU7CgogIGlmIChGLkVsZW1lbnRFeHRlbnNpb25zKSB7CiAgICBjb3B5KEVsZW1lbnQuTWV0aG9kcywgZWxlbWVudFByb3RvdHlwZSk7CiAgICBjb3B5KEVsZW1lbnQuTWV0aG9kcy5TaW11bGF0ZWQsIGVsZW1lbnRQcm90b3R5cGUsIHRydWUpOwogIH0KCiAgaWYgKEYuU3BlY2lmaWNFbGVtZW50RXh0ZW5zaW9ucykgewogICAgZm9yICh2YXIgdGFnIGluIEVsZW1lbnQuTWV0aG9kcy5CeVRhZykgewogICAgICB2YXIga2xhc3MgPSBmaW5kRE9NQ2xhc3ModGFnKTsKICAgICAgaWYgKE9iamVjdC5pc1VuZGVmaW5lZChrbGFzcykpIGNvbnRpbnVlOwogICAgICBjb3B5KFRbdGFnXSwga2xhc3MucHJvdG90eXBlKTsKICAgIH0KICB9CgogIE9iamVjdC5leHRlbmQoRWxlbWVudCwgRWxlbWVudC5NZXRob2RzKTsKICBkZWxldGUgRWxlbWVudC5CeVRhZzsKCiAgaWYgKEVsZW1lbnQuZXh0ZW5kLnJlZnJlc2gpIEVsZW1lbnQuZXh0ZW5kLnJlZnJlc2goKTsKICBFbGVtZW50LmNhY2hlID0geyB9Owp9OwoKCmRvY3VtZW50LnZpZXdwb3J0ID0gewoKICBnZXREaW1lbnNpb25zOiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB7IHdpZHRoOiB0aGlzLmdldFdpZHRoKCksIGhlaWdodDogdGhpcy5nZXRIZWlnaHQoKSB9OwogIH0sCgogIGdldFNjcm9sbE9mZnNldHM6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIEVsZW1lbnQuX3JldHVybk9mZnNldCgKICAgICAgd2luZG93LnBhZ2VYT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0IHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCwKICAgICAgd2luZG93LnBhZ2VZT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wKTsKICB9Cn07CgooZnVuY3Rpb24odmlld3BvcnQpIHsKICB2YXIgQiA9IFByb3RvdHlwZS5Ccm93c2VyLCBkb2MgPSBkb2N1bWVudCwgZWxlbWVudCwgcHJvcGVydHkgPSB7fTsKCiAgZnVuY3Rpb24gZ2V0Um9vdEVsZW1lbnQoKSB7CiAgICBpZiAoQi5XZWJLaXQgJiYgIWRvYy5ldmFsdWF0ZSkKICAgICAgcmV0dXJuIGRvY3VtZW50OwoKICAgIGlmIChCLk9wZXJhICYmIHdpbmRvdy5wYXJzZUZsb2F0KHdpbmRvdy5vcGVyYS52ZXJzaW9uKCkpIDwgOS41KQogICAgICByZXR1cm4gZG9jdW1lbnQuYm9keTsKCiAgICByZXR1cm4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwogIH0KCiAgZnVuY3Rpb24gZGVmaW5lKEQpIHsKICAgIGlmICghZWxlbWVudCkgZWxlbWVudCA9IGdldFJvb3RFbGVtZW50KCk7CgogICAgcHJvcGVydHlbRF0gPSAnY2xpZW50JyArIEQ7CgogICAgdmlld3BvcnRbJ2dldCcgKyBEXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gZWxlbWVudFtwcm9wZXJ0eVtEXV0gfTsKICAgIHJldHVybiB2aWV3cG9ydFsnZ2V0JyArIERdKCk7CiAgfQoKICB2aWV3cG9ydC5nZXRXaWR0aCAgPSBkZWZpbmUuY3VycnkoJ1dpZHRoJyk7CgogIHZpZXdwb3J0LmdldEhlaWdodCA9IGRlZmluZS5jdXJyeSgnSGVpZ2h0Jyk7Cn0pKGRvY3VtZW50LnZpZXdwb3J0KTsKCgpFbGVtZW50LlN0b3JhZ2UgPSB7CiAgVUlEOiAxCn07CgpFbGVtZW50LmFkZE1ldGhvZHMoewogIGdldFN0b3JhZ2U6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIGlmICghKGVsZW1lbnQgPSAkKGVsZW1lbnQpKSkgcmV0dXJuOwoKICAgIHZhciB1aWQ7CiAgICBpZiAoZWxlbWVudCA9PT0gd2luZG93KSB7CiAgICAgIHVpZCA9IDA7CiAgICB9IGVsc2UgewogICAgICBpZiAodHlwZW9mIGVsZW1lbnQuX3Byb3RvdHlwZVVJRCA9PT0gInVuZGVmaW5lZCIpCiAgICAgICAgZWxlbWVudC5fcHJvdG90eXBlVUlEID0gW0VsZW1lbnQuU3RvcmFnZS5VSUQrK107CiAgICAgIHVpZCA9IGVsZW1lbnQuX3Byb3RvdHlwZVVJRFswXTsKICAgIH0KCiAgICBpZiAoIUVsZW1lbnQuU3RvcmFnZVt1aWRdKQogICAgICBFbGVtZW50LlN0b3JhZ2VbdWlkXSA9ICRIKCk7CgogICAgcmV0dXJuIEVsZW1lbnQuU3RvcmFnZVt1aWRdOwogIH0sCgogIHN0b3JlOiBmdW5jdGlvbihlbGVtZW50LCBrZXksIHZhbHVlKSB7CiAgICBpZiAoIShlbGVtZW50ID0gJChlbGVtZW50KSkpIHJldHVybjsKCiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgewogICAgICBFbGVtZW50LmdldFN0b3JhZ2UoZWxlbWVudCkudXBkYXRlKGtleSk7CiAgICB9IGVsc2UgewogICAgICBFbGVtZW50LmdldFN0b3JhZ2UoZWxlbWVudCkuc2V0KGtleSwgdmFsdWUpOwogICAgfQoKICAgIHJldHVybiBlbGVtZW50OwogIH0sCgogIHJldHJpZXZlOiBmdW5jdGlvbihlbGVtZW50LCBrZXksIGRlZmF1bHRWYWx1ZSkgewogICAgaWYgKCEoZWxlbWVudCA9ICQoZWxlbWVudCkpKSByZXR1cm47CiAgICB2YXIgaGFzaCA9IEVsZW1lbnQuZ2V0U3RvcmFnZShlbGVtZW50KSwgdmFsdWUgPSBoYXNoLmdldChrZXkpOwoKICAgIGlmIChPYmplY3QuaXNVbmRlZmluZWQodmFsdWUpKSB7CiAgICAgIGhhc2guc2V0KGtleSwgZGVmYXVsdFZhbHVlKTsKICAgICAgdmFsdWUgPSBkZWZhdWx0VmFsdWU7CiAgICB9CgogICAgcmV0dXJuIHZhbHVlOwogIH0sCgogIGNsb25lOiBmdW5jdGlvbihlbGVtZW50LCBkZWVwKSB7CiAgICBpZiAoIShlbGVtZW50ID0gJChlbGVtZW50KSkpIHJldHVybjsKICAgIHZhciBjbG9uZSA9IGVsZW1lbnQuY2xvbmVOb2RlKGRlZXApOwogICAgY2xvbmUuX3Byb3RvdHlwZVVJRCA9IHZvaWQgMDsKICAgIGlmIChkZWVwKSB7CiAgICAgIHZhciBkZXNjZW5kYW50cyA9IEVsZW1lbnQuc2VsZWN0KGNsb25lLCAnKicpLAogICAgICAgICAgaSA9IGRlc2NlbmRhbnRzLmxlbmd0aDsKICAgICAgd2hpbGUgKGktLSkgewogICAgICAgIGRlc2NlbmRhbnRzW2ldLl9wcm90b3R5cGVVSUQgPSB2b2lkIDA7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBFbGVtZW50LmV4dGVuZChjbG9uZSk7CiAgfQp9KTsKLyogUG9ydGlvbnMgb2YgdGhlIFNlbGVjdG9yIGNsYXNzIGFyZSBkZXJpdmVkIGZyb20gSmFjayBTbG9jdW0ncyBEb21RdWVyeSwKICogcGFydCBvZiBZVUktRXh0IHZlcnNpb24gMC40MCwgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIHRlcm1zIG9mIGFuIE1JVC1zdHlsZQogKiBsaWNlbnNlLiAgUGxlYXNlIHNlZSBodHRwOi8vd3d3Lnl1aS1leHQuY29tLyBmb3IgbW9yZSBpbmZvcm1hdGlvbi4gKi8KCnZhciBTZWxlY3RvciA9IENsYXNzLmNyZWF0ZSh7CiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oZXhwcmVzc2lvbikgewogICAgdGhpcy5leHByZXNzaW9uID0gZXhwcmVzc2lvbi5zdHJpcCgpOwoKICAgIGlmICh0aGlzLnNob3VsZFVzZVNlbGVjdG9yc0FQSSgpKSB7CiAgICAgIHRoaXMubW9kZSA9ICdzZWxlY3RvcnNBUEknOwogICAgfSBlbHNlIGlmICh0aGlzLnNob3VsZFVzZVhQYXRoKCkpIHsKICAgICAgdGhpcy5tb2RlID0gJ3hwYXRoJzsKICAgICAgdGhpcy5jb21waWxlWFBhdGhNYXRjaGVyKCk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLm1vZGUgPSAibm9ybWFsIjsKICAgICAgdGhpcy5jb21waWxlTWF0Y2hlcigpOwogICAgfQoKICB9LAoKICBzaG91bGRVc2VYUGF0aDogKGZ1bmN0aW9uKCkgewoKICAgIHZhciBJU19ERVNDRU5EQU5UX1NFTEVDVE9SX0JVR0dZID0gKGZ1bmN0aW9uKCl7CiAgICAgIHZhciBpc0J1Z2d5ID0gZmFsc2U7CiAgICAgIGlmIChkb2N1bWVudC5ldmFsdWF0ZSAmJiB3aW5kb3cuWFBhdGhSZXN1bHQpIHsKICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBlbC5pbm5lckhUTUwgPSAnPHVsPjxsaT48L2xpPjwvdWw+PGRpdj48dWw+PGxpPjwvbGk+PC91bD48L2Rpdj4nOwoKICAgICAgICB2YXIgeHBhdGggPSAiLi8vKltsb2NhbC1uYW1lKCk9J3VsJyBvciBsb2NhbC1uYW1lKCk9J1VMJ10iICsKICAgICAgICAgICIvLypbbG9jYWwtbmFtZSgpPSdsaScgb3IgbG9jYWwtbmFtZSgpPSdMSSddIjsKCiAgICAgICAgdmFyIHJlc3VsdCA9IGRvY3VtZW50LmV2YWx1YXRlKHhwYXRoLCBlbCwgbnVsbCwKICAgICAgICAgIFhQYXRoUmVzdWx0Lk9SREVSRURfTk9ERV9TTkFQU0hPVF9UWVBFLCBudWxsKTsKCiAgICAgICAgaXNCdWdneSA9IChyZXN1bHQuc25hcHNob3RMZW5ndGggIT09IDIpOwogICAgICAgIGVsID0gbnVsbDsKICAgICAgfQogICAgICByZXR1cm4gaXNCdWdneTsKICAgIH0pKCk7CgogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICBpZiAoIVByb3RvdHlwZS5Ccm93c2VyRmVhdHVyZXMuWFBhdGgpIHJldHVybiBmYWxzZTsKCiAgICAgIHZhciBlID0gdGhpcy5leHByZXNzaW9uOwoKICAgICAgaWYgKFByb3RvdHlwZS5Ccm93c2VyLldlYktpdCAmJgogICAgICAgKGUuaW5jbHVkZSgiLW9mLXR5cGUiKSB8fCBlLmluY2x1ZGUoIjplbXB0eSIpKSkKICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICBpZiAoKC8oXFtbXHctXSo/Onw6Y2hlY2tlZCkvKS50ZXN0KGUpKQogICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgIGlmIChJU19ERVNDRU5EQU5UX1NFTEVDVE9SX0JVR0dZKSByZXR1cm4gZmFsc2U7CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgfSkoKSwKCiAgc2hvdWxkVXNlU2VsZWN0b3JzQVBJOiBmdW5jdGlvbigpIHsKICAgIGlmICghUHJvdG90eXBlLkJyb3dzZXJGZWF0dXJlcy5TZWxlY3RvcnNBUEkpIHJldHVybiBmYWxzZTsKCiAgICBpZiAoU2VsZWN0b3IuQ0FTRV9JTlNFTlNJVElWRV9DTEFTU19OQU1FUykgcmV0dXJuIGZhbHNlOwoKICAgIGlmICghU2VsZWN0b3IuX2RpdikgU2VsZWN0b3IuX2RpdiA9IG5ldyBFbGVtZW50KCdkaXYnKTsKCiAgICB0cnkgewogICAgICBTZWxlY3Rvci5fZGl2LnF1ZXJ5U2VsZWN0b3IodGhpcy5leHByZXNzaW9uKTsKICAgIH0gY2F0Y2goZSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcmV0dXJuIHRydWU7CiAgfSwKCiAgY29tcGlsZU1hdGNoZXI6IGZ1bmN0aW9uKCkgewogICAgdmFyIGUgPSB0aGlzLmV4cHJlc3Npb24sIHBzID0gU2VsZWN0b3IucGF0dGVybnMsIGggPSBTZWxlY3Rvci5oYW5kbGVycywKICAgICAgICBjID0gU2VsZWN0b3IuY3JpdGVyaWEsIGxlLCBwLCBtLCBsZW4gPSBwcy5sZW5ndGgsIG5hbWU7CgogICAgaWYgKFNlbGVjdG9yLl9jYWNoZVtlXSkgewogICAgICB0aGlzLm1hdGNoZXIgPSBTZWxlY3Rvci5fY2FjaGVbZV07CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB0aGlzLm1hdGNoZXIgPSBbInRoaXMubWF0Y2hlciA9IGZ1bmN0aW9uKHJvb3QpIHsiLAogICAgICAgICAgICAgICAgICAgICJ2YXIgciA9IHJvb3QsIGggPSBTZWxlY3Rvci5oYW5kbGVycywgYyA9IGZhbHNlLCBuOyJdOwoKICAgIHdoaWxlIChlICYmIGxlICE9IGUgJiYgKC9cUy8pLnRlc3QoZSkpIHsKICAgICAgbGUgPSBlOwogICAgICBmb3IgKHZhciBpID0gMDsgaTxsZW47IGkrKykgewogICAgICAgIHAgPSBwc1tpXS5yZTsKICAgICAgICBuYW1lID0gcHNbaV0ubmFtZTsKICAgICAgICBpZiAobSA9IGUubWF0Y2gocCkpIHsKICAgICAgICAgIHRoaXMubWF0Y2hlci5wdXNoKE9iamVjdC5pc0Z1bmN0aW9uKGNbbmFtZV0pID8gY1tuYW1lXShtKSA6CiAgICAgICAgICAgIG5ldyBUZW1wbGF0ZShjW25hbWVdKS5ldmFsdWF0ZShtKSk7CiAgICAgICAgICBlID0gZS5yZXBsYWNlKG1bMF0sICcnKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHRoaXMubWF0Y2hlci5wdXNoKCJyZXR1cm4gaC51bmlxdWUobik7XG59Iik7CiAgICBldmFsKHRoaXMubWF0Y2hlci5qb2luKCdcbicpKTsKICAgIFNlbGVjdG9yLl9jYWNoZVt0aGlzLmV4cHJlc3Npb25dID0gdGhpcy5tYXRjaGVyOwogIH0sCgogIGNvbXBpbGVYUGF0aE1hdGNoZXI6IGZ1bmN0aW9uKCkgewogICAgdmFyIGUgPSB0aGlzLmV4cHJlc3Npb24sIHBzID0gU2VsZWN0b3IucGF0dGVybnMsCiAgICAgICAgeCA9IFNlbGVjdG9yLnhwYXRoLCBsZSwgbSwgbGVuID0gcHMubGVuZ3RoLCBuYW1lOwoKICAgIGlmIChTZWxlY3Rvci5fY2FjaGVbZV0pIHsKICAgICAgdGhpcy54cGF0aCA9IFNlbGVjdG9yLl9jYWNoZVtlXTsgcmV0dXJuOwogICAgfQoKICAgIHRoaXMubWF0Y2hlciA9IFsnLi8vKiddOwogICAgd2hpbGUgKGUgJiYgbGUgIT0gZSAmJiAoL1xTLykudGVzdChlKSkgewogICAgICBsZSA9IGU7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpPGxlbjsgaSsrKSB7CiAgICAgICAgbmFtZSA9IHBzW2ldLm5hbWU7CiAgICAgICAgaWYgKG0gPSBlLm1hdGNoKHBzW2ldLnJlKSkgewogICAgICAgICAgdGhpcy5tYXRjaGVyLnB1c2goT2JqZWN0LmlzRnVuY3Rpb24oeFtuYW1lXSkgPyB4W25hbWVdKG0pIDoKICAgICAgICAgICAgbmV3IFRlbXBsYXRlKHhbbmFtZV0pLmV2YWx1YXRlKG0pKTsKICAgICAgICAgIGUgPSBlLnJlcGxhY2UobVswXSwgJycpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgdGhpcy54cGF0aCA9IHRoaXMubWF0Y2hlci5qb2luKCcnKTsKICAgIFNlbGVjdG9yLl9jYWNoZVt0aGlzLmV4cHJlc3Npb25dID0gdGhpcy54cGF0aDsKICB9LAoKICBmaW5kRWxlbWVudHM6IGZ1bmN0aW9uKHJvb3QpIHsKICAgIHJvb3QgPSByb290IHx8IGRvY3VtZW50OwogICAgdmFyIGUgPSB0aGlzLmV4cHJlc3Npb24sIHJlc3VsdHM7CgogICAgc3dpdGNoICh0aGlzLm1vZGUpIHsKICAgICAgY2FzZSAnc2VsZWN0b3JzQVBJJzoKICAgICAgICBpZiAocm9vdCAhPT0gZG9jdW1lbnQpIHsKICAgICAgICAgIHZhciBvbGRJZCA9IHJvb3QuaWQsIGlkID0gJChyb290KS5pZGVudGlmeSgpOwogICAgICAgICAgaWQgPSBpZC5yZXBsYWNlKC8oW1wuOl0pL2csICJcXCQxIik7CiAgICAgICAgICBlID0gIiMiICsgaWQgKyAiICIgKyBlOwogICAgICAgIH0KCiAgICAgICAgcmVzdWx0cyA9ICRBKHJvb3QucXVlcnlTZWxlY3RvckFsbChlKSkubWFwKEVsZW1lbnQuZXh0ZW5kKTsKICAgICAgICByb290LmlkID0gb2xkSWQ7CgogICAgICAgIHJldHVybiByZXN1bHRzOwogICAgICBjYXNlICd4cGF0aCc6CiAgICAgICAgcmV0dXJuIGRvY3VtZW50Ll9nZXRFbGVtZW50c0J5WFBhdGgodGhpcy54cGF0aCwgcm9vdCk7CiAgICAgIGRlZmF1bHQ6CiAgICAgICByZXR1cm4gdGhpcy5tYXRjaGVyKHJvb3QpOwogICAgfQogIH0sCgogIG1hdGNoOiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICB0aGlzLnRva2VucyA9IFtdOwoKICAgIHZhciBlID0gdGhpcy5leHByZXNzaW9uLCBwcyA9IFNlbGVjdG9yLnBhdHRlcm5zLCBhcyA9IFNlbGVjdG9yLmFzc2VydGlvbnM7CiAgICB2YXIgbGUsIHAsIG0sIGxlbiA9IHBzLmxlbmd0aCwgbmFtZTsKCiAgICB3aGlsZSAoZSAmJiBsZSAhPT0gZSAmJiAoL1xTLykudGVzdChlKSkgewogICAgICBsZSA9IGU7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpPGxlbjsgaSsrKSB7CiAgICAgICAgcCA9IHBzW2ldLnJlOwogICAgICAgIG5hbWUgPSBwc1tpXS5uYW1lOwogICAgICAgIGlmIChtID0gZS5tYXRjaChwKSkgewogICAgICAgICAgaWYgKGFzW25hbWVdKSB7CiAgICAgICAgICAgIHRoaXMudG9rZW5zLnB1c2goW25hbWUsIE9iamVjdC5jbG9uZShtKV0pOwogICAgICAgICAgICBlID0gZS5yZXBsYWNlKG1bMF0sICcnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmZpbmRFbGVtZW50cyhkb2N1bWVudCkuaW5jbHVkZShlbGVtZW50KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICB2YXIgbWF0Y2ggPSB0cnVlLCBuYW1lLCBtYXRjaGVzOwogICAgZm9yICh2YXIgaSA9IDAsIHRva2VuOyB0b2tlbiA9IHRoaXMudG9rZW5zW2ldOyBpKyspIHsKICAgICAgbmFtZSA9IHRva2VuWzBdLCBtYXRjaGVzID0gdG9rZW5bMV07CiAgICAgIGlmICghU2VsZWN0b3IuYXNzZXJ0aW9uc1tuYW1lXShlbGVtZW50LCBtYXRjaGVzKSkgewogICAgICAgIG1hdGNoID0gZmFsc2U7IGJyZWFrOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIG1hdGNoOwogIH0sCgogIHRvU3RyaW5nOiBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLmV4cHJlc3Npb247CiAgfSwKCiAgaW5zcGVjdDogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gIiM8U2VsZWN0b3I6IiArIHRoaXMuZXhwcmVzc2lvbi5pbnNwZWN0KCkgKyAiPiI7CiAgfQp9KTsKCmlmIChQcm90b3R5cGUuQnJvd3NlckZlYXR1cmVzLlNlbGVjdG9yc0FQSSAmJgogZG9jdW1lbnQuY29tcGF0TW9kZSA9PT0gJ0JhY2tDb21wYXQnKSB7CiAgU2VsZWN0b3IuQ0FTRV9JTlNFTlNJVElWRV9DTEFTU19OQU1FUyA9IChmdW5jdGlvbigpewogICAgdmFyIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLAogICAgIHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CgogICAgZGl2LmlkID0gInByb3RvdHlwZV90ZXN0X2lkIjsKICAgIHNwYW4uY2xhc3NOYW1lID0gJ1Rlc3QnOwogICAgZGl2LmFwcGVuZENoaWxkKHNwYW4pOwogICAgdmFyIGlzSWdub3JlZCA9IChkaXYucXVlcnlTZWxlY3RvcignI3Byb3RvdHlwZV90ZXN0X2lkIC50ZXN0JykgIT09IG51bGwpOwogICAgZGl2ID0gc3BhbiA9IG51bGw7CiAgICByZXR1cm4gaXNJZ25vcmVkOwogIH0pKCk7Cn0KCk9iamVjdC5leHRlbmQoU2VsZWN0b3IsIHsKICBfY2FjaGU6IHsgfSwKCiAgeHBhdGg6IHsKICAgIGRlc2NlbmRhbnQ6ICAgIi8vKiIsCiAgICBjaGlsZDogICAgICAgICIvKiIsCiAgICBhZGphY2VudDogICAgICIvZm9sbG93aW5nLXNpYmxpbmc6OipbMV0iLAogICAgbGF0ZXJTaWJsaW5nOiAnL2ZvbGxvd2luZy1zaWJsaW5nOjoqJywKICAgIHRhZ05hbWU6ICAgICAgZnVuY3Rpb24obSkgewogICAgICBpZiAobVsxXSA9PSAnKicpIHJldHVybiAnJzsKICAgICAgcmV0dXJuICJbbG9jYWwtbmFtZSgpPSciICsgbVsxXS50b0xvd2VyQ2FzZSgpICsKICAgICAgICAgICAgICInIG9yIGxvY2FsLW5hbWUoKT0nIiArIG1bMV0udG9VcHBlckNhc2UoKSArICInXSI7CiAgICB9LAogICAgY2xhc3NOYW1lOiAgICAiW2NvbnRhaW5zKGNvbmNhdCgnICcsIEBjbGFzcywgJyAnKSwgJyAjezF9ICcpXSIsCiAgICBpZDogICAgICAgICAgICJbQGlkPScjezF9J10iLAogICAgYXR0clByZXNlbmNlOiBmdW5jdGlvbihtKSB7CiAgICAgIG1bMV0gPSBtWzFdLnRvTG93ZXJDYXNlKCk7CiAgICAgIHJldHVybiBuZXcgVGVtcGxhdGUoIltAI3sxfV0iKS5ldmFsdWF0ZShtKTsKICAgIH0sCiAgICBhdHRyOiBmdW5jdGlvbihtKSB7CiAgICAgIG1bMV0gPSBtWzFdLnRvTG93ZXJDYXNlKCk7CiAgICAgIG1bM10gPSBtWzVdIHx8IG1bNl07CiAgICAgIHJldHVybiBuZXcgVGVtcGxhdGUoU2VsZWN0b3IueHBhdGgub3BlcmF0b3JzW21bMl1dKS5ldmFsdWF0ZShtKTsKICAgIH0sCiAgICBwc2V1ZG86IGZ1bmN0aW9uKG0pIHsKICAgICAgdmFyIGggPSBTZWxlY3Rvci54cGF0aC5wc2V1ZG9zW21bMV1dOwogICAgICBpZiAoIWgpIHJldHVybiAnJzsKICAgICAgaWYgKE9iamVjdC5pc0Z1bmN0aW9uKGgpKSByZXR1cm4gaChtKTsKICAgICAgcmV0dXJuIG5ldyBUZW1wbGF0ZShTZWxlY3Rvci54cGF0aC5wc2V1ZG9zW21bMV1dKS5ldmFsdWF0ZShtKTsKICAgIH0sCiAgICBvcGVyYXRvcnM6IHsKICAgICAgJz0nOiAgIltAI3sxfT0nI3szfSddIiwKICAgICAgJyE9JzogIltAI3sxfSE9JyN7M30nXSIsCiAgICAgICdePSc6ICJbc3RhcnRzLXdpdGgoQCN7MX0sICcjezN9JyldIiwKICAgICAgJyQ9JzogIltzdWJzdHJpbmcoQCN7MX0sIChzdHJpbmctbGVuZ3RoKEAjezF9KSAtIHN0cmluZy1sZW5ndGgoJyN7M30nKSArIDEpKT0nI3szfSddIiwKICAgICAgJyo9JzogIltjb250YWlucyhAI3sxfSwgJyN7M30nKV0iLAogICAgICAnfj0nOiAiW2NvbnRhaW5zKGNvbmNhdCgnICcsIEAjezF9LCAnICcpLCAnICN7M30gJyldIiwKICAgICAgJ3w9JzogIltjb250YWlucyhjb25jYXQoJy0nLCBAI3sxfSwgJy0nKSwgJy0jezN9LScpXSIKICAgIH0sCiAgICBwc2V1ZG9zOiB7CiAgICAgICdmaXJzdC1jaGlsZCc6ICdbbm90KHByZWNlZGluZy1zaWJsaW5nOjoqKV0nLAogICAgICAnbGFzdC1jaGlsZCc6ICAnW25vdChmb2xsb3dpbmctc2libGluZzo6KildJywKICAgICAgJ29ubHktY2hpbGQnOiAgJ1tub3QocHJlY2VkaW5nLXNpYmxpbmc6Oiogb3IgZm9sbG93aW5nLXNpYmxpbmc6OiopXScsCiAgICAgICdlbXB0eSc6ICAgICAgICJbY291bnQoKikgPSAwIGFuZCAoY291bnQodGV4dCgpKSA9IDApXSIsCiAgICAgICdjaGVja2VkJzogICAgICJbQGNoZWNrZWRdIiwKICAgICAgJ2Rpc2FibGVkJzogICAgIlsoQGRpc2FibGVkKSBhbmQgKEB0eXBlIT0naGlkZGVuJyldIiwKICAgICAgJ2VuYWJsZWQnOiAgICAgIltub3QoQGRpc2FibGVkKSBhbmQgKEB0eXBlIT0naGlkZGVuJyldIiwKICAgICAgJ25vdCc6IGZ1bmN0aW9uKG0pIHsKICAgICAgICB2YXIgZSA9IG1bNl0sIHAgPSBTZWxlY3Rvci5wYXR0ZXJucywKICAgICAgICAgICAgeCA9IFNlbGVjdG9yLnhwYXRoLCBsZSwgdiwgbGVuID0gcC5sZW5ndGgsIG5hbWU7CgogICAgICAgIHZhciBleGNsdXNpb24gPSBbXTsKICAgICAgICB3aGlsZSAoZSAmJiBsZSAhPSBlICYmICgvXFMvKS50ZXN0KGUpKSB7CiAgICAgICAgICBsZSA9IGU7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaTxsZW47IGkrKykgewogICAgICAgICAgICBuYW1lID0gcFtpXS5uYW1lCiAgICAgICAgICAgIGlmIChtID0gZS5tYXRjaChwW2ldLnJlKSkgewogICAgICAgICAgICAgIHYgPSBPYmplY3QuaXNGdW5jdGlvbih4W25hbWVdKSA/IHhbbmFtZV0obSkgOiBuZXcgVGVtcGxhdGUoeFtuYW1lXSkuZXZhbHVhdGUobSk7CiAgICAgICAgICAgICAgZXhjbHVzaW9uLnB1c2goIigiICsgdi5zdWJzdHJpbmcoMSwgdi5sZW5ndGggLSAxKSArICIpIik7CiAgICAgICAgICAgICAgZSA9IGUucmVwbGFjZShtWzBdLCAnJyk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuICJbbm90KCIgKyBleGNsdXNpb24uam9pbigiIGFuZCAiKSArICIpXSI7CiAgICAgIH0sCiAgICAgICdudGgtY2hpbGQnOiAgICAgIGZ1bmN0aW9uKG0pIHsKICAgICAgICByZXR1cm4gU2VsZWN0b3IueHBhdGgucHNldWRvcy5udGgoIihjb3VudCguL3ByZWNlZGluZy1zaWJsaW5nOjoqKSArIDEpICIsIG0pOwogICAgICB9LAogICAgICAnbnRoLWxhc3QtY2hpbGQnOiBmdW5jdGlvbihtKSB7CiAgICAgICAgcmV0dXJuIFNlbGVjdG9yLnhwYXRoLnBzZXVkb3MubnRoKCIoY291bnQoLi9mb2xsb3dpbmctc2libGluZzo6KikgKyAxKSAiLCBtKTsKICAgICAgfSwKICAgICAgJ250aC1vZi10eXBlJzogICAgZnVuY3Rpb24obSkgewogICAgICAgIHJldHVybiBTZWxlY3Rvci54cGF0aC5wc2V1ZG9zLm50aCgicG9zaXRpb24oKSAiLCBtKTsKICAgICAgfSwKICAgICAgJ250aC1sYXN0LW9mLXR5cGUnOiBmdW5jdGlvbihtKSB7CiAgICAgICAgcmV0dXJuIFNlbGVjdG9yLnhwYXRoLnBzZXVkb3MubnRoKCIobGFzdCgpICsgMSAtIHBvc2l0aW9uKCkpICIsIG0pOwogICAgICB9LAogICAgICAnZmlyc3Qtb2YtdHlwZSc6ICBmdW5jdGlvbihtKSB7CiAgICAgICAgbVs2XSA9ICIxIjsgcmV0dXJuIFNlbGVjdG9yLnhwYXRoLnBzZXVkb3NbJ250aC1vZi10eXBlJ10obSk7CiAgICAgIH0sCiAgICAgICdsYXN0LW9mLXR5cGUnOiAgIGZ1bmN0aW9uKG0pIHsKICAgICAgICBtWzZdID0gIjEiOyByZXR1cm4gU2VsZWN0b3IueHBhdGgucHNldWRvc1snbnRoLWxhc3Qtb2YtdHlwZSddKG0pOwogICAgICB9LAogICAgICAnb25seS1vZi10eXBlJzogICBmdW5jdGlvbihtKSB7CiAgICAgICAgdmFyIHAgPSBTZWxlY3Rvci54cGF0aC5wc2V1ZG9zOyByZXR1cm4gcFsnZmlyc3Qtb2YtdHlwZSddKG0pICsgcFsnbGFzdC1vZi10eXBlJ10obSk7CiAgICAgIH0sCiAgICAgIG50aDogZnVuY3Rpb24oZnJhZ21lbnQsIG0pIHsKICAgICAgICB2YXIgbW0sIGZvcm11bGEgPSBtWzZdLCBwcmVkaWNhdGU7CiAgICAgICAgaWYgKGZvcm11bGEgPT0gJ2V2ZW4nKSBmb3JtdWxhID0gJzJuKzAnOwogICAgICAgIGlmIChmb3JtdWxhID09ICdvZGQnKSAgZm9ybXVsYSA9ICcybisxJzsKICAgICAgICBpZiAobW0gPSBmb3JtdWxhLm1hdGNoKC9eKFxkKykkLykpIC8vIGRpZ2l0IG9ubHkKICAgICAgICAgIHJldHVybiAnWycgKyBmcmFnbWVudCArICI9ICIgKyBtbVsxXSArICddJzsKICAgICAgICBpZiAobW0gPSBmb3JtdWxhLm1hdGNoKC9eKC0/XGQqKT9uKChbKy1dKShcZCspKT8vKSkgeyAvLyBhbitiCiAgICAgICAgICBpZiAobW1bMV0gPT0gIi0iKSBtbVsxXSA9IC0xOwogICAgICAgICAgdmFyIGEgPSBtbVsxXSA/IE51bWJlcihtbVsxXSkgOiAxOwogICAgICAgICAgdmFyIGIgPSBtbVsyXSA/IE51bWJlcihtbVsyXSkgOiAwOwogICAgICAgICAgcHJlZGljYXRlID0gIlsoKCN7ZnJhZ21lbnR9IC0gI3tifSkgbW9kICN7YX0gPSAwKSBhbmQgIiArCiAgICAgICAgICAiKCgje2ZyYWdtZW50fSAtICN7Yn0pIGRpdiAje2F9ID49IDApXSI7CiAgICAgICAgICByZXR1cm4gbmV3IFRlbXBsYXRlKHByZWRpY2F0ZSkuZXZhbHVhdGUoewogICAgICAgICAgICBmcmFnbWVudDogZnJhZ21lbnQsIGE6IGEsIGI6IGIgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwKCiAgY3JpdGVyaWE6IHsKICAgIHRhZ05hbWU6ICAgICAgJ24gPSBoLnRhZ05hbWUobiwgciwgIiN7MX0iLCBjKTsgICAgICBjID0gZmFsc2U7JywKICAgIGNsYXNzTmFtZTogICAgJ24gPSBoLmNsYXNzTmFtZShuLCByLCAiI3sxfSIsIGMpOyAgICBjID0gZmFsc2U7JywKICAgIGlkOiAgICAgICAgICAgJ24gPSBoLmlkKG4sIHIsICIjezF9IiwgYyk7ICAgICAgICAgICBjID0gZmFsc2U7JywKICAgIGF0dHJQcmVzZW5jZTogJ24gPSBoLmF0dHJQcmVzZW5jZShuLCByLCAiI3sxfSIsIGMpOyBjID0gZmFsc2U7JywKICAgIGF0dHI6IGZ1bmN0aW9uKG0pIHsKICAgICAgbVszXSA9IChtWzVdIHx8IG1bNl0pOwogICAgICByZXR1cm4gbmV3IFRlbXBsYXRlKCduID0gaC5hdHRyKG4sIHIsICIjezF9IiwgIiN7M30iLCAiI3syfSIsIGMpOyBjID0gZmFsc2U7JykuZXZhbHVhdGUobSk7CiAgICB9LAogICAgcHNldWRvOiBmdW5jdGlvbihtKSB7CiAgICAgIGlmIChtWzZdKSBtWzZdID0gbVs2XS5yZXBsYWNlKC8iL2csICdcXCInKTsKICAgICAgcmV0dXJuIG5ldyBUZW1wbGF0ZSgnbiA9IGgucHNldWRvKG4sICIjezF9IiwgIiN7Nn0iLCByLCBjKTsgYyA9IGZhbHNlOycpLmV2YWx1YXRlKG0pOwogICAgfSwKICAgIGRlc2NlbmRhbnQ6ICAgJ2MgPSAiZGVzY2VuZGFudCI7JywKICAgIGNoaWxkOiAgICAgICAgJ2MgPSAiY2hpbGQiOycsCiAgICBhZGphY2VudDogICAgICdjID0gImFkamFjZW50IjsnLAogICAgbGF0ZXJTaWJsaW5nOiAnYyA9ICJsYXRlclNpYmxpbmciOycKICB9LAoKICBwYXR0ZXJuczogWwogICAgeyBuYW1lOiAnbGF0ZXJTaWJsaW5nJywgcmU6IC9eXHMqflxzKi8gfSwKICAgIHsgbmFtZTogJ2NoaWxkJywgICAgICAgIHJlOiAvXlxzKj5ccyovIH0sCiAgICB7IG5hbWU6ICdhZGphY2VudCcsICAgICByZTogL15ccypcK1xzKi8gfSwKICAgIHsgbmFtZTogJ2Rlc2NlbmRhbnQnLCAgIHJlOiAvXlxzLyB9LAoKICAgIHsgbmFtZTogJ3RhZ05hbWUnLCAgICAgIHJlOiAvXlxzKihcKnxbXHdcLV0rKShcYnwkKT8vIH0sCiAgICB7IG5hbWU6ICdpZCcsICAgICAgICAgICByZTogL14jKFtcd1wtXCpdKykoXGJ8JCkvIH0sCiAgICB7IG5hbWU6ICdjbGFzc05hbWUnLCAgICByZTogL15cLihbXHdcLVwqXSspKFxifCQpLyB9LAogICAgeyBuYW1lOiAncHNldWRvJywgICAgICAgcmU6IC9eOigoZmlyc3R8bGFzdHxudGh8bnRoLWxhc3R8b25seSkoLWNoaWxkfC1vZi10eXBlKXxlbXB0eXxjaGVja2VkfChlbnxkaXMpYWJsZWR8bm90KShcKCguKj8pXCkpPyhcYnwkfCg/PVxzfFs6K34+XSkpLyB9LAogICAgeyBuYW1lOiAnYXR0clByZXNlbmNlJywgcmU6IC9eXFsoKD86W1x3LV0rOik/W1x3LV0rKVxdLyB9LAogICAgeyBuYW1lOiAnYXR0cicsICAgICAgICAgcmU6IC9cWygoPzpbXHctXSo6KT9bXHctXSspXHMqKD86KFshXiQqfnxdPz0pXHMqKChbJyJdKShbXlw0XSo/KVw0fChbXiciXVteXF1dKj8pKSk/XF0vIH0JCS8vIgogIF0sCgogIGFzc2VydGlvbnM6IHsKICAgIHRhZ05hbWU6IGZ1bmN0aW9uKGVsZW1lbnQsIG1hdGNoZXMpIHsKICAgICAgcmV0dXJuIG1hdGNoZXNbMV0udG9VcHBlckNhc2UoKSA9PSBlbGVtZW50LnRhZ05hbWUudG9VcHBlckNhc2UoKTsKICAgIH0sCgogICAgY2xhc3NOYW1lOiBmdW5jdGlvbihlbGVtZW50LCBtYXRjaGVzKSB7CiAgICAgIHJldHVybiBFbGVtZW50Lmhhc0NsYXNzTmFtZShlbGVtZW50LCBtYXRjaGVzWzFdKTsKICAgIH0sCgogICAgaWQ6IGZ1bmN0aW9uKGVsZW1lbnQsIG1hdGNoZXMpIHsKICAgICAgcmV0dXJuIGVsZW1lbnQuaWQgPT09IG1hdGNoZXNbMV07CiAgICB9LAoKICAgIGF0dHJQcmVzZW5jZTogZnVuY3Rpb24oZWxlbWVudCwgbWF0Y2hlcykgewogICAgICByZXR1cm4gRWxlbWVudC5oYXNBdHRyaWJ1dGUoZWxlbWVudCwgbWF0Y2hlc1sxXSk7CiAgICB9LAoKICAgIGF0dHI6IGZ1bmN0aW9uKGVsZW1lbnQsIG1hdGNoZXMpIHsKICAgICAgdmFyIG5vZGVWYWx1ZSA9IEVsZW1lbnQucmVhZEF0dHJpYnV0ZShlbGVtZW50LCBtYXRjaGVzWzFdKTsKICAgICAgcmV0dXJuIG5vZGVWYWx1ZSAmJiBTZWxlY3Rvci5vcGVyYXRvcnNbbWF0Y2hlc1syXV0obm9kZVZhbHVlLCBtYXRjaGVzWzVdIHx8IG1hdGNoZXNbNl0pOwogICAgfQogIH0sCgogIGhhbmRsZXJzOiB7CiAgICBjb25jYXQ6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSBiW2ldOyBpKyspCiAgICAgICAgYS5wdXNoKG5vZGUpOwogICAgICByZXR1cm4gYTsKICAgIH0sCgogICAgbWFyazogZnVuY3Rpb24obm9kZXMpIHsKICAgICAgdmFyIF90cnVlID0gUHJvdG90eXBlLmVtcHR5RnVuY3Rpb247CiAgICAgIGZvciAodmFyIGkgPSAwLCBub2RlOyBub2RlID0gbm9kZXNbaV07IGkrKykKICAgICAgICBub2RlLl9jb3VudGVkQnlQcm90b3R5cGUgPSBfdHJ1ZTsKICAgICAgcmV0dXJuIG5vZGVzOwogICAgfSwKCiAgICB1bm1hcms6IChmdW5jdGlvbigpewoKICAgICAgdmFyIFBST1BFUlRJRVNfQVRUUklCVVRFU19NQVAgPSAoZnVuY3Rpb24oKXsKICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSwKICAgICAgICAgICAgaXNCdWdneSA9IGZhbHNlLAogICAgICAgICAgICBwcm9wTmFtZSA9ICdfY291bnRlZEJ5UHJvdG90eXBlJywKICAgICAgICAgICAgdmFsdWUgPSAneCcKICAgICAgICBlbFtwcm9wTmFtZV0gPSB2YWx1ZTsKICAgICAgICBpc0J1Z2d5ID0gKGVsLmdldEF0dHJpYnV0ZShwcm9wTmFtZSkgPT09IHZhbHVlKTsKICAgICAgICBlbCA9IG51bGw7CiAgICAgICAgcmV0dXJuIGlzQnVnZ3k7CiAgICAgIH0pKCk7CgogICAgICByZXR1cm4gUFJPUEVSVElFU19BVFRSSUJVVEVTX01BUCA/CiAgICAgICAgZnVuY3Rpb24obm9kZXMpIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBub2RlOyBub2RlID0gbm9kZXNbaV07IGkrKykKICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoJ19jb3VudGVkQnlQcm90b3R5cGUnKTsKICAgICAgICAgIHJldHVybiBub2RlczsKICAgICAgICB9IDoKICAgICAgICBmdW5jdGlvbihub2RlcykgewogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSBub2Rlc1tpXTsgaSsrKQogICAgICAgICAgICBub2RlLl9jb3VudGVkQnlQcm90b3R5cGUgPSB2b2lkIDA7CiAgICAgICAgICByZXR1cm4gbm9kZXM7CiAgICAgICAgfQogICAgfSkoKSwKCiAgICBpbmRleDogZnVuY3Rpb24ocGFyZW50Tm9kZSwgcmV2ZXJzZSwgb2ZUeXBlKSB7CiAgICAgIHBhcmVudE5vZGUuX2NvdW50ZWRCeVByb3RvdHlwZSA9IFByb3RvdHlwZS5lbXB0eUZ1bmN0aW9uOwogICAgICBpZiAocmV2ZXJzZSkgewogICAgICAgIGZvciAodmFyIG5vZGVzID0gcGFyZW50Tm9kZS5jaGlsZE5vZGVzLCBpID0gbm9kZXMubGVuZ3RoIC0gMSwgaiA9IDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICB2YXIgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT0gMSAmJiAoIW9mVHlwZSB8fCBub2RlLl9jb3VudGVkQnlQcm90b3R5cGUpKSBub2RlLm5vZGVJbmRleCA9IGorKzsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGogPSAxLCBub2RlcyA9IHBhcmVudE5vZGUuY2hpbGROb2Rlczsgbm9kZSA9IG5vZGVzW2ldOyBpKyspCiAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PSAxICYmICghb2ZUeXBlIHx8IG5vZGUuX2NvdW50ZWRCeVByb3RvdHlwZSkpIG5vZGUubm9kZUluZGV4ID0gaisrOwogICAgICB9CiAgICB9LAoKICAgIHVuaXF1ZTogZnVuY3Rpb24obm9kZXMpIHsKICAgICAgaWYgKG5vZGVzLmxlbmd0aCA9PSAwKSByZXR1cm4gbm9kZXM7CiAgICAgIHZhciByZXN1bHRzID0gW10sIG47CiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbm9kZXMubGVuZ3RoOyBpIDwgbDsgaSsrKQogICAgICAgIGlmICh0eXBlb2YgKG4gPSBub2Rlc1tpXSkuX2NvdW50ZWRCeVByb3RvdHlwZSA9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgbi5fY291bnRlZEJ5UHJvdG90eXBlID0gUHJvdG90eXBlLmVtcHR5RnVuY3Rpb247CiAgICAgICAgICByZXN1bHRzLnB1c2goRWxlbWVudC5leHRlbmQobikpOwogICAgICAgIH0KICAgICAgcmV0dXJuIFNlbGVjdG9yLmhhbmRsZXJzLnVubWFyayhyZXN1bHRzKTsKICAgIH0sCgogICAgZGVzY2VuZGFudDogZnVuY3Rpb24obm9kZXMpIHsKICAgICAgdmFyIGggPSBTZWxlY3Rvci5oYW5kbGVyczsKICAgICAgZm9yICh2YXIgaSA9IDAsIHJlc3VsdHMgPSBbXSwgbm9kZTsgbm9kZSA9IG5vZGVzW2ldOyBpKyspCiAgICAgICAgaC5jb25jYXQocmVzdWx0cywgbm9kZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpKTsKICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICB9LAoKICAgIGNoaWxkOiBmdW5jdGlvbihub2RlcykgewogICAgICB2YXIgaCA9IFNlbGVjdG9yLmhhbmRsZXJzOwogICAgICBmb3IgKHZhciBpID0gMCwgcmVzdWx0cyA9IFtdLCBub2RlOyBub2RlID0gbm9kZXNbaV07IGkrKykgewogICAgICAgIGZvciAodmFyIGogPSAwLCBjaGlsZDsgY2hpbGQgPSBub2RlLmNoaWxkTm9kZXNbal07IGorKykKICAgICAgICAgIGlmIChjaGlsZC5ub2RlVHlwZSA9PSAxICYmIGNoaWxkLnRhZ05hbWUgIT0gJyEnKSByZXN1bHRzLnB1c2goY2hpbGQpOwogICAgICB9CiAgICAgIHJldHVybiByZXN1bHRzOwogICAgfSwKCiAgICBhZGphY2VudDogZnVuY3Rpb24obm9kZXMpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIHJlc3VsdHMgPSBbXSwgbm9kZTsgbm9kZSA9IG5vZGVzW2ldOyBpKyspIHsKICAgICAgICB2YXIgbmV4dCA9IHRoaXMubmV4dEVsZW1lbnRTaWJsaW5nKG5vZGUpOwogICAgICAgIGlmIChuZXh0KSByZXN1bHRzLnB1c2gobmV4dCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICB9LAoKICAgIGxhdGVyU2libGluZzogZnVuY3Rpb24obm9kZXMpIHsKICAgICAgdmFyIGggPSBTZWxlY3Rvci5oYW5kbGVyczsKICAgICAgZm9yICh2YXIgaSA9IDAsIHJlc3VsdHMgPSBbXSwgbm9kZTsgbm9kZSA9IG5vZGVzW2ldOyBpKyspCiAgICAgICAgaC5jb25jYXQocmVzdWx0cywgRWxlbWVudC5uZXh0U2libGluZ3Mobm9kZSkpOwogICAgICByZXR1cm4gcmVzdWx0czsKICAgIH0sCgogICAgbmV4dEVsZW1lbnRTaWJsaW5nOiBmdW5jdGlvbihub2RlKSB7CiAgICAgIHdoaWxlIChub2RlID0gbm9kZS5uZXh0U2libGluZykKICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PSAxKSByZXR1cm4gbm9kZTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAoKICAgIHByZXZpb3VzRWxlbWVudFNpYmxpbmc6IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgd2hpbGUgKG5vZGUgPSBub2RlLnByZXZpb3VzU2libGluZykKICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PSAxKSByZXR1cm4gbm9kZTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAoKICAgIHRhZ05hbWU6IGZ1bmN0aW9uKG5vZGVzLCByb290LCB0YWdOYW1lLCBjb21iaW5hdG9yKSB7CiAgICAgIHZhciB1VGFnTmFtZSA9IHRhZ05hbWUudG9VcHBlckNhc2UoKTsKICAgICAgdmFyIHJlc3VsdHMgPSBbXSwgaCA9IFNlbGVjdG9yLmhhbmRsZXJzOwogICAgICBpZiAobm9kZXMpIHsKICAgICAgICBpZiAoY29tYmluYXRvcikgewogICAgICAgICAgaWYgKGNvbWJpbmF0b3IgPT0gImRlc2NlbmRhbnQiKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBub2RlOyBub2RlID0gbm9kZXNbaV07IGkrKykKICAgICAgICAgICAgICBoLmNvbmNhdChyZXN1bHRzLCBub2RlLmdldEVsZW1lbnRzQnlUYWdOYW1lKHRhZ05hbWUpKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICAgICAgICB9IGVsc2Ugbm9kZXMgPSB0aGlzW2NvbWJpbmF0b3JdKG5vZGVzKTsKICAgICAgICAgIGlmICh0YWdOYW1lID09ICIqIikgcmV0dXJuIG5vZGVzOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBpID0gMCwgbm9kZTsgbm9kZSA9IG5vZGVzW2ldOyBpKyspCiAgICAgICAgICBpZiAobm9kZS50YWdOYW1lLnRvVXBwZXJDYXNlKCkgPT09IHVUYWdOYW1lKSByZXN1bHRzLnB1c2gobm9kZSk7CiAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICAgIH0gZWxzZSByZXR1cm4gcm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWdOYW1lKTsKICAgIH0sCgogICAgaWQ6IGZ1bmN0aW9uKG5vZGVzLCByb290LCBpZCwgY29tYmluYXRvcikgewogICAgICB2YXIgdGFyZ2V0Tm9kZSA9ICQoaWQpLCBoID0gU2VsZWN0b3IuaGFuZGxlcnM7CgogICAgICBpZiAocm9vdCA9PSBkb2N1bWVudCkgewogICAgICAgIGlmICghdGFyZ2V0Tm9kZSkgcmV0dXJuIFtdOwogICAgICAgIGlmICghbm9kZXMpIHJldHVybiBbdGFyZ2V0Tm9kZV07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCFyb290LnNvdXJjZUluZGV4IHx8IHJvb3Quc291cmNlSW5kZXggPCAxKSB7CiAgICAgICAgICB2YXIgbm9kZXMgPSByb290LmdldEVsZW1lbnRzQnlUYWdOYW1lKCcqJyk7CiAgICAgICAgICBmb3IgKHZhciBqID0gMCwgbm9kZTsgbm9kZSA9IG5vZGVzW2pdOyBqKyspIHsKICAgICAgICAgICAgaWYgKG5vZGUuaWQgPT09IGlkKSByZXR1cm4gW25vZGVdOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKG5vZGVzKSB7CiAgICAgICAgaWYgKGNvbWJpbmF0b3IpIHsKICAgICAgICAgIGlmIChjb21iaW5hdG9yID09ICdjaGlsZCcpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSBub2Rlc1tpXTsgaSsrKQogICAgICAgICAgICAgIGlmICh0YXJnZXROb2RlLnBhcmVudE5vZGUgPT0gbm9kZSkgcmV0dXJuIFt0YXJnZXROb2RlXTsKICAgICAgICAgIH0gZWxzZSBpZiAoY29tYmluYXRvciA9PSAnZGVzY2VuZGFudCcpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSBub2Rlc1tpXTsgaSsrKQogICAgICAgICAgICAgIGlmIChFbGVtZW50LmRlc2NlbmRhbnRPZih0YXJnZXROb2RlLCBub2RlKSkgcmV0dXJuIFt0YXJnZXROb2RlXTsKICAgICAgICAgIH0gZWxzZSBpZiAoY29tYmluYXRvciA9PSAnYWRqYWNlbnQnKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBub2RlOyBub2RlID0gbm9kZXNbaV07IGkrKykKICAgICAgICAgICAgICBpZiAoU2VsZWN0b3IuaGFuZGxlcnMucHJldmlvdXNFbGVtZW50U2libGluZyh0YXJnZXROb2RlKSA9PSBub2RlKQogICAgICAgICAgICAgICAgcmV0dXJuIFt0YXJnZXROb2RlXTsKICAgICAgICAgIH0gZWxzZSBub2RlcyA9IGhbY29tYmluYXRvcl0obm9kZXMpOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBpID0gMCwgbm9kZTsgbm9kZSA9IG5vZGVzW2ldOyBpKyspCiAgICAgICAgICBpZiAobm9kZSA9PSB0YXJnZXROb2RlKSByZXR1cm4gW3RhcmdldE5vZGVdOwogICAgICAgIHJldHVybiBbXTsKICAgICAgfQogICAgICByZXR1cm4gKHRhcmdldE5vZGUgJiYgRWxlbWVudC5kZXNjZW5kYW50T2YodGFyZ2V0Tm9kZSwgcm9vdCkpID8gW3RhcmdldE5vZGVdIDogW107CiAgICB9LAoKICAgIGNsYXNzTmFtZTogZnVuY3Rpb24obm9kZXMsIHJvb3QsIGNsYXNzTmFtZSwgY29tYmluYXRvcikgewogICAgICBpZiAobm9kZXMgJiYgY29tYmluYXRvcikgbm9kZXMgPSB0aGlzW2NvbWJpbmF0b3JdKG5vZGVzKTsKICAgICAgcmV0dXJuIFNlbGVjdG9yLmhhbmRsZXJzLmJ5Q2xhc3NOYW1lKG5vZGVzLCByb290LCBjbGFzc05hbWUpOwogICAgfSwKCiAgICBieUNsYXNzTmFtZTogZnVuY3Rpb24obm9kZXMsIHJvb3QsIGNsYXNzTmFtZSkgewogICAgICBpZiAoIW5vZGVzKSBub2RlcyA9IFNlbGVjdG9yLmhhbmRsZXJzLmRlc2NlbmRhbnQoW3Jvb3RdKTsKICAgICAgdmFyIG5lZWRsZSA9ICcgJyArIGNsYXNzTmFtZSArICcgJzsKICAgICAgZm9yICh2YXIgaSA9IDAsIHJlc3VsdHMgPSBbXSwgbm9kZSwgbm9kZUNsYXNzTmFtZTsgbm9kZSA9IG5vZGVzW2ldOyBpKyspIHsKICAgICAgICBub2RlQ2xhc3NOYW1lID0gbm9kZS5jbGFzc05hbWU7CiAgICAgICAgaWYgKG5vZGVDbGFzc05hbWUubGVuZ3RoID09IDApIGNvbnRpbnVlOwogICAgICAgIGlmIChub2RlQ2xhc3NOYW1lID09IGNsYXNzTmFtZSB8fCAoJyAnICsgbm9kZUNsYXNzTmFtZSArICcgJykuaW5jbHVkZShuZWVkbGUpKQogICAgICAgICAgcmVzdWx0cy5wdXNoKG5vZGUpOwogICAgICB9CiAgICAgIHJldHVybiByZXN1bHRzOwogICAgfSwKCiAgICBhdHRyUHJlc2VuY2U6IGZ1bmN0aW9uKG5vZGVzLCByb290LCBhdHRyLCBjb21iaW5hdG9yKSB7CiAgICAgIGlmICghbm9kZXMpIG5vZGVzID0gcm9vdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpOwogICAgICBpZiAobm9kZXMgJiYgY29tYmluYXRvcikgbm9kZXMgPSB0aGlzW2NvbWJpbmF0b3JdKG5vZGVzKTsKICAgICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSBub2Rlc1tpXTsgaSsrKQogICAgICAgIGlmIChFbGVtZW50Lmhhc0F0dHJpYnV0ZShub2RlLCBhdHRyKSkgcmVzdWx0cy5wdXNoKG5vZGUpOwogICAgICByZXR1cm4gcmVzdWx0czsKICAgIH0sCgogICAgYXR0cjogZnVuY3Rpb24obm9kZXMsIHJvb3QsIGF0dHIsIHZhbHVlLCBvcGVyYXRvciwgY29tYmluYXRvcikgewogICAgICBpZiAoIW5vZGVzKSBub2RlcyA9IHJvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKTsKICAgICAgaWYgKG5vZGVzICYmIGNvbWJpbmF0b3IpIG5vZGVzID0gdGhpc1tjb21iaW5hdG9yXShub2Rlcyk7CiAgICAgIHZhciBoYW5kbGVyID0gU2VsZWN0b3Iub3BlcmF0b3JzW29wZXJhdG9yXSwgcmVzdWx0cyA9IFtdOwogICAgICBmb3IgKHZhciBpID0gMCwgbm9kZTsgbm9kZSA9IG5vZGVzW2ldOyBpKyspIHsKICAgICAgICB2YXIgbm9kZVZhbHVlID0gRWxlbWVudC5yZWFkQXR0cmlidXRlKG5vZGUsIGF0dHIpOwogICAgICAgIGlmIChub2RlVmFsdWUgPT09IG51bGwpIGNvbnRpbnVlOwogICAgICAgIGlmIChoYW5kbGVyKG5vZGVWYWx1ZSwgdmFsdWUpKSByZXN1bHRzLnB1c2gobm9kZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICB9LAoKICAgIHBzZXVkbzogZnVuY3Rpb24obm9kZXMsIG5hbWUsIHZhbHVlLCByb290LCBjb21iaW5hdG9yKSB7CiAgICAgIGlmIChub2RlcyAmJiBjb21iaW5hdG9yKSBub2RlcyA9IHRoaXNbY29tYmluYXRvcl0obm9kZXMpOwogICAgICBpZiAoIW5vZGVzKSBub2RlcyA9IHJvb3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKTsKICAgICAgcmV0dXJuIFNlbGVjdG9yLnBzZXVkb3NbbmFtZV0obm9kZXMsIHZhbHVlLCByb290KTsKICAgIH0KICB9LAoKICBwc2V1ZG9zOiB7CiAgICAnZmlyc3QtY2hpbGQnOiBmdW5jdGlvbihub2RlcywgdmFsdWUsIHJvb3QpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIHJlc3VsdHMgPSBbXSwgbm9kZTsgbm9kZSA9IG5vZGVzW2ldOyBpKyspIHsKICAgICAgICBpZiAoU2VsZWN0b3IuaGFuZGxlcnMucHJldmlvdXNFbGVtZW50U2libGluZyhub2RlKSkgY29udGludWU7CiAgICAgICAgICByZXN1bHRzLnB1c2gobm9kZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICB9LAogICAgJ2xhc3QtY2hpbGQnOiBmdW5jdGlvbihub2RlcywgdmFsdWUsIHJvb3QpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIHJlc3VsdHMgPSBbXSwgbm9kZTsgbm9kZSA9IG5vZGVzW2ldOyBpKyspIHsKICAgICAgICBpZiAoU2VsZWN0b3IuaGFuZGxlcnMubmV4dEVsZW1lbnRTaWJsaW5nKG5vZGUpKSBjb250aW51ZTsKICAgICAgICAgIHJlc3VsdHMucHVzaChub2RlKTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0czsKICAgIH0sCiAgICAnb25seS1jaGlsZCc6IGZ1bmN0aW9uKG5vZGVzLCB2YWx1ZSwgcm9vdCkgewogICAgICB2YXIgaCA9IFNlbGVjdG9yLmhhbmRsZXJzOwogICAgICBmb3IgKHZhciBpID0gMCwgcmVzdWx0cyA9IFtdLCBub2RlOyBub2RlID0gbm9kZXNbaV07IGkrKykKICAgICAgICBpZiAoIWgucHJldmlvdXNFbGVtZW50U2libGluZyhub2RlKSAmJiAhaC5uZXh0RWxlbWVudFNpYmxpbmcobm9kZSkpCiAgICAgICAgICByZXN1bHRzLnB1c2gobm9kZSk7CiAgICAgIHJldHVybiByZXN1bHRzOwogICAgfSwKICAgICdudGgtY2hpbGQnOiAgICAgICAgZnVuY3Rpb24obm9kZXMsIGZvcm11bGEsIHJvb3QpIHsKICAgICAgcmV0dXJuIFNlbGVjdG9yLnBzZXVkb3MubnRoKG5vZGVzLCBmb3JtdWxhLCByb290KTsKICAgIH0sCiAgICAnbnRoLWxhc3QtY2hpbGQnOiAgIGZ1bmN0aW9uKG5vZGVzLCBmb3JtdWxhLCByb290KSB7CiAgICAgIHJldHVybiBTZWxlY3Rvci5wc2V1ZG9zLm50aChub2RlcywgZm9ybXVsYSwgcm9vdCwgdHJ1ZSk7CiAgICB9LAogICAgJ250aC1vZi10eXBlJzogICAgICBmdW5jdGlvbihub2RlcywgZm9ybXVsYSwgcm9vdCkgewogICAgICByZXR1cm4gU2VsZWN0b3IucHNldWRvcy5udGgobm9kZXMsIGZvcm11bGEsIHJvb3QsIGZhbHNlLCB0cnVlKTsKICAgIH0sCiAgICAnbnRoLWxhc3Qtb2YtdHlwZSc6IGZ1bmN0aW9uKG5vZGVzLCBmb3JtdWxhLCByb290KSB7CiAgICAgIHJldHVybiBTZWxlY3Rvci5wc2V1ZG9zLm50aChub2RlcywgZm9ybXVsYSwgcm9vdCwgdHJ1ZSwgdHJ1ZSk7CiAgICB9LAogICAgJ2ZpcnN0LW9mLXR5cGUnOiAgICBmdW5jdGlvbihub2RlcywgZm9ybXVsYSwgcm9vdCkgewogICAgICByZXR1cm4gU2VsZWN0b3IucHNldWRvcy5udGgobm9kZXMsICIxIiwgcm9vdCwgZmFsc2UsIHRydWUpOwogICAgfSwKICAgICdsYXN0LW9mLXR5cGUnOiAgICAgZnVuY3Rpb24obm9kZXMsIGZvcm11bGEsIHJvb3QpIHsKICAgICAgcmV0dXJuIFNlbGVjdG9yLnBzZXVkb3MubnRoKG5vZGVzLCAiMSIsIHJvb3QsIHRydWUsIHRydWUpOwogICAgfSwKICAgICdvbmx5LW9mLXR5cGUnOiAgICAgZnVuY3Rpb24obm9kZXMsIGZvcm11bGEsIHJvb3QpIHsKICAgICAgdmFyIHAgPSBTZWxlY3Rvci5wc2V1ZG9zOwogICAgICByZXR1cm4gcFsnbGFzdC1vZi10eXBlJ10ocFsnZmlyc3Qtb2YtdHlwZSddKG5vZGVzLCBmb3JtdWxhLCByb290KSwgZm9ybXVsYSwgcm9vdCk7CiAgICB9LAoKICAgIGdldEluZGljZXM6IGZ1bmN0aW9uKGEsIGIsIHRvdGFsKSB7CiAgICAgIGlmIChhID09IDApIHJldHVybiBiID4gMCA/IFtiXSA6IFtdOwogICAgICByZXR1cm4gJFIoMSwgdG90YWwpLmluamVjdChbXSwgZnVuY3Rpb24obWVtbywgaSkgewogICAgICAgIGlmICgwID09IChpIC0gYikgJSBhICYmIChpIC0gYikgLyBhID49IDApIG1lbW8ucHVzaChpKTsKICAgICAgICByZXR1cm4gbWVtbzsKICAgICAgfSk7CiAgICB9LAoKICAgIG50aDogZnVuY3Rpb24obm9kZXMsIGZvcm11bGEsIHJvb3QsIHJldmVyc2UsIG9mVHlwZSkgewogICAgICBpZiAobm9kZXMubGVuZ3RoID09IDApIHJldHVybiBbXTsKICAgICAgaWYgKGZvcm11bGEgPT0gJ2V2ZW4nKSBmb3JtdWxhID0gJzJuKzAnOwogICAgICBpZiAoZm9ybXVsYSA9PSAnb2RkJykgIGZvcm11bGEgPSAnMm4rMSc7CiAgICAgIHZhciBoID0gU2VsZWN0b3IuaGFuZGxlcnMsIHJlc3VsdHMgPSBbXSwgaW5kZXhlZCA9IFtdLCBtOwogICAgICBoLm1hcmsobm9kZXMpOwogICAgICBmb3IgKHZhciBpID0gMCwgbm9kZTsgbm9kZSA9IG5vZGVzW2ldOyBpKyspIHsKICAgICAgICBpZiAoIW5vZGUucGFyZW50Tm9kZS5fY291bnRlZEJ5UHJvdG90eXBlKSB7CiAgICAgICAgICBoLmluZGV4KG5vZGUucGFyZW50Tm9kZSwgcmV2ZXJzZSwgb2ZUeXBlKTsKICAgICAgICAgIGluZGV4ZWQucHVzaChub2RlLnBhcmVudE5vZGUpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoZm9ybXVsYS5tYXRjaCgvXlxkKyQvKSkgeyAvLyBqdXN0IGEgbnVtYmVyCiAgICAgICAgZm9ybXVsYSA9IE51bWJlcihmb3JtdWxhKTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbm9kZTsgbm9kZSA9IG5vZGVzW2ldOyBpKyspCiAgICAgICAgICBpZiAobm9kZS5ub2RlSW5kZXggPT0gZm9ybXVsYSkgcmVzdWx0cy5wdXNoKG5vZGUpOwogICAgICB9IGVsc2UgaWYgKG0gPSBmb3JtdWxhLm1hdGNoKC9eKC0/XGQqKT9uKChbKy1dKShcZCspKT8vKSkgeyAvLyBhbitiCiAgICAgICAgaWYgKG1bMV0gPT0gIi0iKSBtWzFdID0gLTE7CiAgICAgICAgdmFyIGEgPSBtWzFdID8gTnVtYmVyKG1bMV0pIDogMTsKICAgICAgICB2YXIgYiA9IG1bMl0gPyBOdW1iZXIobVsyXSkgOiAwOwogICAgICAgIHZhciBpbmRpY2VzID0gU2VsZWN0b3IucHNldWRvcy5nZXRJbmRpY2VzKGEsIGIsIG5vZGVzLmxlbmd0aCk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIG5vZGUsIGwgPSBpbmRpY2VzLmxlbmd0aDsgbm9kZSA9IG5vZGVzW2ldOyBpKyspIHsKICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbDsgaisrKQogICAgICAgICAgICBpZiAobm9kZS5ub2RlSW5kZXggPT0gaW5kaWNlc1tqXSkgcmVzdWx0cy5wdXNoKG5vZGUpOwogICAgICAgIH0KICAgICAgfQogICAgICBoLnVubWFyayhub2Rlcyk7CiAgICAgIGgudW5tYXJrKGluZGV4ZWQpOwogICAgICByZXR1cm4gcmVzdWx0czsKICAgIH0sCgogICAgJ2VtcHR5JzogZnVuY3Rpb24obm9kZXMsIHZhbHVlLCByb290KSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCByZXN1bHRzID0gW10sIG5vZGU7IG5vZGUgPSBub2Rlc1tpXTsgaSsrKSB7CiAgICAgICAgaWYgKG5vZGUudGFnTmFtZSA9PSAnIScgfHwgbm9kZS5maXJzdENoaWxkKSBjb250aW51ZTsKICAgICAgICByZXN1bHRzLnB1c2gobm9kZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICB9LAoKICAgICdub3QnOiBmdW5jdGlvbihub2Rlcywgc2VsZWN0b3IsIHJvb3QpIHsKICAgICAgdmFyIGggPSBTZWxlY3Rvci5oYW5kbGVycywgc2VsZWN0b3JUeXBlLCBtOwogICAgICB2YXIgZXhjbHVzaW9ucyA9IG5ldyBTZWxlY3RvcihzZWxlY3RvcikuZmluZEVsZW1lbnRzKHJvb3QpOwogICAgICBoLm1hcmsoZXhjbHVzaW9ucyk7CiAgICAgIGZvciAodmFyIGkgPSAwLCByZXN1bHRzID0gW10sIG5vZGU7IG5vZGUgPSBub2Rlc1tpXTsgaSsrKQogICAgICAgIGlmICghbm9kZS5fY291bnRlZEJ5UHJvdG90eXBlKSByZXN1bHRzLnB1c2gobm9kZSk7CiAgICAgIGgudW5tYXJrKGV4Y2x1c2lvbnMpOwogICAgICByZXR1cm4gcmVzdWx0czsKICAgIH0sCgogICAgJ2VuYWJsZWQnOiBmdW5jdGlvbihub2RlcywgdmFsdWUsIHJvb3QpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIHJlc3VsdHMgPSBbXSwgbm9kZTsgbm9kZSA9IG5vZGVzW2ldOyBpKyspCiAgICAgICAgaWYgKCFub2RlLmRpc2FibGVkICYmICghbm9kZS50eXBlIHx8IG5vZGUudHlwZSAhPT0gJ2hpZGRlbicpKQogICAgICAgICAgcmVzdWx0cy5wdXNoKG5vZGUpOwogICAgICByZXR1cm4gcmVzdWx0czsKICAgIH0sCgogICAgJ2Rpc2FibGVkJzogZnVuY3Rpb24obm9kZXMsIHZhbHVlLCByb290KSB7CiAgICAgIGZvciAodmFyIGkgPSAwLCByZXN1bHRzID0gW10sIG5vZGU7IG5vZGUgPSBub2Rlc1tpXTsgaSsrKQogICAgICAgIGlmIChub2RlLmRpc2FibGVkKSByZXN1bHRzLnB1c2gobm9kZSk7CiAgICAgIHJldHVybiByZXN1bHRzOwogICAgfSwKCiAgICAnY2hlY2tlZCc6IGZ1bmN0aW9uKG5vZGVzLCB2YWx1ZSwgcm9vdCkgewogICAgICBmb3IgKHZhciBpID0gMCwgcmVzdWx0cyA9IFtdLCBub2RlOyBub2RlID0gbm9kZXNbaV07IGkrKykKICAgICAgICBpZiAobm9kZS5jaGVja2VkKSByZXN1bHRzLnB1c2gobm9kZSk7CiAgICAgIHJldHVybiByZXN1bHRzOwogICAgfQogIH0sCgogIG9wZXJhdG9yczogewogICAgJz0nOiAgZnVuY3Rpb24obnYsIHYpIHsgcmV0dXJuIG52ID09IHY7IH0sCiAgICAnIT0nOiBmdW5jdGlvbihudiwgdikgeyByZXR1cm4gbnYgIT0gdjsgfSwKICAgICdePSc6IGZ1bmN0aW9uKG52LCB2KSB7IHJldHVybiBudiA9PSB2IHx8IG52ICYmIG52LnN0YXJ0c1dpdGgodik7IH0sCiAgICAnJD0nOiBmdW5jdGlvbihudiwgdikgeyByZXR1cm4gbnYgPT0gdiB8fCBudiAmJiBudi5lbmRzV2l0aCh2KTsgfSwKICAgICcqPSc6IGZ1bmN0aW9uKG52LCB2KSB7IHJldHVybiBudiA9PSB2IHx8IG52ICYmIG52LmluY2x1ZGUodik7IH0sCiAgICAnfj0nOiBmdW5jdGlvbihudiwgdikgeyByZXR1cm4gKCcgJyArIG52ICsgJyAnKS5pbmNsdWRlKCcgJyArIHYgKyAnICcpOyB9LAogICAgJ3w9JzogZnVuY3Rpb24obnYsIHYpIHsgcmV0dXJuICgnLScgKyAobnYgfHwgIiIpLnRvVXBwZXJDYXNlKCkgKwogICAgICctJykuaW5jbHVkZSgnLScgKyAodiB8fCAiIikudG9VcHBlckNhc2UoKSArICctJyk7IH0KICB9LAoKICBzcGxpdDogZnVuY3Rpb24oZXhwcmVzc2lvbikgewogICAgdmFyIGV4cHJlc3Npb25zID0gW107CiAgICBleHByZXNzaW9uLnNjYW4oLygoW1x3Izoufj4rKClccy1dK3xcKnxcWy4qP1xdKSspXHMqKCx8JCkvLCBmdW5jdGlvbihtKSB7CiAgICAgIGV4cHJlc3Npb25zLnB1c2gobVsxXS5zdHJpcCgpKTsKICAgIH0pOwogICAgcmV0dXJuIGV4cHJlc3Npb25zOwogIH0sCgogIG1hdGNoRWxlbWVudHM6IGZ1bmN0aW9uKGVsZW1lbnRzLCBleHByZXNzaW9uKSB7CiAgICB2YXIgbWF0Y2hlcyA9ICQkKGV4cHJlc3Npb24pLCBoID0gU2VsZWN0b3IuaGFuZGxlcnM7CiAgICBoLm1hcmsobWF0Y2hlcyk7CiAgICBmb3IgKHZhciBpID0gMCwgcmVzdWx0cyA9IFtdLCBlbGVtZW50OyBlbGVtZW50ID0gZWxlbWVudHNbaV07IGkrKykKICAgICAgaWYgKGVsZW1lbnQuX2NvdW50ZWRCeVByb3RvdHlwZSkgcmVzdWx0cy5wdXNoKGVsZW1lbnQpOwogICAgaC51bm1hcmsobWF0Y2hlcyk7CiAgICByZXR1cm4gcmVzdWx0czsKICB9LAoKICBmaW5kRWxlbWVudDogZnVuY3Rpb24oZWxlbWVudHMsIGV4cHJlc3Npb24sIGluZGV4KSB7CiAgICBpZiAoT2JqZWN0LmlzTnVtYmVyKGV4cHJlc3Npb24pKSB7CiAgICAgIGluZGV4ID0gZXhwcmVzc2lvbjsgZXhwcmVzc2lvbiA9IGZhbHNlOwogICAgfQogICAgcmV0dXJuIFNlbGVjdG9yLm1hdGNoRWxlbWVudHMoZWxlbWVudHMsIGV4cHJlc3Npb24gfHwgJyonKVtpbmRleCB8fCAwXTsKICB9LAoKICBmaW5kQ2hpbGRFbGVtZW50czogZnVuY3Rpb24oZWxlbWVudCwgZXhwcmVzc2lvbnMpIHsKICAgIGV4cHJlc3Npb25zID0gU2VsZWN0b3Iuc3BsaXQoZXhwcmVzc2lvbnMuam9pbignLCcpKTsKICAgIHZhciByZXN1bHRzID0gW10sIGggPSBTZWxlY3Rvci5oYW5kbGVyczsKICAgIGZvciAodmFyIGkgPSAwLCBsID0gZXhwcmVzc2lvbnMubGVuZ3RoLCBzZWxlY3RvcjsgaSA8IGw7IGkrKykgewogICAgICBzZWxlY3RvciA9IG5ldyBTZWxlY3RvcihleHByZXNzaW9uc1tpXS5zdHJpcCgpKTsKICAgICAgaC5jb25jYXQocmVzdWx0cywgc2VsZWN0b3IuZmluZEVsZW1lbnRzKGVsZW1lbnQpKTsKICAgIH0KICAgIHJldHVybiAobCA+IDEpID8gaC51bmlxdWUocmVzdWx0cykgOiByZXN1bHRzOwogIH0KfSk7CgppZiAoUHJvdG90eXBlLkJyb3dzZXIuSUUpIHsKICBPYmplY3QuZXh0ZW5kKFNlbGVjdG9yLmhhbmRsZXJzLCB7CiAgICBjb25jYXQ6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIG5vZGU7IG5vZGUgPSBiW2ldOyBpKyspCiAgICAgICAgaWYgKG5vZGUudGFnTmFtZSAhPT0gIiEiKSBhLnB1c2gobm9kZSk7CiAgICAgIHJldHVybiBhOwogICAgfQogIH0pOwp9CgpmdW5jdGlvbiAkJCgpIHsKICByZXR1cm4gU2VsZWN0b3IuZmluZENoaWxkRWxlbWVudHMoZG9jdW1lbnQsICRBKGFyZ3VtZW50cykpOwp9Cgp2YXIgRm9ybSA9IHsKICByZXNldDogZnVuY3Rpb24oZm9ybSkgewogICAgZm9ybSA9ICQoZm9ybSk7CiAgICBmb3JtLnJlc2V0KCk7CiAgICByZXR1cm4gZm9ybTsKICB9LAoKICBzZXJpYWxpemVFbGVtZW50czogZnVuY3Rpb24oZWxlbWVudHMsIG9wdGlvbnMpIHsKICAgIGlmICh0eXBlb2Ygb3B0aW9ucyAhPSAnb2JqZWN0Jykgb3B0aW9ucyA9IHsgaGFzaDogISFvcHRpb25zIH07CiAgICBlbHNlIGlmIChPYmplY3QuaXNVbmRlZmluZWQob3B0aW9ucy5oYXNoKSkgb3B0aW9ucy5oYXNoID0gdHJ1ZTsKICAgIHZhciBrZXksIHZhbHVlLCBzdWJtaXR0ZWQgPSBmYWxzZSwgc3VibWl0ID0gb3B0aW9ucy5zdWJtaXQ7CgogICAgdmFyIGRhdGEgPSBlbGVtZW50cy5pbmplY3QoeyB9LCBmdW5jdGlvbihyZXN1bHQsIGVsZW1lbnQpIHsKICAgICAgaWYgKCFlbGVtZW50LmRpc2FibGVkICYmIGVsZW1lbnQubmFtZSkgewogICAgICAgIGtleSA9IGVsZW1lbnQubmFtZTsgdmFsdWUgPSAkKGVsZW1lbnQpLmdldFZhbHVlKCk7CiAgICAgICAgaWYgKHZhbHVlICE9IG51bGwgJiYgZWxlbWVudC50eXBlICE9ICdmaWxlJyAmJiAoZWxlbWVudC50eXBlICE9ICdzdWJtaXQnIHx8ICghc3VibWl0dGVkICYmCiAgICAgICAgICAgIHN1Ym1pdCAhPT0gZmFsc2UgJiYgKCFzdWJtaXQgfHwga2V5ID09IHN1Ym1pdCkgJiYgKHN1Ym1pdHRlZCA9IHRydWUpKSkpIHsKICAgICAgICAgIGlmIChrZXkgaW4gcmVzdWx0KSB7CiAgICAgICAgICAgIGlmICghT2JqZWN0LmlzQXJyYXkocmVzdWx0W2tleV0pKSByZXN1bHRba2V5XSA9IFtyZXN1bHRba2V5XV07CiAgICAgICAgICAgIHJlc3VsdFtrZXldLnB1c2godmFsdWUpOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSByZXN1bHRba2V5XSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfSk7CgogICAgcmV0dXJuIG9wdGlvbnMuaGFzaCA/IGRhdGEgOiBPYmplY3QudG9RdWVyeVN0cmluZyhkYXRhKTsKICB9Cn07CgpGb3JtLk1ldGhvZHMgPSB7CiAgc2VyaWFsaXplOiBmdW5jdGlvbihmb3JtLCBvcHRpb25zKSB7CiAgICByZXR1cm4gRm9ybS5zZXJpYWxpemVFbGVtZW50cyhGb3JtLmdldEVsZW1lbnRzKGZvcm0pLCBvcHRpb25zKTsKICB9LAoKICBnZXRFbGVtZW50czogZnVuY3Rpb24oZm9ybSkgewogICAgdmFyIGVsZW1lbnRzID0gJChmb3JtKS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnKicpLAogICAgICAgIGVsZW1lbnQsCiAgICAgICAgYXJyID0gWyBdLAogICAgICAgIHNlcmlhbGl6ZXJzID0gRm9ybS5FbGVtZW50LlNlcmlhbGl6ZXJzOwogICAgZm9yICh2YXIgaSA9IDA7IGVsZW1lbnQgPSBlbGVtZW50c1tpXTsgaSsrKSB7CiAgICAgIGFyci5wdXNoKGVsZW1lbnQpOwogICAgfQogICAgcmV0dXJuIGFyci5pbmplY3QoW10sIGZ1bmN0aW9uKGVsZW1lbnRzLCBjaGlsZCkgewogICAgICBpZiAoc2VyaWFsaXplcnNbY2hpbGQudGFnTmFtZS50b0xvd2VyQ2FzZSgpXSkKICAgICAgICBlbGVtZW50cy5wdXNoKEVsZW1lbnQuZXh0ZW5kKGNoaWxkKSk7CiAgICAgIHJldHVybiBlbGVtZW50czsKICAgIH0pCiAgfSwKCiAgZ2V0SW5wdXRzOiBmdW5jdGlvbihmb3JtLCB0eXBlTmFtZSwgbmFtZSkgewogICAgZm9ybSA9ICQoZm9ybSk7CiAgICB2YXIgaW5wdXRzID0gZm9ybS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW5wdXQnKTsKCiAgICBpZiAoIXR5cGVOYW1lICYmICFuYW1lKSByZXR1cm4gJEEoaW5wdXRzKS5tYXAoRWxlbWVudC5leHRlbmQpOwoKICAgIGZvciAodmFyIGkgPSAwLCBtYXRjaGluZ0lucHV0cyA9IFtdLCBsZW5ndGggPSBpbnB1dHMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIGlucHV0ID0gaW5wdXRzW2ldOwogICAgICBpZiAoKHR5cGVOYW1lICYmIGlucHV0LnR5cGUgIT0gdHlwZU5hbWUpIHx8IChuYW1lICYmIGlucHV0Lm5hbWUgIT0gbmFtZSkpCiAgICAgICAgY29udGludWU7CiAgICAgIG1hdGNoaW5nSW5wdXRzLnB1c2goRWxlbWVudC5leHRlbmQoaW5wdXQpKTsKICAgIH0KCiAgICByZXR1cm4gbWF0Y2hpbmdJbnB1dHM7CiAgfSwKCiAgZGlzYWJsZTogZnVuY3Rpb24oZm9ybSkgewogICAgZm9ybSA9ICQoZm9ybSk7CiAgICBGb3JtLmdldEVsZW1lbnRzKGZvcm0pLmludm9rZSgnZGlzYWJsZScpOwogICAgcmV0dXJuIGZvcm07CiAgfSwKCiAgZW5hYmxlOiBmdW5jdGlvbihmb3JtKSB7CiAgICBmb3JtID0gJChmb3JtKTsKICAgIEZvcm0uZ2V0RWxlbWVudHMoZm9ybSkuaW52b2tlKCdlbmFibGUnKTsKICAgIHJldHVybiBmb3JtOwogIH0sCgogIGZpbmRGaXJzdEVsZW1lbnQ6IGZ1bmN0aW9uKGZvcm0pIHsKICAgIHZhciBlbGVtZW50cyA9ICQoZm9ybSkuZ2V0RWxlbWVudHMoKS5maW5kQWxsKGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgICAgcmV0dXJuICdoaWRkZW4nICE9IGVsZW1lbnQudHlwZSAmJiAhZWxlbWVudC5kaXNhYmxlZDsKICAgIH0pOwogICAgdmFyIGZpcnN0QnlJbmRleCA9IGVsZW1lbnRzLmZpbmRBbGwoZnVuY3Rpb24oZWxlbWVudCkgewogICAgICByZXR1cm4gZWxlbWVudC5oYXNBdHRyaWJ1dGUoJ3RhYkluZGV4JykgJiYgZWxlbWVudC50YWJJbmRleCA+PSAwOwogICAgfSkuc29ydEJ5KGZ1bmN0aW9uKGVsZW1lbnQpIHsgcmV0dXJuIGVsZW1lbnQudGFiSW5kZXggfSkuZmlyc3QoKTsKCiAgICByZXR1cm4gZmlyc3RCeUluZGV4ID8gZmlyc3RCeUluZGV4IDogZWxlbWVudHMuZmluZChmdW5jdGlvbihlbGVtZW50KSB7CiAgICAgIHJldHVybiAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYSkkL2kudGVzdChlbGVtZW50LnRhZ05hbWUpOwogICAgfSk7CiAgfSwKCiAgZm9jdXNGaXJzdEVsZW1lbnQ6IGZ1bmN0aW9uKGZvcm0pIHsKICAgIGZvcm0gPSAkKGZvcm0pOwogICAgZm9ybS5maW5kRmlyc3RFbGVtZW50KCkuYWN0aXZhdGUoKTsKICAgIHJldHVybiBmb3JtOwogIH0sCgogIHJlcXVlc3Q6IGZ1bmN0aW9uKGZvcm0sIG9wdGlvbnMpIHsKICAgIGZvcm0gPSAkKGZvcm0pLCBvcHRpb25zID0gT2JqZWN0LmNsb25lKG9wdGlvbnMgfHwgeyB9KTsKCiAgICB2YXIgcGFyYW1zID0gb3B0aW9ucy5wYXJhbWV0ZXJzLCBhY3Rpb24gPSBmb3JtLnJlYWRBdHRyaWJ1dGUoJ2FjdGlvbicpIHx8ICcnOwogICAgaWYgKGFjdGlvbi5ibGFuaygpKSBhY3Rpb24gPSB3aW5kb3cubG9jYXRpb24uaHJlZjsKICAgIG9wdGlvbnMucGFyYW1ldGVycyA9IGZvcm0uc2VyaWFsaXplKHRydWUpOwoKICAgIGlmIChwYXJhbXMpIHsKICAgICAgaWYgKE9iamVjdC5pc1N0cmluZyhwYXJhbXMpKSBwYXJhbXMgPSBwYXJhbXMudG9RdWVyeVBhcmFtcygpOwogICAgICBPYmplY3QuZXh0ZW5kKG9wdGlvbnMucGFyYW1ldGVycywgcGFyYW1zKTsKICAgIH0KCiAgICBpZiAoZm9ybS5oYXNBdHRyaWJ1dGUoJ21ldGhvZCcpICYmICFvcHRpb25zLm1ldGhvZCkKICAgICAgb3B0aW9ucy5tZXRob2QgPSBmb3JtLm1ldGhvZDsKCiAgICByZXR1cm4gbmV3IEFqYXguUmVxdWVzdChhY3Rpb24sIG9wdGlvbnMpOwogIH0KfTsKCi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKCkZvcm0uRWxlbWVudCA9IHsKICBmb2N1czogZnVuY3Rpb24oZWxlbWVudCkgewogICAgJChlbGVtZW50KS5mb2N1cygpOwogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfSwKCiAgc2VsZWN0OiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICAkKGVsZW1lbnQpLnNlbGVjdCgpOwogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfQp9OwoKRm9ybS5FbGVtZW50Lk1ldGhvZHMgPSB7CgogIHNlcmlhbGl6ZTogZnVuY3Rpb24oZWxlbWVudCkgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICBpZiAoIWVsZW1lbnQuZGlzYWJsZWQgJiYgZWxlbWVudC5uYW1lKSB7CiAgICAgIHZhciB2YWx1ZSA9IGVsZW1lbnQuZ2V0VmFsdWUoKTsKICAgICAgaWYgKHZhbHVlICE9IHVuZGVmaW5lZCkgewogICAgICAgIHZhciBwYWlyID0geyB9OwogICAgICAgIHBhaXJbZWxlbWVudC5uYW1lXSA9IHZhbHVlOwogICAgICAgIHJldHVybiBPYmplY3QudG9RdWVyeVN0cmluZyhwYWlyKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuICcnOwogIH0sCgogIGdldFZhbHVlOiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICBlbGVtZW50ID0gJChlbGVtZW50KTsKICAgIHZhciBtZXRob2QgPSBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTsKICAgIHJldHVybiBGb3JtLkVsZW1lbnQuU2VyaWFsaXplcnNbbWV0aG9kXShlbGVtZW50KTsKICB9LAoKICBzZXRWYWx1ZTogZnVuY3Rpb24oZWxlbWVudCwgdmFsdWUpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwogICAgdmFyIG1ldGhvZCA9IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgRm9ybS5FbGVtZW50LlNlcmlhbGl6ZXJzW21ldGhvZF0oZWxlbWVudCwgdmFsdWUpOwogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfSwKCiAgY2xlYXI6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgICQoZWxlbWVudCkudmFsdWUgPSAnJzsKICAgIHJldHVybiBlbGVtZW50OwogIH0sCgogIHByZXNlbnQ6IGZ1bmN0aW9uKGVsZW1lbnQpIHsKICAgIHJldHVybiAkKGVsZW1lbnQpLnZhbHVlICE9ICcnOwogIH0sCgogIGFjdGl2YXRlOiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICBlbGVtZW50ID0gJChlbGVtZW50KTsKICAgIHRyeSB7CiAgICAgIGVsZW1lbnQuZm9jdXMoKTsKICAgICAgaWYgKGVsZW1lbnQuc2VsZWN0ICYmIChlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKSAhPSAnaW5wdXQnIHx8CiAgICAgICAgICAhKC9eKD86YnV0dG9ufHJlc2V0fHN1Ym1pdCkkL2kudGVzdChlbGVtZW50LnR5cGUpKSkpCiAgICAgICAgZWxlbWVudC5zZWxlY3QoKTsKICAgIH0gY2F0Y2ggKGUpIHsgfQogICAgcmV0dXJuIGVsZW1lbnQ7CiAgfSwKCiAgZGlzYWJsZTogZnVuY3Rpb24oZWxlbWVudCkgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICBlbGVtZW50LmRpc2FibGVkID0gdHJ1ZTsKICAgIHJldHVybiBlbGVtZW50OwogIH0sCgogIGVuYWJsZTogZnVuY3Rpb24oZWxlbWVudCkgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICBlbGVtZW50LmRpc2FibGVkID0gZmFsc2U7CiAgICByZXR1cm4gZWxlbWVudDsKICB9Cn07CgovKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCnZhciBGaWVsZCA9IEZvcm0uRWxlbWVudDsKCnZhciAkRiA9IEZvcm0uRWxlbWVudC5NZXRob2RzLmdldFZhbHVlOwoKLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgpGb3JtLkVsZW1lbnQuU2VyaWFsaXplcnMgPSB7CiAgaW5wdXQ6IGZ1bmN0aW9uKGVsZW1lbnQsIHZhbHVlKSB7CiAgICBzd2l0Y2ggKGVsZW1lbnQudHlwZS50b0xvd2VyQ2FzZSgpKSB7CiAgICAgIGNhc2UgJ2NoZWNrYm94JzoKICAgICAgY2FzZSAncmFkaW8nOgogICAgICAgIHJldHVybiBGb3JtLkVsZW1lbnQuU2VyaWFsaXplcnMuaW5wdXRTZWxlY3RvcihlbGVtZW50LCB2YWx1ZSk7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgcmV0dXJuIEZvcm0uRWxlbWVudC5TZXJpYWxpemVycy50ZXh0YXJlYShlbGVtZW50LCB2YWx1ZSk7CiAgICB9CiAgfSwKCiAgaW5wdXRTZWxlY3RvcjogZnVuY3Rpb24oZWxlbWVudCwgdmFsdWUpIHsKICAgIGlmIChPYmplY3QuaXNVbmRlZmluZWQodmFsdWUpKSByZXR1cm4gZWxlbWVudC5jaGVja2VkID8gZWxlbWVudC52YWx1ZSA6IG51bGw7CiAgICBlbHNlIGVsZW1lbnQuY2hlY2tlZCA9ICEhdmFsdWU7CiAgfSwKCiAgdGV4dGFyZWE6IGZ1bmN0aW9uKGVsZW1lbnQsIHZhbHVlKSB7CiAgICBpZiAoT2JqZWN0LmlzVW5kZWZpbmVkKHZhbHVlKSkgcmV0dXJuIGVsZW1lbnQudmFsdWU7CiAgICBlbHNlIGVsZW1lbnQudmFsdWUgPSB2YWx1ZTsKICB9LAoKICBzZWxlY3Q6IGZ1bmN0aW9uKGVsZW1lbnQsIHZhbHVlKSB7CiAgICBpZiAoT2JqZWN0LmlzVW5kZWZpbmVkKHZhbHVlKSkKICAgICAgcmV0dXJuIHRoaXNbZWxlbWVudC50eXBlID09ICdzZWxlY3Qtb25lJyA/CiAgICAgICAgJ3NlbGVjdE9uZScgOiAnc2VsZWN0TWFueSddKGVsZW1lbnQpOwogICAgZWxzZSB7CiAgICAgIHZhciBvcHQsIGN1cnJlbnRWYWx1ZSwgc2luZ2xlID0gIU9iamVjdC5pc0FycmF5KHZhbHVlKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGVsZW1lbnQubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBvcHQgPSBlbGVtZW50Lm9wdGlvbnNbaV07CiAgICAgICAgY3VycmVudFZhbHVlID0gdGhpcy5vcHRpb25WYWx1ZShvcHQpOwogICAgICAgIGlmIChzaW5nbGUpIHsKICAgICAgICAgIGlmIChjdXJyZW50VmFsdWUgPT0gdmFsdWUpIHsKICAgICAgICAgICAgb3B0LnNlbGVjdGVkID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIG9wdC5zZWxlY3RlZCA9IHZhbHVlLmluY2x1ZGUoY3VycmVudFZhbHVlKTsKICAgICAgfQogICAgfQogIH0sCgogIHNlbGVjdE9uZTogZnVuY3Rpb24oZWxlbWVudCkgewogICAgdmFyIGluZGV4ID0gZWxlbWVudC5zZWxlY3RlZEluZGV4OwogICAgcmV0dXJuIGluZGV4ID49IDAgPyB0aGlzLm9wdGlvblZhbHVlKGVsZW1lbnQub3B0aW9uc1tpbmRleF0pIDogbnVsbDsKICB9LAoKICBzZWxlY3RNYW55OiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICB2YXIgdmFsdWVzLCBsZW5ndGggPSBlbGVtZW50Lmxlbmd0aDsKICAgIGlmICghbGVuZ3RoKSByZXR1cm4gbnVsbDsKCiAgICBmb3IgKHZhciBpID0gMCwgdmFsdWVzID0gW107IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB2YXIgb3B0ID0gZWxlbWVudC5vcHRpb25zW2ldOwogICAgICBpZiAob3B0LnNlbGVjdGVkKSB2YWx1ZXMucHVzaCh0aGlzLm9wdGlvblZhbHVlKG9wdCkpOwogICAgfQogICAgcmV0dXJuIHZhbHVlczsKICB9LAoKICBvcHRpb25WYWx1ZTogZnVuY3Rpb24ob3B0KSB7CiAgICByZXR1cm4gRWxlbWVudC5leHRlbmQob3B0KS5oYXNBdHRyaWJ1dGUoJ3ZhbHVlJykgPyBvcHQudmFsdWUgOiBvcHQudGV4dDsKICB9Cn07CgovKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCgpBYnN0cmFjdC5UaW1lZE9ic2VydmVyID0gQ2xhc3MuY3JlYXRlKFBlcmlvZGljYWxFeGVjdXRlciwgewogIGluaXRpYWxpemU6IGZ1bmN0aW9uKCRzdXBlciwgZWxlbWVudCwgZnJlcXVlbmN5LCBjYWxsYmFjaykgewogICAgJHN1cGVyKGNhbGxiYWNrLCBmcmVxdWVuY3kpOwogICAgdGhpcy5lbGVtZW50ICAgPSAkKGVsZW1lbnQpOwogICAgdGhpcy5sYXN0VmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7CiAgfSwKCiAgZXhlY3V0ZTogZnVuY3Rpb24oKSB7CiAgICB2YXIgdmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7CiAgICBpZiAoT2JqZWN0LmlzU3RyaW5nKHRoaXMubGFzdFZhbHVlKSAmJiBPYmplY3QuaXNTdHJpbmcodmFsdWUpID8KICAgICAgICB0aGlzLmxhc3RWYWx1ZSAhPSB2YWx1ZSA6IFN0cmluZyh0aGlzLmxhc3RWYWx1ZSkgIT0gU3RyaW5nKHZhbHVlKSkgewogICAgICB0aGlzLmNhbGxiYWNrKHRoaXMuZWxlbWVudCwgdmFsdWUpOwogICAgICB0aGlzLmxhc3RWYWx1ZSA9IHZhbHVlOwogICAgfQogIH0KfSk7CgpGb3JtLkVsZW1lbnQuT2JzZXJ2ZXIgPSBDbGFzcy5jcmVhdGUoQWJzdHJhY3QuVGltZWRPYnNlcnZlciwgewogIGdldFZhbHVlOiBmdW5jdGlvbigpIHsKICAgIHJldHVybiBGb3JtLkVsZW1lbnQuZ2V0VmFsdWUodGhpcy5lbGVtZW50KTsKICB9Cn0pOwoKRm9ybS5PYnNlcnZlciA9IENsYXNzLmNyZWF0ZShBYnN0cmFjdC5UaW1lZE9ic2VydmVyLCB7CiAgZ2V0VmFsdWU6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIEZvcm0uc2VyaWFsaXplKHRoaXMuZWxlbWVudCk7CiAgfQp9KTsKCi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKQWJzdHJhY3QuRXZlbnRPYnNlcnZlciA9IENsYXNzLmNyZWF0ZSh7CiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oZWxlbWVudCwgY2FsbGJhY2spIHsKICAgIHRoaXMuZWxlbWVudCAgPSAkKGVsZW1lbnQpOwogICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrOwoKICAgIHRoaXMubGFzdFZhbHVlID0gdGhpcy5nZXRWYWx1ZSgpOwogICAgaWYgKHRoaXMuZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gJ2Zvcm0nKQogICAgICB0aGlzLnJlZ2lzdGVyRm9ybUNhbGxiYWNrcygpOwogICAgZWxzZQogICAgICB0aGlzLnJlZ2lzdGVyQ2FsbGJhY2sodGhpcy5lbGVtZW50KTsKICB9LAoKICBvbkVsZW1lbnRFdmVudDogZnVuY3Rpb24oKSB7CiAgICB2YXIgdmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7CiAgICBpZiAodGhpcy5sYXN0VmFsdWUgIT0gdmFsdWUpIHsKICAgICAgdGhpcy5jYWxsYmFjayh0aGlzLmVsZW1lbnQsIHZhbHVlKTsKICAgICAgdGhpcy5sYXN0VmFsdWUgPSB2YWx1ZTsKICAgIH0KICB9LAoKICByZWdpc3RlckZvcm1DYWxsYmFja3M6IGZ1bmN0aW9uKCkgewogICAgRm9ybS5nZXRFbGVtZW50cyh0aGlzLmVsZW1lbnQpLmVhY2godGhpcy5yZWdpc3RlckNhbGxiYWNrLCB0aGlzKTsKICB9LAoKICByZWdpc3RlckNhbGxiYWNrOiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICBpZiAoZWxlbWVudC50eXBlKSB7CiAgICAgIHN3aXRjaCAoZWxlbWVudC50eXBlLnRvTG93ZXJDYXNlKCkpIHsKICAgICAgICBjYXNlICdjaGVja2JveCc6CiAgICAgICAgY2FzZSAncmFkaW8nOgogICAgICAgICAgRXZlbnQub2JzZXJ2ZShlbGVtZW50LCAnY2xpY2snLCB0aGlzLm9uRWxlbWVudEV2ZW50LmJpbmQodGhpcykpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIEV2ZW50Lm9ic2VydmUoZWxlbWVudCwgJ2NoYW5nZScsIHRoaXMub25FbGVtZW50RXZlbnQuYmluZCh0aGlzKSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogIH0KfSk7CgpGb3JtLkVsZW1lbnQuRXZlbnRPYnNlcnZlciA9IENsYXNzLmNyZWF0ZShBYnN0cmFjdC5FdmVudE9ic2VydmVyLCB7CiAgZ2V0VmFsdWU6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIEZvcm0uRWxlbWVudC5nZXRWYWx1ZSh0aGlzLmVsZW1lbnQpOwogIH0KfSk7CgpGb3JtLkV2ZW50T2JzZXJ2ZXIgPSBDbGFzcy5jcmVhdGUoQWJzdHJhY3QuRXZlbnRPYnNlcnZlciwgewogIGdldFZhbHVlOiBmdW5jdGlvbigpIHsKICAgIHJldHVybiBGb3JtLnNlcmlhbGl6ZSh0aGlzLmVsZW1lbnQpOwogIH0KfSk7CihmdW5jdGlvbigpIHsKCiAgdmFyIEV2ZW50ID0gewogICAgS0VZX0JBQ0tTUEFDRTogOCwKICAgIEtFWV9UQUI6ICAgICAgIDksCiAgICBLRVlfUkVUVVJOOiAgIDEzLAogICAgS0VZX0VTQzogICAgICAyNywKICAgIEtFWV9MRUZUOiAgICAgMzcsCiAgICBLRVlfVVA6ICAgICAgIDM4LAogICAgS0VZX1JJR0hUOiAgICAzOSwKICAgIEtFWV9ET1dOOiAgICAgNDAsCiAgICBLRVlfREVMRVRFOiAgIDQ2LAogICAgS0VZX0hPTUU6ICAgICAzNiwKICAgIEtFWV9FTkQ6ICAgICAgMzUsCiAgICBLRVlfUEFHRVVQOiAgIDMzLAogICAgS0VZX1BBR0VET1dOOiAzNCwKICAgIEtFWV9JTlNFUlQ6ICAgNDUsCgogICAgY2FjaGU6IHt9CiAgfTsKCiAgdmFyIGRvY0VsID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwogIHZhciBNT1VTRUVOVEVSX01PVVNFTEVBVkVfRVZFTlRTX1NVUFBPUlRFRCA9ICdvbm1vdXNlZW50ZXInIGluIGRvY0VsCiAgICAmJiAnb25tb3VzZWxlYXZlJyBpbiBkb2NFbDsKCgoKICB2YXIgaXNJRUxlZ2FjeUV2ZW50ID0gZnVuY3Rpb24oZXZlbnQpIHsgcmV0dXJuIGZhbHNlOyB9OwoKICBpZiAod2luZG93LmF0dGFjaEV2ZW50KSB7CiAgICBpZiAod2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgaXNJRUxlZ2FjeUV2ZW50ID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICByZXR1cm4gIShldmVudCBpbnN0YW5jZW9mIHdpbmRvdy5FdmVudCk7CiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICBpc0lFTGVnYWN5RXZlbnQgPSBmdW5jdGlvbihldmVudCkgeyByZXR1cm4gdHJ1ZTsgfTsKICAgIH0KICB9CgogIHZhciBfaXNCdXR0b247CgogIGZ1bmN0aW9uIF9pc0J1dHRvbkZvckRPTUV2ZW50cyhldmVudCwgY29kZSkgewogICAgcmV0dXJuIGV2ZW50LndoaWNoID8gKGV2ZW50LndoaWNoID09PSBjb2RlICsgMSkgOiAoZXZlbnQuYnV0dG9uID09PSBjb2RlKTsKICB9CgogIHZhciBsZWdhY3lCdXR0b25NYXAgPSB7IDA6IDEsIDE6IDQsIDI6IDIgfTsKICBmdW5jdGlvbiBfaXNCdXR0b25Gb3JMZWdhY3lFdmVudHMoZXZlbnQsIGNvZGUpIHsKICAgIHJldHVybiBldmVudC5idXR0b24gPT09IGxlZ2FjeUJ1dHRvbk1hcFtjb2RlXTsKICB9CgogIGZ1bmN0aW9uIF9pc0J1dHRvbkZvcldlYktpdChldmVudCwgY29kZSkgewogICAgc3dpdGNoIChjb2RlKSB7CiAgICAgIGNhc2UgMDogcmV0dXJuIGV2ZW50LndoaWNoID09IDEgJiYgIWV2ZW50Lm1ldGFLZXk7CiAgICAgIGNhc2UgMTogcmV0dXJuIGV2ZW50LndoaWNoID09IDIgfHwgKGV2ZW50LndoaWNoID09IDEgJiYgZXZlbnQubWV0YUtleSk7CiAgICAgIGNhc2UgMjogcmV0dXJuIGV2ZW50LndoaWNoID09IDM7CiAgICAgIGRlZmF1bHQ6IHJldHVybiBmYWxzZTsKICAgIH0KICB9CgogIGlmICh3aW5kb3cuYXR0YWNoRXZlbnQpIHsKICAgIGlmICghd2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHsKICAgICAgX2lzQnV0dG9uID0gX2lzQnV0dG9uRm9yTGVnYWN5RXZlbnRzOwogICAgfSBlbHNlIHsKICAgICAgX2lzQnV0dG9uID0gZnVuY3Rpb24oZXZlbnQsIGNvZGUpIHsKICAgICAgICByZXR1cm4gaXNJRUxlZ2FjeUV2ZW50KGV2ZW50KSA/IF9pc0J1dHRvbkZvckxlZ2FjeUV2ZW50cyhldmVudCwgY29kZSkgOgogICAgICAgICBfaXNCdXR0b25Gb3JET01FdmVudHMoZXZlbnQsIGNvZGUpOwogICAgICB9CiAgICB9CiAgfSBlbHNlIGlmIChQcm90b3R5cGUuQnJvd3Nlci5XZWJLaXQpIHsKICAgIF9pc0J1dHRvbiA9IF9pc0J1dHRvbkZvcldlYktpdDsKICB9IGVsc2UgewogICAgX2lzQnV0dG9uID0gX2lzQnV0dG9uRm9yRE9NRXZlbnRzOwogIH0KCiAgZnVuY3Rpb24gaXNMZWZ0Q2xpY2soZXZlbnQpICAgeyByZXR1cm4gX2lzQnV0dG9uKGV2ZW50LCAwKSB9CgogIGZ1bmN0aW9uIGlzTWlkZGxlQ2xpY2soZXZlbnQpIHsgcmV0dXJuIF9pc0J1dHRvbihldmVudCwgMSkgfQoKICBmdW5jdGlvbiBpc1JpZ2h0Q2xpY2soZXZlbnQpICB7IHJldHVybiBfaXNCdXR0b24oZXZlbnQsIDIpIH0KCiAgZnVuY3Rpb24gZWxlbWVudChldmVudCkgewogICAgZXZlbnQgPSBFdmVudC5leHRlbmQoZXZlbnQpOwoKICAgIHZhciBub2RlID0gZXZlbnQudGFyZ2V0LCB0eXBlID0gZXZlbnQudHlwZSwKICAgICBjdXJyZW50VGFyZ2V0ID0gZXZlbnQuY3VycmVudFRhcmdldDsKCiAgICBpZiAoY3VycmVudFRhcmdldCAmJiBjdXJyZW50VGFyZ2V0LnRhZ05hbWUpIHsKICAgICAgaWYgKHR5cGUgPT09ICdsb2FkJyB8fCB0eXBlID09PSAnZXJyb3InIHx8CiAgICAgICAgKHR5cGUgPT09ICdjbGljaycgJiYgY3VycmVudFRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdpbnB1dCcKICAgICAgICAgICYmIGN1cnJlbnRUYXJnZXQudHlwZSA9PT0gJ3JhZGlvJykpCiAgICAgICAgICAgIG5vZGUgPSBjdXJyZW50VGFyZ2V0OwogICAgfQoKICAgIGlmIChub2RlLm5vZGVUeXBlID09IE5vZGUuVEVYVF9OT0RFKQogICAgICBub2RlID0gbm9kZS5wYXJlbnROb2RlOwoKICAgIHJldHVybiBFbGVtZW50LmV4dGVuZChub2RlKTsKICB9CgogIGZ1bmN0aW9uIGZpbmRFbGVtZW50KGV2ZW50LCBleHByZXNzaW9uKSB7CiAgICB2YXIgZWxlbWVudCA9IEV2ZW50LmVsZW1lbnQoZXZlbnQpOwoKICAgIGlmICghZXhwcmVzc2lvbikgcmV0dXJuIGVsZW1lbnQ7CiAgICB3aGlsZSAoZWxlbWVudCkgewogICAgICBpZiAoT2JqZWN0LmlzRWxlbWVudChlbGVtZW50KSAmJiBQcm90b3R5cGUuU2VsZWN0b3IubWF0Y2goZWxlbWVudCwgZXhwcmVzc2lvbikpIHsKICAgICAgICByZXR1cm4gRWxlbWVudC5leHRlbmQoZWxlbWVudCk7CiAgICAgIH0KICAgICAgZWxlbWVudCA9IGVsZW1lbnQucGFyZW50Tm9kZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHBvaW50ZXIoZXZlbnQpIHsKICAgIHJldHVybiB7IHg6IHBvaW50ZXJYKGV2ZW50KSwgeTogcG9pbnRlclkoZXZlbnQpIH07CiAgfQoKICBmdW5jdGlvbiBwb2ludGVyWChldmVudCkgewogICAgdmFyIGRvY0VsZW1lbnQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsCiAgICAgYm9keSA9IGRvY3VtZW50LmJvZHkgfHwgeyBzY3JvbGxMZWZ0OiAwIH07CgogICAgcmV0dXJuIGV2ZW50LnBhZ2VYIHx8IChldmVudC5jbGllbnRYICsKICAgICAgKGRvY0VsZW1lbnQuc2Nyb2xsTGVmdCB8fCBib2R5LnNjcm9sbExlZnQpIC0KICAgICAgKGRvY0VsZW1lbnQuY2xpZW50TGVmdCB8fCAwKSk7CiAgfQoKICBmdW5jdGlvbiBwb2ludGVyWShldmVudCkgewogICAgdmFyIGRvY0VsZW1lbnQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsCiAgICAgYm9keSA9IGRvY3VtZW50LmJvZHkgfHwgeyBzY3JvbGxUb3A6IDAgfTsKCiAgICByZXR1cm4gIGV2ZW50LnBhZ2VZIHx8IChldmVudC5jbGllbnRZICsKICAgICAgIChkb2NFbGVtZW50LnNjcm9sbFRvcCB8fCBib2R5LnNjcm9sbFRvcCkgLQogICAgICAgKGRvY0VsZW1lbnQuY2xpZW50VG9wIHx8IDApKTsKICB9CgoKICBmdW5jdGlvbiBzdG9wKGV2ZW50KSB7CiAgICBFdmVudC5leHRlbmQoZXZlbnQpOwogICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoKICAgIGV2ZW50LnN0b3BwZWQgPSB0cnVlOwogIH0KCgogIEV2ZW50Lk1ldGhvZHMgPSB7CiAgICBpc0xlZnRDbGljazogICBpc0xlZnRDbGljaywKICAgIGlzTWlkZGxlQ2xpY2s6IGlzTWlkZGxlQ2xpY2ssCiAgICBpc1JpZ2h0Q2xpY2s6ICBpc1JpZ2h0Q2xpY2ssCgogICAgZWxlbWVudDogICAgIGVsZW1lbnQsCiAgICBmaW5kRWxlbWVudDogZmluZEVsZW1lbnQsCgogICAgcG9pbnRlcjogIHBvaW50ZXIsCiAgICBwb2ludGVyWDogcG9pbnRlclgsCiAgICBwb2ludGVyWTogcG9pbnRlclksCgogICAgc3RvcDogc3RvcAogIH07CgogIHZhciBtZXRob2RzID0gT2JqZWN0LmtleXMoRXZlbnQuTWV0aG9kcykuaW5qZWN0KHsgfSwgZnVuY3Rpb24obSwgbmFtZSkgewogICAgbVtuYW1lXSA9IEV2ZW50Lk1ldGhvZHNbbmFtZV0ubWV0aG9kaXplKCk7CiAgICByZXR1cm4gbTsKICB9KTsKCiAgaWYgKHdpbmRvdy5hdHRhY2hFdmVudCkgewogICAgZnVuY3Rpb24gX3JlbGF0ZWRUYXJnZXQoZXZlbnQpIHsKICAgICAgdmFyIGVsZW1lbnQ7CiAgICAgIHN3aXRjaCAoZXZlbnQudHlwZSkgewogICAgICAgIGNhc2UgJ21vdXNlb3Zlcic6CiAgICAgICAgY2FzZSAnbW91c2VlbnRlcic6CiAgICAgICAgICBlbGVtZW50ID0gZXZlbnQuZnJvbUVsZW1lbnQ7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICdtb3VzZW91dCc6CiAgICAgICAgY2FzZSAnbW91c2VsZWF2ZSc6CiAgICAgICAgICBlbGVtZW50ID0gZXZlbnQudG9FbGVtZW50OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHJldHVybiBFbGVtZW50LmV4dGVuZChlbGVtZW50KTsKICAgIH0KCiAgICB2YXIgYWRkaXRpb25hbE1ldGhvZHMgPSB7CiAgICAgIHN0b3BQcm9wYWdhdGlvbjogZnVuY3Rpb24oKSB7IHRoaXMuY2FuY2VsQnViYmxlID0gdHJ1ZSB9LAogICAgICBwcmV2ZW50RGVmYXVsdDogIGZ1bmN0aW9uKCkgeyB0aGlzLnJldHVyblZhbHVlID0gZmFsc2UgfSwKICAgICAgaW5zcGVjdDogZnVuY3Rpb24oKSB7IHJldHVybiAnW29iamVjdCBFdmVudF0nIH0KICAgIH07CgogICAgRXZlbnQuZXh0ZW5kID0gZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHsKICAgICAgaWYgKCFldmVudCkgcmV0dXJuIGZhbHNlOwoKICAgICAgaWYgKCFpc0lFTGVnYWN5RXZlbnQoZXZlbnQpKSByZXR1cm4gZXZlbnQ7CgogICAgICBpZiAoZXZlbnQuX2V4dGVuZGVkQnlQcm90b3R5cGUpIHJldHVybiBldmVudDsKICAgICAgZXZlbnQuX2V4dGVuZGVkQnlQcm90b3R5cGUgPSBQcm90b3R5cGUuZW1wdHlGdW5jdGlvbjsKCiAgICAgIHZhciBwb2ludGVyID0gRXZlbnQucG9pbnRlcihldmVudCk7CgogICAgICBPYmplY3QuZXh0ZW5kKGV2ZW50LCB7CiAgICAgICAgdGFyZ2V0OiBldmVudC5zcmNFbGVtZW50IHx8IGVsZW1lbnQsCiAgICAgICAgcmVsYXRlZFRhcmdldDogX3JlbGF0ZWRUYXJnZXQoZXZlbnQpLAogICAgICAgIHBhZ2VYOiAgcG9pbnRlci54LAogICAgICAgIHBhZ2VZOiAgcG9pbnRlci55CiAgICAgIH0pOwoKICAgICAgT2JqZWN0LmV4dGVuZChldmVudCwgbWV0aG9kcyk7CiAgICAgIE9iamVjdC5leHRlbmQoZXZlbnQsIGFkZGl0aW9uYWxNZXRob2RzKTsKCiAgICAgIHJldHVybiBldmVudDsKICAgIH07CiAgfSBlbHNlIHsKICAgIEV2ZW50LmV4dGVuZCA9IFByb3RvdHlwZS5LOwogIH0KCiAgaWYgKHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKSB7CiAgICBFdmVudC5wcm90b3R5cGUgPSB3aW5kb3cuRXZlbnQucHJvdG90eXBlIHx8IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdIVE1MRXZlbnRzJykuX19wcm90b19fOwogICAgT2JqZWN0LmV4dGVuZChFdmVudC5wcm90b3R5cGUsIG1ldGhvZHMpOwogIH0KCiAgZnVuY3Rpb24gX2NyZWF0ZVJlc3BvbmRlcihlbGVtZW50LCBldmVudE5hbWUsIGhhbmRsZXIpIHsKICAgIHZhciByZWdpc3RyeSA9IEVsZW1lbnQucmV0cmlldmUoZWxlbWVudCwgJ3Byb3RvdHlwZV9ldmVudF9yZWdpc3RyeScpOwoKICAgIGlmIChPYmplY3QuaXNVbmRlZmluZWQocmVnaXN0cnkpKSB7CiAgICAgIENBQ0hFLnB1c2goZWxlbWVudCk7CiAgICAgIHJlZ2lzdHJ5ID0gRWxlbWVudC5yZXRyaWV2ZShlbGVtZW50LCAncHJvdG90eXBlX2V2ZW50X3JlZ2lzdHJ5JywgJEgoKSk7CiAgICB9CgogICAgdmFyIHJlc3BvbmRlcnNGb3JFdmVudCA9IHJlZ2lzdHJ5LmdldChldmVudE5hbWUpOwogICAgaWYgKE9iamVjdC5pc1VuZGVmaW5lZChyZXNwb25kZXJzRm9yRXZlbnQpKSB7CiAgICAgIHJlc3BvbmRlcnNGb3JFdmVudCA9IFtdOwogICAgICByZWdpc3RyeS5zZXQoZXZlbnROYW1lLCByZXNwb25kZXJzRm9yRXZlbnQpOwogICAgfQoKICAgIGlmIChyZXNwb25kZXJzRm9yRXZlbnQucGx1Y2soJ2hhbmRsZXInKS5pbmNsdWRlKGhhbmRsZXIpKSByZXR1cm4gZmFsc2U7CgogICAgdmFyIHJlc3BvbmRlcjsKICAgIGlmIChldmVudE5hbWUuaW5jbHVkZSgiOiIpKSB7CiAgICAgIHJlc3BvbmRlciA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgaWYgKE9iamVjdC5pc1VuZGVmaW5lZChldmVudC5ldmVudE5hbWUpKQogICAgICAgICAgcmV0dXJuIGZhbHNlOwoKICAgICAgICBpZiAoZXZlbnQuZXZlbnROYW1lICE9PSBldmVudE5hbWUpCiAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIEV2ZW50LmV4dGVuZChldmVudCwgZWxlbWVudCk7CiAgICAgICAgaGFuZGxlci5jYWxsKGVsZW1lbnQsIGV2ZW50KTsKICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghTU9VU0VFTlRFUl9NT1VTRUxFQVZFX0VWRU5UU19TVVBQT1JURUQgJiYKICAgICAgIChldmVudE5hbWUgPT09ICJtb3VzZWVudGVyIiB8fCBldmVudE5hbWUgPT09ICJtb3VzZWxlYXZlIikpIHsKICAgICAgICBpZiAoZXZlbnROYW1lID09PSAibW91c2VlbnRlciIgfHwgZXZlbnROYW1lID09PSAibW91c2VsZWF2ZSIpIHsKICAgICAgICAgIHJlc3BvbmRlciA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgIEV2ZW50LmV4dGVuZChldmVudCwgZWxlbWVudCk7CgogICAgICAgICAgICB2YXIgcGFyZW50ID0gZXZlbnQucmVsYXRlZFRhcmdldDsKICAgICAgICAgICAgd2hpbGUgKHBhcmVudCAmJiBwYXJlbnQgIT09IGVsZW1lbnQpIHsKICAgICAgICAgICAgICB0cnkgeyBwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZTsgfQogICAgICAgICAgICAgIGNhdGNoKGUpIHsgcGFyZW50ID0gZWxlbWVudDsgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAocGFyZW50ID09PSBlbGVtZW50KSByZXR1cm47CgogICAgICAgICAgICBoYW5kbGVyLmNhbGwoZWxlbWVudCwgZXZlbnQpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVzcG9uZGVyID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgIEV2ZW50LmV4dGVuZChldmVudCwgZWxlbWVudCk7CiAgICAgICAgICBoYW5kbGVyLmNhbGwoZWxlbWVudCwgZXZlbnQpOwogICAgICAgIH07CiAgICAgIH0KICAgIH0KCiAgICByZXNwb25kZXIuaGFuZGxlciA9IGhhbmRsZXI7CiAgICByZXNwb25kZXJzRm9yRXZlbnQucHVzaChyZXNwb25kZXIpOwogICAgcmV0dXJuIHJlc3BvbmRlcjsKICB9CgogIGZ1bmN0aW9uIF9kZXN0cm95Q2FjaGUoKSB7CiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gQ0FDSEUubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgRXZlbnQuc3RvcE9ic2VydmluZyhDQUNIRVtpXSk7CiAgICAgIENBQ0hFW2ldID0gbnVsbDsKICAgIH0KICB9CgogIHZhciBDQUNIRSA9IFtdOwoKICBpZiAoUHJvdG90eXBlLkJyb3dzZXIuSUUpCiAgICB3aW5kb3cuYXR0YWNoRXZlbnQoJ29udW5sb2FkJywgX2Rlc3Ryb3lDYWNoZSk7CgogIGlmIChQcm90b3R5cGUuQnJvd3Nlci5XZWJLaXQpCiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndW5sb2FkJywgUHJvdG90eXBlLmVtcHR5RnVuY3Rpb24sIGZhbHNlKTsKCgogIHZhciBfZ2V0RE9NRXZlbnROYW1lID0gUHJvdG90eXBlLkssCiAgICAgIHRyYW5zbGF0aW9ucyA9IHsgbW91c2VlbnRlcjogIm1vdXNlb3ZlciIsIG1vdXNlbGVhdmU6ICJtb3VzZW91dCIgfTsKCiAgaWYgKCFNT1VTRUVOVEVSX01PVVNFTEVBVkVfRVZFTlRTX1NVUFBPUlRFRCkgewogICAgX2dldERPTUV2ZW50TmFtZSA9IGZ1bmN0aW9uKGV2ZW50TmFtZSkgewogICAgICByZXR1cm4gKHRyYW5zbGF0aW9uc1tldmVudE5hbWVdIHx8IGV2ZW50TmFtZSk7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gb2JzZXJ2ZShlbGVtZW50LCBldmVudE5hbWUsIGhhbmRsZXIpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwoKICAgIHZhciByZXNwb25kZXIgPSBfY3JlYXRlUmVzcG9uZGVyKGVsZW1lbnQsIGV2ZW50TmFtZSwgaGFuZGxlcik7CgogICAgaWYgKCFyZXNwb25kZXIpIHJldHVybiBlbGVtZW50OwoKICAgIGlmIChldmVudE5hbWUuaW5jbHVkZSgnOicpKSB7CiAgICAgIGlmIChlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIpCiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJkYXRhYXZhaWxhYmxlIiwgcmVzcG9uZGVyLCBmYWxzZSk7CiAgICAgIGVsc2UgewogICAgICAgIGVsZW1lbnQuYXR0YWNoRXZlbnQoIm9uZGF0YWF2YWlsYWJsZSIsIHJlc3BvbmRlcik7CiAgICAgICAgZWxlbWVudC5hdHRhY2hFdmVudCgib25sb3NlY2FwdHVyZSIsIHJlc3BvbmRlcik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHZhciBhY3R1YWxFdmVudE5hbWUgPSBfZ2V0RE9NRXZlbnROYW1lKGV2ZW50TmFtZSk7CgogICAgICBpZiAoZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKQogICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihhY3R1YWxFdmVudE5hbWUsIHJlc3BvbmRlciwgZmFsc2UpOwogICAgICBlbHNlCiAgICAgICAgZWxlbWVudC5hdHRhY2hFdmVudCgib24iICsgYWN0dWFsRXZlbnROYW1lLCByZXNwb25kZXIpOwogICAgfQoKICAgIHJldHVybiBlbGVtZW50OwogIH0KCiAgZnVuY3Rpb24gc3RvcE9ic2VydmluZyhlbGVtZW50LCBldmVudE5hbWUsIGhhbmRsZXIpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwoKICAgIHZhciByZWdpc3RyeSA9IEVsZW1lbnQucmV0cmlldmUoZWxlbWVudCwgJ3Byb3RvdHlwZV9ldmVudF9yZWdpc3RyeScpOwogICAgaWYgKCFyZWdpc3RyeSkgcmV0dXJuIGVsZW1lbnQ7CgogICAgaWYgKCFldmVudE5hbWUpIHsKICAgICAgcmVnaXN0cnkuZWFjaCggZnVuY3Rpb24ocGFpcikgewogICAgICAgIHZhciBldmVudE5hbWUgPSBwYWlyLmtleTsKICAgICAgICBzdG9wT2JzZXJ2aW5nKGVsZW1lbnQsIGV2ZW50TmFtZSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gZWxlbWVudDsKICAgIH0KCiAgICB2YXIgcmVzcG9uZGVycyA9IHJlZ2lzdHJ5LmdldChldmVudE5hbWUpOwogICAgaWYgKCFyZXNwb25kZXJzKSByZXR1cm4gZWxlbWVudDsKCiAgICBpZiAoIWhhbmRsZXIpIHsKICAgICAgcmVzcG9uZGVycy5lYWNoKGZ1bmN0aW9uKHIpIHsKICAgICAgICBzdG9wT2JzZXJ2aW5nKGVsZW1lbnQsIGV2ZW50TmFtZSwgci5oYW5kbGVyKTsKICAgICAgfSk7CiAgICAgIHJldHVybiBlbGVtZW50OwogICAgfQoKICAgIHZhciBpID0gcmVzcG9uZGVycy5sZW5ndGgsIHJlc3BvbmRlcjsKICAgIHdoaWxlIChpLS0pIHsKICAgICAgaWYgKHJlc3BvbmRlcnNbaV0uaGFuZGxlciA9PT0gaGFuZGxlcikgewogICAgICAgIHJlc3BvbmRlciA9IHJlc3BvbmRlcnNbaV07CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGlmICghcmVzcG9uZGVyKSByZXR1cm4gZWxlbWVudDsKCiAgICBpZiAoZXZlbnROYW1lLmluY2x1ZGUoJzonKSkgewogICAgICBpZiAoZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKQogICAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiZGF0YWF2YWlsYWJsZSIsIHJlc3BvbmRlciwgZmFsc2UpOwogICAgICBlbHNlIHsKICAgICAgICBlbGVtZW50LmRldGFjaEV2ZW50KCJvbmRhdGFhdmFpbGFibGUiLCByZXNwb25kZXIpOwogICAgICAgIGVsZW1lbnQuZGV0YWNoRXZlbnQoIm9ubG9zZWNhcHR1cmUiLCByZXNwb25kZXIpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB2YXIgYWN0dWFsRXZlbnROYW1lID0gX2dldERPTUV2ZW50TmFtZShldmVudE5hbWUpOwogICAgICBpZiAoZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKQogICAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihhY3R1YWxFdmVudE5hbWUsIHJlc3BvbmRlciwgZmFsc2UpOwogICAgICBlbHNlCiAgICAgICAgZWxlbWVudC5kZXRhY2hFdmVudCgnb24nICsgYWN0dWFsRXZlbnROYW1lLCByZXNwb25kZXIpOwogICAgfQoKICAgIHJlZ2lzdHJ5LnNldChldmVudE5hbWUsIHJlc3BvbmRlcnMud2l0aG91dChyZXNwb25kZXIpKTsKCiAgICByZXR1cm4gZWxlbWVudDsKICB9CgogIGZ1bmN0aW9uIGZpcmUoZWxlbWVudCwgZXZlbnROYW1lLCBtZW1vLCBidWJibGUpIHsKICAgIGVsZW1lbnQgPSAkKGVsZW1lbnQpOwoKICAgIGlmIChPYmplY3QuaXNVbmRlZmluZWQoYnViYmxlKSkKICAgICAgYnViYmxlID0gdHJ1ZTsKCiAgICBpZiAoZWxlbWVudCA9PSBkb2N1bWVudCAmJiBkb2N1bWVudC5jcmVhdGVFdmVudCAmJiAhZWxlbWVudC5kaXNwYXRjaEV2ZW50KQogICAgICBlbGVtZW50ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwoKICAgIHZhciBldmVudDsKICAgIGlmIChkb2N1bWVudC5jcmVhdGVFdmVudCkgewogICAgICBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdIVE1MRXZlbnRzJyk7CiAgICAgIGV2ZW50LmluaXRFdmVudCgnZGF0YWF2YWlsYWJsZScsIGJ1YmJsZSwgdHJ1ZSk7CiAgICB9IGVsc2UgewogICAgICBldmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50T2JqZWN0KCk7CiAgICAgIGV2ZW50LmV2ZW50VHlwZSA9IGJ1YmJsZSA/ICdvbmRhdGFhdmFpbGFibGUnIDogJ29ubG9zZWNhcHR1cmUnOwogICAgfQoKICAgIGV2ZW50LmV2ZW50TmFtZSA9IGV2ZW50TmFtZTsKICAgIGV2ZW50Lm1lbW8gPSBtZW1vIHx8IHsgfTsKCiAgICBpZiAoZG9jdW1lbnQuY3JlYXRlRXZlbnQpCiAgICAgIGVsZW1lbnQuZGlzcGF0Y2hFdmVudChldmVudCk7CiAgICBlbHNlCiAgICAgIGVsZW1lbnQuZmlyZUV2ZW50KGV2ZW50LmV2ZW50VHlwZSwgZXZlbnQpOwoKICAgIHJldHVybiBFdmVudC5leHRlbmQoZXZlbnQpOwogIH0KCiAgRXZlbnQuSGFuZGxlciA9IENsYXNzLmNyZWF0ZSh7CiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihlbGVtZW50LCBldmVudE5hbWUsIHNlbGVjdG9yLCBjYWxsYmFjaykgewogICAgICB0aGlzLmVsZW1lbnQgICA9ICQoZWxlbWVudCk7CiAgICAgIHRoaXMuZXZlbnROYW1lID0gZXZlbnROYW1lOwogICAgICB0aGlzLnNlbGVjdG9yICA9IHNlbGVjdG9yOwogICAgICB0aGlzLmNhbGxiYWNrICA9IGNhbGxiYWNrOwogICAgICB0aGlzLmhhbmRsZXIgICA9IHRoaXMuaGFuZGxlRXZlbnQuYmluZCh0aGlzKTsKICAgIH0sCgogICAgc3RhcnQ6IGZ1bmN0aW9uKCkgewogICAgICBFdmVudC5vYnNlcnZlKHRoaXMuZWxlbWVudCwgdGhpcy5ldmVudE5hbWUsIHRoaXMuaGFuZGxlcik7CiAgICAgIHJldHVybiB0aGlzOwogICAgfSwKCiAgICBzdG9wOiBmdW5jdGlvbigpIHsKICAgICAgRXZlbnQuc3RvcE9ic2VydmluZyh0aGlzLmVsZW1lbnQsIHRoaXMuZXZlbnROYW1lLCB0aGlzLmhhbmRsZXIpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0sCgogICAgaGFuZGxlRXZlbnQ6IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgIHZhciBlbGVtZW50ID0gRXZlbnQuZmluZEVsZW1lbnQoZXZlbnQsIHRoaXMuc2VsZWN0b3IpOwogICAgICBpZiAoZWxlbWVudCkgdGhpcy5jYWxsYmFjay5jYWxsKHRoaXMuZWxlbWVudCwgZXZlbnQsIGVsZW1lbnQpOwogICAgfQogIH0pOwoKICBmdW5jdGlvbiBvbihlbGVtZW50LCBldmVudE5hbWUsIHNlbGVjdG9yLCBjYWxsYmFjaykgewogICAgZWxlbWVudCA9ICQoZWxlbWVudCk7CiAgICBpZiAoT2JqZWN0LmlzRnVuY3Rpb24oc2VsZWN0b3IpICYmIE9iamVjdC5pc1VuZGVmaW5lZChjYWxsYmFjaykpIHsKICAgICAgY2FsbGJhY2sgPSBzZWxlY3Rvciwgc2VsZWN0b3IgPSBudWxsOwogICAgfQoKICAgIHJldHVybiBuZXcgRXZlbnQuSGFuZGxlcihlbGVtZW50LCBldmVudE5hbWUsIHNlbGVjdG9yLCBjYWxsYmFjaykuc3RhcnQoKTsKICB9CgogIE9iamVjdC5leHRlbmQoRXZlbnQsIEV2ZW50Lk1ldGhvZHMpOwoKICBPYmplY3QuZXh0ZW5kKEV2ZW50LCB7CiAgICBmaXJlOiAgICAgICAgICBmaXJlLAogICAgb2JzZXJ2ZTogICAgICAgb2JzZXJ2ZSwKICAgIHN0b3BPYnNlcnZpbmc6IHN0b3BPYnNlcnZpbmcsCiAgICBvbjogICAgICAgICAgICBvbgogIH0pOwoKICBFbGVtZW50LmFkZE1ldGhvZHMoewogICAgZmlyZTogICAgICAgICAgZmlyZSwKCiAgICBvYnNlcnZlOiAgICAgICBvYnNlcnZlLAoKICAgIHN0b3BPYnNlcnZpbmc6IHN0b3BPYnNlcnZpbmcsCgogICAgb246ICAgICAgICAgICAgb24KICB9KTsKCiAgT2JqZWN0LmV4dGVuZChkb2N1bWVudCwgewogICAgZmlyZTogICAgICAgICAgZmlyZS5tZXRob2RpemUoKSwKCiAgICBvYnNlcnZlOiAgICAgICBvYnNlcnZlLm1ldGhvZGl6ZSgpLAoKICAgIHN0b3BPYnNlcnZpbmc6IHN0b3BPYnNlcnZpbmcubWV0aG9kaXplKCksCgogICAgb246ICAgICAgICAgICAgb24ubWV0aG9kaXplKCksCgogICAgbG9hZGVkOiAgICAgICAgZmFsc2UKICB9KTsKCiAgaWYgKHdpbmRvdy5FdmVudCkgT2JqZWN0LmV4dGVuZCh3aW5kb3cuRXZlbnQsIEV2ZW50KTsKICBlbHNlIHdpbmRvdy5FdmVudCA9IEV2ZW50Owp9KSgpOwoKKGZ1bmN0aW9uKCkgewogIC8qIFN1cHBvcnQgZm9yIHRoZSBET01Db250ZW50TG9hZGVkIGV2ZW50IGlzIGJhc2VkIG9uIHdvcmsgYnkgRGFuIFdlYmIsCiAgICAgTWF0dGhpYXMgTWlsbGVyLCBEZWFuIEVkd2FyZHMsIEpvaG4gUmVzaWcsIGFuZCBEaWVnbyBQZXJpbmkuICovCgogIHZhciB0aW1lcjsKCiAgZnVuY3Rpb24gZmlyZUNvbnRlbnRMb2FkZWRFdmVudCgpIHsKICAgIGlmIChkb2N1bWVudC5sb2FkZWQpIHJldHVybjsKICAgIGlmICh0aW1lcikgd2luZG93LmNsZWFyVGltZW91dCh0aW1lcik7CiAgICBkb2N1bWVudC5sb2FkZWQgPSB0cnVlOwogICAgZG9jdW1lbnQuZmlyZSgnZG9tOmxvYWRlZCcpOwogIH0KCiAgZnVuY3Rpb24gY2hlY2tSZWFkeVN0YXRlKCkgewogICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpIHsKICAgICAgZG9jdW1lbnQuc3RvcE9ic2VydmluZygncmVhZHlzdGF0ZWNoYW5nZScsIGNoZWNrUmVhZHlTdGF0ZSk7CiAgICAgIGZpcmVDb250ZW50TG9hZGVkRXZlbnQoKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHBvbGxEb1Njcm9sbCgpIHsKICAgIHRyeSB7IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbCgnbGVmdCcpOyB9CiAgICBjYXRjaChlKSB7CiAgICAgIHRpbWVyID0gcG9sbERvU2Nyb2xsLmRlZmVyKCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZpcmVDb250ZW50TG9hZGVkRXZlbnQoKTsKICB9CgogIGlmIChkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKSB7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZmlyZUNvbnRlbnRMb2FkZWRFdmVudCwgZmFsc2UpOwogIH0gZWxzZSB7CiAgICBkb2N1bWVudC5vYnNlcnZlKCdyZWFkeXN0YXRlY2hhbmdlJywgY2hlY2tSZWFkeVN0YXRlKTsKICAgIGlmICh3aW5kb3cgPT0gdG9wKQogICAgICB0aW1lciA9IHBvbGxEb1Njcm9sbC5kZWZlcigpOwogIH0KCiAgRXZlbnQub2JzZXJ2ZSh3aW5kb3csICdsb2FkJywgZmlyZUNvbnRlbnRMb2FkZWRFdmVudCk7Cn0pKCk7CgpFbGVtZW50LmFkZE1ldGhvZHMoKTsKCi8qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBERVBSRUNBVEVEIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qLwoKSGFzaC50b1F1ZXJ5U3RyaW5nID0gT2JqZWN0LnRvUXVlcnlTdHJpbmc7Cgp2YXIgVG9nZ2xlID0geyBkaXNwbGF5OiBFbGVtZW50LnRvZ2dsZSB9OwoKRWxlbWVudC5NZXRob2RzLmNoaWxkT2YgPSBFbGVtZW50Lk1ldGhvZHMuZGVzY2VuZGFudE9mOwoKdmFyIEluc2VydGlvbiA9IHsKICBCZWZvcmU6IGZ1bmN0aW9uKGVsZW1lbnQsIGNvbnRlbnQpIHsKICAgIHJldHVybiBFbGVtZW50Lmluc2VydChlbGVtZW50LCB7YmVmb3JlOmNvbnRlbnR9KTsKICB9LAoKICBUb3A6IGZ1bmN0aW9uKGVsZW1lbnQsIGNvbnRlbnQpIHsKICAgIHJldHVybiBFbGVtZW50Lmluc2VydChlbGVtZW50LCB7dG9wOmNvbnRlbnR9KTsKICB9LAoKICBCb3R0b206IGZ1bmN0aW9uKGVsZW1lbnQsIGNvbnRlbnQpIHsKICAgIHJldHVybiBFbGVtZW50Lmluc2VydChlbGVtZW50LCB7Ym90dG9tOmNvbnRlbnR9KTsKICB9LAoKICBBZnRlcjogZnVuY3Rpb24oZWxlbWVudCwgY29udGVudCkgewogICAgcmV0dXJuIEVsZW1lbnQuaW5zZXJ0KGVsZW1lbnQsIHthZnRlcjpjb250ZW50fSk7CiAgfQp9OwoKdmFyICRjb250aW51ZSA9IG5ldyBFcnJvcignInRocm93ICRjb250aW51ZSIgaXMgZGVwcmVjYXRlZCwgdXNlICJyZXR1cm4iIGluc3RlYWQnKTsKCnZhciBQb3NpdGlvbiA9IHsKICBpbmNsdWRlU2Nyb2xsT2Zmc2V0czogZmFsc2UsCgogIHByZXBhcmU6IGZ1bmN0aW9uKCkgewogICAgdGhpcy5kZWx0YVggPSAgd2luZG93LnBhZ2VYT2Zmc2V0CiAgICAgICAgICAgICAgICB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdAogICAgICAgICAgICAgICAgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0CiAgICAgICAgICAgICAgICB8fCAwOwogICAgdGhpcy5kZWx0YVkgPSAgd2luZG93LnBhZ2VZT2Zmc2V0CiAgICAgICAgICAgICAgICB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wCiAgICAgICAgICAgICAgICB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcAogICAgICAgICAgICAgICAgfHwgMDsKICB9LAoKICB3aXRoaW46IGZ1bmN0aW9uKGVsZW1lbnQsIHgsIHkpIHsKICAgIGlmICh0aGlzLmluY2x1ZGVTY3JvbGxPZmZzZXRzKQogICAgICByZXR1cm4gdGhpcy53aXRoaW5JbmNsdWRpbmdTY3JvbGxvZmZzZXRzKGVsZW1lbnQsIHgsIHkpOwogICAgdGhpcy54Y29tcCA9IHg7CiAgICB0aGlzLnljb21wID0geTsKICAgIHRoaXMub2Zmc2V0ID0gRWxlbWVudC5jdW11bGF0aXZlT2Zmc2V0KGVsZW1lbnQpOwoKICAgIHJldHVybiAoeSA+PSB0aGlzLm9mZnNldFsxXSAmJgogICAgICAgICAgICB5IDwgIHRoaXMub2Zmc2V0WzFdICsgZWxlbWVudC5vZmZzZXRIZWlnaHQgJiYKICAgICAgICAgICAgeCA+PSB0aGlzLm9mZnNldFswXSAmJgogICAgICAgICAgICB4IDwgIHRoaXMub2Zmc2V0WzBdICsgZWxlbWVudC5vZmZzZXRXaWR0aCk7CiAgfSwKCiAgd2l0aGluSW5jbHVkaW5nU2Nyb2xsb2Zmc2V0czogZnVuY3Rpb24oZWxlbWVudCwgeCwgeSkgewogICAgdmFyIG9mZnNldGNhY2hlID0gRWxlbWVudC5jdW11bGF0aXZlU2Nyb2xsT2Zmc2V0KGVsZW1lbnQpOwoKICAgIHRoaXMueGNvbXAgPSB4ICsgb2Zmc2V0Y2FjaGVbMF0gLSB0aGlzLmRlbHRhWDsKICAgIHRoaXMueWNvbXAgPSB5ICsgb2Zmc2V0Y2FjaGVbMV0gLSB0aGlzLmRlbHRhWTsKICAgIHRoaXMub2Zmc2V0ID0gRWxlbWVudC5jdW11bGF0aXZlT2Zmc2V0KGVsZW1lbnQpOwoKICAgIHJldHVybiAodGhpcy55Y29tcCA+PSB0aGlzLm9mZnNldFsxXSAmJgogICAgICAgICAgICB0aGlzLnljb21wIDwgIHRoaXMub2Zmc2V0WzFdICsgZWxlbWVudC5vZmZzZXRIZWlnaHQgJiYKICAgICAgICAgICAgdGhpcy54Y29tcCA+PSB0aGlzLm9mZnNldFswXSAmJgogICAgICAgICAgICB0aGlzLnhjb21wIDwgIHRoaXMub2Zmc2V0WzBdICsgZWxlbWVudC5vZmZzZXRXaWR0aCk7CiAgfSwKCiAgb3ZlcmxhcDogZnVuY3Rpb24obW9kZSwgZWxlbWVudCkgewogICAgaWYgKCFtb2RlKSByZXR1cm4gMDsKICAgIGlmIChtb2RlID09ICd2ZXJ0aWNhbCcpCiAgICAgIHJldHVybiAoKHRoaXMub2Zmc2V0WzFdICsgZWxlbWVudC5vZmZzZXRIZWlnaHQpIC0gdGhpcy55Y29tcCkgLwogICAgICAgIGVsZW1lbnQub2Zmc2V0SGVpZ2h0OwogICAgaWYgKG1vZGUgPT0gJ2hvcml6b250YWwnKQogICAgICByZXR1cm4gKCh0aGlzLm9mZnNldFswXSArIGVsZW1lbnQub2Zmc2V0V2lkdGgpIC0gdGhpcy54Y29tcCkgLwogICAgICAgIGVsZW1lbnQub2Zmc2V0V2lkdGg7CiAgfSwKCgogIGN1bXVsYXRpdmVPZmZzZXQ6IEVsZW1lbnQuTWV0aG9kcy5jdW11bGF0aXZlT2Zmc2V0LAoKICBwb3NpdGlvbmVkT2Zmc2V0OiBFbGVtZW50Lk1ldGhvZHMucG9zaXRpb25lZE9mZnNldCwKCiAgYWJzb2x1dGl6ZTogZnVuY3Rpb24oZWxlbWVudCkgewogICAgUG9zaXRpb24ucHJlcGFyZSgpOwogICAgcmV0dXJuIEVsZW1lbnQuYWJzb2x1dGl6ZShlbGVtZW50KTsKICB9LAoKICByZWxhdGl2aXplOiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICBQb3NpdGlvbi5wcmVwYXJlKCk7CiAgICByZXR1cm4gRWxlbWVudC5yZWxhdGl2aXplKGVsZW1lbnQpOwogIH0sCgogIHJlYWxPZmZzZXQ6IEVsZW1lbnQuTWV0aG9kcy5jdW11bGF0aXZlU2Nyb2xsT2Zmc2V0LAoKICBvZmZzZXRQYXJlbnQ6IEVsZW1lbnQuTWV0aG9kcy5nZXRPZmZzZXRQYXJlbnQsCgogIHBhZ2U6IEVsZW1lbnQuTWV0aG9kcy52aWV3cG9ydE9mZnNldCwKCiAgY2xvbmU6IGZ1bmN0aW9uKHNvdXJjZSwgdGFyZ2V0LCBvcHRpb25zKSB7CiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7IH07CiAgICByZXR1cm4gRWxlbWVudC5jbG9uZVBvc2l0aW9uKHRhcmdldCwgc291cmNlLCBvcHRpb25zKTsKICB9Cn07CgovKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCmlmICghZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSkgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSA9IGZ1bmN0aW9uKGluc3RhbmNlTWV0aG9kcyl7CiAgZnVuY3Rpb24gaXRlcihuYW1lKSB7CiAgICByZXR1cm4gbmFtZS5ibGFuaygpID8gbnVsbCA6ICJbY29udGFpbnMoY29uY2F0KCcgJywgQGNsYXNzLCAnICcpLCAnICIgKyBuYW1lICsgIiAnKV0iOwogIH0KCiAgaW5zdGFuY2VNZXRob2RzLmdldEVsZW1lbnRzQnlDbGFzc05hbWUgPSBQcm90b3R5cGUuQnJvd3NlckZlYXR1cmVzLlhQYXRoID8KICBmdW5jdGlvbihlbGVtZW50LCBjbGFzc05hbWUpIHsKICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZS50b1N0cmluZygpLnN0cmlwKCk7CiAgICB2YXIgY29uZCA9IC9ccy8udGVzdChjbGFzc05hbWUpID8gJHcoY2xhc3NOYW1lKS5tYXAoaXRlcikuam9pbignJykgOiBpdGVyKGNsYXNzTmFtZSk7CiAgICByZXR1cm4gY29uZCA/IGRvY3VtZW50Ll9nZXRFbGVtZW50c0J5WFBhdGgoJy4vLyonICsgY29uZCwgZWxlbWVudCkgOiBbXTsKICB9IDogZnVuY3Rpb24oZWxlbWVudCwgY2xhc3NOYW1lKSB7CiAgICBjbGFzc05hbWUgPSBjbGFzc05hbWUudG9TdHJpbmcoKS5zdHJpcCgpOwogICAgdmFyIGVsZW1lbnRzID0gW10sIGNsYXNzTmFtZXMgPSAoL1xzLy50ZXN0KGNsYXNzTmFtZSkgPyAkdyhjbGFzc05hbWUpIDogbnVsbCk7CiAgICBpZiAoIWNsYXNzTmFtZXMgJiYgIWNsYXNzTmFtZSkgcmV0dXJuIGVsZW1lbnRzOwoKICAgIHZhciBub2RlcyA9ICQoZWxlbWVudCkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJyonKTsKICAgIGNsYXNzTmFtZSA9ICcgJyArIGNsYXNzTmFtZSArICcgJzsKCiAgICBmb3IgKHZhciBpID0gMCwgY2hpbGQsIGNuOyBjaGlsZCA9IG5vZGVzW2ldOyBpKyspIHsKICAgICAgaWYgKGNoaWxkLmNsYXNzTmFtZSAmJiAoY24gPSAnICcgKyBjaGlsZC5jbGFzc05hbWUgKyAnICcpICYmIChjbi5pbmNsdWRlKGNsYXNzTmFtZSkgfHwKICAgICAgICAgIChjbGFzc05hbWVzICYmIGNsYXNzTmFtZXMuYWxsKGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgICAgICAgcmV0dXJuICFuYW1lLnRvU3RyaW5nKCkuYmxhbmsoKSAmJiBjbi5pbmNsdWRlKCcgJyArIG5hbWUgKyAnICcpOwogICAgICAgICAgfSkpKSkKICAgICAgICBlbGVtZW50cy5wdXNoKEVsZW1lbnQuZXh0ZW5kKGNoaWxkKSk7CiAgICB9CiAgICByZXR1cm4gZWxlbWVudHM7CiAgfTsKCiAgcmV0dXJuIGZ1bmN0aW9uKGNsYXNzTmFtZSwgcGFyZW50RWxlbWVudCkgewogICAgcmV0dXJuICQocGFyZW50RWxlbWVudCB8fCBkb2N1bWVudC5ib2R5KS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGNsYXNzTmFtZSk7CiAgfTsKfShFbGVtZW50Lk1ldGhvZHMpOwoKLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCgpFbGVtZW50LkNsYXNzTmFtZXMgPSBDbGFzcy5jcmVhdGUoKTsKRWxlbWVudC5DbGFzc05hbWVzLnByb3RvdHlwZSA9IHsKICBpbml0aWFsaXplOiBmdW5jdGlvbihlbGVtZW50KSB7CiAgICB0aGlzLmVsZW1lbnQgPSAkKGVsZW1lbnQpOwogIH0sCgogIF9lYWNoOiBmdW5jdGlvbihpdGVyYXRvcikgewogICAgdGhpcy5lbGVtZW50LmNsYXNzTmFtZS5zcGxpdCgvXHMrLykuc2VsZWN0KGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgcmV0dXJuIG5hbWUubGVuZ3RoID4gMDsKICAgIH0pLl9lYWNoKGl0ZXJhdG9yKTsKICB9LAoKICBzZXQ6IGZ1bmN0aW9uKGNsYXNzTmFtZSkgewogICAgdGhpcy5lbGVtZW50LmNsYXNzTmFtZSA9IGNsYXNzTmFtZTsKICB9LAoKICBhZGQ6IGZ1bmN0aW9uKGNsYXNzTmFtZVRvQWRkKSB7CiAgICBpZiAodGhpcy5pbmNsdWRlKGNsYXNzTmFtZVRvQWRkKSkgcmV0dXJuOwogICAgdGhpcy5zZXQoJEEodGhpcykuY29uY2F0KGNsYXNzTmFtZVRvQWRkKS5qb2luKCcgJykpOwogIH0sCgogIHJlbW92ZTogZnVuY3Rpb24oY2xhc3NOYW1lVG9SZW1vdmUpIHsKICAgIGlmICghdGhpcy5pbmNsdWRlKGNsYXNzTmFtZVRvUmVtb3ZlKSkgcmV0dXJuOwogICAgdGhpcy5zZXQoJEEodGhpcykud2l0aG91dChjbGFzc05hbWVUb1JlbW92ZSkuam9pbignICcpKTsKICB9LAoKICB0b1N0cmluZzogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gJEEodGhpcykuam9pbignICcpOwogIH0KfTsKCk9iamVjdC5leHRlbmQoRWxlbWVudC5DbGFzc05hbWVzLnByb3RvdHlwZSwgRW51bWVyYWJsZSk7CgovKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi8KCi8qISBqUXVlcnkgdjEuNy4yIGpxdWVyeS5jb20gfCBqcXVlcnkub3JnL2xpY2Vuc2UgKi8KKGZ1bmN0aW9uKGEsYil7ZnVuY3Rpb24gY3koYSl7cmV0dXJuIGYuaXNXaW5kb3coYSk/YTphLm5vZGVUeXBlPT09OT9hLmRlZmF1bHRWaWV3fHxhLnBhcmVudFdpbmRvdzohMX1mdW5jdGlvbiBjdShhKXtpZighY2pbYV0pe3ZhciBiPWMuYm9keSxkPWYoIjwiK2ErIj4iKS5hcHBlbmRUbyhiKSxlPWQuY3NzKCJkaXNwbGF5Iik7ZC5yZW1vdmUoKTtpZihlPT09Im5vbmUifHxlPT09IiIpe2NrfHwoY2s9Yy5jcmVhdGVFbGVtZW50KCJpZnJhbWUiKSxjay5mcmFtZUJvcmRlcj1jay53aWR0aD1jay5oZWlnaHQ9MCksYi5hcHBlbmRDaGlsZChjayk7aWYoIWNsfHwhY2suY3JlYXRlRWxlbWVudCljbD0oY2suY29udGVudFdpbmRvd3x8Y2suY29udGVudERvY3VtZW50KS5kb2N1bWVudCxjbC53cml0ZSgoZi5zdXBwb3J0LmJveE1vZGVsPyI8IWRvY3R5cGUgaHRtbD4iOiIiKSsiPGh0bWw+PGJvZHk+IiksY2wuY2xvc2UoKTtkPWNsLmNyZWF0ZUVsZW1lbnQoYSksY2wuYm9keS5hcHBlbmRDaGlsZChkKSxlPWYuY3NzKGQsImRpc3BsYXkiKSxiLnJlbW92ZUNoaWxkKGNrKX1jalthXT1lfXJldHVybiBjalthXX1mdW5jdGlvbiBjdChhLGIpe3ZhciBjPXt9O2YuZWFjaChjcC5jb25jYXQuYXBwbHkoW10sY3Auc2xpY2UoMCxiKSksZnVuY3Rpb24oKXtjW3RoaXNdPWF9KTtyZXR1cm4gY31mdW5jdGlvbiBjcygpe2NxPWJ9ZnVuY3Rpb24gY3IoKXtzZXRUaW1lb3V0KGNzLDApO3JldHVybiBjcT1mLm5vdygpfWZ1bmN0aW9uIGNpKCl7dHJ5e3JldHVybiBuZXcgYS5BY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MSFRUUCIpfWNhdGNoKGIpe319ZnVuY3Rpb24gY2goKXt0cnl7cmV0dXJuIG5ldyBhLlhNTEh0dHBSZXF1ZXN0fWNhdGNoKGIpe319ZnVuY3Rpb24gY2IoYSxjKXthLmRhdGFGaWx0ZXImJihjPWEuZGF0YUZpbHRlcihjLGEuZGF0YVR5cGUpKTt2YXIgZD1hLmRhdGFUeXBlcyxlPXt9LGcsaCxpPWQubGVuZ3RoLGosaz1kWzBdLGwsbSxuLG8scDtmb3IoZz0xO2c8aTtnKyspe2lmKGc9PT0xKWZvcihoIGluIGEuY29udmVydGVycyl0eXBlb2YgaD09InN0cmluZyImJihlW2gudG9Mb3dlckNhc2UoKV09YS5jb252ZXJ0ZXJzW2hdKTtsPWssaz1kW2ddO2lmKGs9PT0iKiIpaz1sO2Vsc2UgaWYobCE9PSIqIiYmbCE9PWspe209bCsiICIrayxuPWVbbV18fGVbIiogIitrXTtpZighbil7cD1iO2ZvcihvIGluIGUpe2o9by5zcGxpdCgiICIpO2lmKGpbMF09PT1sfHxqWzBdPT09IioiKXtwPWVbalsxXSsiICIra107aWYocCl7bz1lW29dLG89PT0hMD9uPXA6cD09PSEwJiYobj1vKTticmVha319fX0hbiYmIXAmJmYuZXJyb3IoIk5vIGNvbnZlcnNpb24gZnJvbSAiK20ucmVwbGFjZSgiICIsIiB0byAiKSksbiE9PSEwJiYoYz1uP24oYyk6cChvKGMpKSl9fXJldHVybiBjfWZ1bmN0aW9uIGNhKGEsYyxkKXt2YXIgZT1hLmNvbnRlbnRzLGY9YS5kYXRhVHlwZXMsZz1hLnJlc3BvbnNlRmllbGRzLGgsaSxqLGs7Zm9yKGkgaW4gZylpIGluIGQmJihjW2dbaV1dPWRbaV0pO3doaWxlKGZbMF09PT0iKiIpZi5zaGlmdCgpLGg9PT1iJiYoaD1hLm1pbWVUeXBlfHxjLmdldFJlc3BvbnNlSGVhZGVyKCJjb250ZW50LXR5cGUiKSk7aWYoaClmb3IoaSBpbiBlKWlmKGVbaV0mJmVbaV0udGVzdChoKSl7Zi51bnNoaWZ0KGkpO2JyZWFrfWlmKGZbMF1pbiBkKWo9ZlswXTtlbHNle2ZvcihpIGluIGQpe2lmKCFmWzBdfHxhLmNvbnZlcnRlcnNbaSsiICIrZlswXV0pe2o9aTticmVha31rfHwoaz1pKX1qPWp8fGt9aWYoail7aiE9PWZbMF0mJmYudW5zaGlmdChqKTtyZXR1cm4gZFtqXX19ZnVuY3Rpb24gYl8oYSxiLGMsZCl7aWYoZi5pc0FycmF5KGIpKWYuZWFjaChiLGZ1bmN0aW9uKGIsZSl7Y3x8YkQudGVzdChhKT9kKGEsZSk6Yl8oYSsiWyIrKHR5cGVvZiBlPT0ib2JqZWN0Ij9iOiIiKSsiXSIsZSxjLGQpfSk7ZWxzZSBpZighYyYmZi50eXBlKGIpPT09Im9iamVjdCIpZm9yKHZhciBlIGluIGIpYl8oYSsiWyIrZSsiXSIsYltlXSxjLGQpO2Vsc2UgZChhLGIpfWZ1bmN0aW9uIGIkKGEsYyl7dmFyIGQsZSxnPWYuYWpheFNldHRpbmdzLmZsYXRPcHRpb25zfHx7fTtmb3IoZCBpbiBjKWNbZF0hPT1iJiYoKGdbZF0/YTplfHwoZT17fSkpW2RdPWNbZF0pO2UmJmYuZXh0ZW5kKCEwLGEsZSl9ZnVuY3Rpb24gYlooYSxjLGQsZSxmLGcpe2Y9Znx8Yy5kYXRhVHlwZXNbMF0sZz1nfHx7fSxnW2ZdPSEwO3ZhciBoPWFbZl0saT0wLGo9aD9oLmxlbmd0aDowLGs9YT09PWJTLGw7Zm9yKDtpPGomJihrfHwhbCk7aSsrKWw9aFtpXShjLGQsZSksdHlwZW9mIGw9PSJzdHJpbmciJiYoIWt8fGdbbF0/bD1iOihjLmRhdGFUeXBlcy51bnNoaWZ0KGwpLGw9YlooYSxjLGQsZSxsLGcpKSk7KGt8fCFsKSYmIWdbIioiXSYmKGw9YlooYSxjLGQsZSwiKiIsZykpO3JldHVybiBsfWZ1bmN0aW9uIGJZKGEpe3JldHVybiBmdW5jdGlvbihiLGMpe3R5cGVvZiBiIT0ic3RyaW5nIiYmKGM9YixiPSIqIik7aWYoZi5pc0Z1bmN0aW9uKGMpKXt2YXIgZD1iLnRvTG93ZXJDYXNlKCkuc3BsaXQoYk8pLGU9MCxnPWQubGVuZ3RoLGgsaSxqO2Zvcig7ZTxnO2UrKyloPWRbZV0saj0vXlwrLy50ZXN0KGgpLGomJihoPWguc3Vic3RyKDEpfHwiKiIpLGk9YVtoXT1hW2hdfHxbXSxpW2o/InVuc2hpZnQiOiJwdXNoIl0oYyl9fX1mdW5jdGlvbiBiQihhLGIsYyl7dmFyIGQ9Yj09PSJ3aWR0aCI/YS5vZmZzZXRXaWR0aDphLm9mZnNldEhlaWdodCxlPWI9PT0id2lkdGgiPzE6MCxnPTQ7aWYoZD4wKXtpZihjIT09ImJvcmRlciIpZm9yKDtlPGc7ZSs9MiljfHwoZC09cGFyc2VGbG9hdChmLmNzcyhhLCJwYWRkaW5nIitieFtlXSkpfHwwKSxjPT09Im1hcmdpbiI/ZCs9cGFyc2VGbG9hdChmLmNzcyhhLGMrYnhbZV0pKXx8MDpkLT1wYXJzZUZsb2F0KGYuY3NzKGEsImJvcmRlciIrYnhbZV0rIldpZHRoIikpfHwwO3JldHVybiBkKyJweCJ9ZD1ieShhLGIpO2lmKGQ8MHx8ZD09bnVsbClkPWEuc3R5bGVbYl07aWYoYnQudGVzdChkKSlyZXR1cm4gZDtkPXBhcnNlRmxvYXQoZCl8fDA7aWYoYylmb3IoO2U8ZztlKz0yKWQrPXBhcnNlRmxvYXQoZi5jc3MoYSwicGFkZGluZyIrYnhbZV0pKXx8MCxjIT09InBhZGRpbmciJiYoZCs9cGFyc2VGbG9hdChmLmNzcyhhLCJib3JkZXIiK2J4W2VdKyJXaWR0aCIpKXx8MCksYz09PSJtYXJnaW4iJiYoZCs9cGFyc2VGbG9hdChmLmNzcyhhLGMrYnhbZV0pKXx8MCk7cmV0dXJuIGQrInB4In1mdW5jdGlvbiBibyhhKXt2YXIgYj1jLmNyZWF0ZUVsZW1lbnQoImRpdiIpO2JoLmFwcGVuZENoaWxkKGIpLGIuaW5uZXJIVE1MPWEub3V0ZXJIVE1MO3JldHVybiBiLmZpcnN0Q2hpbGR9ZnVuY3Rpb24gYm4oYSl7dmFyIGI9KGEubm9kZU5hbWV8fCIiKS50b0xvd2VyQ2FzZSgpO2I9PT0iaW5wdXQiP2JtKGEpOmIhPT0ic2NyaXB0IiYmdHlwZW9mIGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUhPSJ1bmRlZmluZWQiJiZmLmdyZXAoYS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiaW5wdXQiKSxibSl9ZnVuY3Rpb24gYm0oYSl7aWYoYS50eXBlPT09ImNoZWNrYm94Inx8YS50eXBlPT09InJhZGlvIilhLmRlZmF1bHRDaGVja2VkPWEuY2hlY2tlZH1mdW5jdGlvbiBibChhKXtyZXR1cm4gdHlwZW9mIGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUhPSJ1bmRlZmluZWQiP2EuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKTp0eXBlb2YgYS5xdWVyeVNlbGVjdG9yQWxsIT0idW5kZWZpbmVkIj9hLnF1ZXJ5U2VsZWN0b3JBbGwoIioiKTpbXX1mdW5jdGlvbiBiayhhLGIpe3ZhciBjO2Iubm9kZVR5cGU9PT0xJiYoYi5jbGVhckF0dHJpYnV0ZXMmJmIuY2xlYXJBdHRyaWJ1dGVzKCksYi5tZXJnZUF0dHJpYnV0ZXMmJmIubWVyZ2VBdHRyaWJ1dGVzKGEpLGM9Yi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLGM9PT0ib2JqZWN0Ij9iLm91dGVySFRNTD1hLm91dGVySFRNTDpjIT09ImlucHV0Inx8YS50eXBlIT09ImNoZWNrYm94IiYmYS50eXBlIT09InJhZGlvIj9jPT09Im9wdGlvbiI/Yi5zZWxlY3RlZD1hLmRlZmF1bHRTZWxlY3RlZDpjPT09ImlucHV0Inx8Yz09PSJ0ZXh0YXJlYSI/Yi5kZWZhdWx0VmFsdWU9YS5kZWZhdWx0VmFsdWU6Yz09PSJzY3JpcHQiJiZiLnRleHQhPT1hLnRleHQmJihiLnRleHQ9YS50ZXh0KTooYS5jaGVja2VkJiYoYi5kZWZhdWx0Q2hlY2tlZD1iLmNoZWNrZWQ9YS5jaGVja2VkKSxiLnZhbHVlIT09YS52YWx1ZSYmKGIudmFsdWU9YS52YWx1ZSkpLGIucmVtb3ZlQXR0cmlidXRlKGYuZXhwYW5kbyksYi5yZW1vdmVBdHRyaWJ1dGUoIl9zdWJtaXRfYXR0YWNoZWQiKSxiLnJlbW92ZUF0dHJpYnV0ZSgiX2NoYW5nZV9hdHRhY2hlZCIpKX1mdW5jdGlvbiBiaihhLGIpe2lmKGIubm9kZVR5cGU9PT0xJiYhIWYuaGFzRGF0YShhKSl7dmFyIGMsZCxlLGc9Zi5fZGF0YShhKSxoPWYuX2RhdGEoYixnKSxpPWcuZXZlbnRzO2lmKGkpe2RlbGV0ZSBoLmhhbmRsZSxoLmV2ZW50cz17fTtmb3IoYyBpbiBpKWZvcihkPTAsZT1pW2NdLmxlbmd0aDtkPGU7ZCsrKWYuZXZlbnQuYWRkKGIsYyxpW2NdW2RdKX1oLmRhdGEmJihoLmRhdGE9Zi5leHRlbmQoe30saC5kYXRhKSl9fWZ1bmN0aW9uIGJpKGEsYil7cmV0dXJuIGYubm9kZU5hbWUoYSwidGFibGUiKT9hLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0Ym9keSIpWzBdfHxhLmFwcGVuZENoaWxkKGEub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIpKTphfWZ1bmN0aW9uIFUoYSl7dmFyIGI9Vi5zcGxpdCgifCIpLGM9YS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7aWYoYy5jcmVhdGVFbGVtZW50KXdoaWxlKGIubGVuZ3RoKWMuY3JlYXRlRWxlbWVudChiLnBvcCgpKTtyZXR1cm4gY31mdW5jdGlvbiBUKGEsYixjKXtiPWJ8fDA7aWYoZi5pc0Z1bmN0aW9uKGIpKXJldHVybiBmLmdyZXAoYSxmdW5jdGlvbihhLGQpe3ZhciBlPSEhYi5jYWxsKGEsZCxhKTtyZXR1cm4gZT09PWN9KTtpZihiLm5vZGVUeXBlKXJldHVybiBmLmdyZXAoYSxmdW5jdGlvbihhLGQpe3JldHVybiBhPT09Yj09PWN9KTtpZih0eXBlb2YgYj09InN0cmluZyIpe3ZhciBkPWYuZ3JlcChhLGZ1bmN0aW9uKGEpe3JldHVybiBhLm5vZGVUeXBlPT09MX0pO2lmKE8udGVzdChiKSlyZXR1cm4gZi5maWx0ZXIoYixkLCFjKTtiPWYuZmlsdGVyKGIsZCl9cmV0dXJuIGYuZ3JlcChhLGZ1bmN0aW9uKGEsZCl7cmV0dXJuIGYuaW5BcnJheShhLGIpPj0wPT09Y30pfWZ1bmN0aW9uIFMoYSl7cmV0dXJuIWF8fCFhLnBhcmVudE5vZGV8fGEucGFyZW50Tm9kZS5ub2RlVHlwZT09PTExfWZ1bmN0aW9uIEsoKXtyZXR1cm4hMH1mdW5jdGlvbiBKKCl7cmV0dXJuITF9ZnVuY3Rpb24gbihhLGIsYyl7dmFyIGQ9YisiZGVmZXIiLGU9YisicXVldWUiLGc9YisibWFyayIsaD1mLl9kYXRhKGEsZCk7aCYmKGM9PT0icXVldWUifHwhZi5fZGF0YShhLGUpKSYmKGM9PT0ibWFyayJ8fCFmLl9kYXRhKGEsZykpJiZzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IWYuX2RhdGEoYSxlKSYmIWYuX2RhdGEoYSxnKSYmKGYucmVtb3ZlRGF0YShhLGQsITApLGguZmlyZSgpKX0sMCl9ZnVuY3Rpb24gbShhKXtmb3IodmFyIGIgaW4gYSl7aWYoYj09PSJkYXRhIiYmZi5pc0VtcHR5T2JqZWN0KGFbYl0pKWNvbnRpbnVlO2lmKGIhPT0idG9KU09OIilyZXR1cm4hMX1yZXR1cm4hMH1mdW5jdGlvbiBsKGEsYyxkKXtpZihkPT09YiYmYS5ub2RlVHlwZT09PTEpe3ZhciBlPSJkYXRhLSIrYy5yZXBsYWNlKGssIi0kMSIpLnRvTG93ZXJDYXNlKCk7ZD1hLmdldEF0dHJpYnV0ZShlKTtpZih0eXBlb2YgZD09InN0cmluZyIpe3RyeXtkPWQ9PT0idHJ1ZSI/ITA6ZD09PSJmYWxzZSI/ITE6ZD09PSJudWxsIj9udWxsOmYuaXNOdW1lcmljKGQpPytkOmoudGVzdChkKT9mLnBhcnNlSlNPTihkKTpkfWNhdGNoKGcpe31mLmRhdGEoYSxjLGQpfWVsc2UgZD1ifXJldHVybiBkfWZ1bmN0aW9uIGgoYSl7dmFyIGI9Z1thXT17fSxjLGQ7YT1hLnNwbGl0KC9ccysvKTtmb3IoYz0wLGQ9YS5sZW5ndGg7YzxkO2MrKyliW2FbY11dPSEwO3JldHVybiBifXZhciBjPWEuZG9jdW1lbnQsZD1hLm5hdmlnYXRvcixlPWEubG9jYXRpb24sZj1mdW5jdGlvbigpe2Z1bmN0aW9uIEooKXtpZighZS5pc1JlYWR5KXt0cnl7Yy5kb2N1bWVudEVsZW1lbnQuZG9TY3JvbGwoImxlZnQiKX1jYXRjaChhKXtzZXRUaW1lb3V0KEosMSk7cmV0dXJufWUucmVhZHkoKX19dmFyIGU9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IGUuZm4uaW5pdChhLGIsaCl9LGY9YS5qUXVlcnksZz1hLiQsaCxpPS9eKD86W14jPF0qKDxbXHdcV10rPilbXj5dKiR8IyhbXHdcLV0qKSQpLyxqPS9cUy8saz0vXlxzKy8sbD0vXHMrJC8sbT0vXjwoXHcrKVxzKlwvPz4oPzo8XC9cMT4pPyQvLG49L15bXF0sOnt9XHNdKiQvLG89L1xcKD86WyJcXFwvYmZucnRdfHVbMC05YS1mQS1GXXs0fSkvZyxwPS8iW14iXFxcblxyXSoifHRydWV8ZmFsc2V8bnVsbHwtP1xkKyg/OlwuXGQqKT8oPzpbZUVdWytcLV0/XGQrKT8vZyxxPS8oPzpefDp8LCkoPzpccypcWykrL2cscj0vKHdlYmtpdClbIFwvXShbXHcuXSspLyxzPS8ob3BlcmEpKD86Lip2ZXJzaW9uKT9bIFwvXShbXHcuXSspLyx0PS8obXNpZSkgKFtcdy5dKykvLHU9Lyhtb3ppbGxhKSg/Oi4qPyBydjooW1x3Ll0rKSk/Lyx2PS8tKFthLXpdfFswLTldKS9pZyx3PS9eLW1zLS8seD1mdW5jdGlvbihhLGIpe3JldHVybihiKyIiKS50b1VwcGVyQ2FzZSgpfSx5PWQudXNlckFnZW50LHosQSxCLEM9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZyxEPU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksRT1BcnJheS5wcm90b3R5cGUucHVzaCxGPUFycmF5LnByb3RvdHlwZS5zbGljZSxHPVN0cmluZy5wcm90b3R5cGUudHJpbSxIPUFycmF5LnByb3RvdHlwZS5pbmRleE9mLEk9e307ZS5mbj1lLnByb3RvdHlwZT17Y29uc3RydWN0b3I6ZSxpbml0OmZ1bmN0aW9uKGEsZCxmKXt2YXIgZyxoLGosaztpZighYSlyZXR1cm4gdGhpcztpZihhLm5vZGVUeXBlKXt0aGlzLmNvbnRleHQ9dGhpc1swXT1hLHRoaXMubGVuZ3RoPTE7cmV0dXJuIHRoaXN9aWYoYT09PSJib2R5IiYmIWQmJmMuYm9keSl7dGhpcy5jb250ZXh0PWMsdGhpc1swXT1jLmJvZHksdGhpcy5zZWxlY3Rvcj1hLHRoaXMubGVuZ3RoPTE7cmV0dXJuIHRoaXN9aWYodHlwZW9mIGE9PSJzdHJpbmciKXthLmNoYXJBdCgwKSE9PSI8Inx8YS5jaGFyQXQoYS5sZW5ndGgtMSkhPT0iPiJ8fGEubGVuZ3RoPDM/Zz1pLmV4ZWMoYSk6Zz1bbnVsbCxhLG51bGxdO2lmKGcmJihnWzFdfHwhZCkpe2lmKGdbMV0pe2Q9ZCBpbnN0YW5jZW9mIGU/ZFswXTpkLGs9ZD9kLm93bmVyRG9jdW1lbnR8fGQ6YyxqPW0uZXhlYyhhKSxqP2UuaXNQbGFpbk9iamVjdChkKT8oYT1bYy5jcmVhdGVFbGVtZW50KGpbMV0pXSxlLmZuLmF0dHIuY2FsbChhLGQsITApKTphPVtrLmNyZWF0ZUVsZW1lbnQoalsxXSldOihqPWUuYnVpbGRGcmFnbWVudChbZ1sxXV0sW2tdKSxhPShqLmNhY2hlYWJsZT9lLmNsb25lKGouZnJhZ21lbnQpOmouZnJhZ21lbnQpLmNoaWxkTm9kZXMpO3JldHVybiBlLm1lcmdlKHRoaXMsYSl9aD1jLmdldEVsZW1lbnRCeUlkKGdbMl0pO2lmKGgmJmgucGFyZW50Tm9kZSl7aWYoaC5pZCE9PWdbMl0pcmV0dXJuIGYuZmluZChhKTt0aGlzLmxlbmd0aD0xLHRoaXNbMF09aH10aGlzLmNvbnRleHQ9Yyx0aGlzLnNlbGVjdG9yPWE7cmV0dXJuIHRoaXN9cmV0dXJuIWR8fGQuanF1ZXJ5PyhkfHxmKS5maW5kKGEpOnRoaXMuY29uc3RydWN0b3IoZCkuZmluZChhKX1pZihlLmlzRnVuY3Rpb24oYSkpcmV0dXJuIGYucmVhZHkoYSk7YS5zZWxlY3RvciE9PWImJih0aGlzLnNlbGVjdG9yPWEuc2VsZWN0b3IsdGhpcy5jb250ZXh0PWEuY29udGV4dCk7cmV0dXJuIGUubWFrZUFycmF5KGEsdGhpcyl9LHNlbGVjdG9yOiIiLGpxdWVyeToiMS43LjIiLGxlbmd0aDowLHNpemU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5sZW5ndGh9LHRvQXJyYXk6ZnVuY3Rpb24oKXtyZXR1cm4gRi5jYWxsKHRoaXMsMCl9LGdldDpmdW5jdGlvbihhKXtyZXR1cm4gYT09bnVsbD90aGlzLnRvQXJyYXkoKTphPDA/dGhpc1t0aGlzLmxlbmd0aCthXTp0aGlzW2FdfSxwdXNoU3RhY2s6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPXRoaXMuY29uc3RydWN0b3IoKTtlLmlzQXJyYXkoYSk/RS5hcHBseShkLGEpOmUubWVyZ2UoZCxhKSxkLnByZXZPYmplY3Q9dGhpcyxkLmNvbnRleHQ9dGhpcy5jb250ZXh0LGI9PT0iZmluZCI/ZC5zZWxlY3Rvcj10aGlzLnNlbGVjdG9yKyh0aGlzLnNlbGVjdG9yPyIgIjoiIikrYzpiJiYoZC5zZWxlY3Rvcj10aGlzLnNlbGVjdG9yKyIuIitiKyIoIitjKyIpIik7cmV0dXJuIGR9LGVhY2g6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZS5lYWNoKHRoaXMsYSxiKX0scmVhZHk6ZnVuY3Rpb24oYSl7ZS5iaW5kUmVhZHkoKSxBLmFkZChhKTtyZXR1cm4gdGhpc30sZXE6ZnVuY3Rpb24oYSl7YT0rYTtyZXR1cm4gYT09PS0xP3RoaXMuc2xpY2UoYSk6dGhpcy5zbGljZShhLGErMSl9LGZpcnN0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZXEoMCl9LGxhc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lcSgtMSl9LHNsaWNlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucHVzaFN0YWNrKEYuYXBwbHkodGhpcyxhcmd1bWVudHMpLCJzbGljZSIsRi5jYWxsKGFyZ3VtZW50cykuam9pbigiLCIpKX0sbWFwOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnB1c2hTdGFjayhlLm1hcCh0aGlzLGZ1bmN0aW9uKGIsYyl7cmV0dXJuIGEuY2FsbChiLGMsYil9KSl9LGVuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnByZXZPYmplY3R8fHRoaXMuY29uc3RydWN0b3IobnVsbCl9LHB1c2g6RSxzb3J0OltdLnNvcnQsc3BsaWNlOltdLnNwbGljZX0sZS5mbi5pbml0LnByb3RvdHlwZT1lLmZuLGUuZXh0ZW5kPWUuZm4uZXh0ZW5kPWZ1bmN0aW9uKCl7dmFyIGEsYyxkLGYsZyxoLGk9YXJndW1lbnRzWzBdfHx7fSxqPTEsaz1hcmd1bWVudHMubGVuZ3RoLGw9ITE7dHlwZW9mIGk9PSJib29sZWFuIiYmKGw9aSxpPWFyZ3VtZW50c1sxXXx8e30saj0yKSx0eXBlb2YgaSE9Im9iamVjdCImJiFlLmlzRnVuY3Rpb24oaSkmJihpPXt9KSxrPT09aiYmKGk9dGhpcywtLWopO2Zvcig7ajxrO2orKylpZigoYT1hcmd1bWVudHNbal0pIT1udWxsKWZvcihjIGluIGEpe2Q9aVtjXSxmPWFbY107aWYoaT09PWYpY29udGludWU7bCYmZiYmKGUuaXNQbGFpbk9iamVjdChmKXx8KGc9ZS5pc0FycmF5KGYpKSk/KGc/KGc9ITEsaD1kJiZlLmlzQXJyYXkoZCk/ZDpbXSk6aD1kJiZlLmlzUGxhaW5PYmplY3QoZCk/ZDp7fSxpW2NdPWUuZXh0ZW5kKGwsaCxmKSk6ZiE9PWImJihpW2NdPWYpfXJldHVybiBpfSxlLmV4dGVuZCh7bm9Db25mbGljdDpmdW5jdGlvbihiKXthLiQ9PT1lJiYoYS4kPWcpLGImJmEualF1ZXJ5PT09ZSYmKGEualF1ZXJ5PWYpO3JldHVybiBlfSxpc1JlYWR5OiExLHJlYWR5V2FpdDoxLGhvbGRSZWFkeTpmdW5jdGlvbihhKXthP2UucmVhZHlXYWl0Kys6ZS5yZWFkeSghMCl9LHJlYWR5OmZ1bmN0aW9uKGEpe2lmKGE9PT0hMCYmIS0tZS5yZWFkeVdhaXR8fGEhPT0hMCYmIWUuaXNSZWFkeSl7aWYoIWMuYm9keSlyZXR1cm4gc2V0VGltZW91dChlLnJlYWR5LDEpO2UuaXNSZWFkeT0hMDtpZihhIT09ITAmJi0tZS5yZWFkeVdhaXQ+MClyZXR1cm47QS5maXJlV2l0aChjLFtlXSksZS5mbi50cmlnZ2VyJiZlKGMpLnRyaWdnZXIoInJlYWR5Iikub2ZmKCJyZWFkeSIpfX0sYmluZFJlYWR5OmZ1bmN0aW9uKCl7aWYoIUEpe0E9ZS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5Iik7aWYoYy5yZWFkeVN0YXRlPT09ImNvbXBsZXRlIilyZXR1cm4gc2V0VGltZW91dChlLnJlYWR5LDEpO2lmKGMuYWRkRXZlbnRMaXN0ZW5lciljLmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLEIsITEpLGEuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsZS5yZWFkeSwhMSk7ZWxzZSBpZihjLmF0dGFjaEV2ZW50KXtjLmF0dGFjaEV2ZW50KCJvbnJlYWR5c3RhdGVjaGFuZ2UiLEIpLGEuYXR0YWNoRXZlbnQoIm9ubG9hZCIsZS5yZWFkeSk7dmFyIGI9ITE7dHJ5e2I9YS5mcmFtZUVsZW1lbnQ9PW51bGx9Y2F0Y2goZCl7fWMuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsJiZiJiZKKCl9fX0saXNGdW5jdGlvbjpmdW5jdGlvbihhKXtyZXR1cm4gZS50eXBlKGEpPT09ImZ1bmN0aW9uIn0saXNBcnJheTpBcnJheS5pc0FycmF5fHxmdW5jdGlvbihhKXtyZXR1cm4gZS50eXBlKGEpPT09ImFycmF5In0saXNXaW5kb3c6ZnVuY3Rpb24oYSl7cmV0dXJuIGEhPW51bGwmJmE9PWEud2luZG93fSxpc051bWVyaWM6ZnVuY3Rpb24oYSl7cmV0dXJuIWlzTmFOKHBhcnNlRmxvYXQoYSkpJiZpc0Zpbml0ZShhKX0sdHlwZTpmdW5jdGlvbihhKXtyZXR1cm4gYT09bnVsbD9TdHJpbmcoYSk6SVtDLmNhbGwoYSldfHwib2JqZWN0In0saXNQbGFpbk9iamVjdDpmdW5jdGlvbihhKXtpZighYXx8ZS50eXBlKGEpIT09Im9iamVjdCJ8fGEubm9kZVR5cGV8fGUuaXNXaW5kb3coYSkpcmV0dXJuITE7dHJ5e2lmKGEuY29uc3RydWN0b3ImJiFELmNhbGwoYSwiY29uc3RydWN0b3IiKSYmIUQuY2FsbChhLmNvbnN0cnVjdG9yLnByb3RvdHlwZSwiaXNQcm90b3R5cGVPZiIpKXJldHVybiExfWNhdGNoKGMpe3JldHVybiExfXZhciBkO2ZvcihkIGluIGEpO3JldHVybiBkPT09Ynx8RC5jYWxsKGEsZCl9LGlzRW1wdHlPYmplY3Q6ZnVuY3Rpb24oYSl7Zm9yKHZhciBiIGluIGEpcmV0dXJuITE7cmV0dXJuITB9LGVycm9yOmZ1bmN0aW9uKGEpe3Rocm93IG5ldyBFcnJvcihhKX0scGFyc2VKU09OOmZ1bmN0aW9uKGIpe2lmKHR5cGVvZiBiIT0ic3RyaW5nInx8IWIpcmV0dXJuIG51bGw7Yj1lLnRyaW0oYik7aWYoYS5KU09OJiZhLkpTT04ucGFyc2UpcmV0dXJuIGEuSlNPTi5wYXJzZShiKTtpZihuLnRlc3QoYi5yZXBsYWNlKG8sIkAiKS5yZXBsYWNlKHAsIl0iKS5yZXBsYWNlKHEsIiIpKSlyZXR1cm4obmV3IEZ1bmN0aW9uKCJyZXR1cm4gIitiKSkoKTtlLmVycm9yKCJJbnZhbGlkIEpTT046ICIrYil9LHBhcnNlWE1MOmZ1bmN0aW9uKGMpe2lmKHR5cGVvZiBjIT0ic3RyaW5nInx8IWMpcmV0dXJuIG51bGw7dmFyIGQsZjt0cnl7YS5ET01QYXJzZXI/KGY9bmV3IERPTVBhcnNlcixkPWYucGFyc2VGcm9tU3RyaW5nKGMsInRleHQveG1sIikpOihkPW5ldyBBY3RpdmVYT2JqZWN0KCJNaWNyb3NvZnQuWE1MRE9NIiksZC5hc3luYz0iZmFsc2UiLGQubG9hZFhNTChjKSl9Y2F0Y2goZyl7ZD1ifSghZHx8IWQuZG9jdW1lbnRFbGVtZW50fHxkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJwYXJzZXJlcnJvciIpLmxlbmd0aCkmJmUuZXJyb3IoIkludmFsaWQgWE1MOiAiK2MpO3JldHVybiBkfSxub29wOmZ1bmN0aW9uKCl7fSxnbG9iYWxFdmFsOmZ1bmN0aW9uKGIpe2ImJmoudGVzdChiKSYmKGEuZXhlY1NjcmlwdHx8ZnVuY3Rpb24oYil7YS5ldmFsLmNhbGwoYSxiKX0pKGIpfSxjYW1lbENhc2U6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSh3LCJtcy0iKS5yZXBsYWNlKHYseCl9LG5vZGVOYW1lOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGEubm9kZU5hbWUmJmEubm9kZU5hbWUudG9VcHBlckNhc2UoKT09PWIudG9VcHBlckNhc2UoKX0sZWFjaDpmdW5jdGlvbihhLGMsZCl7dmFyIGYsZz0wLGg9YS5sZW5ndGgsaT1oPT09Ynx8ZS5pc0Z1bmN0aW9uKGEpO2lmKGQpe2lmKGkpe2ZvcihmIGluIGEpaWYoYy5hcHBseShhW2ZdLGQpPT09ITEpYnJlYWt9ZWxzZSBmb3IoO2c8aDspaWYoYy5hcHBseShhW2crK10sZCk9PT0hMSlicmVha31lbHNlIGlmKGkpe2ZvcihmIGluIGEpaWYoYy5jYWxsKGFbZl0sZixhW2ZdKT09PSExKWJyZWFrfWVsc2UgZm9yKDtnPGg7KWlmKGMuY2FsbChhW2ddLGcsYVtnKytdKT09PSExKWJyZWFrO3JldHVybiBhfSx0cmltOkc/ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/IiI6Ry5jYWxsKGEpfTpmdW5jdGlvbihhKXtyZXR1cm4gYT09bnVsbD8iIjooYSsiIikucmVwbGFjZShrLCIiKS5yZXBsYWNlKGwsIiIpfSxtYWtlQXJyYXk6ZnVuY3Rpb24oYSxiKXt2YXIgYz1ifHxbXTtpZihhIT1udWxsKXt2YXIgZD1lLnR5cGUoYSk7YS5sZW5ndGg9PW51bGx8fGQ9PT0ic3RyaW5nInx8ZD09PSJmdW5jdGlvbiJ8fGQ9PT0icmVnZXhwInx8ZS5pc1dpbmRvdyhhKT9FLmNhbGwoYyxhKTplLm1lcmdlKGMsYSl9cmV0dXJuIGN9LGluQXJyYXk6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkO2lmKGIpe2lmKEgpcmV0dXJuIEguY2FsbChiLGEsYyk7ZD1iLmxlbmd0aCxjPWM/YzwwP01hdGgubWF4KDAsZCtjKTpjOjA7Zm9yKDtjPGQ7YysrKWlmKGMgaW4gYiYmYltjXT09PWEpcmV0dXJuIGN9cmV0dXJuLTF9LG1lcmdlOmZ1bmN0aW9uKGEsYyl7dmFyIGQ9YS5sZW5ndGgsZT0wO2lmKHR5cGVvZiBjLmxlbmd0aD09Im51bWJlciIpZm9yKHZhciBmPWMubGVuZ3RoO2U8ZjtlKyspYVtkKytdPWNbZV07ZWxzZSB3aGlsZShjW2VdIT09YilhW2QrK109Y1tlKytdO2EubGVuZ3RoPWQ7cmV0dXJuIGF9LGdyZXA6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPVtdLGU7Yz0hIWM7Zm9yKHZhciBmPTAsZz1hLmxlbmd0aDtmPGc7ZisrKWU9ISFiKGFbZl0sZiksYyE9PWUmJmQucHVzaChhW2ZdKTtyZXR1cm4gZH0sbWFwOmZ1bmN0aW9uKGEsYyxkKXt2YXIgZixnLGg9W10saT0wLGo9YS5sZW5ndGgsaz1hIGluc3RhbmNlb2YgZXx8aiE9PWImJnR5cGVvZiBqPT0ibnVtYmVyIiYmKGo+MCYmYVswXSYmYVtqLTFdfHxqPT09MHx8ZS5pc0FycmF5KGEpKTtpZihrKWZvcig7aTxqO2krKylmPWMoYVtpXSxpLGQpLGYhPW51bGwmJihoW2gubGVuZ3RoXT1mKTtlbHNlIGZvcihnIGluIGEpZj1jKGFbZ10sZyxkKSxmIT1udWxsJiYoaFtoLmxlbmd0aF09Zik7cmV0dXJuIGguY29uY2F0LmFwcGx5KFtdLGgpfSxndWlkOjEscHJveHk6ZnVuY3Rpb24oYSxjKXtpZih0eXBlb2YgYz09InN0cmluZyIpe3ZhciBkPWFbY107Yz1hLGE9ZH1pZighZS5pc0Z1bmN0aW9uKGEpKXJldHVybiBiO3ZhciBmPUYuY2FsbChhcmd1bWVudHMsMiksZz1mdW5jdGlvbigpe3JldHVybiBhLmFwcGx5KGMsZi5jb25jYXQoRi5jYWxsKGFyZ3VtZW50cykpKX07Zy5ndWlkPWEuZ3VpZD1hLmd1aWR8fGcuZ3VpZHx8ZS5ndWlkKys7cmV0dXJuIGd9LGFjY2VzczpmdW5jdGlvbihhLGMsZCxmLGcsaCxpKXt2YXIgaixrPWQ9PW51bGwsbD0wLG09YS5sZW5ndGg7aWYoZCYmdHlwZW9mIGQ9PSJvYmplY3QiKXtmb3IobCBpbiBkKWUuYWNjZXNzKGEsYyxsLGRbbF0sMSxoLGYpO2c9MX1lbHNlIGlmKGYhPT1iKXtqPWk9PT1iJiZlLmlzRnVuY3Rpb24oZiksayYmKGo/KGo9YyxjPWZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gai5jYWxsKGUoYSksYyl9KTooYy5jYWxsKGEsZiksYz1udWxsKSk7aWYoYylmb3IoO2w8bTtsKyspYyhhW2xdLGQsaj9mLmNhbGwoYVtsXSxsLGMoYVtsXSxkKSk6ZixpKTtnPTF9cmV0dXJuIGc/YTprP2MuY2FsbChhKTptP2MoYVswXSxkKTpofSxub3c6ZnVuY3Rpb24oKXtyZXR1cm4obmV3IERhdGUpLmdldFRpbWUoKX0sdWFNYXRjaDpmdW5jdGlvbihhKXthPWEudG9Mb3dlckNhc2UoKTt2YXIgYj1yLmV4ZWMoYSl8fHMuZXhlYyhhKXx8dC5leGVjKGEpfHxhLmluZGV4T2YoImNvbXBhdGlibGUiKTwwJiZ1LmV4ZWMoYSl8fFtdO3JldHVybnticm93c2VyOmJbMV18fCIiLHZlcnNpb246YlsyXXx8IjAifX0sc3ViOmZ1bmN0aW9uKCl7ZnVuY3Rpb24gYShiLGMpe3JldHVybiBuZXcgYS5mbi5pbml0KGIsYyl9ZS5leHRlbmQoITAsYSx0aGlzKSxhLnN1cGVyY2xhc3M9dGhpcyxhLmZuPWEucHJvdG90eXBlPXRoaXMoKSxhLmZuLmNvbnN0cnVjdG9yPWEsYS5zdWI9dGhpcy5zdWIsYS5mbi5pbml0PWZ1bmN0aW9uKGQsZil7ZiYmZiBpbnN0YW5jZW9mIGUmJiEoZiBpbnN0YW5jZW9mIGEpJiYoZj1hKGYpKTtyZXR1cm4gZS5mbi5pbml0LmNhbGwodGhpcyxkLGYsYil9LGEuZm4uaW5pdC5wcm90b3R5cGU9YS5mbjt2YXIgYj1hKGMpO3JldHVybiBhfSxicm93c2VyOnt9fSksZS5lYWNoKCJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgT2JqZWN0Ii5zcGxpdCgiICIpLGZ1bmN0aW9uKGEsYil7SVsiW29iamVjdCAiK2IrIl0iXT1iLnRvTG93ZXJDYXNlKCl9KSx6PWUudWFNYXRjaCh5KSx6LmJyb3dzZXImJihlLmJyb3dzZXJbei5icm93c2VyXT0hMCxlLmJyb3dzZXIudmVyc2lvbj16LnZlcnNpb24pLGUuYnJvd3Nlci53ZWJraXQmJihlLmJyb3dzZXIuc2FmYXJpPSEwKSxqLnRlc3QoIsKgIikmJihrPS9eW1xzXHhBMF0rLyxsPS9bXHNceEEwXSskLyksaD1lKGMpLGMuYWRkRXZlbnRMaXN0ZW5lcj9CPWZ1bmN0aW9uKCl7Yy5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIixCLCExKSxlLnJlYWR5KCl9OmMuYXR0YWNoRXZlbnQmJihCPWZ1bmN0aW9uKCl7Yy5yZWFkeVN0YXRlPT09ImNvbXBsZXRlIiYmKGMuZGV0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsQiksZS5yZWFkeSgpKX0pO3JldHVybiBlfSgpLGc9e307Zi5DYWxsYmFja3M9ZnVuY3Rpb24oYSl7YT1hP2dbYV18fGgoYSk6e307dmFyIGM9W10sZD1bXSxlLGksaixrLGwsbSxuPWZ1bmN0aW9uKGIpe3ZhciBkLGUsZyxoLGk7Zm9yKGQ9MCxlPWIubGVuZ3RoO2Q8ZTtkKyspZz1iW2RdLGg9Zi50eXBlKGcpLGg9PT0iYXJyYXkiP24oZyk6aD09PSJmdW5jdGlvbiImJighYS51bmlxdWV8fCFwLmhhcyhnKSkmJmMucHVzaChnKX0sbz1mdW5jdGlvbihiLGYpe2Y9Znx8W10sZT0hYS5tZW1vcnl8fFtiLGZdLGk9ITAsaj0hMCxtPWt8fDAsaz0wLGw9Yy5sZW5ndGg7Zm9yKDtjJiZtPGw7bSsrKWlmKGNbbV0uYXBwbHkoYixmKT09PSExJiZhLnN0b3BPbkZhbHNlKXtlPSEwO2JyZWFrfWo9ITEsYyYmKGEub25jZT9lPT09ITA/cC5kaXNhYmxlKCk6Yz1bXTpkJiZkLmxlbmd0aCYmKGU9ZC5zaGlmdCgpLHAuZmlyZVdpdGgoZVswXSxlWzFdKSkpfSxwPXthZGQ6ZnVuY3Rpb24oKXtpZihjKXt2YXIgYT1jLmxlbmd0aDtuKGFyZ3VtZW50cyksaj9sPWMubGVuZ3RoOmUmJmUhPT0hMCYmKGs9YSxvKGVbMF0sZVsxXSkpfXJldHVybiB0aGlzfSxyZW1vdmU6ZnVuY3Rpb24oKXtpZihjKXt2YXIgYj1hcmd1bWVudHMsZD0wLGU9Yi5sZW5ndGg7Zm9yKDtkPGU7ZCsrKWZvcih2YXIgZj0wO2Y8Yy5sZW5ndGg7ZisrKWlmKGJbZF09PT1jW2ZdKXtqJiZmPD1sJiYobC0tLGY8PW0mJm0tLSksYy5zcGxpY2UoZi0tLDEpO2lmKGEudW5pcXVlKWJyZWFrfX1yZXR1cm4gdGhpc30saGFzOmZ1bmN0aW9uKGEpe2lmKGMpe3ZhciBiPTAsZD1jLmxlbmd0aDtmb3IoO2I8ZDtiKyspaWYoYT09PWNbYl0pcmV0dXJuITB9cmV0dXJuITF9LGVtcHR5OmZ1bmN0aW9uKCl7Yz1bXTtyZXR1cm4gdGhpc30sZGlzYWJsZTpmdW5jdGlvbigpe2M9ZD1lPWI7cmV0dXJuIHRoaXN9LGRpc2FibGVkOmZ1bmN0aW9uKCl7cmV0dXJuIWN9LGxvY2s6ZnVuY3Rpb24oKXtkPWIsKCFlfHxlPT09ITApJiZwLmRpc2FibGUoKTtyZXR1cm4gdGhpc30sbG9ja2VkOmZ1bmN0aW9uKCl7cmV0dXJuIWR9LGZpcmVXaXRoOmZ1bmN0aW9uKGIsYyl7ZCYmKGo/YS5vbmNlfHxkLnB1c2goW2IsY10pOighYS5vbmNlfHwhZSkmJm8oYixjKSk7cmV0dXJuIHRoaXN9LGZpcmU6ZnVuY3Rpb24oKXtwLmZpcmVXaXRoKHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gdGhpc30sZmlyZWQ6ZnVuY3Rpb24oKXtyZXR1cm4hIWl9fTtyZXR1cm4gcH07dmFyIGk9W10uc2xpY2U7Zi5leHRlbmQoe0RlZmVycmVkOmZ1bmN0aW9uKGEpe3ZhciBiPWYuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLGM9Zi5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksZD1mLkNhbGxiYWNrcygibWVtb3J5IiksZT0icGVuZGluZyIsZz17cmVzb2x2ZTpiLHJlamVjdDpjLG5vdGlmeTpkfSxoPXtkb25lOmIuYWRkLGZhaWw6Yy5hZGQscHJvZ3Jlc3M6ZC5hZGQsc3RhdGU6ZnVuY3Rpb24oKXtyZXR1cm4gZX0saXNSZXNvbHZlZDpiLmZpcmVkLGlzUmVqZWN0ZWQ6Yy5maXJlZCx0aGVuOmZ1bmN0aW9uKGEsYixjKXtpLmRvbmUoYSkuZmFpbChiKS5wcm9ncmVzcyhjKTtyZXR1cm4gdGhpc30sYWx3YXlzOmZ1bmN0aW9uKCl7aS5kb25lLmFwcGx5KGksYXJndW1lbnRzKS5mYWlsLmFwcGx5KGksYXJndW1lbnRzKTtyZXR1cm4gdGhpc30scGlwZTpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuRGVmZXJyZWQoZnVuY3Rpb24oZCl7Zi5lYWNoKHtkb25lOlthLCJyZXNvbHZlIl0sZmFpbDpbYiwicmVqZWN0Il0scHJvZ3Jlc3M6W2MsIm5vdGlmeSJdfSxmdW5jdGlvbihhLGIpe3ZhciBjPWJbMF0sZT1iWzFdLGc7Zi5pc0Z1bmN0aW9uKGMpP2lbYV0oZnVuY3Rpb24oKXtnPWMuYXBwbHkodGhpcyxhcmd1bWVudHMpLGcmJmYuaXNGdW5jdGlvbihnLnByb21pc2UpP2cucHJvbWlzZSgpLnRoZW4oZC5yZXNvbHZlLGQucmVqZWN0LGQubm90aWZ5KTpkW2UrIldpdGgiXSh0aGlzPT09aT9kOnRoaXMsW2ddKX0pOmlbYV0oZFtlXSl9KX0pLnByb21pc2UoKX0scHJvbWlzZTpmdW5jdGlvbihhKXtpZihhPT1udWxsKWE9aDtlbHNlIGZvcih2YXIgYiBpbiBoKWFbYl09aFtiXTtyZXR1cm4gYX19LGk9aC5wcm9taXNlKHt9KSxqO2ZvcihqIGluIGcpaVtqXT1nW2pdLmZpcmUsaVtqKyJXaXRoIl09Z1tqXS5maXJlV2l0aDtpLmRvbmUoZnVuY3Rpb24oKXtlPSJyZXNvbHZlZCJ9LGMuZGlzYWJsZSxkLmxvY2spLmZhaWwoZnVuY3Rpb24oKXtlPSJyZWplY3RlZCJ9LGIuZGlzYWJsZSxkLmxvY2spLGEmJmEuY2FsbChpLGkpO3JldHVybiBpfSx3aGVuOmZ1bmN0aW9uKGEpe2Z1bmN0aW9uIG0oYSl7cmV0dXJuIGZ1bmN0aW9uKGIpe2VbYV09YXJndW1lbnRzLmxlbmd0aD4xP2kuY2FsbChhcmd1bWVudHMsMCk6YixqLm5vdGlmeVdpdGgoayxlKX19ZnVuY3Rpb24gbChhKXtyZXR1cm4gZnVuY3Rpb24oYyl7YlthXT1hcmd1bWVudHMubGVuZ3RoPjE/aS5jYWxsKGFyZ3VtZW50cywwKTpjLC0tZ3x8ai5yZXNvbHZlV2l0aChqLGIpfX12YXIgYj1pLmNhbGwoYXJndW1lbnRzLDApLGM9MCxkPWIubGVuZ3RoLGU9QXJyYXkoZCksZz1kLGg9ZCxqPWQ8PTEmJmEmJmYuaXNGdW5jdGlvbihhLnByb21pc2UpP2E6Zi5EZWZlcnJlZCgpLGs9ai5wcm9taXNlKCk7aWYoZD4xKXtmb3IoO2M8ZDtjKyspYltjXSYmYltjXS5wcm9taXNlJiZmLmlzRnVuY3Rpb24oYltjXS5wcm9taXNlKT9iW2NdLnByb21pc2UoKS50aGVuKGwoYyksai5yZWplY3QsbShjKSk6LS1nO2d8fGoucmVzb2x2ZVdpdGgoaixiKX1lbHNlIGohPT1hJiZqLnJlc29sdmVXaXRoKGosZD9bYV06W10pO3JldHVybiBrfX0pLGYuc3VwcG9ydD1mdW5jdGlvbigpe3ZhciBiLGQsZSxnLGgsaSxqLGssbCxtLG4sbyxwPWMuY3JlYXRlRWxlbWVudCgiZGl2IikscT1jLmRvY3VtZW50RWxlbWVudDtwLnNldEF0dHJpYnV0ZSgiY2xhc3NOYW1lIiwidCIpLHAuaW5uZXJIVE1MPSIgICA8bGluay8+PHRhYmxlPjwvdGFibGU+PGEgaHJlZj0nL2EnIHN0eWxlPSd0b3A6MXB4O2Zsb2F0OmxlZnQ7b3BhY2l0eTouNTU7Jz5hPC9hPjxpbnB1dCB0eXBlPSdjaGVja2JveCcvPiIsZD1wLmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIiksZT1wLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJhIilbMF07aWYoIWR8fCFkLmxlbmd0aHx8IWUpcmV0dXJue307Zz1jLmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpLGg9Zy5hcHBlbmRDaGlsZChjLmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpKSxpPXAuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImlucHV0IilbMF0sYj17bGVhZGluZ1doaXRlc3BhY2U6cC5maXJzdENoaWxkLm5vZGVUeXBlPT09Myx0Ym9keTohcC5nZXRFbGVtZW50c0J5VGFnTmFtZSgidGJvZHkiKS5sZW5ndGgsaHRtbFNlcmlhbGl6ZTohIXAuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImxpbmsiKS5sZW5ndGgsc3R5bGU6L3RvcC8udGVzdChlLmdldEF0dHJpYnV0ZSgic3R5bGUiKSksaHJlZk5vcm1hbGl6ZWQ6ZS5nZXRBdHRyaWJ1dGUoImhyZWYiKT09PSIvYSIsb3BhY2l0eTovXjAuNTUvLnRlc3QoZS5zdHlsZS5vcGFjaXR5KSxjc3NGbG9hdDohIWUuc3R5bGUuY3NzRmxvYXQsY2hlY2tPbjppLnZhbHVlPT09Im9uIixvcHRTZWxlY3RlZDpoLnNlbGVjdGVkLGdldFNldEF0dHJpYnV0ZTpwLmNsYXNzTmFtZSE9PSJ0IixlbmN0eXBlOiEhYy5jcmVhdGVFbGVtZW50KCJmb3JtIikuZW5jdHlwZSxodG1sNUNsb25lOmMuY3JlYXRlRWxlbWVudCgibmF2IikuY2xvbmVOb2RlKCEwKS5vdXRlckhUTUwhPT0iPDpuYXY+PC86bmF2PiIsc3VibWl0QnViYmxlczohMCxjaGFuZ2VCdWJibGVzOiEwLGZvY3VzaW5CdWJibGVzOiExLGRlbGV0ZUV4cGFuZG86ITAsbm9DbG9uZUV2ZW50OiEwLGlubGluZUJsb2NrTmVlZHNMYXlvdXQ6ITEsc2hyaW5rV3JhcEJsb2NrczohMSxyZWxpYWJsZU1hcmdpblJpZ2h0OiEwLHBpeGVsTWFyZ2luOiEwfSxmLmJveE1vZGVsPWIuYm94TW9kZWw9Yy5jb21wYXRNb2RlPT09IkNTUzFDb21wYXQiLGkuY2hlY2tlZD0hMCxiLm5vQ2xvbmVDaGVja2VkPWkuY2xvbmVOb2RlKCEwKS5jaGVja2VkLGcuZGlzYWJsZWQ9ITAsYi5vcHREaXNhYmxlZD0haC5kaXNhYmxlZDt0cnl7ZGVsZXRlIHAudGVzdH1jYXRjaChyKXtiLmRlbGV0ZUV4cGFuZG89ITF9IXAuYWRkRXZlbnRMaXN0ZW5lciYmcC5hdHRhY2hFdmVudCYmcC5maXJlRXZlbnQmJihwLmF0dGFjaEV2ZW50KCJvbmNsaWNrIixmdW5jdGlvbigpe2Iubm9DbG9uZUV2ZW50PSExfSkscC5jbG9uZU5vZGUoITApLmZpcmVFdmVudCgib25jbGljayIpKSxpPWMuY3JlYXRlRWxlbWVudCgiaW5wdXQiKSxpLnZhbHVlPSJ0IixpLnNldEF0dHJpYnV0ZSgidHlwZSIsInJhZGlvIiksYi5yYWRpb1ZhbHVlPWkudmFsdWU9PT0idCIsaS5zZXRBdHRyaWJ1dGUoImNoZWNrZWQiLCJjaGVja2VkIiksaS5zZXRBdHRyaWJ1dGUoIm5hbWUiLCJ0IikscC5hcHBlbmRDaGlsZChpKSxqPWMuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLGouYXBwZW5kQ2hpbGQocC5sYXN0Q2hpbGQpLGIuY2hlY2tDbG9uZT1qLmNsb25lTm9kZSghMCkuY2xvbmVOb2RlKCEwKS5sYXN0Q2hpbGQuY2hlY2tlZCxiLmFwcGVuZENoZWNrZWQ9aS5jaGVja2VkLGoucmVtb3ZlQ2hpbGQoaSksai5hcHBlbmRDaGlsZChwKTtpZihwLmF0dGFjaEV2ZW50KWZvcihuIGlue3N1Ym1pdDoxLGNoYW5nZToxLGZvY3VzaW46MX0pbT0ib24iK24sbz1tIGluIHAsb3x8KHAuc2V0QXR0cmlidXRlKG0sInJldHVybjsiKSxvPXR5cGVvZiBwW21dPT0iZnVuY3Rpb24iKSxiW24rIkJ1YmJsZXMiXT1vO2oucmVtb3ZlQ2hpbGQocCksaj1nPWg9cD1pPW51bGwsZihmdW5jdGlvbigpe3ZhciBkLGUsZyxoLGksaixsLG0sbixxLHIscyx0LHU9Yy5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdOyF1fHwobT0xLHQ9InBhZGRpbmc6MDttYXJnaW46MDtib3JkZXI6IixyPSJwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7d2lkdGg6MXB4O2hlaWdodDoxcHg7IixzPXQrIjA7dmlzaWJpbGl0eTpoaWRkZW47IixuPSJzdHlsZT0nIityK3QrIjVweCBzb2xpZCAjMDAwOyIscT0iPGRpdiAiK24rImRpc3BsYXk6YmxvY2s7Jz48ZGl2IHN0eWxlPSciK3QrIjA7ZGlzcGxheTpibG9jaztvdmVyZmxvdzpoaWRkZW47Jz48L2Rpdj48L2Rpdj4iKyI8dGFibGUgIituKyInIGNlbGxwYWRkaW5nPScwJyBjZWxsc3BhY2luZz0nMCc+IisiPHRyPjx0ZD48L3RkPjwvdHI+PC90YWJsZT4iLGQ9Yy5jcmVhdGVFbGVtZW50KCJkaXYiKSxkLnN0eWxlLmNzc1RleHQ9cysid2lkdGg6MDtoZWlnaHQ6MDtwb3NpdGlvbjpzdGF0aWM7dG9wOjA7bWFyZ2luLXRvcDoiK20rInB4Iix1Lmluc2VydEJlZm9yZShkLHUuZmlyc3RDaGlsZCkscD1jLmNyZWF0ZUVsZW1lbnQoImRpdiIpLGQuYXBwZW5kQ2hpbGQocCkscC5pbm5lckhUTUw9Ijx0YWJsZT48dHI+PHRkIHN0eWxlPSciK3QrIjA7ZGlzcGxheTpub25lJz48L3RkPjx0ZD50PC90ZD48L3RyPjwvdGFibGU+IixrPXAuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRkIiksbz1rWzBdLm9mZnNldEhlaWdodD09PTAsa1swXS5zdHlsZS5kaXNwbGF5PSIiLGtbMV0uc3R5bGUuZGlzcGxheT0ibm9uZSIsYi5yZWxpYWJsZUhpZGRlbk9mZnNldHM9byYma1swXS5vZmZzZXRIZWlnaHQ9PT0wLGEuZ2V0Q29tcHV0ZWRTdHlsZSYmKHAuaW5uZXJIVE1MPSIiLGw9Yy5jcmVhdGVFbGVtZW50KCJkaXYiKSxsLnN0eWxlLndpZHRoPSIwIixsLnN0eWxlLm1hcmdpblJpZ2h0PSIwIixwLnN0eWxlLndpZHRoPSIycHgiLHAuYXBwZW5kQ2hpbGQobCksYi5yZWxpYWJsZU1hcmdpblJpZ2h0PShwYXJzZUludCgoYS5nZXRDb21wdXRlZFN0eWxlKGwsbnVsbCl8fHttYXJnaW5SaWdodDowfSkubWFyZ2luUmlnaHQsMTApfHwwKT09PTApLHR5cGVvZiBwLnN0eWxlLnpvb20hPSJ1bmRlZmluZWQiJiYocC5pbm5lckhUTUw9IiIscC5zdHlsZS53aWR0aD1wLnN0eWxlLnBhZGRpbmc9IjFweCIscC5zdHlsZS5ib3JkZXI9MCxwLnN0eWxlLm92ZXJmbG93PSJoaWRkZW4iLHAuc3R5bGUuZGlzcGxheT0iaW5saW5lIixwLnN0eWxlLnpvb209MSxiLmlubGluZUJsb2NrTmVlZHNMYXlvdXQ9cC5vZmZzZXRXaWR0aD09PTMscC5zdHlsZS5kaXNwbGF5PSJibG9jayIscC5zdHlsZS5vdmVyZmxvdz0idmlzaWJsZSIscC5pbm5lckhUTUw9IjxkaXYgc3R5bGU9J3dpZHRoOjVweDsnPjwvZGl2PiIsYi5zaHJpbmtXcmFwQmxvY2tzPXAub2Zmc2V0V2lkdGghPT0zKSxwLnN0eWxlLmNzc1RleHQ9citzLHAuaW5uZXJIVE1MPXEsZT1wLmZpcnN0Q2hpbGQsZz1lLmZpcnN0Q2hpbGQsaT1lLm5leHRTaWJsaW5nLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZCxqPXtkb2VzTm90QWRkQm9yZGVyOmcub2Zmc2V0VG9wIT09NSxkb2VzQWRkQm9yZGVyRm9yVGFibGVBbmRDZWxsczppLm9mZnNldFRvcD09PTV9LGcuc3R5bGUucG9zaXRpb249ImZpeGVkIixnLnN0eWxlLnRvcD0iMjBweCIsai5maXhlZFBvc2l0aW9uPWcub2Zmc2V0VG9wPT09MjB8fGcub2Zmc2V0VG9wPT09MTUsZy5zdHlsZS5wb3NpdGlvbj1nLnN0eWxlLnRvcD0iIixlLnN0eWxlLm92ZXJmbG93PSJoaWRkZW4iLGUuc3R5bGUucG9zaXRpb249InJlbGF0aXZlIixqLnN1YnRyYWN0c0JvcmRlckZvck92ZXJmbG93Tm90VmlzaWJsZT1nLm9mZnNldFRvcD09PS01LGouZG9lc05vdEluY2x1ZGVNYXJnaW5JbkJvZHlPZmZzZXQ9dS5vZmZzZXRUb3AhPT1tLGEuZ2V0Q29tcHV0ZWRTdHlsZSYmKHAuc3R5bGUubWFyZ2luVG9wPSIxJSIsYi5waXhlbE1hcmdpbj0oYS5nZXRDb21wdXRlZFN0eWxlKHAsbnVsbCl8fHttYXJnaW5Ub3A6MH0pLm1hcmdpblRvcCE9PSIxJSIpLHR5cGVvZiBkLnN0eWxlLnpvb20hPSJ1bmRlZmluZWQiJiYoZC5zdHlsZS56b29tPTEpLHUucmVtb3ZlQ2hpbGQoZCksbD1wPWQ9bnVsbCxmLmV4dGVuZChiLGopKX0pO3JldHVybiBifSgpO3ZhciBqPS9eKD86XHsuKlx9fFxbLipcXSkkLyxrPS8oW0EtWl0pL2c7Zi5leHRlbmQoe2NhY2hlOnt9LHV1aWQ6MCxleHBhbmRvOiJqUXVlcnkiKyhmLmZuLmpxdWVyeStNYXRoLnJhbmRvbSgpKS5yZXBsYWNlKC9cRC9nLCIiKSxub0RhdGE6e2VtYmVkOiEwLG9iamVjdDoiY2xzaWQ6RDI3Q0RCNkUtQUU2RC0xMWNmLTk2QjgtNDQ0NTUzNTQwMDAwIixhcHBsZXQ6ITB9LGhhc0RhdGE6ZnVuY3Rpb24oYSl7YT1hLm5vZGVUeXBlP2YuY2FjaGVbYVtmLmV4cGFuZG9dXTphW2YuZXhwYW5kb107cmV0dXJuISFhJiYhbShhKX0sZGF0YTpmdW5jdGlvbihhLGMsZCxlKXtpZighIWYuYWNjZXB0RGF0YShhKSl7dmFyIGcsaCxpLGo9Zi5leHBhbmRvLGs9dHlwZW9mIGM9PSJzdHJpbmciLGw9YS5ub2RlVHlwZSxtPWw/Zi5jYWNoZTphLG49bD9hW2pdOmFbal0mJmosbz1jPT09ImV2ZW50cyI7aWYoKCFufHwhbVtuXXx8IW8mJiFlJiYhbVtuXS5kYXRhKSYmayYmZD09PWIpcmV0dXJuO258fChsP2Fbal09bj0rK2YudXVpZDpuPWopLG1bbl18fChtW25dPXt9LGx8fChtW25dLnRvSlNPTj1mLm5vb3ApKTtpZih0eXBlb2YgYz09Im9iamVjdCJ8fHR5cGVvZiBjPT0iZnVuY3Rpb24iKWU/bVtuXT1mLmV4dGVuZChtW25dLGMpOm1bbl0uZGF0YT1mLmV4dGVuZChtW25dLmRhdGEsYyk7Zz1oPW1bbl0sZXx8KGguZGF0YXx8KGguZGF0YT17fSksaD1oLmRhdGEpLGQhPT1iJiYoaFtmLmNhbWVsQ2FzZShjKV09ZCk7aWYobyYmIWhbY10pcmV0dXJuIGcuZXZlbnRzO2s/KGk9aFtjXSxpPT1udWxsJiYoaT1oW2YuY2FtZWxDYXNlKGMpXSkpOmk9aDtyZXR1cm4gaX19LHJlbW92ZURhdGE6ZnVuY3Rpb24oYSxiLGMpe2lmKCEhZi5hY2NlcHREYXRhKGEpKXt2YXIgZCxlLGcsaD1mLmV4cGFuZG8saT1hLm5vZGVUeXBlLGo9aT9mLmNhY2hlOmEsaz1pP2FbaF06aDtpZighaltrXSlyZXR1cm47aWYoYil7ZD1jP2pba106altrXS5kYXRhO2lmKGQpe2YuaXNBcnJheShiKXx8KGIgaW4gZD9iPVtiXTooYj1mLmNhbWVsQ2FzZShiKSxiIGluIGQ/Yj1bYl06Yj1iLnNwbGl0KCIgIikpKTtmb3IoZT0wLGc9Yi5sZW5ndGg7ZTxnO2UrKylkZWxldGUgZFtiW2VdXTtpZighKGM/bTpmLmlzRW1wdHlPYmplY3QpKGQpKXJldHVybn19aWYoIWMpe2RlbGV0ZSBqW2tdLmRhdGE7aWYoIW0oaltrXSkpcmV0dXJufWYuc3VwcG9ydC5kZWxldGVFeHBhbmRvfHwhai5zZXRJbnRlcnZhbD9kZWxldGUgaltrXTpqW2tdPW51bGwsaSYmKGYuc3VwcG9ydC5kZWxldGVFeHBhbmRvP2RlbGV0ZSBhW2hdOmEucmVtb3ZlQXR0cmlidXRlP2EucmVtb3ZlQXR0cmlidXRlKGgpOmFbaF09bnVsbCl9fSxfZGF0YTpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuZGF0YShhLGIsYywhMCl9LGFjY2VwdERhdGE6ZnVuY3Rpb24oYSl7aWYoYS5ub2RlTmFtZSl7dmFyIGI9Zi5ub0RhdGFbYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXTtpZihiKXJldHVybiBiIT09ITAmJmEuZ2V0QXR0cmlidXRlKCJjbGFzc2lkIik9PT1ifXJldHVybiEwfX0pLGYuZm4uZXh0ZW5kKHtkYXRhOmZ1bmN0aW9uKGEsYyl7dmFyIGQsZSxnLGgsaSxqPXRoaXNbMF0saz0wLG09bnVsbDtpZihhPT09Yil7aWYodGhpcy5sZW5ndGgpe209Zi5kYXRhKGopO2lmKGoubm9kZVR5cGU9PT0xJiYhZi5fZGF0YShqLCJwYXJzZWRBdHRycyIpKXtnPWouYXR0cmlidXRlcztmb3IoaT1nLmxlbmd0aDtrPGk7aysrKWg9Z1trXS5uYW1lLGguaW5kZXhPZigiZGF0YS0iKT09PTAmJihoPWYuY2FtZWxDYXNlKGguc3Vic3RyaW5nKDUpKSxsKGosaCxtW2hdKSk7Zi5fZGF0YShqLCJwYXJzZWRBdHRycyIsITApfX1yZXR1cm4gbX1pZih0eXBlb2YgYT09Im9iamVjdCIpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2YuZGF0YSh0aGlzLGEpfSk7ZD1hLnNwbGl0KCIuIiwyKSxkWzFdPWRbMV0/Ii4iK2RbMV06IiIsZT1kWzFdKyIhIjtyZXR1cm4gZi5hY2Nlc3ModGhpcyxmdW5jdGlvbihjKXtpZihjPT09Yil7bT10aGlzLnRyaWdnZXJIYW5kbGVyKCJnZXREYXRhIitlLFtkWzBdXSksbT09PWImJmomJihtPWYuZGF0YShqLGEpLG09bChqLGEsbSkpO3JldHVybiBtPT09YiYmZFsxXT90aGlzLmRhdGEoZFswXSk6bX1kWzFdPWMsdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9Zih0aGlzKTtiLnRyaWdnZXJIYW5kbGVyKCJzZXREYXRhIitlLGQpLGYuZGF0YSh0aGlzLGEsYyksYi50cmlnZ2VySGFuZGxlcigiY2hhbmdlRGF0YSIrZSxkKX0pfSxudWxsLGMsYXJndW1lbnRzLmxlbmd0aD4xLG51bGwsITEpfSxyZW1vdmVEYXRhOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLnJlbW92ZURhdGEodGhpcyxhKX0pfX0pLGYuZXh0ZW5kKHtfbWFyazpmdW5jdGlvbihhLGIpe2EmJihiPShifHwiZngiKSsibWFyayIsZi5fZGF0YShhLGIsKGYuX2RhdGEoYSxiKXx8MCkrMSkpfSxfdW5tYXJrOmZ1bmN0aW9uKGEsYixjKXthIT09ITAmJihjPWIsYj1hLGE9ITEpO2lmKGIpe2M9Y3x8ImZ4Ijt2YXIgZD1jKyJtYXJrIixlPWE/MDooZi5fZGF0YShiLGQpfHwxKS0xO2U/Zi5fZGF0YShiLGQsZSk6KGYucmVtb3ZlRGF0YShiLGQsITApLG4oYixjLCJtYXJrIikpfX0scXVldWU6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkO2lmKGEpe2I9KGJ8fCJmeCIpKyJxdWV1ZSIsZD1mLl9kYXRhKGEsYiksYyYmKCFkfHxmLmlzQXJyYXkoYyk/ZD1mLl9kYXRhKGEsYixmLm1ha2VBcnJheShjKSk6ZC5wdXNoKGMpKTtyZXR1cm4gZHx8W119fSxkZXF1ZXVlOmZ1bmN0aW9uKGEsYil7Yj1ifHwiZngiO3ZhciBjPWYucXVldWUoYSxiKSxkPWMuc2hpZnQoKSxlPXt9O2Q9PT0iaW5wcm9ncmVzcyImJihkPWMuc2hpZnQoKSksZCYmKGI9PT0iZngiJiZjLnVuc2hpZnQoImlucHJvZ3Jlc3MiKSxmLl9kYXRhKGEsYisiLnJ1biIsZSksZC5jYWxsKGEsZnVuY3Rpb24oKXtmLmRlcXVldWUoYSxiKX0sZSkpLGMubGVuZ3RofHwoZi5yZW1vdmVEYXRhKGEsYisicXVldWUgIitiKyIucnVuIiwhMCksbihhLGIsInF1ZXVlIikpfX0pLGYuZm4uZXh0ZW5kKHtxdWV1ZTpmdW5jdGlvbihhLGMpe3ZhciBkPTI7dHlwZW9mIGEhPSJzdHJpbmciJiYoYz1hLGE9ImZ4IixkLS0pO2lmKGFyZ3VtZW50cy5sZW5ndGg8ZClyZXR1cm4gZi5xdWV1ZSh0aGlzWzBdLGEpO3JldHVybiBjPT09Yj90aGlzOnRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPWYucXVldWUodGhpcyxhLGMpO2E9PT0iZngiJiZiWzBdIT09ImlucHJvZ3Jlc3MiJiZmLmRlcXVldWUodGhpcyxhKX0pfSxkZXF1ZXVlOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLmRlcXVldWUodGhpcyxhKX0pfSxkZWxheTpmdW5jdGlvbihhLGIpe2E9Zi5meD9mLmZ4LnNwZWVkc1thXXx8YTphLGI9Ynx8ImZ4IjtyZXR1cm4gdGhpcy5xdWV1ZShiLGZ1bmN0aW9uKGIsYyl7dmFyIGQ9c2V0VGltZW91dChiLGEpO2Muc3RvcD1mdW5jdGlvbigpe2NsZWFyVGltZW91dChkKX19KX0sY2xlYXJRdWV1ZTpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5xdWV1ZShhfHwiZngiLFtdKX0scHJvbWlzZTpmdW5jdGlvbihhLGMpe2Z1bmN0aW9uIG0oKXstLWh8fGQucmVzb2x2ZVdpdGgoZSxbZV0pfXR5cGVvZiBhIT0ic3RyaW5nIiYmKGM9YSxhPWIpLGE9YXx8ImZ4Ijt2YXIgZD1mLkRlZmVycmVkKCksZT10aGlzLGc9ZS5sZW5ndGgsaD0xLGk9YSsiZGVmZXIiLGo9YSsicXVldWUiLGs9YSsibWFyayIsbDt3aGlsZShnLS0paWYobD1mLmRhdGEoZVtnXSxpLGIsITApfHwoZi5kYXRhKGVbZ10saixiLCEwKXx8Zi5kYXRhKGVbZ10sayxiLCEwKSkmJmYuZGF0YShlW2ddLGksZi5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksITApKWgrKyxsLmFkZChtKTttKCk7cmV0dXJuIGQucHJvbWlzZShjKX19KTt2YXIgbz0vW1xuXHRccl0vZyxwPS9ccysvLHE9L1xyL2cscj0vXig/OmJ1dHRvbnxpbnB1dCkkL2kscz0vXig/OmJ1dHRvbnxpbnB1dHxvYmplY3R8c2VsZWN0fHRleHRhcmVhKSQvaSx0PS9eYSg/OnJlYSk/JC9pLHU9L14oPzphdXRvZm9jdXN8YXV0b3BsYXl8YXN5bmN8Y2hlY2tlZHxjb250cm9sc3xkZWZlcnxkaXNhYmxlZHxoaWRkZW58bG9vcHxtdWx0aXBsZXxvcGVufHJlYWRvbmx5fHJlcXVpcmVkfHNjb3BlZHxzZWxlY3RlZCkkL2ksdj1mLnN1cHBvcnQuZ2V0U2V0QXR0cmlidXRlLHcseCx5O2YuZm4uZXh0ZW5kKHthdHRyOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGYuYWNjZXNzKHRoaXMsZi5hdHRyLGEsYixhcmd1bWVudHMubGVuZ3RoPjEpfSxyZW1vdmVBdHRyOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLnJlbW92ZUF0dHIodGhpcyxhKX0pfSxwcm9wOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGYuYWNjZXNzKHRoaXMsZi5wcm9wLGEsYixhcmd1bWVudHMubGVuZ3RoPjEpfSxyZW1vdmVQcm9wOmZ1bmN0aW9uKGEpe2E9Zi5wcm9wRml4W2FdfHxhO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt0cnl7dGhpc1thXT1iLGRlbGV0ZSB0aGlzW2FdfWNhdGNoKGMpe319KX0sYWRkQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGIsYyxkLGUsZyxoLGk7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zih0aGlzKS5hZGRDbGFzcyhhLmNhbGwodGhpcyxiLHRoaXMuY2xhc3NOYW1lKSl9KTtpZihhJiZ0eXBlb2YgYT09InN0cmluZyIpe2I9YS5zcGxpdChwKTtmb3IoYz0wLGQ9dGhpcy5sZW5ndGg7YzxkO2MrKyl7ZT10aGlzW2NdO2lmKGUubm9kZVR5cGU9PT0xKWlmKCFlLmNsYXNzTmFtZSYmYi5sZW5ndGg9PT0xKWUuY2xhc3NOYW1lPWE7ZWxzZXtnPSIgIitlLmNsYXNzTmFtZSsiICI7Zm9yKGg9MCxpPWIubGVuZ3RoO2g8aTtoKyspfmcuaW5kZXhPZigiICIrYltoXSsiICIpfHwoZys9YltoXSsiICIpO2UuY2xhc3NOYW1lPWYudHJpbShnKX19fXJldHVybiB0aGlzfSxyZW1vdmVDbGFzczpmdW5jdGlvbihhKXt2YXIgYyxkLGUsZyxoLGksajtpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXtmKHRoaXMpLnJlbW92ZUNsYXNzKGEuY2FsbCh0aGlzLGIsdGhpcy5jbGFzc05hbWUpKX0pO2lmKGEmJnR5cGVvZiBhPT0ic3RyaW5nInx8YT09PWIpe2M9KGF8fCIiKS5zcGxpdChwKTtmb3IoZD0wLGU9dGhpcy5sZW5ndGg7ZDxlO2QrKyl7Zz10aGlzW2RdO2lmKGcubm9kZVR5cGU9PT0xJiZnLmNsYXNzTmFtZSlpZihhKXtoPSgiICIrZy5jbGFzc05hbWUrIiAiKS5yZXBsYWNlKG8sIiAiKTtmb3IoaT0wLGo9Yy5sZW5ndGg7aTxqO2krKyloPWgucmVwbGFjZSgiICIrY1tpXSsiICIsIiAiKTtnLmNsYXNzTmFtZT1mLnRyaW0oaCl9ZWxzZSBnLmNsYXNzTmFtZT0iIn19cmV0dXJuIHRoaXN9LHRvZ2dsZUNsYXNzOmZ1bmN0aW9uKGEsYil7dmFyIGM9dHlwZW9mIGEsZD10eXBlb2YgYj09ImJvb2xlYW4iO2lmKGYuaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGMpe2YodGhpcykudG9nZ2xlQ2xhc3MoYS5jYWxsKHRoaXMsYyx0aGlzLmNsYXNzTmFtZSxiKSxiKX0pO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtpZihjPT09InN0cmluZyIpe3ZhciBlLGc9MCxoPWYodGhpcyksaT1iLGo9YS5zcGxpdChwKTt3aGlsZShlPWpbZysrXSlpPWQ/aTohaC5oYXNDbGFzcyhlKSxoW2k/ImFkZENsYXNzIjoicmVtb3ZlQ2xhc3MiXShlKX1lbHNlIGlmKGM9PT0idW5kZWZpbmVkInx8Yz09PSJib29sZWFuIil0aGlzLmNsYXNzTmFtZSYmZi5fZGF0YSh0aGlzLCJfX2NsYXNzTmFtZV9fIix0aGlzLmNsYXNzTmFtZSksdGhpcy5jbGFzc05hbWU9dGhpcy5jbGFzc05hbWV8fGE9PT0hMT8iIjpmLl9kYXRhKHRoaXMsIl9fY2xhc3NOYW1lX18iKXx8IiJ9KX0saGFzQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGI9IiAiK2ErIiAiLGM9MCxkPXRoaXMubGVuZ3RoO2Zvcig7YzxkO2MrKylpZih0aGlzW2NdLm5vZGVUeXBlPT09MSYmKCIgIit0aGlzW2NdLmNsYXNzTmFtZSsiICIpLnJlcGxhY2UobywiICIpLmluZGV4T2YoYik+LTEpcmV0dXJuITA7cmV0dXJuITF9LHZhbDpmdW5jdGlvbihhKXt2YXIgYyxkLGUsZz10aGlzWzBdO3tpZighIWFyZ3VtZW50cy5sZW5ndGgpe2U9Zi5pc0Z1bmN0aW9uKGEpO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZCl7dmFyIGc9Zih0aGlzKSxoO2lmKHRoaXMubm9kZVR5cGU9PT0xKXtlP2g9YS5jYWxsKHRoaXMsZCxnLnZhbCgpKTpoPWEsaD09bnVsbD9oPSIiOnR5cGVvZiBoPT0ibnVtYmVyIj9oKz0iIjpmLmlzQXJyYXkoaCkmJihoPWYubWFwKGgsZnVuY3Rpb24oYSl7cmV0dXJuIGE9PW51bGw/IiI6YSsiIn0pKSxjPWYudmFsSG9va3NbdGhpcy50eXBlXXx8Zi52YWxIb29rc1t0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldO2lmKCFjfHwhKCJzZXQiaW4gYyl8fGMuc2V0KHRoaXMsaCwidmFsdWUiKT09PWIpdGhpcy52YWx1ZT1ofX0pfWlmKGcpe2M9Zi52YWxIb29rc1tnLnR5cGVdfHxmLnZhbEhvb2tzW2cubm9kZU5hbWUudG9Mb3dlckNhc2UoKV07aWYoYyYmImdldCJpbiBjJiYoZD1jLmdldChnLCJ2YWx1ZSIpKSE9PWIpcmV0dXJuIGQ7ZD1nLnZhbHVlO3JldHVybiB0eXBlb2YgZD09InN0cmluZyI/ZC5yZXBsYWNlKHEsIiIpOmQ9PW51bGw/IiI6ZH19fX0pLGYuZXh0ZW5kKHt2YWxIb29rczp7b3B0aW9uOntnZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5hdHRyaWJ1dGVzLnZhbHVlO3JldHVybiFifHxiLnNwZWNpZmllZD9hLnZhbHVlOmEudGV4dH19LHNlbGVjdDp7Z2V0OmZ1bmN0aW9uKGEpe3ZhciBiLGMsZCxlLGc9YS5zZWxlY3RlZEluZGV4LGg9W10saT1hLm9wdGlvbnMsaj1hLnR5cGU9PT0ic2VsZWN0LW9uZSI7aWYoZzwwKXJldHVybiBudWxsO2M9aj9nOjAsZD1qP2crMTppLmxlbmd0aDtmb3IoO2M8ZDtjKyspe2U9aVtjXTtpZihlLnNlbGVjdGVkJiYoZi5zdXBwb3J0Lm9wdERpc2FibGVkPyFlLmRpc2FibGVkOmUuZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpPT09bnVsbCkmJighZS5wYXJlbnROb2RlLmRpc2FibGVkfHwhZi5ub2RlTmFtZShlLnBhcmVudE5vZGUsIm9wdGdyb3VwIikpKXtiPWYoZSkudmFsKCk7aWYoailyZXR1cm4gYjtoLnB1c2goYil9fWlmKGomJiFoLmxlbmd0aCYmaS5sZW5ndGgpcmV0dXJuIGYoaVtnXSkudmFsKCk7cmV0dXJuIGh9LHNldDpmdW5jdGlvbihhLGIpe3ZhciBjPWYubWFrZUFycmF5KGIpO2YoYSkuZmluZCgib3B0aW9uIikuZWFjaChmdW5jdGlvbigpe3RoaXMuc2VsZWN0ZWQ9Zi5pbkFycmF5KGYodGhpcykudmFsKCksYyk+PTB9KSxjLmxlbmd0aHx8KGEuc2VsZWN0ZWRJbmRleD0tMSk7cmV0dXJuIGN9fX0sYXR0ckZuOnt2YWw6ITAsY3NzOiEwLGh0bWw6ITAsdGV4dDohMCxkYXRhOiEwLHdpZHRoOiEwLGhlaWdodDohMCxvZmZzZXQ6ITB9LGF0dHI6ZnVuY3Rpb24oYSxjLGQsZSl7dmFyIGcsaCxpLGo9YS5ub2RlVHlwZTtpZighIWEmJmohPT0zJiZqIT09OCYmaiE9PTIpe2lmKGUmJmMgaW4gZi5hdHRyRm4pcmV0dXJuIGYoYSlbY10oZCk7aWYodHlwZW9mIGEuZ2V0QXR0cmlidXRlPT0idW5kZWZpbmVkIilyZXR1cm4gZi5wcm9wKGEsYyxkKTtpPWohPT0xfHwhZi5pc1hNTERvYyhhKSxpJiYoYz1jLnRvTG93ZXJDYXNlKCksaD1mLmF0dHJIb29rc1tjXXx8KHUudGVzdChjKT94OncpKTtpZihkIT09Yil7aWYoZD09PW51bGwpe2YucmVtb3ZlQXR0cihhLGMpO3JldHVybn1pZihoJiYic2V0ImluIGgmJmkmJihnPWguc2V0KGEsZCxjKSkhPT1iKXJldHVybiBnO2Euc2V0QXR0cmlidXRlKGMsIiIrZCk7cmV0dXJuIGR9aWYoaCYmImdldCJpbiBoJiZpJiYoZz1oLmdldChhLGMpKSE9PW51bGwpcmV0dXJuIGc7Zz1hLmdldEF0dHJpYnV0ZShjKTtyZXR1cm4gZz09PW51bGw/YjpnfX0scmVtb3ZlQXR0cjpmdW5jdGlvbihhLGIpe3ZhciBjLGQsZSxnLGgsaT0wO2lmKGImJmEubm9kZVR5cGU9PT0xKXtkPWIudG9Mb3dlckNhc2UoKS5zcGxpdChwKSxnPWQubGVuZ3RoO2Zvcig7aTxnO2krKyllPWRbaV0sZSYmKGM9Zi5wcm9wRml4W2VdfHxlLGg9dS50ZXN0KGUpLGh8fGYuYXR0cihhLGUsIiIpLGEucmVtb3ZlQXR0cmlidXRlKHY/ZTpjKSxoJiZjIGluIGEmJihhW2NdPSExKSl9fSxhdHRySG9va3M6e3R5cGU6e3NldDpmdW5jdGlvbihhLGIpe2lmKHIudGVzdChhLm5vZGVOYW1lKSYmYS5wYXJlbnROb2RlKWYuZXJyb3IoInR5cGUgcHJvcGVydHkgY2FuJ3QgYmUgY2hhbmdlZCIpO2Vsc2UgaWYoIWYuc3VwcG9ydC5yYWRpb1ZhbHVlJiZiPT09InJhZGlvIiYmZi5ub2RlTmFtZShhLCJpbnB1dCIpKXt2YXIgYz1hLnZhbHVlO2Euc2V0QXR0cmlidXRlKCJ0eXBlIixiKSxjJiYoYS52YWx1ZT1jKTtyZXR1cm4gYn19fSx2YWx1ZTp7Z2V0OmZ1bmN0aW9uKGEsYil7aWYodyYmZi5ub2RlTmFtZShhLCJidXR0b24iKSlyZXR1cm4gdy5nZXQoYSxiKTtyZXR1cm4gYiBpbiBhP2EudmFsdWU6bnVsbH0sc2V0OmZ1bmN0aW9uKGEsYixjKXtpZih3JiZmLm5vZGVOYW1lKGEsImJ1dHRvbiIpKXJldHVybiB3LnNldChhLGIsYyk7YS52YWx1ZT1ifX19LHByb3BGaXg6e3RhYmluZGV4OiJ0YWJJbmRleCIscmVhZG9ubHk6InJlYWRPbmx5IiwiZm9yIjoiaHRtbEZvciIsImNsYXNzIjoiY2xhc3NOYW1lIixtYXhsZW5ndGg6Im1heExlbmd0aCIsY2VsbHNwYWNpbmc6ImNlbGxTcGFjaW5nIixjZWxscGFkZGluZzoiY2VsbFBhZGRpbmciLHJvd3NwYW46InJvd1NwYW4iLGNvbHNwYW46ImNvbFNwYW4iLHVzZW1hcDoidXNlTWFwIixmcmFtZWJvcmRlcjoiZnJhbWVCb3JkZXIiLGNvbnRlbnRlZGl0YWJsZToiY29udGVudEVkaXRhYmxlIn0scHJvcDpmdW5jdGlvbihhLGMsZCl7dmFyIGUsZyxoLGk9YS5ub2RlVHlwZTtpZighIWEmJmkhPT0zJiZpIT09OCYmaSE9PTIpe2g9aSE9PTF8fCFmLmlzWE1MRG9jKGEpLGgmJihjPWYucHJvcEZpeFtjXXx8YyxnPWYucHJvcEhvb2tzW2NdKTtyZXR1cm4gZCE9PWI/ZyYmInNldCJpbiBnJiYoZT1nLnNldChhLGQsYykpIT09Yj9lOmFbY109ZDpnJiYiZ2V0ImluIGcmJihlPWcuZ2V0KGEsYykpIT09bnVsbD9lOmFbY119fSxwcm9wSG9va3M6e3RhYkluZGV4OntnZXQ6ZnVuY3Rpb24oYSl7dmFyIGM9YS5nZXRBdHRyaWJ1dGVOb2RlKCJ0YWJpbmRleCIpO3JldHVybiBjJiZjLnNwZWNpZmllZD9wYXJzZUludChjLnZhbHVlLDEwKTpzLnRlc3QoYS5ub2RlTmFtZSl8fHQudGVzdChhLm5vZGVOYW1lKSYmYS5ocmVmPzA6Yn19fX0pLGYuYXR0ckhvb2tzLnRhYmluZGV4PWYucHJvcEhvb2tzLnRhYkluZGV4LHg9e2dldDpmdW5jdGlvbihhLGMpe3ZhciBkLGU9Zi5wcm9wKGEsYyk7cmV0dXJuIGU9PT0hMHx8dHlwZW9mIGUhPSJib29sZWFuIiYmKGQ9YS5nZXRBdHRyaWJ1dGVOb2RlKGMpKSYmZC5ub2RlVmFsdWUhPT0hMT9jLnRvTG93ZXJDYXNlKCk6Yn0sc2V0OmZ1bmN0aW9uKGEsYixjKXt2YXIgZDtiPT09ITE/Zi5yZW1vdmVBdHRyKGEsYyk6KGQ9Zi5wcm9wRml4W2NdfHxjLGQgaW4gYSYmKGFbZF09ITApLGEuc2V0QXR0cmlidXRlKGMsYy50b0xvd2VyQ2FzZSgpKSk7cmV0dXJuIGN9fSx2fHwoeT17bmFtZTohMCxpZDohMCxjb29yZHM6ITB9LHc9Zi52YWxIb29rcy5idXR0b249e2dldDpmdW5jdGlvbihhLGMpe3ZhciBkO2Q9YS5nZXRBdHRyaWJ1dGVOb2RlKGMpO3JldHVybiBkJiYoeVtjXT9kLm5vZGVWYWx1ZSE9PSIiOmQuc3BlY2lmaWVkKT9kLm5vZGVWYWx1ZTpifSxzZXQ6ZnVuY3Rpb24oYSxiLGQpe3ZhciBlPWEuZ2V0QXR0cmlidXRlTm9kZShkKTtlfHwoZT1jLmNyZWF0ZUF0dHJpYnV0ZShkKSxhLnNldEF0dHJpYnV0ZU5vZGUoZSkpO3JldHVybiBlLm5vZGVWYWx1ZT1iKyIifX0sZi5hdHRySG9va3MudGFiaW5kZXguc2V0PXcuc2V0LGYuZWFjaChbIndpZHRoIiwiaGVpZ2h0Il0sZnVuY3Rpb24oYSxiKXtmLmF0dHJIb29rc1tiXT1mLmV4dGVuZChmLmF0dHJIb29rc1tiXSx7c2V0OmZ1bmN0aW9uKGEsYyl7aWYoYz09PSIiKXthLnNldEF0dHJpYnV0ZShiLCJhdXRvIik7cmV0dXJuIGN9fX0pfSksZi5hdHRySG9va3MuY29udGVudGVkaXRhYmxlPXtnZXQ6dy5nZXQsc2V0OmZ1bmN0aW9uKGEsYixjKXtiPT09IiImJihiPSJmYWxzZSIpLHcuc2V0KGEsYixjKX19KSxmLnN1cHBvcnQuaHJlZk5vcm1hbGl6ZWR8fGYuZWFjaChbImhyZWYiLCJzcmMiLCJ3aWR0aCIsImhlaWdodCJdLGZ1bmN0aW9uKGEsYyl7Zi5hdHRySG9va3NbY109Zi5leHRlbmQoZi5hdHRySG9va3NbY10se2dldDpmdW5jdGlvbihhKXt2YXIgZD1hLmdldEF0dHJpYnV0ZShjLDIpO3JldHVybiBkPT09bnVsbD9iOmR9fSl9KSxmLnN1cHBvcnQuc3R5bGV8fChmLmF0dHJIb29rcy5zdHlsZT17Z2V0OmZ1bmN0aW9uKGEpe3JldHVybiBhLnN0eWxlLmNzc1RleHQudG9Mb3dlckNhc2UoKXx8Yn0sc2V0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIGEuc3R5bGUuY3NzVGV4dD0iIitifX0pLGYuc3VwcG9ydC5vcHRTZWxlY3RlZHx8KGYucHJvcEhvb2tzLnNlbGVjdGVkPWYuZXh0ZW5kKGYucHJvcEhvb2tzLnNlbGVjdGVkLHtnZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5wYXJlbnROb2RlO2ImJihiLnNlbGVjdGVkSW5kZXgsYi5wYXJlbnROb2RlJiZiLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleCk7cmV0dXJuIG51bGx9fSkpLGYuc3VwcG9ydC5lbmN0eXBlfHwoZi5wcm9wRml4LmVuY3R5cGU9ImVuY29kaW5nIiksZi5zdXBwb3J0LmNoZWNrT258fGYuZWFjaChbInJhZGlvIiwiY2hlY2tib3giXSxmdW5jdGlvbigpe2YudmFsSG9va3NbdGhpc109e2dldDpmdW5jdGlvbihhKXtyZXR1cm4gYS5nZXRBdHRyaWJ1dGUoInZhbHVlIik9PT1udWxsPyJvbiI6YS52YWx1ZX19fSksZi5lYWNoKFsicmFkaW8iLCJjaGVja2JveCJdLGZ1bmN0aW9uKCl7Zi52YWxIb29rc1t0aGlzXT1mLmV4dGVuZChmLnZhbEhvb2tzW3RoaXNdLHtzZXQ6ZnVuY3Rpb24oYSxiKXtpZihmLmlzQXJyYXkoYikpcmV0dXJuIGEuY2hlY2tlZD1mLmluQXJyYXkoZihhKS52YWwoKSxiKT49MH19KX0pO3ZhciB6PS9eKD86dGV4dGFyZWF8aW5wdXR8c2VsZWN0KSQvaSxBPS9eKFteXC5dKik/KD86XC4oLispKT8kLyxCPS8oPzpefFxzKWhvdmVyKFwuXFMrKT9cYi8sQz0vXmtleS8sRD0vXig/Om1vdXNlfGNvbnRleHRtZW51KXxjbGljay8sRT0vXig/OmZvY3VzaW5mb2N1c3xmb2N1c291dGJsdXIpJC8sRj0vXihcdyopKD86IyhbXHdcLV0rKSk/KD86XC4oW1x3XC1dKykpPyQvLEc9ZnVuY3Rpb24oCmEpe3ZhciBiPUYuZXhlYyhhKTtiJiYoYlsxXT0oYlsxXXx8IiIpLnRvTG93ZXJDYXNlKCksYlszXT1iWzNdJiZuZXcgUmVnRXhwKCIoPzpefFxccykiK2JbM10rIig/Olxcc3wkKSIpKTtyZXR1cm4gYn0sSD1mdW5jdGlvbihhLGIpe3ZhciBjPWEuYXR0cmlidXRlc3x8e307cmV0dXJuKCFiWzFdfHxhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1iWzFdKSYmKCFiWzJdfHwoYy5pZHx8e30pLnZhbHVlPT09YlsyXSkmJighYlszXXx8YlszXS50ZXN0KChjWyJjbGFzcyJdfHx7fSkudmFsdWUpKX0sST1mdW5jdGlvbihhKXtyZXR1cm4gZi5ldmVudC5zcGVjaWFsLmhvdmVyP2E6YS5yZXBsYWNlKEIsIm1vdXNlZW50ZXIkMSBtb3VzZWxlYXZlJDEiKX07Zi5ldmVudD17YWRkOmZ1bmN0aW9uKGEsYyxkLGUsZyl7dmFyIGgsaSxqLGssbCxtLG4sbyxwLHEscixzO2lmKCEoYS5ub2RlVHlwZT09PTN8fGEubm9kZVR5cGU9PT04fHwhY3x8IWR8fCEoaD1mLl9kYXRhKGEpKSkpe2QuaGFuZGxlciYmKHA9ZCxkPXAuaGFuZGxlcixnPXAuc2VsZWN0b3IpLGQuZ3VpZHx8KGQuZ3VpZD1mLmd1aWQrKyksaj1oLmV2ZW50cyxqfHwoaC5ldmVudHM9aj17fSksaT1oLmhhbmRsZSxpfHwoaC5oYW5kbGU9aT1mdW5jdGlvbihhKXtyZXR1cm4gdHlwZW9mIGYhPSJ1bmRlZmluZWQiJiYoIWF8fGYuZXZlbnQudHJpZ2dlcmVkIT09YS50eXBlKT9mLmV2ZW50LmRpc3BhdGNoLmFwcGx5KGkuZWxlbSxhcmd1bWVudHMpOmJ9LGkuZWxlbT1hKSxjPWYudHJpbShJKGMpKS5zcGxpdCgiICIpO2ZvcihrPTA7azxjLmxlbmd0aDtrKyspe2w9QS5leGVjKGNba10pfHxbXSxtPWxbMV0sbj0obFsyXXx8IiIpLnNwbGl0KCIuIikuc29ydCgpLHM9Zi5ldmVudC5zcGVjaWFsW21dfHx7fSxtPShnP3MuZGVsZWdhdGVUeXBlOnMuYmluZFR5cGUpfHxtLHM9Zi5ldmVudC5zcGVjaWFsW21dfHx7fSxvPWYuZXh0ZW5kKHt0eXBlOm0sb3JpZ1R5cGU6bFsxXSxkYXRhOmUsaGFuZGxlcjpkLGd1aWQ6ZC5ndWlkLHNlbGVjdG9yOmcscXVpY2s6ZyYmRyhnKSxuYW1lc3BhY2U6bi5qb2luKCIuIil9LHApLHI9alttXTtpZighcil7cj1qW21dPVtdLHIuZGVsZWdhdGVDb3VudD0wO2lmKCFzLnNldHVwfHxzLnNldHVwLmNhbGwoYSxlLG4saSk9PT0hMSlhLmFkZEV2ZW50TGlzdGVuZXI/YS5hZGRFdmVudExpc3RlbmVyKG0saSwhMSk6YS5hdHRhY2hFdmVudCYmYS5hdHRhY2hFdmVudCgib24iK20saSl9cy5hZGQmJihzLmFkZC5jYWxsKGEsbyksby5oYW5kbGVyLmd1aWR8fChvLmhhbmRsZXIuZ3VpZD1kLmd1aWQpKSxnP3Iuc3BsaWNlKHIuZGVsZWdhdGVDb3VudCsrLDAsbyk6ci5wdXNoKG8pLGYuZXZlbnQuZ2xvYmFsW21dPSEwfWE9bnVsbH19LGdsb2JhbDp7fSxyZW1vdmU6ZnVuY3Rpb24oYSxiLGMsZCxlKXt2YXIgZz1mLmhhc0RhdGEoYSkmJmYuX2RhdGEoYSksaCxpLGosayxsLG0sbixvLHAscSxyLHM7aWYoISFnJiYhIShvPWcuZXZlbnRzKSl7Yj1mLnRyaW0oSShifHwiIikpLnNwbGl0KCIgIik7Zm9yKGg9MDtoPGIubGVuZ3RoO2grKyl7aT1BLmV4ZWMoYltoXSl8fFtdLGo9az1pWzFdLGw9aVsyXTtpZighail7Zm9yKGogaW4gbylmLmV2ZW50LnJlbW92ZShhLGorYltoXSxjLGQsITApO2NvbnRpbnVlfXA9Zi5ldmVudC5zcGVjaWFsW2pdfHx7fSxqPShkP3AuZGVsZWdhdGVUeXBlOnAuYmluZFR5cGUpfHxqLHI9b1tqXXx8W10sbT1yLmxlbmd0aCxsPWw/bmV3IFJlZ0V4cCgiKF58XFwuKSIrbC5zcGxpdCgiLiIpLnNvcnQoKS5qb2luKCJcXC4oPzouKlxcLik/IikrIihcXC58JCkiKTpudWxsO2ZvcihuPTA7bjxyLmxlbmd0aDtuKyspcz1yW25dLChlfHxrPT09cy5vcmlnVHlwZSkmJighY3x8Yy5ndWlkPT09cy5ndWlkKSYmKCFsfHxsLnRlc3Qocy5uYW1lc3BhY2UpKSYmKCFkfHxkPT09cy5zZWxlY3Rvcnx8ZD09PSIqKiImJnMuc2VsZWN0b3IpJiYoci5zcGxpY2Uobi0tLDEpLHMuc2VsZWN0b3ImJnIuZGVsZWdhdGVDb3VudC0tLHAucmVtb3ZlJiZwLnJlbW92ZS5jYWxsKGEscykpO3IubGVuZ3RoPT09MCYmbSE9PXIubGVuZ3RoJiYoKCFwLnRlYXJkb3dufHxwLnRlYXJkb3duLmNhbGwoYSxsKT09PSExKSYmZi5yZW1vdmVFdmVudChhLGosZy5oYW5kbGUpLGRlbGV0ZSBvW2pdKX1mLmlzRW1wdHlPYmplY3QobykmJihxPWcuaGFuZGxlLHEmJihxLmVsZW09bnVsbCksZi5yZW1vdmVEYXRhKGEsWyJldmVudHMiLCJoYW5kbGUiXSwhMCkpfX0sY3VzdG9tRXZlbnQ6e2dldERhdGE6ITAsc2V0RGF0YTohMCxjaGFuZ2VEYXRhOiEwfSx0cmlnZ2VyOmZ1bmN0aW9uKGMsZCxlLGcpe2lmKCFlfHxlLm5vZGVUeXBlIT09MyYmZS5ub2RlVHlwZSE9PTgpe3ZhciBoPWMudHlwZXx8YyxpPVtdLGosayxsLG0sbixvLHAscSxyLHM7aWYoRS50ZXN0KGgrZi5ldmVudC50cmlnZ2VyZWQpKXJldHVybjtoLmluZGV4T2YoIiEiKT49MCYmKGg9aC5zbGljZSgwLC0xKSxrPSEwKSxoLmluZGV4T2YoIi4iKT49MCYmKGk9aC5zcGxpdCgiLiIpLGg9aS5zaGlmdCgpLGkuc29ydCgpKTtpZigoIWV8fGYuZXZlbnQuY3VzdG9tRXZlbnRbaF0pJiYhZi5ldmVudC5nbG9iYWxbaF0pcmV0dXJuO2M9dHlwZW9mIGM9PSJvYmplY3QiP2NbZi5leHBhbmRvXT9jOm5ldyBmLkV2ZW50KGgsYyk6bmV3IGYuRXZlbnQoaCksYy50eXBlPWgsYy5pc1RyaWdnZXI9ITAsYy5leGNsdXNpdmU9ayxjLm5hbWVzcGFjZT1pLmpvaW4oIi4iKSxjLm5hbWVzcGFjZV9yZT1jLm5hbWVzcGFjZT9uZXcgUmVnRXhwKCIoXnxcXC4pIitpLmpvaW4oIlxcLig/Oi4qXFwuKT8iKSsiKFxcLnwkKSIpOm51bGwsbz1oLmluZGV4T2YoIjoiKTwwPyJvbiIraDoiIjtpZighZSl7aj1mLmNhY2hlO2ZvcihsIGluIGopaltsXS5ldmVudHMmJmpbbF0uZXZlbnRzW2hdJiZmLmV2ZW50LnRyaWdnZXIoYyxkLGpbbF0uaGFuZGxlLmVsZW0sITApO3JldHVybn1jLnJlc3VsdD1iLGMudGFyZ2V0fHwoYy50YXJnZXQ9ZSksZD1kIT1udWxsP2YubWFrZUFycmF5KGQpOltdLGQudW5zaGlmdChjKSxwPWYuZXZlbnQuc3BlY2lhbFtoXXx8e307aWYocC50cmlnZ2VyJiZwLnRyaWdnZXIuYXBwbHkoZSxkKT09PSExKXJldHVybjtyPVtbZSxwLmJpbmRUeXBlfHxoXV07aWYoIWcmJiFwLm5vQnViYmxlJiYhZi5pc1dpbmRvdyhlKSl7cz1wLmRlbGVnYXRlVHlwZXx8aCxtPUUudGVzdChzK2gpP2U6ZS5wYXJlbnROb2RlLG49bnVsbDtmb3IoO207bT1tLnBhcmVudE5vZGUpci5wdXNoKFttLHNdKSxuPW07biYmbj09PWUub3duZXJEb2N1bWVudCYmci5wdXNoKFtuLmRlZmF1bHRWaWV3fHxuLnBhcmVudFdpbmRvd3x8YSxzXSl9Zm9yKGw9MDtsPHIubGVuZ3RoJiYhYy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpO2wrKyltPXJbbF1bMF0sYy50eXBlPXJbbF1bMV0scT0oZi5fZGF0YShtLCJldmVudHMiKXx8e30pW2MudHlwZV0mJmYuX2RhdGEobSwiaGFuZGxlIikscSYmcS5hcHBseShtLGQpLHE9byYmbVtvXSxxJiZmLmFjY2VwdERhdGEobSkmJnEuYXBwbHkobSxkKT09PSExJiZjLnByZXZlbnREZWZhdWx0KCk7Yy50eXBlPWgsIWcmJiFjLmlzRGVmYXVsdFByZXZlbnRlZCgpJiYoIXAuX2RlZmF1bHR8fHAuX2RlZmF1bHQuYXBwbHkoZS5vd25lckRvY3VtZW50LGQpPT09ITEpJiYoaCE9PSJjbGljayJ8fCFmLm5vZGVOYW1lKGUsImEiKSkmJmYuYWNjZXB0RGF0YShlKSYmbyYmZVtoXSYmKGghPT0iZm9jdXMiJiZoIT09ImJsdXIifHxjLnRhcmdldC5vZmZzZXRXaWR0aCE9PTApJiYhZi5pc1dpbmRvdyhlKSYmKG49ZVtvXSxuJiYoZVtvXT1udWxsKSxmLmV2ZW50LnRyaWdnZXJlZD1oLGVbaF0oKSxmLmV2ZW50LnRyaWdnZXJlZD1iLG4mJihlW29dPW4pKTtyZXR1cm4gYy5yZXN1bHR9fSxkaXNwYXRjaDpmdW5jdGlvbihjKXtjPWYuZXZlbnQuZml4KGN8fGEuZXZlbnQpO3ZhciBkPShmLl9kYXRhKHRoaXMsImV2ZW50cyIpfHx7fSlbYy50eXBlXXx8W10sZT1kLmRlbGVnYXRlQ291bnQsZz1bXS5zbGljZS5jYWxsKGFyZ3VtZW50cywwKSxoPSFjLmV4Y2x1c2l2ZSYmIWMubmFtZXNwYWNlLGk9Zi5ldmVudC5zcGVjaWFsW2MudHlwZV18fHt9LGo9W10sayxsLG0sbixvLHAscSxyLHMsdCx1O2dbMF09YyxjLmRlbGVnYXRlVGFyZ2V0PXRoaXM7aWYoIWkucHJlRGlzcGF0Y2h8fGkucHJlRGlzcGF0Y2guY2FsbCh0aGlzLGMpIT09ITEpe2lmKGUmJighYy5idXR0b258fGMudHlwZSE9PSJjbGljayIpKXtuPWYodGhpcyksbi5jb250ZXh0PXRoaXMub3duZXJEb2N1bWVudHx8dGhpcztmb3IobT1jLnRhcmdldDttIT10aGlzO209bS5wYXJlbnROb2RlfHx0aGlzKWlmKG0uZGlzYWJsZWQhPT0hMCl7cD17fSxyPVtdLG5bMF09bTtmb3Ioaz0wO2s8ZTtrKyspcz1kW2tdLHQ9cy5zZWxlY3RvcixwW3RdPT09YiYmKHBbdF09cy5xdWljaz9IKG0scy5xdWljayk6bi5pcyh0KSkscFt0XSYmci5wdXNoKHMpO3IubGVuZ3RoJiZqLnB1c2goe2VsZW06bSxtYXRjaGVzOnJ9KX19ZC5sZW5ndGg+ZSYmai5wdXNoKHtlbGVtOnRoaXMsbWF0Y2hlczpkLnNsaWNlKGUpfSk7Zm9yKGs9MDtrPGoubGVuZ3RoJiYhYy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpO2srKyl7cT1qW2tdLGMuY3VycmVudFRhcmdldD1xLmVsZW07Zm9yKGw9MDtsPHEubWF0Y2hlcy5sZW5ndGgmJiFjLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkKCk7bCsrKXtzPXEubWF0Y2hlc1tsXTtpZihofHwhYy5uYW1lc3BhY2UmJiFzLm5hbWVzcGFjZXx8Yy5uYW1lc3BhY2VfcmUmJmMubmFtZXNwYWNlX3JlLnRlc3Qocy5uYW1lc3BhY2UpKWMuZGF0YT1zLmRhdGEsYy5oYW5kbGVPYmo9cyxvPSgoZi5ldmVudC5zcGVjaWFsW3Mub3JpZ1R5cGVdfHx7fSkuaGFuZGxlfHxzLmhhbmRsZXIpLmFwcGx5KHEuZWxlbSxnKSxvIT09YiYmKGMucmVzdWx0PW8sbz09PSExJiYoYy5wcmV2ZW50RGVmYXVsdCgpLGMuc3RvcFByb3BhZ2F0aW9uKCkpKX19aS5wb3N0RGlzcGF0Y2gmJmkucG9zdERpc3BhdGNoLmNhbGwodGhpcyxjKTtyZXR1cm4gYy5yZXN1bHR9fSxwcm9wczoiYXR0ckNoYW5nZSBhdHRyTmFtZSByZWxhdGVkTm9kZSBzcmNFbGVtZW50IGFsdEtleSBidWJibGVzIGNhbmNlbGFibGUgY3RybEtleSBjdXJyZW50VGFyZ2V0IGV2ZW50UGhhc2UgbWV0YUtleSByZWxhdGVkVGFyZ2V0IHNoaWZ0S2V5IHRhcmdldCB0aW1lU3RhbXAgdmlldyB3aGljaCIuc3BsaXQoIiAiKSxmaXhIb29rczp7fSxrZXlIb29rczp7cHJvcHM6ImNoYXIgY2hhckNvZGUga2V5IGtleUNvZGUiLnNwbGl0KCIgIiksZmlsdGVyOmZ1bmN0aW9uKGEsYil7YS53aGljaD09bnVsbCYmKGEud2hpY2g9Yi5jaGFyQ29kZSE9bnVsbD9iLmNoYXJDb2RlOmIua2V5Q29kZSk7cmV0dXJuIGF9fSxtb3VzZUhvb2tzOntwcm9wczoiYnV0dG9uIGJ1dHRvbnMgY2xpZW50WCBjbGllbnRZIGZyb21FbGVtZW50IG9mZnNldFggb2Zmc2V0WSBwYWdlWCBwYWdlWSBzY3JlZW5YIHNjcmVlblkgdG9FbGVtZW50Ii5zcGxpdCgiICIpLGZpbHRlcjpmdW5jdGlvbihhLGQpe3ZhciBlLGYsZyxoPWQuYnV0dG9uLGk9ZC5mcm9tRWxlbWVudDthLnBhZ2VYPT1udWxsJiZkLmNsaWVudFghPW51bGwmJihlPWEudGFyZ2V0Lm93bmVyRG9jdW1lbnR8fGMsZj1lLmRvY3VtZW50RWxlbWVudCxnPWUuYm9keSxhLnBhZ2VYPWQuY2xpZW50WCsoZiYmZi5zY3JvbGxMZWZ0fHxnJiZnLnNjcm9sbExlZnR8fDApLShmJiZmLmNsaWVudExlZnR8fGcmJmcuY2xpZW50TGVmdHx8MCksYS5wYWdlWT1kLmNsaWVudFkrKGYmJmYuc2Nyb2xsVG9wfHxnJiZnLnNjcm9sbFRvcHx8MCktKGYmJmYuY2xpZW50VG9wfHxnJiZnLmNsaWVudFRvcHx8MCkpLCFhLnJlbGF0ZWRUYXJnZXQmJmkmJihhLnJlbGF0ZWRUYXJnZXQ9aT09PWEudGFyZ2V0P2QudG9FbGVtZW50OmkpLCFhLndoaWNoJiZoIT09YiYmKGEud2hpY2g9aCYxPzE6aCYyPzM6aCY0PzI6MCk7cmV0dXJuIGF9fSxmaXg6ZnVuY3Rpb24oYSl7aWYoYVtmLmV4cGFuZG9dKXJldHVybiBhO3ZhciBkLGUsZz1hLGg9Zi5ldmVudC5maXhIb29rc1thLnR5cGVdfHx7fSxpPWgucHJvcHM/dGhpcy5wcm9wcy5jb25jYXQoaC5wcm9wcyk6dGhpcy5wcm9wczthPWYuRXZlbnQoZyk7Zm9yKGQ9aS5sZW5ndGg7ZDspZT1pWy0tZF0sYVtlXT1nW2VdO2EudGFyZ2V0fHwoYS50YXJnZXQ9Zy5zcmNFbGVtZW50fHxjKSxhLnRhcmdldC5ub2RlVHlwZT09PTMmJihhLnRhcmdldD1hLnRhcmdldC5wYXJlbnROb2RlKSxhLm1ldGFLZXk9PT1iJiYoYS5tZXRhS2V5PWEuY3RybEtleSk7cmV0dXJuIGguZmlsdGVyP2guZmlsdGVyKGEsZyk6YX0sc3BlY2lhbDp7cmVhZHk6e3NldHVwOmYuYmluZFJlYWR5fSxsb2FkOntub0J1YmJsZTohMH0sZm9jdXM6e2RlbGVnYXRlVHlwZToiZm9jdXNpbiJ9LGJsdXI6e2RlbGVnYXRlVHlwZToiZm9jdXNvdXQifSxiZWZvcmV1bmxvYWQ6e3NldHVwOmZ1bmN0aW9uKGEsYixjKXtmLmlzV2luZG93KHRoaXMpJiYodGhpcy5vbmJlZm9yZXVubG9hZD1jKX0sdGVhcmRvd246ZnVuY3Rpb24oYSxiKXt0aGlzLm9uYmVmb3JldW5sb2FkPT09YiYmKHRoaXMub25iZWZvcmV1bmxvYWQ9bnVsbCl9fX0sc2ltdWxhdGU6ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9Zi5leHRlbmQobmV3IGYuRXZlbnQsYyx7dHlwZTphLGlzU2ltdWxhdGVkOiEwLG9yaWdpbmFsRXZlbnQ6e319KTtkP2YuZXZlbnQudHJpZ2dlcihlLG51bGwsYik6Zi5ldmVudC5kaXNwYXRjaC5jYWxsKGIsZSksZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSYmYy5wcmV2ZW50RGVmYXVsdCgpfX0sZi5ldmVudC5oYW5kbGU9Zi5ldmVudC5kaXNwYXRjaCxmLnJlbW92ZUV2ZW50PWMucmVtb3ZlRXZlbnRMaXN0ZW5lcj9mdW5jdGlvbihhLGIsYyl7YS5yZW1vdmVFdmVudExpc3RlbmVyJiZhLnJlbW92ZUV2ZW50TGlzdGVuZXIoYixjLCExKX06ZnVuY3Rpb24oYSxiLGMpe2EuZGV0YWNoRXZlbnQmJmEuZGV0YWNoRXZlbnQoIm9uIitiLGMpfSxmLkV2ZW50PWZ1bmN0aW9uKGEsYil7aWYoISh0aGlzIGluc3RhbmNlb2YgZi5FdmVudCkpcmV0dXJuIG5ldyBmLkV2ZW50KGEsYik7YSYmYS50eXBlPyh0aGlzLm9yaWdpbmFsRXZlbnQ9YSx0aGlzLnR5cGU9YS50eXBlLHRoaXMuaXNEZWZhdWx0UHJldmVudGVkPWEuZGVmYXVsdFByZXZlbnRlZHx8YS5yZXR1cm5WYWx1ZT09PSExfHxhLmdldFByZXZlbnREZWZhdWx0JiZhLmdldFByZXZlbnREZWZhdWx0KCk/SzpKKTp0aGlzLnR5cGU9YSxiJiZmLmV4dGVuZCh0aGlzLGIpLHRoaXMudGltZVN0YW1wPWEmJmEudGltZVN0YW1wfHxmLm5vdygpLHRoaXNbZi5leHBhbmRvXT0hMH0sZi5FdmVudC5wcm90b3R5cGU9e3ByZXZlbnREZWZhdWx0OmZ1bmN0aW9uKCl7dGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQ9Szt2YXIgYT10aGlzLm9yaWdpbmFsRXZlbnQ7IWF8fChhLnByZXZlbnREZWZhdWx0P2EucHJldmVudERlZmF1bHQoKTphLnJldHVyblZhbHVlPSExKX0sc3RvcFByb3BhZ2F0aW9uOmZ1bmN0aW9uKCl7dGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZD1LO3ZhciBhPXRoaXMub3JpZ2luYWxFdmVudDshYXx8KGEuc3RvcFByb3BhZ2F0aW9uJiZhLnN0b3BQcm9wYWdhdGlvbigpLGEuY2FuY2VsQnViYmxlPSEwKX0sc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOmZ1bmN0aW9uKCl7dGhpcy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZD1LLHRoaXMuc3RvcFByb3BhZ2F0aW9uKCl9LGlzRGVmYXVsdFByZXZlbnRlZDpKLGlzUHJvcGFnYXRpb25TdG9wcGVkOkosaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ6Sn0sZi5lYWNoKHttb3VzZWVudGVyOiJtb3VzZW92ZXIiLG1vdXNlbGVhdmU6Im1vdXNlb3V0In0sZnVuY3Rpb24oYSxiKXtmLmV2ZW50LnNwZWNpYWxbYV09e2RlbGVnYXRlVHlwZTpiLGJpbmRUeXBlOmIsaGFuZGxlOmZ1bmN0aW9uKGEpe3ZhciBjPXRoaXMsZD1hLnJlbGF0ZWRUYXJnZXQsZT1hLmhhbmRsZU9iaixnPWUuc2VsZWN0b3IsaDtpZighZHx8ZCE9PWMmJiFmLmNvbnRhaW5zKGMsZCkpYS50eXBlPWUub3JpZ1R5cGUsaD1lLmhhbmRsZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpLGEudHlwZT1iO3JldHVybiBofX19KSxmLnN1cHBvcnQuc3VibWl0QnViYmxlc3x8KGYuZXZlbnQuc3BlY2lhbC5zdWJtaXQ9e3NldHVwOmZ1bmN0aW9uKCl7aWYoZi5ub2RlTmFtZSh0aGlzLCJmb3JtIikpcmV0dXJuITE7Zi5ldmVudC5hZGQodGhpcywiY2xpY2suX3N1Ym1pdCBrZXlwcmVzcy5fc3VibWl0IixmdW5jdGlvbihhKXt2YXIgYz1hLnRhcmdldCxkPWYubm9kZU5hbWUoYywiaW5wdXQiKXx8Zi5ub2RlTmFtZShjLCJidXR0b24iKT9jLmZvcm06YjtkJiYhZC5fc3VibWl0X2F0dGFjaGVkJiYoZi5ldmVudC5hZGQoZCwic3VibWl0Ll9zdWJtaXQiLGZ1bmN0aW9uKGEpe2EuX3N1Ym1pdF9idWJibGU9ITB9KSxkLl9zdWJtaXRfYXR0YWNoZWQ9ITApfSl9LHBvc3REaXNwYXRjaDpmdW5jdGlvbihhKXthLl9zdWJtaXRfYnViYmxlJiYoZGVsZXRlIGEuX3N1Ym1pdF9idWJibGUsdGhpcy5wYXJlbnROb2RlJiYhYS5pc1RyaWdnZXImJmYuZXZlbnQuc2ltdWxhdGUoInN1Ym1pdCIsdGhpcy5wYXJlbnROb2RlLGEsITApKX0sdGVhcmRvd246ZnVuY3Rpb24oKXtpZihmLm5vZGVOYW1lKHRoaXMsImZvcm0iKSlyZXR1cm4hMTtmLmV2ZW50LnJlbW92ZSh0aGlzLCIuX3N1Ym1pdCIpfX0pLGYuc3VwcG9ydC5jaGFuZ2VCdWJibGVzfHwoZi5ldmVudC5zcGVjaWFsLmNoYW5nZT17c2V0dXA6ZnVuY3Rpb24oKXtpZih6LnRlc3QodGhpcy5ub2RlTmFtZSkpe2lmKHRoaXMudHlwZT09PSJjaGVja2JveCJ8fHRoaXMudHlwZT09PSJyYWRpbyIpZi5ldmVudC5hZGQodGhpcywicHJvcGVydHljaGFuZ2UuX2NoYW5nZSIsZnVuY3Rpb24oYSl7YS5vcmlnaW5hbEV2ZW50LnByb3BlcnR5TmFtZT09PSJjaGVja2VkIiYmKHRoaXMuX2p1c3RfY2hhbmdlZD0hMCl9KSxmLmV2ZW50LmFkZCh0aGlzLCJjbGljay5fY2hhbmdlIixmdW5jdGlvbihhKXt0aGlzLl9qdXN0X2NoYW5nZWQmJiFhLmlzVHJpZ2dlciYmKHRoaXMuX2p1c3RfY2hhbmdlZD0hMSxmLmV2ZW50LnNpbXVsYXRlKCJjaGFuZ2UiLHRoaXMsYSwhMCkpfSk7cmV0dXJuITF9Zi5ldmVudC5hZGQodGhpcywiYmVmb3JlYWN0aXZhdGUuX2NoYW5nZSIsZnVuY3Rpb24oYSl7dmFyIGI9YS50YXJnZXQ7ei50ZXN0KGIubm9kZU5hbWUpJiYhYi5fY2hhbmdlX2F0dGFjaGVkJiYoZi5ldmVudC5hZGQoYiwiY2hhbmdlLl9jaGFuZ2UiLGZ1bmN0aW9uKGEpe3RoaXMucGFyZW50Tm9kZSYmIWEuaXNTaW11bGF0ZWQmJiFhLmlzVHJpZ2dlciYmZi5ldmVudC5zaW11bGF0ZSgiY2hhbmdlIix0aGlzLnBhcmVudE5vZGUsYSwhMCl9KSxiLl9jaGFuZ2VfYXR0YWNoZWQ9ITApfSl9LGhhbmRsZTpmdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldDtpZih0aGlzIT09Ynx8YS5pc1NpbXVsYXRlZHx8YS5pc1RyaWdnZXJ8fGIudHlwZSE9PSJyYWRpbyImJmIudHlwZSE9PSJjaGVja2JveCIpcmV0dXJuIGEuaGFuZGxlT2JqLmhhbmRsZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpfSx0ZWFyZG93bjpmdW5jdGlvbigpe2YuZXZlbnQucmVtb3ZlKHRoaXMsIi5fY2hhbmdlIik7cmV0dXJuIHoudGVzdCh0aGlzLm5vZGVOYW1lKX19KSxmLnN1cHBvcnQuZm9jdXNpbkJ1YmJsZXN8fGYuZWFjaCh7Zm9jdXM6ImZvY3VzaW4iLGJsdXI6ImZvY3Vzb3V0In0sZnVuY3Rpb24oYSxiKXt2YXIgZD0wLGU9ZnVuY3Rpb24oYSl7Zi5ldmVudC5zaW11bGF0ZShiLGEudGFyZ2V0LGYuZXZlbnQuZml4KGEpLCEwKX07Zi5ldmVudC5zcGVjaWFsW2JdPXtzZXR1cDpmdW5jdGlvbigpe2QrKz09PTAmJmMuYWRkRXZlbnRMaXN0ZW5lcihhLGUsITApfSx0ZWFyZG93bjpmdW5jdGlvbigpey0tZD09PTAmJmMucmVtb3ZlRXZlbnRMaXN0ZW5lcihhLGUsITApfX19KSxmLmZuLmV4dGVuZCh7b246ZnVuY3Rpb24oYSxjLGQsZSxnKXt2YXIgaCxpO2lmKHR5cGVvZiBhPT0ib2JqZWN0Iil7dHlwZW9mIGMhPSJzdHJpbmciJiYoZD1kfHxjLGM9Yik7Zm9yKGkgaW4gYSl0aGlzLm9uKGksYyxkLGFbaV0sZyk7cmV0dXJuIHRoaXN9ZD09bnVsbCYmZT09bnVsbD8oZT1jLGQ9Yz1iKTplPT1udWxsJiYodHlwZW9mIGM9PSJzdHJpbmciPyhlPWQsZD1iKTooZT1kLGQ9YyxjPWIpKTtpZihlPT09ITEpZT1KO2Vsc2UgaWYoIWUpcmV0dXJuIHRoaXM7Zz09PTEmJihoPWUsZT1mdW5jdGlvbihhKXtmKCkub2ZmKGEpO3JldHVybiBoLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0sZS5ndWlkPWguZ3VpZHx8KGguZ3VpZD1mLmd1aWQrKykpO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLmV2ZW50LmFkZCh0aGlzLGEsZSxkLGMpfSl9LG9uZTpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5vbihhLGIsYyxkLDEpfSxvZmY6ZnVuY3Rpb24oYSxjLGQpe2lmKGEmJmEucHJldmVudERlZmF1bHQmJmEuaGFuZGxlT2JqKXt2YXIgZT1hLmhhbmRsZU9iajtmKGEuZGVsZWdhdGVUYXJnZXQpLm9mZihlLm5hbWVzcGFjZT9lLm9yaWdUeXBlKyIuIitlLm5hbWVzcGFjZTplLm9yaWdUeXBlLGUuc2VsZWN0b3IsZS5oYW5kbGVyKTtyZXR1cm4gdGhpc31pZih0eXBlb2YgYT09Im9iamVjdCIpe2Zvcih2YXIgZyBpbiBhKXRoaXMub2ZmKGcsYyxhW2ddKTtyZXR1cm4gdGhpc31pZihjPT09ITF8fHR5cGVvZiBjPT0iZnVuY3Rpb24iKWQ9YyxjPWI7ZD09PSExJiYoZD1KKTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zi5ldmVudC5yZW1vdmUodGhpcyxhLGQsYyl9KX0sYmluZDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIHRoaXMub24oYSxudWxsLGIsYyl9LHVuYmluZDpmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLm9mZihhLG51bGwsYil9LGxpdmU6ZnVuY3Rpb24oYSxiLGMpe2YodGhpcy5jb250ZXh0KS5vbihhLHRoaXMuc2VsZWN0b3IsYixjKTtyZXR1cm4gdGhpc30sZGllOmZ1bmN0aW9uKGEsYil7Zih0aGlzLmNvbnRleHQpLm9mZihhLHRoaXMuc2VsZWN0b3J8fCIqKiIsYik7cmV0dXJuIHRoaXN9LGRlbGVnYXRlOmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiB0aGlzLm9uKGIsYSxjLGQpfSx1bmRlbGVnYXRlOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD09MT90aGlzLm9mZihhLCIqKiIpOnRoaXMub2ZmKGIsYSxjKX0sdHJpZ2dlcjpmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmLmV2ZW50LnRyaWdnZXIoYSxiLHRoaXMpfSl9LHRyaWdnZXJIYW5kbGVyOmZ1bmN0aW9uKGEsYil7aWYodGhpc1swXSlyZXR1cm4gZi5ldmVudC50cmlnZ2VyKGEsYix0aGlzWzBdLCEwKX0sdG9nZ2xlOmZ1bmN0aW9uKGEpe3ZhciBiPWFyZ3VtZW50cyxjPWEuZ3VpZHx8Zi5ndWlkKyssZD0wLGU9ZnVuY3Rpb24oYyl7dmFyIGU9KGYuX2RhdGEodGhpcywibGFzdFRvZ2dsZSIrYS5ndWlkKXx8MCklZDtmLl9kYXRhKHRoaXMsImxhc3RUb2dnbGUiK2EuZ3VpZCxlKzEpLGMucHJldmVudERlZmF1bHQoKTtyZXR1cm4gYltlXS5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fCExfTtlLmd1aWQ9Yzt3aGlsZShkPGIubGVuZ3RoKWJbZCsrXS5ndWlkPWM7cmV0dXJuIHRoaXMuY2xpY2soZSl9LGhvdmVyOmZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMubW91c2VlbnRlcihhKS5tb3VzZWxlYXZlKGJ8fGEpfX0pLGYuZWFjaCgiYmx1ciBmb2N1cyBmb2N1c2luIGZvY3Vzb3V0IGxvYWQgcmVzaXplIHNjcm9sbCB1bmxvYWQgY2xpY2sgZGJsY2xpY2sgbW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBlcnJvciBjb250ZXh0bWVudSIuc3BsaXQoIiAiKSxmdW5jdGlvbihhLGIpe2YuZm5bYl09ZnVuY3Rpb24oYSxjKXtjPT1udWxsJiYoYz1hLGE9bnVsbCk7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg+MD90aGlzLm9uKGIsbnVsbCxhLGMpOnRoaXMudHJpZ2dlcihiKX0sZi5hdHRyRm4mJihmLmF0dHJGbltiXT0hMCksQy50ZXN0KGIpJiYoZi5ldmVudC5maXhIb29rc1tiXT1mLmV2ZW50LmtleUhvb2tzKSxELnRlc3QoYikmJihmLmV2ZW50LmZpeEhvb2tzW2JdPWYuZXZlbnQubW91c2VIb29rcyl9KSxmdW5jdGlvbigpe2Z1bmN0aW9uIHgoYSxiLGMsZSxmLGcpe2Zvcih2YXIgaD0wLGk9ZS5sZW5ndGg7aDxpO2grKyl7dmFyIGo9ZVtoXTtpZihqKXt2YXIgaz0hMTtqPWpbYV07d2hpbGUoail7aWYoaltkXT09PWMpe2s9ZVtqLnNpenNldF07YnJlYWt9aWYoai5ub2RlVHlwZT09PTEpe2d8fChqW2RdPWMsai5zaXpzZXQ9aCk7aWYodHlwZW9mIGIhPSJzdHJpbmciKXtpZihqPT09Yil7az0hMDticmVha319ZWxzZSBpZihtLmZpbHRlcihiLFtqXSkubGVuZ3RoPjApe2s9ajticmVha319aj1qW2FdfWVbaF09a319fWZ1bmN0aW9uIHcoYSxiLGMsZSxmLGcpe2Zvcih2YXIgaD0wLGk9ZS5sZW5ndGg7aDxpO2grKyl7dmFyIGo9ZVtoXTtpZihqKXt2YXIgaz0hMTtqPWpbYV07d2hpbGUoail7aWYoaltkXT09PWMpe2s9ZVtqLnNpenNldF07YnJlYWt9ai5ub2RlVHlwZT09PTEmJiFnJiYoaltkXT1jLGouc2l6c2V0PWgpO2lmKGoubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PWIpe2s9ajticmVha31qPWpbYV19ZVtoXT1rfX19dmFyIGE9LygoPzpcKCg/OlwoW14oKV0rXCl8W14oKV0rKStcKXxcWyg/OlxbW15cW1xdXSpcXXxbJyJdW14nIl0qWyciXXxbXlxbXF0nIl0rKStcXXxcXC58W14gPit+LChcW1xcXSspK3xbPit+XSkoXHMqLFxzKik/KCg/Oi58XHJ8XG4pKikvZyxkPSJzaXpjYWNoZSIrKE1hdGgucmFuZG9tKCkrIiIpLnJlcGxhY2UoIi4iLCIiKSxlPTAsZz1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLGg9ITEsaT0hMCxqPS9cXC9nLGs9L1xyXG4vZyxsPS9cVy87WzAsMF0uc29ydChmdW5jdGlvbigpe2k9ITE7cmV0dXJuIDB9KTt2YXIgbT1mdW5jdGlvbihiLGQsZSxmKXtlPWV8fFtdLGQ9ZHx8Yzt2YXIgaD1kO2lmKGQubm9kZVR5cGUhPT0xJiZkLm5vZGVUeXBlIT09OSlyZXR1cm5bXTtpZighYnx8dHlwZW9mIGIhPSJzdHJpbmciKXJldHVybiBlO3ZhciBpLGosayxsLG4scSxyLHQsdT0hMCx2PW0uaXNYTUwoZCksdz1bXSx4PWI7ZG97YS5leGVjKCIiKSxpPWEuZXhlYyh4KTtpZihpKXt4PWlbM10sdy5wdXNoKGlbMV0pO2lmKGlbMl0pe2w9aVszXTticmVha319fXdoaWxlKGkpO2lmKHcubGVuZ3RoPjEmJnAuZXhlYyhiKSlpZih3Lmxlbmd0aD09PTImJm8ucmVsYXRpdmVbd1swXV0paj15KHdbMF0rd1sxXSxkLGYpO2Vsc2V7aj1vLnJlbGF0aXZlW3dbMF1dP1tkXTptKHcuc2hpZnQoKSxkKTt3aGlsZSh3Lmxlbmd0aCliPXcuc2hpZnQoKSxvLnJlbGF0aXZlW2JdJiYoYis9dy5zaGlmdCgpKSxqPXkoYixqLGYpfWVsc2V7IWYmJncubGVuZ3RoPjEmJmQubm9kZVR5cGU9PT05JiYhdiYmby5tYXRjaC5JRC50ZXN0KHdbMF0pJiYhby5tYXRjaC5JRC50ZXN0KHdbdy5sZW5ndGgtMV0pJiYobj1tLmZpbmQody5zaGlmdCgpLGQsdiksZD1uLmV4cHI/bS5maWx0ZXIobi5leHByLG4uc2V0KVswXTpuLnNldFswXSk7aWYoZCl7bj1mP3tleHByOncucG9wKCksc2V0OnMoZil9Om0uZmluZCh3LnBvcCgpLHcubGVuZ3RoPT09MSYmKHdbMF09PT0ifiJ8fHdbMF09PT0iKyIpJiZkLnBhcmVudE5vZGU/ZC5wYXJlbnROb2RlOmQsdiksaj1uLmV4cHI/bS5maWx0ZXIobi5leHByLG4uc2V0KTpuLnNldCx3Lmxlbmd0aD4wP2s9cyhqKTp1PSExO3doaWxlKHcubGVuZ3RoKXE9dy5wb3AoKSxyPXEsby5yZWxhdGl2ZVtxXT9yPXcucG9wKCk6cT0iIixyPT1udWxsJiYocj1kKSxvLnJlbGF0aXZlW3FdKGsscix2KX1lbHNlIGs9dz1bXX1rfHwoaz1qKSxrfHxtLmVycm9yKHF8fGIpO2lmKGcuY2FsbChrKT09PSJbb2JqZWN0IEFycmF5XSIpaWYoIXUpZS5wdXNoLmFwcGx5KGUsayk7ZWxzZSBpZihkJiZkLm5vZGVUeXBlPT09MSlmb3IodD0wO2tbdF0hPW51bGw7dCsrKWtbdF0mJihrW3RdPT09ITB8fGtbdF0ubm9kZVR5cGU9PT0xJiZtLmNvbnRhaW5zKGQsa1t0XSkpJiZlLnB1c2goalt0XSk7ZWxzZSBmb3IodD0wO2tbdF0hPW51bGw7dCsrKWtbdF0mJmtbdF0ubm9kZVR5cGU9PT0xJiZlLnB1c2goalt0XSk7ZWxzZSBzKGssZSk7bCYmKG0obCxoLGUsZiksbS51bmlxdWVTb3J0KGUpKTtyZXR1cm4gZX07bS51bmlxdWVTb3J0PWZ1bmN0aW9uKGEpe2lmKHUpe2g9aSxhLnNvcnQodSk7aWYoaClmb3IodmFyIGI9MTtiPGEubGVuZ3RoO2IrKylhW2JdPT09YVtiLTFdJiZhLnNwbGljZShiLS0sMSl9cmV0dXJuIGF9LG0ubWF0Y2hlcz1mdW5jdGlvbihhLGIpe3JldHVybiBtKGEsbnVsbCxudWxsLGIpfSxtLm1hdGNoZXNTZWxlY3Rvcj1mdW5jdGlvbihhLGIpe3JldHVybiBtKGIsbnVsbCxudWxsLFthXSkubGVuZ3RoPjB9LG0uZmluZD1mdW5jdGlvbihhLGIsYyl7dmFyIGQsZSxmLGcsaCxpO2lmKCFhKXJldHVybltdO2ZvcihlPTAsZj1vLm9yZGVyLmxlbmd0aDtlPGY7ZSsrKXtoPW8ub3JkZXJbZV07aWYoZz1vLmxlZnRNYXRjaFtoXS5leGVjKGEpKXtpPWdbMV0sZy5zcGxpY2UoMSwxKTtpZihpLnN1YnN0cihpLmxlbmd0aC0xKSE9PSJcXCIpe2dbMV09KGdbMV18fCIiKS5yZXBsYWNlKGosIiIpLGQ9by5maW5kW2hdKGcsYixjKTtpZihkIT1udWxsKXthPWEucmVwbGFjZShvLm1hdGNoW2hdLCIiKTticmVha319fX1kfHwoZD10eXBlb2YgYi5nZXRFbGVtZW50c0J5VGFnTmFtZSE9InVuZGVmaW5lZCI/Yi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpOltdKTtyZXR1cm57c2V0OmQsZXhwcjphfX0sbS5maWx0ZXI9ZnVuY3Rpb24oYSxjLGQsZSl7dmFyIGYsZyxoLGksaixrLGwsbixwLHE9YSxyPVtdLHM9Yyx0PWMmJmNbMF0mJm0uaXNYTUwoY1swXSk7d2hpbGUoYSYmYy5sZW5ndGgpe2ZvcihoIGluIG8uZmlsdGVyKWlmKChmPW8ubGVmdE1hdGNoW2hdLmV4ZWMoYSkpIT1udWxsJiZmWzJdKXtrPW8uZmlsdGVyW2hdLGw9ZlsxXSxnPSExLGYuc3BsaWNlKDEsMSk7aWYobC5zdWJzdHIobC5sZW5ndGgtMSk9PT0iXFwiKWNvbnRpbnVlO3M9PT1yJiYocj1bXSk7aWYoby5wcmVGaWx0ZXJbaF0pe2Y9by5wcmVGaWx0ZXJbaF0oZixzLGQscixlLHQpO2lmKCFmKWc9aT0hMDtlbHNlIGlmKGY9PT0hMCljb250aW51ZX1pZihmKWZvcihuPTA7KGo9c1tuXSkhPW51bGw7bisrKWomJihpPWsoaixmLG4scykscD1lXmksZCYmaSE9bnVsbD9wP2c9ITA6c1tuXT0hMTpwJiYoci5wdXNoKGopLGc9ITApKTtpZihpIT09Yil7ZHx8KHM9ciksYT1hLnJlcGxhY2Uoby5tYXRjaFtoXSwiIik7aWYoIWcpcmV0dXJuW107YnJlYWt9fWlmKGE9PT1xKWlmKGc9PW51bGwpbS5lcnJvcihhKTtlbHNlIGJyZWFrO3E9YX1yZXR1cm4gc30sbS5lcnJvcj1mdW5jdGlvbihhKXt0aHJvdyBuZXcgRXJyb3IoIlN5bnRheCBlcnJvciwgdW5yZWNvZ25pemVkIGV4cHJlc3Npb246ICIrYSl9O3ZhciBuPW0uZ2V0VGV4dD1mdW5jdGlvbihhKXt2YXIgYixjLGQ9YS5ub2RlVHlwZSxlPSIiO2lmKGQpe2lmKGQ9PT0xfHxkPT09OXx8ZD09PTExKXtpZih0eXBlb2YgYS50ZXh0Q29udGVudD09InN0cmluZyIpcmV0dXJuIGEudGV4dENvbnRlbnQ7aWYodHlwZW9mIGEuaW5uZXJUZXh0PT0ic3RyaW5nIilyZXR1cm4gYS5pbm5lclRleHQucmVwbGFjZShrLCIiKTtmb3IoYT1hLmZpcnN0Q2hpbGQ7YTthPWEubmV4dFNpYmxpbmcpZSs9bihhKX1lbHNlIGlmKGQ9PT0zfHxkPT09NClyZXR1cm4gYS5ub2RlVmFsdWV9ZWxzZSBmb3IoYj0wO2M9YVtiXTtiKyspYy5ub2RlVHlwZSE9PTgmJihlKz1uKGMpKTtyZXR1cm4gZX0sbz1tLnNlbGVjdG9ycz17b3JkZXI6WyJJRCIsIk5BTUUiLCJUQUciXSxtYXRjaDp7SUQ6LyMoKD86W1x3XHUwMGMwLVx1RkZGRlwtXXxcXC4pKykvLENMQVNTOi9cLigoPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikrKS8sTkFNRTovXFtuYW1lPVsnIl0qKCg/Oltcd1x1MDBjMC1cdUZGRkZcLV18XFwuKSspWyciXSpcXS8sQVRUUjovXFtccyooKD86W1x3XHUwMGMwLVx1RkZGRlwtXXxcXC4pKylccyooPzooXFM/PSlccyooPzooWyciXSkoLio/KVwzfCgjPyg/Oltcd1x1MDBjMC1cdUZGRkZcLV18XFwuKSopfCl8KVxzKlxdLyxUQUc6L14oKD86W1x3XHUwMGMwLVx1RkZGRlwqXC1dfFxcLikrKS8sQ0hJTEQ6Lzoob25seXxudGh8bGFzdHxmaXJzdCktY2hpbGQoPzpcKFxzKihldmVufG9kZHwoPzpbK1wtXT9cZCt8KD86WytcLV0/XGQqKT9uXHMqKD86WytcLV1ccypcZCspPykpXHMqXCkpPy8sUE9TOi86KG50aHxlcXxndHxsdHxmaXJzdHxsYXN0fGV2ZW58b2RkKSg/OlwoKFxkKilcKSk/KD89W15cLV18JCkvLFBTRVVETzovOigoPzpbXHdcdTAwYzAtXHVGRkZGXC1dfFxcLikrKSg/OlwoKFsnIl0/KSgoPzpcKFteXCldK1wpfFteXChcKV0qKSspXDJcKSk/L30sbGVmdE1hdGNoOnt9LGF0dHJNYXA6eyJjbGFzcyI6ImNsYXNzTmFtZSIsImZvciI6Imh0bWxGb3IifSxhdHRySGFuZGxlOntocmVmOmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZSgiaHJlZiIpfSx0eXBlOmZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZSgidHlwZSIpfX0scmVsYXRpdmU6eyIrIjpmdW5jdGlvbihhLGIpe3ZhciBjPXR5cGVvZiBiPT0ic3RyaW5nIixkPWMmJiFsLnRlc3QoYiksZT1jJiYhZDtkJiYoYj1iLnRvTG93ZXJDYXNlKCkpO2Zvcih2YXIgZj0wLGc9YS5sZW5ndGgsaDtmPGc7ZisrKWlmKGg9YVtmXSl7d2hpbGUoKGg9aC5wcmV2aW91c1NpYmxpbmcpJiZoLm5vZGVUeXBlIT09MSk7YVtmXT1lfHxoJiZoLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1iP2h8fCExOmg9PT1ifWUmJm0uZmlsdGVyKGIsYSwhMCl9LCI+IjpmdW5jdGlvbihhLGIpe3ZhciBjLGQ9dHlwZW9mIGI9PSJzdHJpbmciLGU9MCxmPWEubGVuZ3RoO2lmKGQmJiFsLnRlc3QoYikpe2I9Yi50b0xvd2VyQ2FzZSgpO2Zvcig7ZTxmO2UrKyl7Yz1hW2VdO2lmKGMpe3ZhciBnPWMucGFyZW50Tm9kZTthW2VdPWcubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PWI/ZzohMX19fWVsc2V7Zm9yKDtlPGY7ZSsrKWM9YVtlXSxjJiYoYVtlXT1kP2MucGFyZW50Tm9kZTpjLnBhcmVudE5vZGU9PT1iKTtkJiZtLmZpbHRlcihiLGEsITApfX0sIiI6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGY9ZSsrLGc9eDt0eXBlb2YgYj09InN0cmluZyImJiFsLnRlc3QoYikmJihiPWIudG9Mb3dlckNhc2UoKSxkPWIsZz13KSxnKCJwYXJlbnROb2RlIixiLGYsYSxkLGMpfSwifiI6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGY9ZSsrLGc9eDt0eXBlb2YgYj09InN0cmluZyImJiFsLnRlc3QoYikmJihiPWIudG9Mb3dlckNhc2UoKSxkPWIsZz13KSxnKCJwcmV2aW91c1NpYmxpbmciLGIsZixhLGQsYyl9fSxmaW5kOntJRDpmdW5jdGlvbihhLGIsYyl7aWYodHlwZW9mIGIuZ2V0RWxlbWVudEJ5SWQhPSJ1bmRlZmluZWQiJiYhYyl7dmFyIGQ9Yi5nZXRFbGVtZW50QnlJZChhWzFdKTtyZXR1cm4gZCYmZC5wYXJlbnROb2RlP1tkXTpbXX19LE5BTUU6ZnVuY3Rpb24oYSxiKXtpZih0eXBlb2YgYi5nZXRFbGVtZW50c0J5TmFtZSE9InVuZGVmaW5lZCIpe3ZhciBjPVtdLGQ9Yi5nZXRFbGVtZW50c0J5TmFtZShhWzFdKTtmb3IodmFyIGU9MCxmPWQubGVuZ3RoO2U8ZjtlKyspZFtlXS5nZXRBdHRyaWJ1dGUoIm5hbWUiKT09PWFbMV0mJmMucHVzaChkW2VdKTtyZXR1cm4gYy5sZW5ndGg9PT0wP251bGw6Y319LFRBRzpmdW5jdGlvbihhLGIpe2lmKHR5cGVvZiBiLmdldEVsZW1lbnRzQnlUYWdOYW1lIT0idW5kZWZpbmVkIilyZXR1cm4gYi5nZXRFbGVtZW50c0J5VGFnTmFtZShhWzFdKX19LHByZUZpbHRlcjp7Q0xBU1M6ZnVuY3Rpb24oYSxiLGMsZCxlLGYpe2E9IiAiK2FbMV0ucmVwbGFjZShqLCIiKSsiICI7aWYoZilyZXR1cm4gYTtmb3IodmFyIGc9MCxoOyhoPWJbZ10pIT1udWxsO2crKyloJiYoZV4oaC5jbGFzc05hbWUmJigiICIraC5jbGFzc05hbWUrIiAiKS5yZXBsYWNlKC9bXHRcblxyXS9nLCIgIikuaW5kZXhPZihhKT49MCk/Y3x8ZC5wdXNoKGgpOmMmJihiW2ddPSExKSk7cmV0dXJuITF9LElEOmZ1bmN0aW9uKGEpe3JldHVybiBhWzFdLnJlcGxhY2UoaiwiIil9LFRBRzpmdW5jdGlvbihhLGIpe3JldHVybiBhWzFdLnJlcGxhY2UoaiwiIikudG9Mb3dlckNhc2UoKX0sQ0hJTEQ6ZnVuY3Rpb24oYSl7aWYoYVsxXT09PSJudGgiKXthWzJdfHxtLmVycm9yKGFbMF0pLGFbMl09YVsyXS5yZXBsYWNlKC9eXCt8XHMqL2csIiIpO3ZhciBiPS8oLT8pKFxkKikoPzpuKFsrXC1dP1xkKikpPy8uZXhlYyhhWzJdPT09ImV2ZW4iJiYiMm4ifHxhWzJdPT09Im9kZCImJiIybisxInx8IS9cRC8udGVzdChhWzJdKSYmIjBuKyIrYVsyXXx8YVsyXSk7YVsyXT1iWzFdKyhiWzJdfHwxKS0wLGFbM109YlszXS0wfWVsc2UgYVsyXSYmbS5lcnJvcihhWzBdKTthWzBdPWUrKztyZXR1cm4gYX0sQVRUUjpmdW5jdGlvbihhLGIsYyxkLGUsZil7dmFyIGc9YVsxXT1hWzFdLnJlcGxhY2UoaiwiIik7IWYmJm8uYXR0ck1hcFtnXSYmKGFbMV09by5hdHRyTWFwW2ddKSxhWzRdPShhWzRdfHxhWzVdfHwiIikucmVwbGFjZShqLCIiKSxhWzJdPT09In49IiYmKGFbNF09IiAiK2FbNF0rIiAiKTtyZXR1cm4gYX0sUFNFVURPOmZ1bmN0aW9uKGIsYyxkLGUsZil7aWYoYlsxXT09PSJub3QiKWlmKChhLmV4ZWMoYlszXSl8fCIiKS5sZW5ndGg+MXx8L15cdy8udGVzdChiWzNdKSliWzNdPW0oYlszXSxudWxsLG51bGwsYyk7ZWxzZXt2YXIgZz1tLmZpbHRlcihiWzNdLGMsZCwhMF5mKTtkfHxlLnB1c2guYXBwbHkoZSxnKTtyZXR1cm4hMX1lbHNlIGlmKG8ubWF0Y2guUE9TLnRlc3QoYlswXSl8fG8ubWF0Y2guQ0hJTEQudGVzdChiWzBdKSlyZXR1cm4hMDtyZXR1cm4gYn0sUE9TOmZ1bmN0aW9uKGEpe2EudW5zaGlmdCghMCk7cmV0dXJuIGF9fSxmaWx0ZXJzOntlbmFibGVkOmZ1bmN0aW9uKGEpe3JldHVybiBhLmRpc2FibGVkPT09ITEmJmEudHlwZSE9PSJoaWRkZW4ifSxkaXNhYmxlZDpmdW5jdGlvbihhKXtyZXR1cm4gYS5kaXNhYmxlZD09PSEwfSxjaGVja2VkOmZ1bmN0aW9uKGEpe3JldHVybiBhLmNoZWNrZWQ9PT0hMH0sc2VsZWN0ZWQ6ZnVuY3Rpb24oYSl7YS5wYXJlbnROb2RlJiZhLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleDtyZXR1cm4gYS5zZWxlY3RlZD09PSEwfSxwYXJlbnQ6ZnVuY3Rpb24oYSl7cmV0dXJuISFhLmZpcnN0Q2hpbGR9LGVtcHR5OmZ1bmN0aW9uKGEpe3JldHVybiFhLmZpcnN0Q2hpbGR9LGhhczpmdW5jdGlvbihhLGIsYyl7cmV0dXJuISFtKGNbM10sYSkubGVuZ3RofSxoZWFkZXI6ZnVuY3Rpb24oYSl7cmV0dXJuL2hcZC9pLnRlc3QoYS5ub2RlTmFtZSl9LHRleHQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5nZXRBdHRyaWJ1dGUoInR5cGUiKSxjPWEudHlwZTtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmInRleHQiPT09YyYmKGI9PT1jfHxiPT09bnVsbCl9LHJhZGlvOmZ1bmN0aW9uKGEpe3JldHVybiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT0iaW5wdXQiJiYicmFkaW8iPT09YS50eXBlfSxjaGVja2JveDpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmImNoZWNrYm94Ij09PWEudHlwZX0sZmlsZTpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmImZpbGUiPT09YS50eXBlfSxwYXNzd29yZDpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmInBhc3N3b3JkIj09PWEudHlwZX0sc3VibWl0OmZ1bmN0aW9uKGEpe3ZhciBiPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4oYj09PSJpbnB1dCJ8fGI9PT0iYnV0dG9uIikmJiJzdWJtaXQiPT09YS50eXBlfSxpbWFnZTpmdW5jdGlvbihhKXtyZXR1cm4gYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ImlucHV0IiYmImltYWdlIj09PWEudHlwZX0scmVzZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybihiPT09ImlucHV0Inx8Yj09PSJidXR0b24iKSYmInJlc2V0Ij09PWEudHlwZX0sYnV0dG9uOmZ1bmN0aW9uKGEpe3ZhciBiPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4gYj09PSJpbnB1dCImJiJidXR0b24iPT09YS50eXBlfHxiPT09ImJ1dHRvbiJ9LGlucHV0OmZ1bmN0aW9uKGEpe3JldHVybi9pbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uL2kudGVzdChhLm5vZGVOYW1lKX0sZm9jdXM6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT1hLm93bmVyRG9jdW1lbnQuYWN0aXZlRWxlbWVudH19LHNldEZpbHRlcnM6e2ZpcnN0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIGI9PT0wfSxsYXN0OmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiBiPT09ZC5sZW5ndGgtMX0sZXZlbjpmdW5jdGlvbihhLGIpe3JldHVybiBiJTI9PT0wfSxvZGQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYiUyPT09MX0sbHQ6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBiPGNbM10tMH0sZ3Q6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBiPmNbM10tMH0sbnRoOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gY1szXS0wPT09Yn0sZXE6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBjWzNdLTA9PT1ifX0sZmlsdGVyOntQU0VVRE86ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9YlsxXSxmPW8uZmlsdGVyc1tlXTtpZihmKXJldHVybiBmKGEsYyxiLGQpO2lmKGU9PT0iY29udGFpbnMiKXJldHVybihhLnRleHRDb250ZW50fHxhLmlubmVyVGV4dHx8bihbYV0pfHwiIikuaW5kZXhPZihiWzNdKT49MDtpZihlPT09Im5vdCIpe3ZhciBnPWJbM107Zm9yKHZhciBoPTAsaT1nLmxlbmd0aDtoPGk7aCsrKWlmKGdbaF09PT1hKXJldHVybiExO3JldHVybiEwfW0uZXJyb3IoZSl9LENISUxEOmZ1bmN0aW9uKGEsYil7dmFyIGMsZSxmLGcsaCxpLGosaz1iWzFdLGw9YTtzd2l0Y2goayl7Y2FzZSJvbmx5IjpjYXNlImZpcnN0Ijp3aGlsZShsPWwucHJldmlvdXNTaWJsaW5nKWlmKGwubm9kZVR5cGU9PT0xKXJldHVybiExO2lmKGs9PT0iZmlyc3QiKXJldHVybiEwO2w9YTtjYXNlImxhc3QiOndoaWxlKGw9bC5uZXh0U2libGluZylpZihsLm5vZGVUeXBlPT09MSlyZXR1cm4hMTtyZXR1cm4hMDtjYXNlIm50aCI6Yz1iWzJdLGU9YlszXTtpZihjPT09MSYmZT09PTApcmV0dXJuITA7Zj1iWzBdLGc9YS5wYXJlbnROb2RlO2lmKGcmJihnW2RdIT09Znx8IWEubm9kZUluZGV4KSl7aT0wO2ZvcihsPWcuZmlyc3RDaGlsZDtsO2w9bC5uZXh0U2libGluZylsLm5vZGVUeXBlPT09MSYmKGwubm9kZUluZGV4PSsraSk7Z1tkXT1mfWo9YS5ub2RlSW5kZXgtZTtyZXR1cm4gYz09PTA/aj09PTA6aiVjPT09MCYmai9jPj0wfX0sSUQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYS5ub2RlVHlwZT09PTEmJmEuZ2V0QXR0cmlidXRlKCJpZCIpPT09Yn0sVEFHOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGI9PT0iKiImJmEubm9kZVR5cGU9PT0xfHwhIWEubm9kZU5hbWUmJmEubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PWJ9LENMQVNTOmZ1bmN0aW9uKGEsYil7cmV0dXJuKCIgIisoYS5jbGFzc05hbWV8fGEuZ2V0QXR0cmlidXRlKCJjbGFzcyIpKSsiICIpLmluZGV4T2YoYik+LTF9LEFUVFI6ZnVuY3Rpb24oYSxiKXt2YXIgYz1iWzFdLGQ9bS5hdHRyP20uYXR0cihhLGMpOm8uYXR0ckhhbmRsZVtjXT9vLmF0dHJIYW5kbGVbY10oYSk6YVtjXSE9bnVsbD9hW2NdOmEuZ2V0QXR0cmlidXRlKGMpLGU9ZCsiIixmPWJbMl0sZz1iWzRdO3JldHVybiBkPT1udWxsP2Y9PT0iIT0iOiFmJiZtLmF0dHI/ZCE9bnVsbDpmPT09Ij0iP2U9PT1nOmY9PT0iKj0iP2UuaW5kZXhPZihnKT49MDpmPT09In49Ij8oIiAiK2UrIiAiKS5pbmRleE9mKGcpPj0wOmc/Zj09PSIhPSI/ZSE9PWc6Zj09PSJePSI/ZS5pbmRleE9mKGcpPT09MDpmPT09IiQ9Ij9lLnN1YnN0cihlLmxlbmd0aC1nLmxlbmd0aCk9PT1nOmY9PT0ifD0iP2U9PT1nfHxlLnN1YnN0cigwLGcubGVuZ3RoKzEpPT09ZysiLSI6ITE6ZSYmZCE9PSExfSxQT1M6ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9YlsyXSxmPW8uc2V0RmlsdGVyc1tlXTtpZihmKXJldHVybiBmKGEsYyxiLGQpfX19LHA9by5tYXRjaC5QT1MscT1mdW5jdGlvbihhLGIpe3JldHVybiJcXCIrKGItMCsxKX07Zm9yKHZhciByIGluIG8ubWF0Y2gpby5tYXRjaFtyXT1uZXcgUmVnRXhwKG8ubWF0Y2hbcl0uc291cmNlKy8oPyFbXlxbXSpcXSkoPyFbXlwoXSpcKSkvLnNvdXJjZSksby5sZWZ0TWF0Y2hbcl09bmV3IFJlZ0V4cCgvKF4oPzoufFxyfFxuKSo/KS8uc291cmNlK28ubWF0Y2hbcl0uc291cmNlLnJlcGxhY2UoL1xcKFxkKykvZyxxKSk7by5tYXRjaC5nbG9iYWxQT1M9cDt2YXIgcz1mdW5jdGlvbihhLGIpe2E9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYSwwKTtpZihiKXtiLnB1c2guYXBwbHkoYixhKTtyZXR1cm4gYn1yZXR1cm4gYX07dHJ5e0FycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGMuZG9jdW1lbnRFbGVtZW50LmNoaWxkTm9kZXMsMClbMF0ubm9kZVR5cGV9Y2F0Y2godCl7cz1mdW5jdGlvbihhLGIpe3ZhciBjPTAsZD1ifHxbXTtpZihnLmNhbGwoYSk9PT0iW29iamVjdCBBcnJheV0iKUFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGQsYSk7ZWxzZSBpZih0eXBlb2YgYS5sZW5ndGg9PSJudW1iZXIiKWZvcih2YXIgZT1hLmxlbmd0aDtjPGU7YysrKWQucHVzaChhW2NdKTtlbHNlIGZvcig7YVtjXTtjKyspZC5wdXNoKGFbY10pO3JldHVybiBkfX12YXIgdSx2O2MuZG9jdW1lbnRFbGVtZW50LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uP3U9ZnVuY3Rpb24oYSxiKXtpZihhPT09Yil7aD0hMDtyZXR1cm4gMH1pZighYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbnx8IWIuY29tcGFyZURvY3VtZW50UG9zaXRpb24pcmV0dXJuIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24/LTE6MTtyZXR1cm4gYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihiKSY0Py0xOjF9Oih1PWZ1bmN0aW9uKGEsYil7aWYoYT09PWIpe2g9ITA7cmV0dXJuIDB9aWYoYS5zb3VyY2VJbmRleCYmYi5zb3VyY2VJbmRleClyZXR1cm4gYS5zb3VyY2VJbmRleC1iLnNvdXJjZUluZGV4O3ZhciBjLGQsZT1bXSxmPVtdLGc9YS5wYXJlbnROb2RlLGk9Yi5wYXJlbnROb2RlLGo9ZztpZihnPT09aSlyZXR1cm4gdihhLGIpO2lmKCFnKXJldHVybi0xO2lmKCFpKXJldHVybiAxO3doaWxlKGopZS51bnNoaWZ0KGopLGo9ai5wYXJlbnROb2RlO2o9aTt3aGlsZShqKWYudW5zaGlmdChqKSxqPWoucGFyZW50Tm9kZTtjPWUubGVuZ3RoLGQ9Zi5sZW5ndGg7Zm9yKHZhciBrPTA7azxjJiZrPGQ7aysrKWlmKGVba10hPT1mW2tdKXJldHVybiB2KGVba10sZltrXSk7cmV0dXJuIGs9PT1jP3YoYSxmW2tdLC0xKTp2KGVba10sYiwxKX0sdj1mdW5jdGlvbihhLGIsYyl7aWYoYT09PWIpcmV0dXJuIGM7dmFyIGQ9YS5uZXh0U2libGluZzt3aGlsZShkKXtpZihkPT09YilyZXR1cm4tMTtkPWQubmV4dFNpYmxpbmd9cmV0dXJuIDF9KSxmdW5jdGlvbigpe3ZhciBhPWMuY3JlYXRlRWxlbWVudCgiZGl2IiksZD0ic2NyaXB0IisobmV3IERhdGUpLmdldFRpbWUoKSxlPWMuZG9jdW1lbnRFbGVtZW50O2EuaW5uZXJIVE1MPSI8YSBuYW1lPSciK2QrIicvPiIsZS5pbnNlcnRCZWZvcmUoYSxlLmZpcnN0Q2hpbGQpLGMuZ2V0RWxlbWVudEJ5SWQoZCkmJihvLmZpbmQuSUQ9ZnVuY3Rpb24oYSxjLGQpe2lmKHR5cGVvZiBjLmdldEVsZW1lbnRCeUlkIT0idW5kZWZpbmVkIiYmIWQpe3ZhciBlPWMuZ2V0RWxlbWVudEJ5SWQoYVsxXSk7cmV0dXJuIGU/ZS5pZD09PWFbMV18fHR5cGVvZiBlLmdldEF0dHJpYnV0ZU5vZGUhPSJ1bmRlZmluZWQiJiZlLmdldEF0dHJpYnV0ZU5vZGUoImlkIikubm9kZVZhbHVlPT09YVsxXT9bZV06YjpbXX19LG8uZmlsdGVyLklEPWZ1bmN0aW9uKGEsYil7dmFyIGM9dHlwZW9mIGEuZ2V0QXR0cmlidXRlTm9kZSE9InVuZGVmaW5lZCImJmEuZ2V0QXR0cmlidXRlTm9kZSgiaWQiKTtyZXR1cm4gYS5ub2RlVHlwZT09PTEmJmMmJmMubm9kZVZhbHVlPT09Yn0pLGUucmVtb3ZlQ2hpbGQoYSksZT1hPW51bGx9KCksZnVuY3Rpb24oKXt2YXIgYT1jLmNyZWF0ZUVsZW1lbnQoImRpdiIpO2EuYXBwZW5kQ2hpbGQoYy5jcmVhdGVDb21tZW50KCIiKSksYS5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLmxlbmd0aD4wJiYoby5maW5kLlRBRz1mdW5jdGlvbihhLGIpe3ZhciBjPWIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYVsxXSk7aWYoYVsxXT09PSIqIil7dmFyIGQ9W107Zm9yKHZhciBlPTA7Y1tlXTtlKyspY1tlXS5ub2RlVHlwZT09PTEmJmQucHVzaChjW2VdKTtjPWR9cmV0dXJuIGN9KSxhLmlubmVySFRNTD0iPGEgaHJlZj0nIyc+PC9hPiIsYS5maXJzdENoaWxkJiZ0eXBlb2YgYS5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSE9InVuZGVmaW5lZCImJmEuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoImhyZWYiKSE9PSIjIiYmKG8uYXR0ckhhbmRsZS5ocmVmPWZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZSgiaHJlZiIsMil9KSxhPW51bGx9KCksYy5xdWVyeVNlbGVjdG9yQWxsJiZmdW5jdGlvbigpe3ZhciBhPW0sYj1jLmNyZWF0ZUVsZW1lbnQoImRpdiIpLGQ9Il9fc2l6emxlX18iO2IuaW5uZXJIVE1MPSI8cCBjbGFzcz0nVEVTVCc+PC9wPiI7aWYoIWIucXVlcnlTZWxlY3RvckFsbHx8Yi5xdWVyeVNlbGVjdG9yQWxsKCIuVEVTVCIpLmxlbmd0aCE9PTApe209ZnVuY3Rpb24oYixlLGYsZyl7ZT1lfHxjO2lmKCFnJiYhbS5pc1hNTChlKSl7dmFyIGg9L14oXHcrJCl8XlwuKFtcd1wtXSskKXxeIyhbXHdcLV0rJCkvLmV4ZWMoYik7aWYoaCYmKGUubm9kZVR5cGU9PT0xfHxlLm5vZGVUeXBlPT09OSkpe2lmKGhbMV0pcmV0dXJuIHMoZS5nZXRFbGVtZW50c0J5VGFnTmFtZShiKSxmKTtpZihoWzJdJiZvLmZpbmQuQ0xBU1MmJmUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSlyZXR1cm4gcyhlLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoaFsyXSksZil9aWYoZS5ub2RlVHlwZT09PTkpe2lmKGI9PT0iYm9keSImJmUuYm9keSlyZXR1cm4gcyhbZS5ib2R5XSxmKTtpZihoJiZoWzNdKXt2YXIgaT1lLmdldEVsZW1lbnRCeUlkKGhbM10pO2lmKCFpfHwhaS5wYXJlbnROb2RlKXJldHVybiBzKFtdLGYpO2lmKGkuaWQ9PT1oWzNdKXJldHVybiBzKFtpXSxmKX10cnl7cmV0dXJuIHMoZS5xdWVyeVNlbGVjdG9yQWxsKGIpLGYpfWNhdGNoKGope319ZWxzZSBpZihlLm5vZGVUeXBlPT09MSYmZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpIT09Im9iamVjdCIpe3ZhciBrPWUsbD1lLmdldEF0dHJpYnV0ZSgiaWQiKSxuPWx8fGQscD1lLnBhcmVudE5vZGUscT0vXlxzKlsrfl0vLnRlc3QoYik7bD9uPW4ucmVwbGFjZSgvJy9nLCJcXCQmIik6ZS5zZXRBdHRyaWJ1dGUoImlkIixuKSxxJiZwJiYoZT1lLnBhcmVudE5vZGUpO3RyeXtpZighcXx8cClyZXR1cm4gcyhlLnF1ZXJ5U2VsZWN0b3JBbGwoIltpZD0nIituKyInXSAiK2IpLGYpfWNhdGNoKHIpe31maW5hbGx5e2x8fGsucmVtb3ZlQXR0cmlidXRlKCJpZCIpfX19cmV0dXJuIGEoYixlLGYsZyl9O2Zvcih2YXIgZSBpbiBhKW1bZV09YVtlXTtiPW51bGx9fSgpLGZ1bmN0aW9uKCl7dmFyIGE9Yy5kb2N1bWVudEVsZW1lbnQsYj1hLm1hdGNoZXNTZWxlY3Rvcnx8YS5tb3pNYXRjaGVzU2VsZWN0b3J8fGEud2Via2l0TWF0Y2hlc1NlbGVjdG9yfHxhLm1zTWF0Y2hlc1NlbGVjdG9yO2lmKGIpe3ZhciBkPSFiLmNhbGwoYy5jcmVhdGVFbGVtZW50KCJkaXYiKSwiZGl2IiksZT0hMTt0cnl7Yi5jYWxsKGMuZG9jdW1lbnRFbGVtZW50LCJbdGVzdCE9JyddOnNpenpsZSIpfWNhdGNoKGYpe2U9ITB9bS5tYXRjaGVzU2VsZWN0b3I9ZnVuY3Rpb24oYSxjKXtjPWMucmVwbGFjZSgvXD1ccyooW14nIlxdXSopXHMqXF0vZywiPSckMSddIik7aWYoIW0uaXNYTUwoYSkpdHJ5e2lmKGV8fCFvLm1hdGNoLlBTRVVETy50ZXN0KGMpJiYhLyE9Ly50ZXN0KGMpKXt2YXIgZj1iLmNhbGwoYSxjKTtpZihmfHwhZHx8YS5kb2N1bWVudCYmYS5kb2N1bWVudC5ub2RlVHlwZSE9PTExKXJldHVybiBmfX1jYXRjaChnKXt9cmV0dXJuIG0oYyxudWxsLG51bGwsW2FdKS5sZW5ndGg+MH19fSgpLGZ1bmN0aW9uKCl7dmFyIGE9Yy5jcmVhdGVFbGVtZW50KCJkaXYiKTthLmlubmVySFRNTD0iPGRpdiBjbGFzcz0ndGVzdCBlJz48L2Rpdj48ZGl2IGNsYXNzPSd0ZXN0Jz48L2Rpdj4iO2lmKCEhYS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lJiZhLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImUiKS5sZW5ndGghPT0wKXthLmxhc3RDaGlsZC5jbGFzc05hbWU9ImUiO2lmKGEuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiZSIpLmxlbmd0aD09PTEpcmV0dXJuO28ub3JkZXIuc3BsaWNlKDEsMCwiQ0xBU1MiKSxvLmZpbmQuQ0xBU1M9ZnVuY3Rpb24oYSxiLGMpe2lmKHR5cGVvZiBiLmdldEVsZW1lbnRzQnlDbGFzc05hbWUhPSJ1bmRlZmluZWQiJiYhYylyZXR1cm4gYi5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGFbMV0pfSxhPW51bGx9fSgpLGMuZG9jdW1lbnRFbGVtZW50LmNvbnRhaW5zP20uY29udGFpbnM9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYSE9PWImJihhLmNvbnRhaW5zP2EuY29udGFpbnMoYik6ITApfTpjLmRvY3VtZW50RWxlbWVudC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbj9tLmNvbnRhaW5zPWZ1bmN0aW9uKGEsYil7cmV0dXJuISEoYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihiKSYxNil9Om0uY29udGFpbnM9ZnVuY3Rpb24oKXtyZXR1cm4hMX0sbS5pc1hNTD1mdW5jdGlvbihhKXt2YXIgYj0oYT9hLm93bmVyRG9jdW1lbnR8fGE6MCkuZG9jdW1lbnRFbGVtZW50O3JldHVybiBiP2Iubm9kZU5hbWUhPT0iSFRNTCI6ITF9O3ZhciB5PWZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlPVtdLGY9IiIsZz1iLm5vZGVUeXBlP1tiXTpiO3doaWxlKGQ9by5tYXRjaC5QU0VVRE8uZXhlYyhhKSlmKz1kWzBdLGE9YS5yZXBsYWNlKG8ubWF0Y2guUFNFVURPLCIiKTthPW8ucmVsYXRpdmVbYV0/YSsiKiI6YTtmb3IodmFyIGg9MCxpPWcubGVuZ3RoO2g8aTtoKyspbShhLGdbaF0sZSxjKTtyZXR1cm4gbS5maWx0ZXIoZixlKX07bS5hdHRyPWYuYXR0cixtLnNlbGVjdG9ycy5hdHRyTWFwPXt9LGYuZmluZD1tLGYuZXhwcj1tLnNlbGVjdG9ycyxmLmV4cHJbIjoiXT1mLmV4cHIuZmlsdGVycyxmLnVuaXF1ZT1tLnVuaXF1ZVNvcnQsZi50ZXh0PW0uZ2V0VGV4dCxmLmlzWE1MRG9jPW0uaXNYTUwsZi5jb250YWlucz1tLmNvbnRhaW5zfSgpO3ZhciBMPS9VbnRpbCQvLE09L14oPzpwYXJlbnRzfHByZXZVbnRpbHxwcmV2QWxsKS8sTj0vLC8sTz0vXi5bXjojXFtcLixdKiQvLFA9QXJyYXkucHJvdG90eXBlLnNsaWNlLFE9Zi5leHByLm1hdGNoLmdsb2JhbFBPUyxSPXtjaGlsZHJlbjohMCxjb250ZW50czohMCxuZXh0OiEwLHByZXY6ITB9O2YuZm4uZXh0ZW5kKHtmaW5kOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMsYyxkO2lmKHR5cGVvZiBhIT0ic3RyaW5nIilyZXR1cm4gZihhKS5maWx0ZXIoZnVuY3Rpb24oKXtmb3IoYz0wLGQ9Yi5sZW5ndGg7YzxkO2MrKylpZihmLmNvbnRhaW5zKGJbY10sdGhpcykpcmV0dXJuITB9KTt2YXIgZT10aGlzLnB1c2hTdGFjaygiIiwiZmluZCIsYSksZyxoLGk7Zm9yKGM9MCxkPXRoaXMubGVuZ3RoO2M8ZDtjKyspe2c9ZS5sZW5ndGgsZi5maW5kKGEsdGhpc1tjXSxlKTtpZihjPjApZm9yKGg9ZztoPGUubGVuZ3RoO2grKylmb3IoaT0wO2k8ZztpKyspaWYoZVtpXT09PWVbaF0pe2Uuc3BsaWNlKGgtLSwxKTticmVha319cmV0dXJuIGV9LGhhczpmdW5jdGlvbihhKXt2YXIgYj1mKGEpO3JldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbigpe2Zvcih2YXIgYT0wLGM9Yi5sZW5ndGg7YTxjO2ErKylpZihmLmNvbnRhaW5zKHRoaXMsYlthXSkpcmV0dXJuITB9KX0sbm90OmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnB1c2hTdGFjayhUKHRoaXMsYSwhMSksIm5vdCIsYSl9LGZpbHRlcjpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2soVCh0aGlzLGEsITApLCJmaWx0ZXIiLGEpfSxpczpmdW5jdGlvbihhKXtyZXR1cm4hIWEmJih0eXBlb2YgYT09InN0cmluZyI/US50ZXN0KGEpP2YoYSx0aGlzLmNvbnRleHQpLmluZGV4KHRoaXNbMF0pPj0wOmYuZmlsdGVyKGEsdGhpcykubGVuZ3RoPjA6dGhpcy5maWx0ZXIoYSkubGVuZ3RoPjApfSxjbG9zZXN0OmZ1bmN0aW9uKGEsYil7dmFyIGM9W10sZCxlLGc9dGhpc1swXTtpZihmLmlzQXJyYXkoYSkpe3ZhciBoPTE7d2hpbGUoZyYmZy5vd25lckRvY3VtZW50JiZnIT09Yil7Zm9yKGQ9MDtkPGEubGVuZ3RoO2QrKylmKGcpLmlzKGFbZF0pJiZjLnB1c2goe3NlbGVjdG9yOmFbZF0sZWxlbTpnLGxldmVsOmh9KTtnPWcucGFyZW50Tm9kZSxoKyt9cmV0dXJuIGN9dmFyIGk9US50ZXN0KGEpfHx0eXBlb2YgYSE9InN0cmluZyI/ZihhLGJ8fHRoaXMuY29udGV4dCk6MDtmb3IoZD0wLGU9dGhpcy5sZW5ndGg7ZDxlO2QrKyl7Zz10aGlzW2RdO3doaWxlKGcpe2lmKGk/aS5pbmRleChnKT4tMTpmLmZpbmQubWF0Y2hlc1NlbGVjdG9yKGcsYSkpe2MucHVzaChnKTticmVha31nPWcucGFyZW50Tm9kZTtpZighZ3x8IWcub3duZXJEb2N1bWVudHx8Zz09PWJ8fGcubm9kZVR5cGU9PT0xMSlicmVha319Yz1jLmxlbmd0aD4xP2YudW5pcXVlKGMpOmM7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGMsImNsb3Nlc3QiLGEpfSxpbmRleDpmdW5jdGlvbihhKXtpZighYSlyZXR1cm4gdGhpc1swXSYmdGhpc1swXS5wYXJlbnROb2RlP3RoaXMucHJldkFsbCgpLmxlbmd0aDotMTtpZih0eXBlb2YgYT09InN0cmluZyIpcmV0dXJuIGYuaW5BcnJheSh0aGlzWzBdLGYoYSkpO3JldHVybiBmLmluQXJyYXkoYS5qcXVlcnk/YVswXTphLHRoaXMpfSxhZGQ6ZnVuY3Rpb24oYSxiKXt2YXIgYz10eXBlb2YgYT09InN0cmluZyI/ZihhLGIpOmYubWFrZUFycmF5KGEmJmEubm9kZVR5cGU/W2FdOmEpLGQ9Zi5tZXJnZSh0aGlzLmdldCgpLGMpO3JldHVybiB0aGlzLnB1c2hTdGFjayhTKGNbMF0pfHxTKGRbMF0pP2Q6Zi51bmlxdWUoZCkpfSxhbmRTZWxmOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuYWRkKHRoaXMucHJldk9iamVjdCl9fSksZi5lYWNoKHtwYXJlbnQ6ZnVuY3Rpb24oYSl7dmFyIGI9YS5wYXJlbnROb2RlO3JldHVybiBiJiZiLm5vZGVUeXBlIT09MTE/YjpudWxsfSxwYXJlbnRzOmZ1bmN0aW9uKGEpe3JldHVybiBmLmRpcihhLCJwYXJlbnROb2RlIil9LHBhcmVudHNVbnRpbDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuZGlyKGEsInBhcmVudE5vZGUiLGMpfSxuZXh0OmZ1bmN0aW9uKGEpe3JldHVybiBmLm50aChhLDIsIm5leHRTaWJsaW5nIil9LHByZXY6ZnVuY3Rpb24oYSl7cmV0dXJuIGYubnRoKGEsMiwicHJldmlvdXNTaWJsaW5nIil9LG5leHRBbGw6ZnVuY3Rpb24oYSl7cmV0dXJuIGYuZGlyKGEsIm5leHRTaWJsaW5nIil9LHByZXZBbGw6ZnVuY3Rpb24oYSl7cmV0dXJuIGYuZGlyKGEsInByZXZpb3VzU2libGluZyIpfSxuZXh0VW50aWw6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBmLmRpcihhLCJuZXh0U2libGluZyIsYyl9LHByZXZVbnRpbDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGYuZGlyKGEsInByZXZpb3VzU2libGluZyIsYyl9LHNpYmxpbmdzOmZ1bmN0aW9uKGEpe3JldHVybiBmLnNpYmxpbmcoKGEucGFyZW50Tm9kZXx8e30pLmZpcnN0Q2hpbGQsYSl9LGNoaWxkcmVuOmZ1bmN0aW9uKGEpe3JldHVybiBmLnNpYmxpbmcoYS5maXJzdENoaWxkKX0sY29udGVudHM6ZnVuY3Rpb24oYSl7cmV0dXJuIGYubm9kZU5hbWUoYSwiaWZyYW1lIik/YS5jb250ZW50RG9jdW1lbnR8fGEuY29udGVudFdpbmRvdy5kb2N1bWVudDpmLm1ha2VBcnJheShhLmNoaWxkTm9kZXMpfX0sZnVuY3Rpb24oYSxiKXtmLmZuW2FdPWZ1bmN0aW9uKGMsZCl7dmFyIGU9Zi5tYXAodGhpcyxiLGMpO0wudGVzdChhKXx8KGQ9YyksZCYmdHlwZW9mIGQ9PSJzdHJpbmciJiYoZT1mLmZpbHRlcihkLGUpKSxlPXRoaXMubGVuZ3RoPjEmJiFSW2FdP2YudW5pcXVlKGUpOmUsKHRoaXMubGVuZ3RoPjF8fE4udGVzdChkKSkmJk0udGVzdChhKSYmKGU9ZS5yZXZlcnNlKCkpO3JldHVybiB0aGlzLnB1c2hTdGFjayhlLGEsUC5jYWxsKGFyZ3VtZW50cykuam9pbigiLCIpKX19KSxmLmV4dGVuZCh7ZmlsdGVyOmZ1bmN0aW9uKGEsYixjKXtjJiYoYT0iOm5vdCgiK2ErIikiKTtyZXR1cm4gYi5sZW5ndGg9PT0xP2YuZmluZC5tYXRjaGVzU2VsZWN0b3IoYlswXSxhKT9bYlswXV06W106Zi5maW5kLm1hdGNoZXMoYSxiKX0sZGlyOmZ1bmN0aW9uKGEsYyxkKXt2YXIgZT1bXSxnPWFbY107d2hpbGUoZyYmZy5ub2RlVHlwZSE9PTkmJihkPT09Ynx8Zy5ub2RlVHlwZSE9PTF8fCFmKGcpLmlzKGQpKSlnLm5vZGVUeXBlPT09MSYmZS5wdXNoKGcpLGc9Z1tjXTtyZXR1cm4gZX0sbnRoOmZ1bmN0aW9uKGEsYixjLGQpe2I9Ynx8MTt2YXIgZT0wO2Zvcig7YTthPWFbY10paWYoYS5ub2RlVHlwZT09PTEmJisrZT09PWIpYnJlYWs7cmV0dXJuIGF9LHNpYmxpbmc6ZnVuY3Rpb24oYSxiKXt2YXIgYz1bXTtmb3IoO2E7YT1hLm5leHRTaWJsaW5nKWEubm9kZVR5cGU9PT0xJiZhIT09YiYmYy5wdXNoKGEpO3JldHVybiBjfX0pO3ZhciBWPSJhYmJyfGFydGljbGV8YXNpZGV8YXVkaW98YmRpfGNhbnZhc3xkYXRhfGRhdGFsaXN0fGRldGFpbHN8ZmlnY2FwdGlvbnxmaWd1cmV8Zm9vdGVyfGhlYWRlcnxoZ3JvdXB8bWFya3xtZXRlcnxuYXZ8b3V0cHV0fHByb2dyZXNzfHNlY3Rpb258c3VtbWFyeXx0aW1lfHZpZGVvIixXPS8galF1ZXJ5XGQrPSIoPzpcZCt8bnVsbCkiL2csWD0vXlxzKy8sWT0vPCg/IWFyZWF8YnJ8Y29sfGVtYmVkfGhyfGltZ3xpbnB1dHxsaW5rfG1ldGF8cGFyYW0pKChbXHc6XSspW14+XSopXC8+L2lnLFo9LzwoW1x3Ol0rKS8sJD0vPHRib2R5L2ksXz0vPHwmIz9cdys7LyxiYT0vPCg/OnNjcmlwdHxzdHlsZSkvaSxiYj0vPCg/OnNjcmlwdHxvYmplY3R8ZW1iZWR8b3B0aW9ufHN0eWxlKS9pLGJjPW5ldyBSZWdFeHAoIjwoPzoiK1YrIilbXFxzLz5dIiwiaSIpLGJkPS9jaGVja2VkXHMqKD86W149XXw9XHMqLmNoZWNrZWQuKS9pLGJlPS9cLyhqYXZhfGVjbWEpc2NyaXB0L2ksYmY9L15ccyo8ISg/OlxbQ0RBVEFcW3xcLVwtKS8sYmc9e29wdGlvbjpbMSwiPHNlbGVjdCBtdWx0aXBsZT0nbXVsdGlwbGUnPiIsIjwvc2VsZWN0PiJdLGxlZ2VuZDpbMSwiPGZpZWxkc2V0PiIsIjwvZmllbGRzZXQ+Il0sdGhlYWQ6WzEsIjx0YWJsZT4iLCI8L3RhYmxlPiJdLHRyOlsyLCI8dGFibGU+PHRib2R5PiIsIjwvdGJvZHk+PC90YWJsZT4iXSx0ZDpbMywiPHRhYmxlPjx0Ym9keT48dHI+IiwiPC90cj48L3Rib2R5PjwvdGFibGU+Il0sY29sOlsyLCI8dGFibGU+PHRib2R5PjwvdGJvZHk+PGNvbGdyb3VwPiIsIjwvY29sZ3JvdXA+PC90YWJsZT4iXSxhcmVhOlsxLCI8bWFwPiIsIjwvbWFwPiJdLF9kZWZhdWx0OlswLCIiLCIiXX0sYmg9VShjKTtiZy5vcHRncm91cD1iZy5vcHRpb24sYmcudGJvZHk9YmcudGZvb3Q9YmcuY29sZ3JvdXA9YmcuY2FwdGlvbj1iZy50aGVhZCxiZy50aD1iZy50ZCxmLnN1cHBvcnQuaHRtbFNlcmlhbGl6ZXx8KGJnLl9kZWZhdWx0PVsxLCJkaXY8ZGl2PiIsIjwvZGl2PiJdKSxmLmZuLmV4dGVuZCh7dGV4dDpmdW5jdGlvbihhKXtyZXR1cm4gZi5hY2Nlc3ModGhpcyxmdW5jdGlvbihhKXtyZXR1cm4gYT09PWI/Zi50ZXh0KHRoaXMpOnRoaXMuZW1wdHkoKS5hcHBlbmQoKHRoaXNbMF0mJnRoaXNbMF0ub3duZXJEb2N1bWVudHx8YykuY3JlYXRlVGV4dE5vZGUoYSkpfSxudWxsLGEsYXJndW1lbnRzLmxlbmd0aCl9LHdyYXBBbGw6ZnVuY3Rpb24oYSl7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7Zih0aGlzKS53cmFwQWxsKGEuY2FsbCh0aGlzLGIpKX0pO2lmKHRoaXNbMF0pe3ZhciBiPWYoYSx0aGlzWzBdLm93bmVyRG9jdW1lbnQpLmVxKDApLmNsb25lKCEwKTt0aGlzWzBdLnBhcmVudE5vZGUmJmIuaW5zZXJ0QmVmb3JlKHRoaXNbMF0pLGIubWFwKGZ1bmN0aW9uKCl7dmFyIGE9dGhpczt3aGlsZShhLmZpcnN0Q2hpbGQmJmEuZmlyc3RDaGlsZC5ub2RlVHlwZT09PTEpYT1hLmZpcnN0Q2hpbGQ7cmV0dXJuIGF9KS5hcHBlbmQodGhpcyl9cmV0dXJuIHRoaXN9LHdyYXBJbm5lcjpmdW5jdGlvbihhKXtpZihmLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXtmKHRoaXMpLndyYXBJbm5lcihhLmNhbGwodGhpcyxiKSl9KTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9Zih0aGlzKSxjPWIuY29udGVudHMoKTtjLmxlbmd0aD9jLndyYXBBbGwoYSk6Yi5hcHBlbmQoYSl9KX0sd3JhcDpmdW5jdGlvbihhKXt2YXIgYj1mLmlzRnVuY3Rpb24oYSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihjKXtmKHRoaXMpLndyYXBBbGwoYj9hLmNhbGwodGhpcyxjKTphKX0pfSx1bndyYXA6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uKCl7Zi5ub2RlTmFtZSh0aGlzLCJib2R5Iil8fGYodGhpcykucmVwbGFjZVdpdGgodGhpcy5jaGlsZE5vZGVzKX0pLmVuZCgpfSxhcHBlbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsITAsZnVuY3Rpb24oYSl7dGhpcy5ub2RlVHlwZT09PTEmJnRoaXMuYXBwZW5kQ2hpbGQoYSl9KX0scHJlcGVuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywhMCxmdW5jdGlvbihhKXt0aGlzLm5vZGVUeXBlPT09MSYmdGhpcy5pbnNlcnRCZWZvcmUoYSx0aGlzLmZpcnN0Q2hpbGQpfSl9LGJlZm9yZTpmdW5jdGlvbigpe2lmKHRoaXNbMF0mJnRoaXNbMF0ucGFyZW50Tm9kZSlyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsITEsZnVuY3Rpb24oYSl7dGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLHRoaXMpfSk7aWYoYXJndW1lbnRzLmxlbmd0aCl7dmFyIGE9ZgouY2xlYW4oYXJndW1lbnRzKTthLnB1c2guYXBwbHkoYSx0aGlzLnRvQXJyYXkoKSk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGEsImJlZm9yZSIsYXJndW1lbnRzKX19LGFmdGVyOmZ1bmN0aW9uKCl7aWYodGhpc1swXSYmdGhpc1swXS5wYXJlbnROb2RlKXJldHVybiB0aGlzLmRvbU1hbmlwKGFyZ3VtZW50cywhMSxmdW5jdGlvbihhKXt0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGEsdGhpcy5uZXh0U2libGluZyl9KTtpZihhcmd1bWVudHMubGVuZ3RoKXt2YXIgYT10aGlzLnB1c2hTdGFjayh0aGlzLCJhZnRlciIsYXJndW1lbnRzKTthLnB1c2guYXBwbHkoYSxmLmNsZWFuKGFyZ3VtZW50cykpO3JldHVybiBhfX0scmVtb3ZlOmZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjPTAsZDsoZD10aGlzW2NdKSE9bnVsbDtjKyspaWYoIWF8fGYuZmlsdGVyKGEsW2RdKS5sZW5ndGgpIWImJmQubm9kZVR5cGU9PT0xJiYoZi5jbGVhbkRhdGEoZC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpKSxmLmNsZWFuRGF0YShbZF0pKSxkLnBhcmVudE5vZGUmJmQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChkKTtyZXR1cm4gdGhpc30sZW1wdHk6ZnVuY3Rpb24oKXtmb3IodmFyIGE9MCxiOyhiPXRoaXNbYV0pIT1udWxsO2ErKyl7Yi5ub2RlVHlwZT09PTEmJmYuY2xlYW5EYXRhKGIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoIioiKSk7d2hpbGUoYi5maXJzdENoaWxkKWIucmVtb3ZlQ2hpbGQoYi5maXJzdENoaWxkKX1yZXR1cm4gdGhpc30sY2xvbmU6ZnVuY3Rpb24oYSxiKXthPWE9PW51bGw/ITE6YSxiPWI9PW51bGw/YTpiO3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3JldHVybiBmLmNsb25lKHRoaXMsYSxiKX0pfSxodG1sOmZ1bmN0aW9uKGEpe3JldHVybiBmLmFjY2Vzcyh0aGlzLGZ1bmN0aW9uKGEpe3ZhciBjPXRoaXNbMF18fHt9LGQ9MCxlPXRoaXMubGVuZ3RoO2lmKGE9PT1iKXJldHVybiBjLm5vZGVUeXBlPT09MT9jLmlubmVySFRNTC5yZXBsYWNlKFcsIiIpOm51bGw7aWYodHlwZW9mIGE9PSJzdHJpbmciJiYhYmEudGVzdChhKSYmKGYuc3VwcG9ydC5sZWFkaW5nV2hpdGVzcGFjZXx8IVgudGVzdChhKSkmJiFiZ1soWi5leGVjKGEpfHxbIiIsIiJdKVsxXS50b0xvd2VyQ2FzZSgpXSl7YT1hLnJlcGxhY2UoWSwiPCQxPjwvJDI+Iik7dHJ5e2Zvcig7ZDxlO2QrKyljPXRoaXNbZF18fHt9LGMubm9kZVR5cGU9PT0xJiYoZi5jbGVhbkRhdGEoYy5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpKSxjLmlubmVySFRNTD1hKTtjPTB9Y2F0Y2goZyl7fX1jJiZ0aGlzLmVtcHR5KCkuYXBwZW5kKGEpfSxudWxsLGEsYXJndW1lbnRzLmxlbmd0aCl9LHJlcGxhY2VXaXRoOmZ1bmN0aW9uKGEpe2lmKHRoaXNbMF0mJnRoaXNbMF0ucGFyZW50Tm9kZSl7aWYoZi5pc0Z1bmN0aW9uKGEpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oYil7dmFyIGM9Zih0aGlzKSxkPWMuaHRtbCgpO2MucmVwbGFjZVdpdGgoYS5jYWxsKHRoaXMsYixkKSl9KTt0eXBlb2YgYSE9InN0cmluZyImJihhPWYoYSkuZGV0YWNoKCkpO3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYj10aGlzLm5leHRTaWJsaW5nLGM9dGhpcy5wYXJlbnROb2RlO2YodGhpcykucmVtb3ZlKCksYj9mKGIpLmJlZm9yZShhKTpmKGMpLmFwcGVuZChhKX0pfXJldHVybiB0aGlzLmxlbmd0aD90aGlzLnB1c2hTdGFjayhmKGYuaXNGdW5jdGlvbihhKT9hKCk6YSksInJlcGxhY2VXaXRoIixhKTp0aGlzfSxkZXRhY2g6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMucmVtb3ZlKGEsITApfSxkb21NYW5pcDpmdW5jdGlvbihhLGMsZCl7dmFyIGUsZyxoLGksaj1hWzBdLGs9W107aWYoIWYuc3VwcG9ydC5jaGVja0Nsb25lJiZhcmd1bWVudHMubGVuZ3RoPT09MyYmdHlwZW9mIGo9PSJzdHJpbmciJiZiZC50ZXN0KGopKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtmKHRoaXMpLmRvbU1hbmlwKGEsYyxkLCEwKX0pO2lmKGYuaXNGdW5jdGlvbihqKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGUpe3ZhciBnPWYodGhpcyk7YVswXT1qLmNhbGwodGhpcyxlLGM/Zy5odG1sKCk6YiksZy5kb21NYW5pcChhLGMsZCl9KTtpZih0aGlzWzBdKXtpPWomJmoucGFyZW50Tm9kZSxmLnN1cHBvcnQucGFyZW50Tm9kZSYmaSYmaS5ub2RlVHlwZT09PTExJiZpLmNoaWxkTm9kZXMubGVuZ3RoPT09dGhpcy5sZW5ndGg/ZT17ZnJhZ21lbnQ6aX06ZT1mLmJ1aWxkRnJhZ21lbnQoYSx0aGlzLGspLGg9ZS5mcmFnbWVudCxoLmNoaWxkTm9kZXMubGVuZ3RoPT09MT9nPWg9aC5maXJzdENoaWxkOmc9aC5maXJzdENoaWxkO2lmKGcpe2M9YyYmZi5ub2RlTmFtZShnLCJ0ciIpO2Zvcih2YXIgbD0wLG09dGhpcy5sZW5ndGgsbj1tLTE7bDxtO2wrKylkLmNhbGwoYz9iaSh0aGlzW2xdLGcpOnRoaXNbbF0sZS5jYWNoZWFibGV8fG0+MSYmbDxuP2YuY2xvbmUoaCwhMCwhMCk6aCl9ay5sZW5ndGgmJmYuZWFjaChrLGZ1bmN0aW9uKGEsYil7Yi5zcmM/Zi5hamF4KHt0eXBlOiJHRVQiLGdsb2JhbDohMSx1cmw6Yi5zcmMsYXN5bmM6ITEsZGF0YVR5cGU6InNjcmlwdCJ9KTpmLmdsb2JhbEV2YWwoKGIudGV4dHx8Yi50ZXh0Q29udGVudHx8Yi5pbm5lckhUTUx8fCIiKS5yZXBsYWNlKGJmLCIvKiQwKi8iKSksYi5wYXJlbnROb2RlJiZiLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYil9KX1yZXR1cm4gdGhpc319KSxmLmJ1aWxkRnJhZ21lbnQ9ZnVuY3Rpb24oYSxiLGQpe3ZhciBlLGcsaCxpLGo9YVswXTtiJiZiWzBdJiYoaT1iWzBdLm93bmVyRG9jdW1lbnR8fGJbMF0pLGkuY3JlYXRlRG9jdW1lbnRGcmFnbWVudHx8KGk9YyksYS5sZW5ndGg9PT0xJiZ0eXBlb2Ygaj09InN0cmluZyImJmoubGVuZ3RoPDUxMiYmaT09PWMmJmouY2hhckF0KDApPT09IjwiJiYhYmIudGVzdChqKSYmKGYuc3VwcG9ydC5jaGVja0Nsb25lfHwhYmQudGVzdChqKSkmJihmLnN1cHBvcnQuaHRtbDVDbG9uZXx8IWJjLnRlc3QoaikpJiYoZz0hMCxoPWYuZnJhZ21lbnRzW2pdLGgmJmghPT0xJiYoZT1oKSksZXx8KGU9aS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksZi5jbGVhbihhLGksZSxkKSksZyYmKGYuZnJhZ21lbnRzW2pdPWg/ZToxKTtyZXR1cm57ZnJhZ21lbnQ6ZSxjYWNoZWFibGU6Z319LGYuZnJhZ21lbnRzPXt9LGYuZWFjaCh7YXBwZW5kVG86ImFwcGVuZCIscHJlcGVuZFRvOiJwcmVwZW5kIixpbnNlcnRCZWZvcmU6ImJlZm9yZSIsaW5zZXJ0QWZ0ZXI6ImFmdGVyIixyZXBsYWNlQWxsOiJyZXBsYWNlV2l0aCJ9LGZ1bmN0aW9uKGEsYil7Zi5mblthXT1mdW5jdGlvbihjKXt2YXIgZD1bXSxlPWYoYyksZz10aGlzLmxlbmd0aD09PTEmJnRoaXNbMF0ucGFyZW50Tm9kZTtpZihnJiZnLm5vZGVUeXBlPT09MTEmJmcuY2hpbGROb2Rlcy5sZW5ndGg9PT0xJiZlLmxlbmd0aD09PTEpe2VbYl0odGhpc1swXSk7cmV0dXJuIHRoaXN9Zm9yKHZhciBoPTAsaT1lLmxlbmd0aDtoPGk7aCsrKXt2YXIgaj0oaD4wP3RoaXMuY2xvbmUoITApOnRoaXMpLmdldCgpO2YoZVtoXSlbYl0oaiksZD1kLmNvbmNhdChqKX1yZXR1cm4gdGhpcy5wdXNoU3RhY2soZCxhLGUuc2VsZWN0b3IpfX0pLGYuZXh0ZW5kKHtjbG9uZTpmdW5jdGlvbihhLGIsYyl7dmFyIGQsZSxnLGg9Zi5zdXBwb3J0Lmh0bWw1Q2xvbmV8fGYuaXNYTUxEb2MoYSl8fCFiYy50ZXN0KCI8IithLm5vZGVOYW1lKyI+Iik/YS5jbG9uZU5vZGUoITApOmJvKGEpO2lmKCghZi5zdXBwb3J0Lm5vQ2xvbmVFdmVudHx8IWYuc3VwcG9ydC5ub0Nsb25lQ2hlY2tlZCkmJihhLm5vZGVUeXBlPT09MXx8YS5ub2RlVHlwZT09PTExKSYmIWYuaXNYTUxEb2MoYSkpe2JrKGEsaCksZD1ibChhKSxlPWJsKGgpO2ZvcihnPTA7ZFtnXTsrK2cpZVtnXSYmYmsoZFtnXSxlW2ddKX1pZihiKXtiaihhLGgpO2lmKGMpe2Q9YmwoYSksZT1ibChoKTtmb3IoZz0wO2RbZ107KytnKWJqKGRbZ10sZVtnXSl9fWQ9ZT1udWxsO3JldHVybiBofSxjbGVhbjpmdW5jdGlvbihhLGIsZCxlKXt2YXIgZyxoLGksaj1bXTtiPWJ8fGMsdHlwZW9mIGIuY3JlYXRlRWxlbWVudD09InVuZGVmaW5lZCImJihiPWIub3duZXJEb2N1bWVudHx8YlswXSYmYlswXS5vd25lckRvY3VtZW50fHxjKTtmb3IodmFyIGs9MCxsOyhsPWFba10pIT1udWxsO2srKyl7dHlwZW9mIGw9PSJudW1iZXIiJiYobCs9IiIpO2lmKCFsKWNvbnRpbnVlO2lmKHR5cGVvZiBsPT0ic3RyaW5nIilpZighXy50ZXN0KGwpKWw9Yi5jcmVhdGVUZXh0Tm9kZShsKTtlbHNle2w9bC5yZXBsYWNlKFksIjwkMT48LyQyPiIpO3ZhciBtPShaLmV4ZWMobCl8fFsiIiwiIl0pWzFdLnRvTG93ZXJDYXNlKCksbj1iZ1ttXXx8YmcuX2RlZmF1bHQsbz1uWzBdLHA9Yi5jcmVhdGVFbGVtZW50KCJkaXYiKSxxPWJoLmNoaWxkTm9kZXMscjtiPT09Yz9iaC5hcHBlbmRDaGlsZChwKTpVKGIpLmFwcGVuZENoaWxkKHApLHAuaW5uZXJIVE1MPW5bMV0rbCtuWzJdO3doaWxlKG8tLSlwPXAubGFzdENoaWxkO2lmKCFmLnN1cHBvcnQudGJvZHkpe3ZhciBzPSQudGVzdChsKSx0PW09PT0idGFibGUiJiYhcz9wLmZpcnN0Q2hpbGQmJnAuZmlyc3RDaGlsZC5jaGlsZE5vZGVzOm5bMV09PT0iPHRhYmxlPiImJiFzP3AuY2hpbGROb2RlczpbXTtmb3IoaT10Lmxlbmd0aC0xO2k+PTA7LS1pKWYubm9kZU5hbWUodFtpXSwidGJvZHkiKSYmIXRbaV0uY2hpbGROb2Rlcy5sZW5ndGgmJnRbaV0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0W2ldKX0hZi5zdXBwb3J0LmxlYWRpbmdXaGl0ZXNwYWNlJiZYLnRlc3QobCkmJnAuaW5zZXJ0QmVmb3JlKGIuY3JlYXRlVGV4dE5vZGUoWC5leGVjKGwpWzBdKSxwLmZpcnN0Q2hpbGQpLGw9cC5jaGlsZE5vZGVzLHAmJihwLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocCkscS5sZW5ndGg+MCYmKHI9cVtxLmxlbmd0aC0xXSxyJiZyLnBhcmVudE5vZGUmJnIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChyKSkpfXZhciB1O2lmKCFmLnN1cHBvcnQuYXBwZW5kQ2hlY2tlZClpZihsWzBdJiZ0eXBlb2YgKHU9bC5sZW5ndGgpPT0ibnVtYmVyIilmb3IoaT0wO2k8dTtpKyspYm4obFtpXSk7ZWxzZSBibihsKTtsLm5vZGVUeXBlP2oucHVzaChsKTpqPWYubWVyZ2UoaixsKX1pZihkKXtnPWZ1bmN0aW9uKGEpe3JldHVybiFhLnR5cGV8fGJlLnRlc3QoYS50eXBlKX07Zm9yKGs9MDtqW2tdO2srKyl7aD1qW2tdO2lmKGUmJmYubm9kZU5hbWUoaCwic2NyaXB0IikmJighaC50eXBlfHxiZS50ZXN0KGgudHlwZSkpKWUucHVzaChoLnBhcmVudE5vZGU/aC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGgpOmgpO2Vsc2V7aWYoaC5ub2RlVHlwZT09PTEpe3ZhciB2PWYuZ3JlcChoLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzY3JpcHQiKSxnKTtqLnNwbGljZS5hcHBseShqLFtrKzEsMF0uY29uY2F0KHYpKX1kLmFwcGVuZENoaWxkKGgpfX19cmV0dXJuIGp9LGNsZWFuRGF0YTpmdW5jdGlvbihhKXt2YXIgYixjLGQ9Zi5jYWNoZSxlPWYuZXZlbnQuc3BlY2lhbCxnPWYuc3VwcG9ydC5kZWxldGVFeHBhbmRvO2Zvcih2YXIgaD0wLGk7KGk9YVtoXSkhPW51bGw7aCsrKXtpZihpLm5vZGVOYW1lJiZmLm5vRGF0YVtpLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKWNvbnRpbnVlO2M9aVtmLmV4cGFuZG9dO2lmKGMpe2I9ZFtjXTtpZihiJiZiLmV2ZW50cyl7Zm9yKHZhciBqIGluIGIuZXZlbnRzKWVbal0/Zi5ldmVudC5yZW1vdmUoaSxqKTpmLnJlbW92ZUV2ZW50KGksaixiLmhhbmRsZSk7Yi5oYW5kbGUmJihiLmhhbmRsZS5lbGVtPW51bGwpfWc/ZGVsZXRlIGlbZi5leHBhbmRvXTppLnJlbW92ZUF0dHJpYnV0ZSYmaS5yZW1vdmVBdHRyaWJ1dGUoZi5leHBhbmRvKSxkZWxldGUgZFtjXX19fX0pO3ZhciBicD0vYWxwaGFcKFteKV0qXCkvaSxicT0vb3BhY2l0eT0oW14pXSopLyxicj0vKFtBLVpdfF5tcykvZyxicz0vXltcLStdPyg/OlxkKlwuKT9cZCskL2ksYnQ9L14tPyg/OlxkKlwuKT9cZCsoPyFweClbXlxkXHNdKyQvaSxidT0vXihbXC0rXSk9KFtcLSsuXGRlXSspLyxidj0vXm1hcmdpbi8sYnc9e3Bvc2l0aW9uOiJhYnNvbHV0ZSIsdmlzaWJpbGl0eToiaGlkZGVuIixkaXNwbGF5OiJibG9jayJ9LGJ4PVsiVG9wIiwiUmlnaHQiLCJCb3R0b20iLCJMZWZ0Il0sYnksYnosYkE7Zi5mbi5jc3M9ZnVuY3Rpb24oYSxjKXtyZXR1cm4gZi5hY2Nlc3ModGhpcyxmdW5jdGlvbihhLGMsZCl7cmV0dXJuIGQhPT1iP2Yuc3R5bGUoYSxjLGQpOmYuY3NzKGEsYyl9LGEsYyxhcmd1bWVudHMubGVuZ3RoPjEpfSxmLmV4dGVuZCh7Y3NzSG9va3M6e29wYWNpdHk6e2dldDpmdW5jdGlvbihhLGIpe2lmKGIpe3ZhciBjPWJ5KGEsIm9wYWNpdHkiKTtyZXR1cm4gYz09PSIiPyIxIjpjfXJldHVybiBhLnN0eWxlLm9wYWNpdHl9fX0sY3NzTnVtYmVyOntmaWxsT3BhY2l0eTohMCxmb250V2VpZ2h0OiEwLGxpbmVIZWlnaHQ6ITAsb3BhY2l0eTohMCxvcnBoYW5zOiEwLHdpZG93czohMCx6SW5kZXg6ITAsem9vbTohMH0sY3NzUHJvcHM6eyJmbG9hdCI6Zi5zdXBwb3J0LmNzc0Zsb2F0PyJjc3NGbG9hdCI6InN0eWxlRmxvYXQifSxzdHlsZTpmdW5jdGlvbihhLGMsZCxlKXtpZighIWEmJmEubm9kZVR5cGUhPT0zJiZhLm5vZGVUeXBlIT09OCYmISFhLnN0eWxlKXt2YXIgZyxoLGk9Zi5jYW1lbENhc2UoYyksaj1hLnN0eWxlLGs9Zi5jc3NIb29rc1tpXTtjPWYuY3NzUHJvcHNbaV18fGk7aWYoZD09PWIpe2lmKGsmJiJnZXQiaW4gayYmKGc9ay5nZXQoYSwhMSxlKSkhPT1iKXJldHVybiBnO3JldHVybiBqW2NdfWg9dHlwZW9mIGQsaD09PSJzdHJpbmciJiYoZz1idS5leGVjKGQpKSYmKGQ9KyhnWzFdKzEpKitnWzJdK3BhcnNlRmxvYXQoZi5jc3MoYSxjKSksaD0ibnVtYmVyIik7aWYoZD09bnVsbHx8aD09PSJudW1iZXIiJiZpc05hTihkKSlyZXR1cm47aD09PSJudW1iZXIiJiYhZi5jc3NOdW1iZXJbaV0mJihkKz0icHgiKTtpZigha3x8ISgic2V0ImluIGspfHwoZD1rLnNldChhLGQpKSE9PWIpdHJ5e2pbY109ZH1jYXRjaChsKXt9fX0sY3NzOmZ1bmN0aW9uKGEsYyxkKXt2YXIgZSxnO2M9Zi5jYW1lbENhc2UoYyksZz1mLmNzc0hvb2tzW2NdLGM9Zi5jc3NQcm9wc1tjXXx8YyxjPT09ImNzc0Zsb2F0IiYmKGM9ImZsb2F0Iik7aWYoZyYmImdldCJpbiBnJiYoZT1nLmdldChhLCEwLGQpKSE9PWIpcmV0dXJuIGU7aWYoYnkpcmV0dXJuIGJ5KGEsYyl9LHN3YXA6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPXt9LGUsZjtmb3IoZiBpbiBiKWRbZl09YS5zdHlsZVtmXSxhLnN0eWxlW2ZdPWJbZl07ZT1jLmNhbGwoYSk7Zm9yKGYgaW4gYilhLnN0eWxlW2ZdPWRbZl07cmV0dXJuIGV9fSksZi5jdXJDU1M9Zi5jc3MsYy5kZWZhdWx0VmlldyYmYy5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlJiYoYno9ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGUsZyxoPWEuc3R5bGU7Yj1iLnJlcGxhY2UoYnIsIi0kMSIpLnRvTG93ZXJDYXNlKCksKGQ9YS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3KSYmKGU9ZC5nZXRDb21wdXRlZFN0eWxlKGEsbnVsbCkpJiYoYz1lLmdldFByb3BlcnR5VmFsdWUoYiksYz09PSIiJiYhZi5jb250YWlucyhhLm93bmVyRG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LGEpJiYoYz1mLnN0eWxlKGEsYikpKSwhZi5zdXBwb3J0LnBpeGVsTWFyZ2luJiZlJiZidi50ZXN0KGIpJiZidC50ZXN0KGMpJiYoZz1oLndpZHRoLGgud2lkdGg9YyxjPWUud2lkdGgsaC53aWR0aD1nKTtyZXR1cm4gY30pLGMuZG9jdW1lbnRFbGVtZW50LmN1cnJlbnRTdHlsZSYmKGJBPWZ1bmN0aW9uKGEsYil7dmFyIGMsZCxlLGY9YS5jdXJyZW50U3R5bGUmJmEuY3VycmVudFN0eWxlW2JdLGc9YS5zdHlsZTtmPT1udWxsJiZnJiYoZT1nW2JdKSYmKGY9ZSksYnQudGVzdChmKSYmKGM9Zy5sZWZ0LGQ9YS5ydW50aW1lU3R5bGUmJmEucnVudGltZVN0eWxlLmxlZnQsZCYmKGEucnVudGltZVN0eWxlLmxlZnQ9YS5jdXJyZW50U3R5bGUubGVmdCksZy5sZWZ0PWI9PT0iZm9udFNpemUiPyIxZW0iOmYsZj1nLnBpeGVsTGVmdCsicHgiLGcubGVmdD1jLGQmJihhLnJ1bnRpbWVTdHlsZS5sZWZ0PWQpKTtyZXR1cm4gZj09PSIiPyJhdXRvIjpmfSksYnk9Ynp8fGJBLGYuZWFjaChbImhlaWdodCIsIndpZHRoIl0sZnVuY3Rpb24oYSxiKXtmLmNzc0hvb2tzW2JdPXtnZXQ6ZnVuY3Rpb24oYSxjLGQpe2lmKGMpcmV0dXJuIGEub2Zmc2V0V2lkdGghPT0wP2JCKGEsYixkKTpmLnN3YXAoYSxidyxmdW5jdGlvbigpe3JldHVybiBiQihhLGIsZCl9KX0sc2V0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIGJzLnRlc3QoYik/YisicHgiOmJ9fX0pLGYuc3VwcG9ydC5vcGFjaXR5fHwoZi5jc3NIb29rcy5vcGFjaXR5PXtnZXQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYnEudGVzdCgoYiYmYS5jdXJyZW50U3R5bGU/YS5jdXJyZW50U3R5bGUuZmlsdGVyOmEuc3R5bGUuZmlsdGVyKXx8IiIpP3BhcnNlRmxvYXQoUmVnRXhwLiQxKS8xMDArIiI6Yj8iMSI6IiJ9LHNldDpmdW5jdGlvbihhLGIpe3ZhciBjPWEuc3R5bGUsZD1hLmN1cnJlbnRTdHlsZSxlPWYuaXNOdW1lcmljKGIpPyJhbHBoYShvcGFjaXR5PSIrYioxMDArIikiOiIiLGc9ZCYmZC5maWx0ZXJ8fGMuZmlsdGVyfHwiIjtjLnpvb209MTtpZihiPj0xJiZmLnRyaW0oZy5yZXBsYWNlKGJwLCIiKSk9PT0iIil7Yy5yZW1vdmVBdHRyaWJ1dGUoImZpbHRlciIpO2lmKGQmJiFkLmZpbHRlcilyZXR1cm59Yy5maWx0ZXI9YnAudGVzdChnKT9nLnJlcGxhY2UoYnAsZSk6ZysiICIrZX19KSxmKGZ1bmN0aW9uKCl7Zi5zdXBwb3J0LnJlbGlhYmxlTWFyZ2luUmlnaHR8fChmLmNzc0hvb2tzLm1hcmdpblJpZ2h0PXtnZXQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZi5zd2FwKGEse2Rpc3BsYXk6ImlubGluZS1ibG9jayJ9LGZ1bmN0aW9uKCl7cmV0dXJuIGI/YnkoYSwibWFyZ2luLXJpZ2h0Iik6YS5zdHlsZS5tYXJnaW5SaWdodH0pfX0pfSksZi5leHByJiZmLmV4cHIuZmlsdGVycyYmKGYuZXhwci5maWx0ZXJzLmhpZGRlbj1mdW5jdGlvbihhKXt2YXIgYj1hLm9mZnNldFdpZHRoLGM9YS5vZmZzZXRIZWlnaHQ7cmV0dXJuIGI9PT0wJiZjPT09MHx8IWYuc3VwcG9ydC5yZWxpYWJsZUhpZGRlbk9mZnNldHMmJihhLnN0eWxlJiZhLnN0eWxlLmRpc3BsYXl8fGYuY3NzKGEsImRpc3BsYXkiKSk9PT0ibm9uZSJ9LGYuZXhwci5maWx0ZXJzLnZpc2libGU9ZnVuY3Rpb24oYSl7cmV0dXJuIWYuZXhwci5maWx0ZXJzLmhpZGRlbihhKX0pLGYuZWFjaCh7bWFyZ2luOiIiLHBhZGRpbmc6IiIsYm9yZGVyOiJXaWR0aCJ9LGZ1bmN0aW9uKGEsYil7Zi5jc3NIb29rc1thK2JdPXtleHBhbmQ6ZnVuY3Rpb24oYyl7dmFyIGQsZT10eXBlb2YgYz09InN0cmluZyI/Yy5zcGxpdCgiICIpOltjXSxmPXt9O2ZvcihkPTA7ZDw0O2QrKylmW2ErYnhbZF0rYl09ZVtkXXx8ZVtkLTJdfHxlWzBdO3JldHVybiBmfX19KTt2YXIgYkM9LyUyMC9nLGJEPS9cW1xdJC8sYkU9L1xyP1xuL2csYkY9LyMuKiQvLGJHPS9eKC4qPyk6WyBcdF0qKFteXHJcbl0qKVxyPyQvbWcsYkg9L14oPzpjb2xvcnxkYXRlfGRhdGV0aW1lfGRhdGV0aW1lLWxvY2FsfGVtYWlsfGhpZGRlbnxtb250aHxudW1iZXJ8cGFzc3dvcmR8cmFuZ2V8c2VhcmNofHRlbHx0ZXh0fHRpbWV8dXJsfHdlZWspJC9pLGJJPS9eKD86YWJvdXR8YXBwfGFwcFwtc3RvcmFnZXwuK1wtZXh0ZW5zaW9ufGZpbGV8cmVzfHdpZGdldCk6JC8sYko9L14oPzpHRVR8SEVBRCkkLyxiSz0vXlwvXC8vLGJMPS9cPy8sYk09LzxzY3JpcHRcYltePF0qKD86KD8hPFwvc2NyaXB0Pik8W148XSopKjxcL3NjcmlwdD4vZ2ksYk49L14oPzpzZWxlY3R8dGV4dGFyZWEpL2ksYk89L1xzKy8sYlA9LyhbPyZdKV89W14mXSovLGJRPS9eKFtcd1wrXC5cLV0rOikoPzpcL1wvKFteXC8/IzpdKikoPzo6KFxkKykpPyk/LyxiUj1mLmZuLmxvYWQsYlM9e30sYlQ9e30sYlUsYlYsYlc9WyIqLyJdK1siKiJdO3RyeXtiVT1lLmhyZWZ9Y2F0Y2goYlgpe2JVPWMuY3JlYXRlRWxlbWVudCgiYSIpLGJVLmhyZWY9IiIsYlU9YlUuaHJlZn1iVj1iUS5leGVjKGJVLnRvTG93ZXJDYXNlKCkpfHxbXSxmLmZuLmV4dGVuZCh7bG9hZDpmdW5jdGlvbihhLGMsZCl7aWYodHlwZW9mIGEhPSJzdHJpbmciJiZiUilyZXR1cm4gYlIuYXBwbHkodGhpcyxhcmd1bWVudHMpO2lmKCF0aGlzLmxlbmd0aClyZXR1cm4gdGhpczt2YXIgZT1hLmluZGV4T2YoIiAiKTtpZihlPj0wKXt2YXIgZz1hLnNsaWNlKGUsYS5sZW5ndGgpO2E9YS5zbGljZSgwLGUpfXZhciBoPSJHRVQiO2MmJihmLmlzRnVuY3Rpb24oYyk/KGQ9YyxjPWIpOnR5cGVvZiBjPT0ib2JqZWN0IiYmKGM9Zi5wYXJhbShjLGYuYWpheFNldHRpbmdzLnRyYWRpdGlvbmFsKSxoPSJQT1NUIikpO3ZhciBpPXRoaXM7Zi5hamF4KHt1cmw6YSx0eXBlOmgsZGF0YVR5cGU6Imh0bWwiLGRhdGE6Yyxjb21wbGV0ZTpmdW5jdGlvbihhLGIsYyl7Yz1hLnJlc3BvbnNlVGV4dCxhLmlzUmVzb2x2ZWQoKSYmKGEuZG9uZShmdW5jdGlvbihhKXtjPWF9KSxpLmh0bWwoZz9mKCI8ZGl2PiIpLmFwcGVuZChjLnJlcGxhY2UoYk0sIiIpKS5maW5kKGcpOmMpKSxkJiZpLmVhY2goZCxbYyxiLGFdKX19KTtyZXR1cm4gdGhpc30sc2VyaWFsaXplOmZ1bmN0aW9uKCl7cmV0dXJuIGYucGFyYW0odGhpcy5zZXJpYWxpemVBcnJheSgpKX0sc2VyaWFsaXplQXJyYXk6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lbGVtZW50cz9mLm1ha2VBcnJheSh0aGlzLmVsZW1lbnRzKTp0aGlzfSkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubmFtZSYmIXRoaXMuZGlzYWJsZWQmJih0aGlzLmNoZWNrZWR8fGJOLnRlc3QodGhpcy5ub2RlTmFtZSl8fGJILnRlc3QodGhpcy50eXBlKSl9KS5tYXAoZnVuY3Rpb24oYSxiKXt2YXIgYz1mKHRoaXMpLnZhbCgpO3JldHVybiBjPT1udWxsP251bGw6Zi5pc0FycmF5KGMpP2YubWFwKGMsZnVuY3Rpb24oYSxjKXtyZXR1cm57bmFtZTpiLm5hbWUsdmFsdWU6YS5yZXBsYWNlKGJFLCJcclxuIil9fSk6e25hbWU6Yi5uYW1lLHZhbHVlOmMucmVwbGFjZShiRSwiXHJcbiIpfX0pLmdldCgpfX0pLGYuZWFjaCgiYWpheFN0YXJ0IGFqYXhTdG9wIGFqYXhDb21wbGV0ZSBhamF4RXJyb3IgYWpheFN1Y2Nlc3MgYWpheFNlbmQiLnNwbGl0KCIgIiksZnVuY3Rpb24oYSxiKXtmLmZuW2JdPWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLm9uKGIsYSl9fSksZi5lYWNoKFsiZ2V0IiwicG9zdCJdLGZ1bmN0aW9uKGEsYyl7ZltjXT1mdW5jdGlvbihhLGQsZSxnKXtmLmlzRnVuY3Rpb24oZCkmJihnPWd8fGUsZT1kLGQ9Yik7cmV0dXJuIGYuYWpheCh7dHlwZTpjLHVybDphLGRhdGE6ZCxzdWNjZXNzOmUsZGF0YVR5cGU6Z30pfX0pLGYuZXh0ZW5kKHtnZXRTY3JpcHQ6ZnVuY3Rpb24oYSxjKXtyZXR1cm4gZi5nZXQoYSxiLGMsInNjcmlwdCIpfSxnZXRKU09OOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gZi5nZXQoYSxiLGMsImpzb24iKX0sYWpheFNldHVwOmZ1bmN0aW9uKGEsYil7Yj9iJChhLGYuYWpheFNldHRpbmdzKTooYj1hLGE9Zi5hamF4U2V0dGluZ3MpLGIkKGEsYik7cmV0dXJuIGF9LGFqYXhTZXR0aW5nczp7dXJsOmJVLGlzTG9jYWw6YkkudGVzdChiVlsxXSksZ2xvYmFsOiEwLHR5cGU6IkdFVCIsY29udGVudFR5cGU6ImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCIscHJvY2Vzc0RhdGE6ITAsYXN5bmM6ITAsYWNjZXB0czp7eG1sOiJhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sIixodG1sOiJ0ZXh0L2h0bWwiLHRleHQ6InRleHQvcGxhaW4iLGpzb246ImFwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdCIsIioiOmJXfSxjb250ZW50czp7eG1sOi94bWwvLGh0bWw6L2h0bWwvLGpzb246L2pzb24vfSxyZXNwb25zZUZpZWxkczp7eG1sOiJyZXNwb25zZVhNTCIsdGV4dDoicmVzcG9uc2VUZXh0In0sY29udmVydGVyczp7IiogdGV4dCI6YS5TdHJpbmcsInRleHQgaHRtbCI6ITAsInRleHQganNvbiI6Zi5wYXJzZUpTT04sInRleHQgeG1sIjpmLnBhcnNlWE1MfSxmbGF0T3B0aW9uczp7Y29udGV4dDohMCx1cmw6ITB9fSxhamF4UHJlZmlsdGVyOmJZKGJTKSxhamF4VHJhbnNwb3J0OmJZKGJUKSxhamF4OmZ1bmN0aW9uKGEsYyl7ZnVuY3Rpb24gdyhhLGMsbCxtKXtpZihzIT09Mil7cz0yLHEmJmNsZWFyVGltZW91dChxKSxwPWIsbj1tfHwiIix2LnJlYWR5U3RhdGU9YT4wPzQ6MDt2YXIgbyxyLHUsdz1jLHg9bD9jYShkLHYsbCk6Yix5LHo7aWYoYT49MjAwJiZhPDMwMHx8YT09PTMwNCl7aWYoZC5pZk1vZGlmaWVkKXtpZih5PXYuZ2V0UmVzcG9uc2VIZWFkZXIoIkxhc3QtTW9kaWZpZWQiKSlmLmxhc3RNb2RpZmllZFtrXT15O2lmKHo9di5nZXRSZXNwb25zZUhlYWRlcigiRXRhZyIpKWYuZXRhZ1trXT16fWlmKGE9PT0zMDQpdz0ibm90bW9kaWZpZWQiLG89ITA7ZWxzZSB0cnl7cj1jYihkLHgpLHc9InN1Y2Nlc3MiLG89ITB9Y2F0Y2goQSl7dz0icGFyc2VyZXJyb3IiLHU9QX19ZWxzZXt1PXc7aWYoIXd8fGEpdz0iZXJyb3IiLGE8MCYmKGE9MCl9di5zdGF0dXM9YSx2LnN0YXR1c1RleHQ9IiIrKGN8fHcpLG8/aC5yZXNvbHZlV2l0aChlLFtyLHcsdl0pOmgucmVqZWN0V2l0aChlLFt2LHcsdV0pLHYuc3RhdHVzQ29kZShqKSxqPWIsdCYmZy50cmlnZ2VyKCJhamF4Iisobz8iU3VjY2VzcyI6IkVycm9yIiksW3YsZCxvP3I6dV0pLGkuZmlyZVdpdGgoZSxbdix3XSksdCYmKGcudHJpZ2dlcigiYWpheENvbXBsZXRlIixbdixkXSksLS1mLmFjdGl2ZXx8Zi5ldmVudC50cmlnZ2VyKCJhamF4U3RvcCIpKX19dHlwZW9mIGE9PSJvYmplY3QiJiYoYz1hLGE9YiksYz1jfHx7fTt2YXIgZD1mLmFqYXhTZXR1cCh7fSxjKSxlPWQuY29udGV4dHx8ZCxnPWUhPT1kJiYoZS5ub2RlVHlwZXx8ZSBpbnN0YW5jZW9mIGYpP2YoZSk6Zi5ldmVudCxoPWYuRGVmZXJyZWQoKSxpPWYuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLGo9ZC5zdGF0dXNDb2RlfHx7fSxrLGw9e30sbT17fSxuLG8scCxxLHIscz0wLHQsdSx2PXtyZWFkeVN0YXRlOjAsc2V0UmVxdWVzdEhlYWRlcjpmdW5jdGlvbihhLGIpe2lmKCFzKXt2YXIgYz1hLnRvTG93ZXJDYXNlKCk7YT1tW2NdPW1bY118fGEsbFthXT1ifXJldHVybiB0aGlzfSxnZXRBbGxSZXNwb25zZUhlYWRlcnM6ZnVuY3Rpb24oKXtyZXR1cm4gcz09PTI/bjpudWxsfSxnZXRSZXNwb25zZUhlYWRlcjpmdW5jdGlvbihhKXt2YXIgYztpZihzPT09Mil7aWYoIW8pe289e307d2hpbGUoYz1iRy5leGVjKG4pKW9bY1sxXS50b0xvd2VyQ2FzZSgpXT1jWzJdfWM9b1thLnRvTG93ZXJDYXNlKCldfXJldHVybiBjPT09Yj9udWxsOmN9LG92ZXJyaWRlTWltZVR5cGU6ZnVuY3Rpb24oYSl7c3x8KGQubWltZVR5cGU9YSk7cmV0dXJuIHRoaXN9LGFib3J0OmZ1bmN0aW9uKGEpe2E9YXx8ImFib3J0IixwJiZwLmFib3J0KGEpLHcoMCxhKTtyZXR1cm4gdGhpc319O2gucHJvbWlzZSh2KSx2LnN1Y2Nlc3M9di5kb25lLHYuZXJyb3I9di5mYWlsLHYuY29tcGxldGU9aS5hZGQsdi5zdGF0dXNDb2RlPWZ1bmN0aW9uKGEpe2lmKGEpe3ZhciBiO2lmKHM8Milmb3IoYiBpbiBhKWpbYl09W2pbYl0sYVtiXV07ZWxzZSBiPWFbdi5zdGF0dXNdLHYudGhlbihiLGIpfXJldHVybiB0aGlzfSxkLnVybD0oKGF8fGQudXJsKSsiIikucmVwbGFjZShiRiwiIikucmVwbGFjZShiSyxiVlsxXSsiLy8iKSxkLmRhdGFUeXBlcz1mLnRyaW0oZC5kYXRhVHlwZXx8IioiKS50b0xvd2VyQ2FzZSgpLnNwbGl0KGJPKSxkLmNyb3NzRG9tYWluPT1udWxsJiYocj1iUS5leGVjKGQudXJsLnRvTG93ZXJDYXNlKCkpLGQuY3Jvc3NEb21haW49ISghcnx8clsxXT09YlZbMV0mJnJbMl09PWJWWzJdJiYoclszXXx8KHJbMV09PT0iaHR0cDoiPzgwOjQ0MykpPT0oYlZbM118fChiVlsxXT09PSJodHRwOiI/ODA6NDQzKSkpKSxkLmRhdGEmJmQucHJvY2Vzc0RhdGEmJnR5cGVvZiBkLmRhdGEhPSJzdHJpbmciJiYoZC5kYXRhPWYucGFyYW0oZC5kYXRhLGQudHJhZGl0aW9uYWwpKSxiWihiUyxkLGMsdik7aWYocz09PTIpcmV0dXJuITE7dD1kLmdsb2JhbCxkLnR5cGU9ZC50eXBlLnRvVXBwZXJDYXNlKCksZC5oYXNDb250ZW50PSFiSi50ZXN0KGQudHlwZSksdCYmZi5hY3RpdmUrKz09PTAmJmYuZXZlbnQudHJpZ2dlcigiYWpheFN0YXJ0Iik7aWYoIWQuaGFzQ29udGVudCl7ZC5kYXRhJiYoZC51cmwrPShiTC50ZXN0KGQudXJsKT8iJiI6Ij8iKStkLmRhdGEsZGVsZXRlIGQuZGF0YSksaz1kLnVybDtpZihkLmNhY2hlPT09ITEpe3ZhciB4PWYubm93KCkseT1kLnVybC5yZXBsYWNlKGJQLCIkMV89Iit4KTtkLnVybD15Kyh5PT09ZC51cmw/KGJMLnRlc3QoZC51cmwpPyImIjoiPyIpKyJfPSIreDoiIil9fShkLmRhdGEmJmQuaGFzQ29udGVudCYmZC5jb250ZW50VHlwZSE9PSExfHxjLmNvbnRlbnRUeXBlKSYmdi5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLGQuY29udGVudFR5cGUpLGQuaWZNb2RpZmllZCYmKGs9a3x8ZC51cmwsZi5sYXN0TW9kaWZpZWRba10mJnYuc2V0UmVxdWVzdEhlYWRlcigiSWYtTW9kaWZpZWQtU2luY2UiLGYubGFzdE1vZGlmaWVkW2tdKSxmLmV0YWdba10mJnYuc2V0UmVxdWVzdEhlYWRlcigiSWYtTm9uZS1NYXRjaCIsZi5ldGFnW2tdKSksdi5zZXRSZXF1ZXN0SGVhZGVyKCJBY2NlcHQiLGQuZGF0YVR5cGVzWzBdJiZkLmFjY2VwdHNbZC5kYXRhVHlwZXNbMF1dP2QuYWNjZXB0c1tkLmRhdGFUeXBlc1swXV0rKGQuZGF0YVR5cGVzWzBdIT09IioiPyIsICIrYlcrIjsgcT0wLjAxIjoiIik6ZC5hY2NlcHRzWyIqIl0pO2Zvcih1IGluIGQuaGVhZGVycyl2LnNldFJlcXVlc3RIZWFkZXIodSxkLmhlYWRlcnNbdV0pO2lmKGQuYmVmb3JlU2VuZCYmKGQuYmVmb3JlU2VuZC5jYWxsKGUsdixkKT09PSExfHxzPT09Mikpe3YuYWJvcnQoKTtyZXR1cm4hMX1mb3IodSBpbntzdWNjZXNzOjEsZXJyb3I6MSxjb21wbGV0ZToxfSl2W3VdKGRbdV0pO3A9YlooYlQsZCxjLHYpO2lmKCFwKXcoLTEsIk5vIFRyYW5zcG9ydCIpO2Vsc2V7di5yZWFkeVN0YXRlPTEsdCYmZy50cmlnZ2VyKCJhamF4U2VuZCIsW3YsZF0pLGQuYXN5bmMmJmQudGltZW91dD4wJiYocT1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7di5hYm9ydCgidGltZW91dCIpfSxkLnRpbWVvdXQpKTt0cnl7cz0xLHAuc2VuZChsLHcpfWNhdGNoKHope2lmKHM8Mil3KC0xLHopO2Vsc2UgdGhyb3cgen19cmV0dXJuIHZ9LHBhcmFtOmZ1bmN0aW9uKGEsYyl7dmFyIGQ9W10sZT1mdW5jdGlvbihhLGIpe2I9Zi5pc0Z1bmN0aW9uKGIpP2IoKTpiLGRbZC5sZW5ndGhdPWVuY29kZVVSSUNvbXBvbmVudChhKSsiPSIrZW5jb2RlVVJJQ29tcG9uZW50KGIpfTtjPT09YiYmKGM9Zi5hamF4U2V0dGluZ3MudHJhZGl0aW9uYWwpO2lmKGYuaXNBcnJheShhKXx8YS5qcXVlcnkmJiFmLmlzUGxhaW5PYmplY3QoYSkpZi5lYWNoKGEsZnVuY3Rpb24oKXtlKHRoaXMubmFtZSx0aGlzLnZhbHVlKX0pO2Vsc2UgZm9yKHZhciBnIGluIGEpYl8oZyxhW2ddLGMsZSk7cmV0dXJuIGQuam9pbigiJiIpLnJlcGxhY2UoYkMsIisiKX19KSxmLmV4dGVuZCh7YWN0aXZlOjAsbGFzdE1vZGlmaWVkOnt9LGV0YWc6e319KTt2YXIgY2M9Zi5ub3coKSxjZD0vKFw9KVw/KCZ8JCl8XD9cPy9pO2YuYWpheFNldHVwKHtqc29ucDoiY2FsbGJhY2siLGpzb25wQ2FsbGJhY2s6ZnVuY3Rpb24oKXtyZXR1cm4gZi5leHBhbmRvKyJfIitjYysrfX0pLGYuYWpheFByZWZpbHRlcigianNvbiBqc29ucCIsZnVuY3Rpb24oYixjLGQpe3ZhciBlPXR5cGVvZiBiLmRhdGE9PSJzdHJpbmciJiYvXmFwcGxpY2F0aW9uXC94XC13d3dcLWZvcm1cLXVybGVuY29kZWQvLnRlc3QoYi5jb250ZW50VHlwZSk7aWYoYi5kYXRhVHlwZXNbMF09PT0ianNvbnAifHxiLmpzb25wIT09ITEmJihjZC50ZXN0KGIudXJsKXx8ZSYmY2QudGVzdChiLmRhdGEpKSl7dmFyIGcsaD1iLmpzb25wQ2FsbGJhY2s9Zi5pc0Z1bmN0aW9uKGIuanNvbnBDYWxsYmFjayk/Yi5qc29ucENhbGxiYWNrKCk6Yi5qc29ucENhbGxiYWNrLGk9YVtoXSxqPWIudXJsLGs9Yi5kYXRhLGw9IiQxIitoKyIkMiI7Yi5qc29ucCE9PSExJiYoaj1qLnJlcGxhY2UoY2QsbCksYi51cmw9PT1qJiYoZSYmKGs9ay5yZXBsYWNlKGNkLGwpKSxiLmRhdGE9PT1rJiYoais9KC9cPy8udGVzdChqKT8iJiI6Ij8iKStiLmpzb25wKyI9IitoKSkpLGIudXJsPWosYi5kYXRhPWssYVtoXT1mdW5jdGlvbihhKXtnPVthXX0sZC5hbHdheXMoZnVuY3Rpb24oKXthW2hdPWksZyYmZi5pc0Z1bmN0aW9uKGkpJiZhW2hdKGdbMF0pfSksYi5jb252ZXJ0ZXJzWyJzY3JpcHQganNvbiJdPWZ1bmN0aW9uKCl7Z3x8Zi5lcnJvcihoKyIgd2FzIG5vdCBjYWxsZWQiKTtyZXR1cm4gZ1swXX0sYi5kYXRhVHlwZXNbMF09Impzb24iO3JldHVybiJzY3JpcHQifX0pLGYuYWpheFNldHVwKHthY2NlcHRzOntzY3JpcHQ6InRleHQvamF2YXNjcmlwdCwgYXBwbGljYXRpb24vamF2YXNjcmlwdCwgYXBwbGljYXRpb24vZWNtYXNjcmlwdCwgYXBwbGljYXRpb24veC1lY21hc2NyaXB0In0sY29udGVudHM6e3NjcmlwdDovamF2YXNjcmlwdHxlY21hc2NyaXB0L30sY29udmVydGVyczp7InRleHQgc2NyaXB0IjpmdW5jdGlvbihhKXtmLmdsb2JhbEV2YWwoYSk7cmV0dXJuIGF9fX0pLGYuYWpheFByZWZpbHRlcigic2NyaXB0IixmdW5jdGlvbihhKXthLmNhY2hlPT09YiYmKGEuY2FjaGU9ITEpLGEuY3Jvc3NEb21haW4mJihhLnR5cGU9IkdFVCIsYS5nbG9iYWw9ITEpfSksZi5hamF4VHJhbnNwb3J0KCJzY3JpcHQiLGZ1bmN0aW9uKGEpe2lmKGEuY3Jvc3NEb21haW4pe3ZhciBkLGU9Yy5oZWFkfHxjLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF18fGMuZG9jdW1lbnRFbGVtZW50O3JldHVybntzZW5kOmZ1bmN0aW9uKGYsZyl7ZD1jLmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpLGQuYXN5bmM9ImFzeW5jIixhLnNjcmlwdENoYXJzZXQmJihkLmNoYXJzZXQ9YS5zY3JpcHRDaGFyc2V0KSxkLnNyYz1hLnVybCxkLm9ubG9hZD1kLm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbihhLGMpe2lmKGN8fCFkLnJlYWR5U3RhdGV8fC9sb2FkZWR8Y29tcGxldGUvLnRlc3QoZC5yZWFkeVN0YXRlKSlkLm9ubG9hZD1kLm9ucmVhZHlzdGF0ZWNoYW5nZT1udWxsLGUmJmQucGFyZW50Tm9kZSYmZS5yZW1vdmVDaGlsZChkKSxkPWIsY3x8ZygyMDAsInN1Y2Nlc3MiKX0sZS5pbnNlcnRCZWZvcmUoZCxlLmZpcnN0Q2hpbGQpfSxhYm9ydDpmdW5jdGlvbigpe2QmJmQub25sb2FkKDAsMSl9fX19KTt2YXIgY2U9YS5BY3RpdmVYT2JqZWN0P2Z1bmN0aW9uKCl7Zm9yKHZhciBhIGluIGNnKWNnW2FdKDAsMSl9OiExLGNmPTAsY2c7Zi5hamF4U2V0dGluZ3MueGhyPWEuQWN0aXZlWE9iamVjdD9mdW5jdGlvbigpe3JldHVybiF0aGlzLmlzTG9jYWwmJmNoKCl8fGNpKCl9OmNoLGZ1bmN0aW9uKGEpe2YuZXh0ZW5kKGYuc3VwcG9ydCx7YWpheDohIWEsY29yczohIWEmJiJ3aXRoQ3JlZGVudGlhbHMiaW4gYX0pfShmLmFqYXhTZXR0aW5ncy54aHIoKSksZi5zdXBwb3J0LmFqYXgmJmYuYWpheFRyYW5zcG9ydChmdW5jdGlvbihjKXtpZighYy5jcm9zc0RvbWFpbnx8Zi5zdXBwb3J0LmNvcnMpe3ZhciBkO3JldHVybntzZW5kOmZ1bmN0aW9uKGUsZyl7dmFyIGg9Yy54aHIoKSxpLGo7Yy51c2VybmFtZT9oLm9wZW4oYy50eXBlLGMudXJsLGMuYXN5bmMsYy51c2VybmFtZSxjLnBhc3N3b3JkKTpoLm9wZW4oYy50eXBlLGMudXJsLGMuYXN5bmMpO2lmKGMueGhyRmllbGRzKWZvcihqIGluIGMueGhyRmllbGRzKWhbal09Yy54aHJGaWVsZHNbal07Yy5taW1lVHlwZSYmaC5vdmVycmlkZU1pbWVUeXBlJiZoLm92ZXJyaWRlTWltZVR5cGUoYy5taW1lVHlwZSksIWMuY3Jvc3NEb21haW4mJiFlWyJYLVJlcXVlc3RlZC1XaXRoIl0mJihlWyJYLVJlcXVlc3RlZC1XaXRoIl09IlhNTEh0dHBSZXF1ZXN0Iik7dHJ5e2ZvcihqIGluIGUpaC5zZXRSZXF1ZXN0SGVhZGVyKGosZVtqXSl9Y2F0Y2goayl7fWguc2VuZChjLmhhc0NvbnRlbnQmJmMuZGF0YXx8bnVsbCksZD1mdW5jdGlvbihhLGUpe3ZhciBqLGssbCxtLG47dHJ5e2lmKGQmJihlfHxoLnJlYWR5U3RhdGU9PT00KSl7ZD1iLGkmJihoLm9ucmVhZHlzdGF0ZWNoYW5nZT1mLm5vb3AsY2UmJmRlbGV0ZSBjZ1tpXSk7aWYoZSloLnJlYWR5U3RhdGUhPT00JiZoLmFib3J0KCk7ZWxzZXtqPWguc3RhdHVzLGw9aC5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSxtPXt9LG49aC5yZXNwb25zZVhNTCxuJiZuLmRvY3VtZW50RWxlbWVudCYmKG0ueG1sPW4pO3RyeXttLnRleHQ9aC5yZXNwb25zZVRleHR9Y2F0Y2goYSl7fXRyeXtrPWguc3RhdHVzVGV4dH1jYXRjaChvKXtrPSIifSFqJiZjLmlzTG9jYWwmJiFjLmNyb3NzRG9tYWluP2o9bS50ZXh0PzIwMDo0MDQ6aj09PTEyMjMmJihqPTIwNCl9fX1jYXRjaChwKXtlfHxnKC0xLHApfW0mJmcoaixrLG0sbCl9LCFjLmFzeW5jfHxoLnJlYWR5U3RhdGU9PT00P2QoKTooaT0rK2NmLGNlJiYoY2d8fChjZz17fSxmKGEpLnVubG9hZChjZSkpLGNnW2ldPWQpLGgub25yZWFkeXN0YXRlY2hhbmdlPWQpfSxhYm9ydDpmdW5jdGlvbigpe2QmJmQoMCwxKX19fX0pO3ZhciBjaj17fSxjayxjbCxjbT0vXig/OnRvZ2dsZXxzaG93fGhpZGUpJC8sY249L14oWytcLV09KT8oW1xkKy5cLV0rKShbYS16JV0qKSQvaSxjbyxjcD1bWyJoZWlnaHQiLCJtYXJnaW5Ub3AiLCJtYXJnaW5Cb3R0b20iLCJwYWRkaW5nVG9wIiwicGFkZGluZ0JvdHRvbSJdLFsid2lkdGgiLCJtYXJnaW5MZWZ0IiwibWFyZ2luUmlnaHQiLCJwYWRkaW5nTGVmdCIsInBhZGRpbmdSaWdodCJdLFsib3BhY2l0eSJdXSxjcTtmLmZuLmV4dGVuZCh7c2hvdzpmdW5jdGlvbihhLGIsYyl7dmFyIGQsZTtpZihhfHxhPT09MClyZXR1cm4gdGhpcy5hbmltYXRlKGN0KCJzaG93IiwzKSxhLGIsYyk7Zm9yKHZhciBnPTAsaD10aGlzLmxlbmd0aDtnPGg7ZysrKWQ9dGhpc1tnXSxkLnN0eWxlJiYoZT1kLnN0eWxlLmRpc3BsYXksIWYuX2RhdGEoZCwib2xkZGlzcGxheSIpJiZlPT09Im5vbmUiJiYoZT1kLnN0eWxlLmRpc3BsYXk9IiIpLChlPT09IiImJmYuY3NzKGQsImRpc3BsYXkiKT09PSJub25lInx8IWYuY29udGFpbnMoZC5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudCxkKSkmJmYuX2RhdGEoZCwib2xkZGlzcGxheSIsY3UoZC5ub2RlTmFtZSkpKTtmb3IoZz0wO2c8aDtnKyspe2Q9dGhpc1tnXTtpZihkLnN0eWxlKXtlPWQuc3R5bGUuZGlzcGxheTtpZihlPT09IiJ8fGU9PT0ibm9uZSIpZC5zdHlsZS5kaXNwbGF5PWYuX2RhdGEoZCwib2xkZGlzcGxheSIpfHwiIn19cmV0dXJuIHRoaXN9LGhpZGU6ZnVuY3Rpb24oYSxiLGMpe2lmKGF8fGE9PT0wKXJldHVybiB0aGlzLmFuaW1hdGUoY3QoImhpZGUiLDMpLGEsYixjKTt2YXIgZCxlLGc9MCxoPXRoaXMubGVuZ3RoO2Zvcig7ZzxoO2crKylkPXRoaXNbZ10sZC5zdHlsZSYmKGU9Zi5jc3MoZCwiZGlzcGxheSIpLGUhPT0ibm9uZSImJiFmLl9kYXRhKGQsIm9sZGRpc3BsYXkiKSYmZi5fZGF0YShkLCJvbGRkaXNwbGF5IixlKSk7Zm9yKGc9MDtnPGg7ZysrKXRoaXNbZ10uc3R5bGUmJih0aGlzW2ddLnN0eWxlLmRpc3BsYXk9Im5vbmUiKTtyZXR1cm4gdGhpc30sX3RvZ2dsZTpmLmZuLnRvZ2dsZSx0b2dnbGU6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPXR5cGVvZiBhPT0iYm9vbGVhbiI7Zi5pc0Z1bmN0aW9uKGEpJiZmLmlzRnVuY3Rpb24oYik/dGhpcy5fdG9nZ2xlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTphPT1udWxsfHxkP3RoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPWQ/YTpmKHRoaXMpLmlzKCI6aGlkZGVuIik7Zih0aGlzKVtiPyJzaG93IjoiaGlkZSJdKCl9KTp0aGlzLmFuaW1hdGUoY3QoInRvZ2dsZSIsMyksYSxiLGMpO3JldHVybiB0aGlzfSxmYWRlVG86ZnVuY3Rpb24oYSxiLGMsZCl7cmV0dXJuIHRoaXMuZmlsdGVyKCI6aGlkZGVuIikuY3NzKCJvcGFjaXR5IiwwKS5zaG93KCkuZW5kKCkuYW5pbWF0ZSh7b3BhY2l0eTpifSxhLGMsZCl9LGFuaW1hdGU6ZnVuY3Rpb24oYSxiLGMsZCl7ZnVuY3Rpb24gZygpe2UucXVldWU9PT0hMSYmZi5fbWFyayh0aGlzKTt2YXIgYj1mLmV4dGVuZCh7fSxlKSxjPXRoaXMubm9kZVR5cGU9PT0xLGQ9YyYmZih0aGlzKS5pcygiOmhpZGRlbiIpLGcsaCxpLGosayxsLG0sbixvLHAscTtiLmFuaW1hdGVkUHJvcGVydGllcz17fTtmb3IoaSBpbiBhKXtnPWYuY2FtZWxDYXNlKGkpLGkhPT1nJiYoYVtnXT1hW2ldLGRlbGV0ZSBhW2ldKTtpZigoaz1mLmNzc0hvb2tzW2ddKSYmImV4cGFuZCJpbiBrKXtsPWsuZXhwYW5kKGFbZ10pLGRlbGV0ZSBhW2ddO2ZvcihpIGluIGwpaSBpbiBhfHwoYVtpXT1sW2ldKX19Zm9yKGcgaW4gYSl7aD1hW2ddLGYuaXNBcnJheShoKT8oYi5hbmltYXRlZFByb3BlcnRpZXNbZ109aFsxXSxoPWFbZ109aFswXSk6Yi5hbmltYXRlZFByb3BlcnRpZXNbZ109Yi5zcGVjaWFsRWFzaW5nJiZiLnNwZWNpYWxFYXNpbmdbZ118fGIuZWFzaW5nfHwic3dpbmciO2lmKGg9PT0iaGlkZSImJmR8fGg9PT0ic2hvdyImJiFkKXJldHVybiBiLmNvbXBsZXRlLmNhbGwodGhpcyk7YyYmKGc9PT0iaGVpZ2h0Inx8Zz09PSJ3aWR0aCIpJiYoYi5vdmVyZmxvdz1bdGhpcy5zdHlsZS5vdmVyZmxvdyx0aGlzLnN0eWxlLm92ZXJmbG93WCx0aGlzLnN0eWxlLm92ZXJmbG93WV0sZi5jc3ModGhpcywiZGlzcGxheSIpPT09ImlubGluZSImJmYuY3NzKHRoaXMsImZsb2F0Iik9PT0ibm9uZSImJighZi5zdXBwb3J0LmlubGluZUJsb2NrTmVlZHNMYXlvdXR8fGN1KHRoaXMubm9kZU5hbWUpPT09ImlubGluZSI/dGhpcy5zdHlsZS5kaXNwbGF5PSJpbmxpbmUtYmxvY2siOnRoaXMuc3R5bGUuem9vbT0xKSl9Yi5vdmVyZmxvdyE9bnVsbCYmKHRoaXMuc3R5bGUub3ZlcmZsb3c9ImhpZGRlbiIpO2ZvcihpIGluIGEpaj1uZXcgZi5meCh0aGlzLGIsaSksaD1hW2ldLGNtLnRlc3QoaCk/KHE9Zi5fZGF0YSh0aGlzLCJ0b2dnbGUiK2kpfHwoaD09PSJ0b2dnbGUiP2Q/InNob3ciOiJoaWRlIjowKSxxPyhmLl9kYXRhKHRoaXMsInRvZ2dsZSIraSxxPT09InNob3ciPyJoaWRlIjoic2hvdyIpLGpbcV0oKSk6altoXSgpKToobT1jbi5leGVjKGgpLG49ai5jdXIoKSxtPyhvPXBhcnNlRmxvYXQobVsyXSkscD1tWzNdfHwoZi5jc3NOdW1iZXJbaV0/IiI6InB4IikscCE9PSJweCImJihmLnN0eWxlKHRoaXMsaSwob3x8MSkrcCksbj0ob3x8MSkvai5jdXIoKSpuLGYuc3R5bGUodGhpcyxpLG4rcCkpLG1bMV0mJihvPShtWzFdPT09Ii09Ij8tMToxKSpvK24pLGouY3VzdG9tKG4sbyxwKSk6ai5jdXN0b20obixoLCIiKSk7cmV0dXJuITB9dmFyIGU9Zi5zcGVlZChiLGMsZCk7aWYoZi5pc0VtcHR5T2JqZWN0KGEpKXJldHVybiB0aGlzLmVhY2goZS5jb21wbGV0ZSxbITFdKTthPWYuZXh0ZW5kKHt9LGEpO3JldHVybiBlLnF1ZXVlPT09ITE/dGhpcy5lYWNoKGcpOnRoaXMucXVldWUoZS5xdWV1ZSxnKX0sc3RvcDpmdW5jdGlvbihhLGMsZCl7dHlwZW9mIGEhPSJzdHJpbmciJiYoZD1jLGM9YSxhPWIpLGMmJmEhPT0hMSYmdGhpcy5xdWV1ZShhfHwiZngiLFtdKTtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gaChhLGIsYyl7dmFyIGU9YltjXTtmLnJlbW92ZURhdGEoYSxjLCEwKSxlLnN0b3AoZCl9dmFyIGIsYz0hMSxlPWYudGltZXJzLGc9Zi5fZGF0YSh0aGlzKTtkfHxmLl91bm1hcmsoITAsdGhpcyk7aWYoYT09bnVsbClmb3IoYiBpbiBnKWdbYl0mJmdbYl0uc3RvcCYmYi5pbmRleE9mKCIucnVuIik9PT1iLmxlbmd0aC00JiZoKHRoaXMsZyxiKTtlbHNlIGdbYj1hKyIucnVuIl0mJmdbYl0uc3RvcCYmaCh0aGlzLGcsYik7Zm9yKGI9ZS5sZW5ndGg7Yi0tOyllW2JdLmVsZW09PT10aGlzJiYoYT09bnVsbHx8ZVtiXS5xdWV1ZT09PWEpJiYoZD9lW2JdKCEwKTplW2JdLnNhdmVTdGF0ZSgpLGM9ITAsZS5zcGxpY2UoYiwxKSk7KCFkfHwhYykmJmYuZGVxdWV1ZSh0aGlzLGEpfSl9fSksZi5lYWNoKHtzbGlkZURvd246Y3QoInNob3ciLDEpLHNsaWRlVXA6Y3QoImhpZGUiLDEpLHNsaWRlVG9nZ2xlOmN0KCJ0b2dnbGUiLDEpLGZhZGVJbjp7b3BhY2l0eToic2hvdyJ9LGZhZGVPdXQ6e29wYWNpdHk6ImhpZGUifSxmYWRlVG9nZ2xlOntvcGFjaXR5OiJ0b2dnbGUifX0sZnVuY3Rpb24oYSxiKXtmLmZuW2FdPWZ1bmN0aW9uKGEsYyxkKXtyZXR1cm4gdGhpcy5hbmltYXRlKGIsYSxjLGQpfX0pLGYuZXh0ZW5kKHtzcGVlZDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9YSYmdHlwZW9mIGE9PSJvYmplY3QiP2YuZXh0ZW5kKHt9LGEpOntjb21wbGV0ZTpjfHwhYyYmYnx8Zi5pc0Z1bmN0aW9uKGEpJiZhLGR1cmF0aW9uOmEsZWFzaW5nOmMmJmJ8fGImJiFmLmlzRnVuY3Rpb24oYikmJmJ9O2QuZHVyYXRpb249Zi5meC5vZmY/MDp0eXBlb2YgZC5kdXJhdGlvbj09Im51bWJlciI/ZC5kdXJhdGlvbjpkLmR1cmF0aW9uIGluIGYuZnguc3BlZWRzP2YuZnguc3BlZWRzW2QuZHVyYXRpb25dOmYuZnguc3BlZWRzLl9kZWZhdWx0O2lmKGQucXVldWU9PW51bGx8fGQucXVldWU9PT0hMClkLnF1ZXVlPSJmeCI7ZC5vbGQ9ZC5jb21wbGV0ZSxkLmNvbXBsZXRlPWZ1bmN0aW9uKGEpe2YuaXNGdW5jdGlvbihkLm9sZCkmJmQub2xkLmNhbGwodGhpcyksZC5xdWV1ZT9mLmRlcXVldWUodGhpcyxkLnF1ZXVlKTphIT09ITEmJmYuX3VubWFyayh0aGlzKX07cmV0dXJuIGR9LGVhc2luZzp7bGluZWFyOmZ1bmN0aW9uKGEpe3JldHVybiBhfSxzd2luZzpmdW5jdGlvbihhKXtyZXR1cm4tTWF0aC5jb3MoYSpNYXRoLlBJKS8yKy41fX0sdGltZXJzOltdLGZ4OmZ1bmN0aW9uKGEsYixjKXt0aGlzLm9wdGlvbnM9Yix0aGlzLmVsZW09YSx0aGlzLnByb3A9YyxiLm9yaWc9Yi5vcmlnfHx7fX19KSxmLmZ4LnByb3RvdHlwZT17dXBkYXRlOmZ1bmN0aW9uKCl7dGhpcy5vcHRpb25zLnN0ZXAmJnRoaXMub3B0aW9ucy5zdGVwLmNhbGwodGhpcy5lbGVtLHRoaXMubm93LHRoaXMpLChmLmZ4LnN0ZXBbdGhpcy5wcm9wXXx8Zi5meC5zdGVwLl9kZWZhdWx0KSh0aGlzKX0sY3VyOmZ1bmN0aW9uKCl7aWYodGhpcy5lbGVtW3RoaXMucHJvcF0hPW51bGwmJighdGhpcy5lbGVtLnN0eWxlfHx0aGlzLmVsZW0uc3R5bGVbdGhpcy5wcm9wXT09bnVsbCkpcmV0dXJuIHRoaXMuZWxlbVt0aGlzLnByb3BdO3ZhciBhLGI9Zi5jc3ModGhpcy5lbGVtLHRoaXMucHJvcCk7cmV0dXJuIGlzTmFOKGE9cGFyc2VGbG9hdChiKSk/IWJ8fGI9PT0iYXV0byI/MDpiOmF9LGN1c3RvbTpmdW5jdGlvbihhLGMsZCl7ZnVuY3Rpb24gaChhKXtyZXR1cm4gZS5zdGVwKGEpfXZhciBlPXRoaXMsZz1mLmZ4O3RoaXMuc3RhcnRUaW1lPWNxfHxjcigpLHRoaXMuZW5kPWMsdGhpcy5ub3c9dGhpcy5zdGFydD1hLHRoaXMucG9zPXRoaXMuc3RhdGU9MCx0aGlzLnVuaXQ9ZHx8dGhpcy51bml0fHwoZi5jc3NOdW1iZXJbdGhpcy5wcm9wXT8iIjoicHgiKSxoLnF1ZXVlPXRoaXMub3B0aW9ucy5xdWV1ZSxoLmVsZW09dGhpcy5lbGVtLGguc2F2ZVN0YXRlPWZ1bmN0aW9uKCl7Zi5fZGF0YShlLmVsZW0sImZ4c2hvdyIrZS5wcm9wKT09PWImJihlLm9wdGlvbnMuaGlkZT9mLl9kYXRhKGUuZWxlbSwiZnhzaG93IitlLnByb3AsZS5zdGFydCk6ZS5vcHRpb25zLnNob3cmJmYuX2RhdGEoZS5lbGVtLCJmeHNob3ciK2UucHJvcCxlLmVuZCkpfSxoKCkmJmYudGltZXJzLnB1c2goaCkmJiFjbyYmKGNvPXNldEludGVydmFsKGcudGljayxnLmludGVydmFsKSl9LHNob3c6ZnVuY3Rpb24oKXt2YXIgYT1mLl9kYXRhKHRoaXMuZWxlbSwiZnhzaG93Iit0aGlzLnByb3ApO3RoaXMub3B0aW9ucy5vcmlnW3RoaXMucHJvcF09YXx8Zi5zdHlsZSh0aGlzLmVsZW0sdGhpcy5wcm9wKSx0aGlzLm9wdGlvbnMuc2hvdz0hMCxhIT09Yj90aGlzLmN1c3RvbSh0aGlzLmN1cigpLGEpOnRoaXMuY3VzdG9tKHRoaXMucHJvcD09PSJ3aWR0aCJ8fHRoaXMucHJvcD09PSJoZWlnaHQiPzE6MCx0aGlzLmN1cigpKSxmKHRoaXMuZWxlbSkuc2hvdygpfSxoaWRlOmZ1bmN0aW9uKCl7dGhpcy5vcHRpb25zLm9yaWdbdGhpcy5wcm9wXT1mLl9kYXRhKHRoaXMuZWxlbSwiZnhzaG93Iit0aGlzLnByb3ApfHxmLnN0eWxlKHRoaXMuZWxlbSx0aGlzLnByb3ApLHRoaXMub3B0aW9ucy5oaWRlPSEwLHRoaXMuY3VzdG9tKHRoaXMuY3VyKCksMCl9LHN0ZXA6ZnVuY3Rpb24oYSl7dmFyIGIsYyxkLGU9Y3F8fGNyKCksZz0hMCxoPXRoaXMuZWxlbSxpPXRoaXMub3B0aW9ucztpZihhfHxlPj1pLmR1cmF0aW9uK3RoaXMuc3RhcnRUaW1lKXt0aGlzLm5vdz10aGlzLmVuZCx0aGlzLnBvcz10aGlzLnN0YXRlPTEsdGhpcy51cGRhdGUoKSxpLmFuaW1hdGVkUHJvcGVydGllc1t0aGlzLnByb3BdPSEwO2ZvcihiIGluIGkuYW5pbWF0ZWRQcm9wZXJ0aWVzKWkuYW5pbWF0ZWRQcm9wZXJ0aWVzW2JdIT09ITAmJihnPSExKTtpZihnKXtpLm92ZXJmbG93IT1udWxsJiYhZi5zdXBwb3J0LnNocmlua1dyYXBCbG9ja3MmJmYuZWFjaChbIiIsIlgiLCJZIl0sZnVuY3Rpb24oYSxiKXtoLnN0eWxlWyJvdmVyZmxvdyIrYl09aS5vdmVyZmxvd1thXX0pLGkuaGlkZSYmZihoKS5oaWRlKCk7aWYoaS5oaWRlfHxpLnNob3cpZm9yKGIgaW4gaS5hbmltYXRlZFByb3BlcnRpZXMpZi5zdHlsZShoLGIsaS5vcmlnW2JdKSxmLnJlbW92ZURhdGEoaCwiZnhzaG93IitiLCEwKSxmLnJlbW92ZURhdGEoaCwidG9nZ2xlIitiLCEwKTtkPWkuY29tcGxldGUsZCYmKGkuY29tcGxldGU9ITEsZC5jYWxsKGgpKX1yZXR1cm4hMX1pLmR1cmF0aW9uPT1JbmZpbml0eT90aGlzLm5vdz1lOihjPWUtdGhpcy5zdGFydFRpbWUsdGhpcy5zdGF0ZT1jL2kuZHVyYXRpb24sdGhpcy5wb3M9Zi5lYXNpbmdbaS5hbmltYXRlZFByb3BlcnRpZXNbdGhpcy5wcm9wXV0odGhpcy5zdGF0ZSxjLDAsMSxpLmR1cmF0aW9uKSx0aGlzLm5vdz10aGlzLnN0YXJ0Kyh0aGlzLmVuZC10aGlzLnN0YXJ0KSp0aGlzLnBvcyksdGhpcy51cGRhdGUoKTtyZXR1cm4hMH19LGYuZXh0ZW5kKGYuZngse3RpY2s6ZnVuY3Rpb24oKXt2YXIgYSxiPWYudGltZXJzLGM9MDtmb3IoO2M8Yi5sZW5ndGg7YysrKWE9YltjXSwhYSgpJiZiW2NdPT09YSYmYi5zcGxpY2UoYy0tLDEpO2IubGVuZ3RofHxmLmZ4LnN0b3AoKX0saW50ZXJ2YWw6MTMsc3RvcDpmdW5jdGlvbigpe2NsZWFySW50ZXJ2YWwoY28pLGNvPW51bGx9LHNwZWVkczp7c2xvdzo2MDAsZmFzdDoyMDAsX2RlZmF1bHQ6NDAwfSxzdGVwOntvcGFjaXR5OmZ1bmN0aW9uKGEpe2Yuc3R5bGUoYS5lbGVtLCJvcGFjaXR5IixhLm5vdyl9LF9kZWZhdWx0OmZ1bmN0aW9uKGEpe2EuZWxlbS5zdHlsZSYmYS5lbGVtLnN0eWxlW2EucHJvcF0hPW51bGw/YS5lbGVtLnN0eWxlW2EucHJvcF09YS5ub3crYS51bml0OmEuZWxlbVthLnByb3BdPWEubm93fX19KSxmLmVhY2goY3AuY29uY2F0LmFwcGx5KFtdLGNwKSxmdW5jdGlvbihhLGIpe2IuaW5kZXhPZigibWFyZ2luIikmJihmLmZ4LnN0ZXBbYl09ZnVuY3Rpb24oYSl7Zi5zdHlsZShhLmVsZW0sYixNYXRoLm1heCgwLGEubm93KSthLnVuaXQpfSl9KSxmLmV4cHImJmYuZXhwci5maWx0ZXJzJiYoZi5leHByLmZpbHRlcnMuYW5pbWF0ZWQ9ZnVuY3Rpb24oYSl7cmV0dXJuIGYuZ3JlcChmLnRpbWVycyxmdW5jdGlvbihiKXtyZXR1cm4gYT09PWIuZWxlbX0pLmxlbmd0aH0pO3ZhciBjdixjdz0vXnQoPzphYmxlfGR8aCkkL2ksY3g9L14oPzpib2R5fGh0bWwpJC9pOyJnZXRCb3VuZGluZ0NsaWVudFJlY3QiaW4gYy5kb2N1bWVudEVsZW1lbnQ/Y3Y9ZnVuY3Rpb24oYSxiLGMsZCl7dHJ5e2Q9YS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKX1jYXRjaChlKXt9aWYoIWR8fCFmLmNvbnRhaW5zKGMsYSkpcmV0dXJuIGQ/e3RvcDpkLnRvcCxsZWZ0OmQubGVmdH06e3RvcDowLGxlZnQ6MH07dmFyIGc9Yi5ib2R5LGg9Y3koYiksaT1jLmNsaWVudFRvcHx8Zy5jbGllbnRUb3B8fDAsaj1jLmNsaWVudExlZnR8fGcuY2xpZW50TGVmdHx8MCxrPWgucGFnZVlPZmZzZXR8fGYuc3VwcG9ydC5ib3hNb2RlbCYmYy5zY3JvbGxUb3B8fGcuc2Nyb2xsVG9wLGw9aC5wYWdlWE9mZnNldHx8Zi5zdXBwb3J0LmJveE1vZGVsJiZjLnNjcm9sbExlZnR8fGcuc2Nyb2xsTGVmdCxtPWQudG9wK2staSxuPWQubGVmdCtsLWo7cmV0dXJue3RvcDptLGxlZnQ6bn19OmN2PWZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlPWEub2Zmc2V0UGFyZW50LGc9YSxoPWIuYm9keSxpPWIuZGVmYXVsdFZpZXcsaj1pP2kuZ2V0Q29tcHV0ZWRTdHlsZShhLG51bGwpOmEuY3VycmVudFN0eWxlLGs9YS5vZmZzZXRUb3AsbD1hLm9mZnNldExlZnQ7d2hpbGUoKGE9YS5wYXJlbnROb2RlKSYmYSE9PWgmJmEhPT1jKXtpZihmLnN1cHBvcnQuZml4ZWRQb3NpdGlvbiYmai5wb3NpdGlvbj09PSJmaXhlZCIpYnJlYWs7ZD1pP2kuZ2V0Q29tcHV0ZWRTdHlsZShhLG51bGwpOmEuY3VycmVudFN0eWxlLGstPWEuc2Nyb2xsVG9wLGwtPWEuc2Nyb2xsTGVmdCxhPT09ZSYmKGsrPWEub2Zmc2V0VG9wLGwrPWEub2Zmc2V0TGVmdCxmLnN1cHBvcnQuZG9lc05vdEFkZEJvcmRlciYmKCFmLnN1cHBvcnQuZG9lc0FkZEJvcmRlckZvclRhYmxlQW5kQ2VsbHN8fCFjdy50ZXN0KGEubm9kZU5hbWUpKSYmKGsrPXBhcnNlRmxvYXQoZC5ib3JkZXJUb3BXaWR0aCl8fDAsbCs9cGFyc2VGbG9hdChkLmJvcmRlckxlZnRXaWR0aCl8fDApLGc9ZSxlPWEub2Zmc2V0UGFyZW50KSxmLnN1cHBvcnQuc3VidHJhY3RzQm9yZGVyRm9yT3ZlcmZsb3dOb3RWaXNpYmxlJiZkLm92ZXJmbG93IT09InZpc2libGUiJiYoays9cGFyc2VGbG9hdChkLmJvcmRlclRvcFdpZHRoKXx8MCxsKz1wYXJzZUZsb2F0KGQuYm9yZGVyTGVmdFdpZHRoKXx8MCksaj1kfWlmKGoucG9zaXRpb249PT0icmVsYXRpdmUifHxqLnBvc2l0aW9uPT09InN0YXRpYyIpays9aC5vZmZzZXRUb3AsbCs9aC5vZmZzZXRMZWZ0O2Yuc3VwcG9ydC5maXhlZFBvc2l0aW9uJiZqLnBvc2l0aW9uPT09ImZpeGVkIiYmKGsrPU1hdGgubWF4KGMuc2Nyb2xsVG9wLGguc2Nyb2xsVG9wKSxsKz1NYXRoLm1heChjLnNjcm9sbExlZnQsaC5zY3JvbGxMZWZ0KSk7cmV0dXJue3RvcDprLGxlZnQ6bH19LGYuZm4ub2Zmc2V0PWZ1bmN0aW9uKGEpe2lmKGFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIGE9PT1iP3RoaXM6dGhpcy5lYWNoKGZ1bmN0aW9uKGIpe2Yub2Zmc2V0LnNldE9mZnNldCh0aGlzLGEsYil9KTt2YXIgYz10aGlzWzBdLGQ9YyYmYy5vd25lckRvY3VtZW50O2lmKCFkKXJldHVybiBudWxsO2lmKGM9PT1kLmJvZHkpcmV0dXJuIGYub2Zmc2V0LmJvZHlPZmZzZXQoYyk7cmV0dXJuIGN2KGMsZCxkLmRvY3VtZW50RWxlbWVudCl9LGYub2Zmc2V0PXtib2R5T2Zmc2V0OmZ1bmN0aW9uKGEpe3ZhciBiPWEub2Zmc2V0VG9wLGM9YS5vZmZzZXRMZWZ0O2Yuc3VwcG9ydC5kb2VzTm90SW5jbHVkZU1hcmdpbkluQm9keU9mZnNldCYmKGIrPXBhcnNlRmxvYXQoZi5jc3MoYSwibWFyZ2luVG9wIikpfHwwLGMrPXBhcnNlRmxvYXQoZi5jc3MoYSwibWFyZ2luTGVmdCIpKXx8MCk7cmV0dXJue3RvcDpiLGxlZnQ6Y319LHNldE9mZnNldDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9Zi5jc3MoYSwicG9zaXRpb24iKTtkPT09InN0YXRpYyImJihhLnN0eWxlLnBvc2l0aW9uPSJyZWxhdGl2ZSIpO3ZhciBlPWYoYSksZz1lLm9mZnNldCgpLGg9Zi5jc3MoYSwidG9wIiksaT1mLmNzcyhhLCJsZWZ0Iiksaj0oZD09PSJhYnNvbHV0ZSJ8fGQ9PT0iZml4ZWQiKSYmZi5pbkFycmF5KCJhdXRvIixbaCxpXSk+LTEsaz17fSxsPXt9LG0sbjtqPyhsPWUucG9zaXRpb24oKSxtPWwudG9wLG49bC5sZWZ0KToobT1wYXJzZUZsb2F0KGgpfHwwLG49cGFyc2VGbG9hdChpKXx8MCksZi5pc0Z1bmN0aW9uKGIpJiYoYj1iLmNhbGwoYSxjLGcpKSxiLnRvcCE9bnVsbCYmKGsudG9wPWIudG9wLWcudG9wK20pLGIubGVmdCE9bnVsbCYmKGsubGVmdD1iLmxlZnQtZy5sZWZ0K24pLCJ1c2luZyJpbiBiP2IudXNpbmcuY2FsbChhLGspOmUuY3NzKGspfX0sZi5mbi5leHRlbmQoe3Bvc2l0aW9uOmZ1bmN0aW9uKCl7aWYoIXRoaXNbMF0pcmV0dXJuIG51bGw7dmFyIGE9dGhpc1swXSxiPXRoaXMub2Zmc2V0UGFyZW50KCksYz10aGlzLm9mZnNldCgpLGQ9Y3gudGVzdChiWzBdLm5vZGVOYW1lKT97dG9wOjAsbGVmdDowfTpiLm9mZnNldCgpO2MudG9wLT1wYXJzZUZsb2F0KGYuY3NzKGEsIm1hcmdpblRvcCIpKXx8MCxjLmxlZnQtPXBhcnNlRmxvYXQoZi5jc3MoYSwibWFyZ2luTGVmdCIpKXx8MCxkLnRvcCs9cGFyc2VGbG9hdChmLmNzcyhiWzBdLCJib3JkZXJUb3BXaWR0aCIpKXx8MCxkLmxlZnQrPXBhcnNlRmxvYXQoZi5jc3MoYlswXSwiYm9yZGVyTGVmdFdpZHRoIikpfHwwO3JldHVybnt0b3A6Yy50b3AtZC50b3AsbGVmdDpjLmxlZnQtZC5sZWZ0fX0sb2Zmc2V0UGFyZW50OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5vZmZzZXRQYXJlbnR8fGMuYm9keTt3aGlsZShhJiYhY3gudGVzdChhLm5vZGVOYW1lKSYmZi5jc3MoYSwicG9zaXRpb24iKT09PSJzdGF0aWMiKWE9YS5vZmZzZXRQYXJlbnQ7cmV0dXJuIGF9KX19KSxmLmVhY2goe3Njcm9sbExlZnQ6InBhZ2VYT2Zmc2V0IixzY3JvbGxUb3A6InBhZ2VZT2Zmc2V0In0sZnVuY3Rpb24oYSxjKXt2YXIgZD0vWS8udGVzdChjKTtmLmZuW2FdPWZ1bmN0aW9uKGUpe3JldHVybiBmLmFjY2Vzcyh0aGlzLGZ1bmN0aW9uKGEsZSxnKXt2YXIgaD1jeShhKTtpZihnPT09YilyZXR1cm4gaD9jIGluIGg/aFtjXTpmLnN1cHBvcnQuYm94TW9kZWwmJmguZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50W2VdfHxoLmRvY3VtZW50LmJvZHlbZV06YVtlXTtoP2guc2Nyb2xsVG8oZD9mKGgpLnNjcm9sbExlZnQoKTpnLGQ/ZzpmKGgpLnNjcm9sbFRvcCgpKTphW2VdPWd9LGEsZSxhcmd1bWVudHMubGVuZ3RoLG51bGwpfX0pLGYuZWFjaCh7SGVpZ2h0OiJoZWlnaHQiLFdpZHRoOiJ3aWR0aCJ9LGZ1bmN0aW9uKGEsYyl7dmFyIGQ9ImNsaWVudCIrYSxlPSJzY3JvbGwiK2EsZz0ib2Zmc2V0IithO2YuZm5bImlubmVyIithXT1mdW5jdGlvbigpe3ZhciBhPXRoaXNbMF07cmV0dXJuIGE/YS5zdHlsZT9wYXJzZUZsb2F0KGYuY3NzKGEsYywicGFkZGluZyIpKTp0aGlzW2NdKCk6bnVsbH0sZi5mblsib3V0ZXIiK2FdPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXNbMF07cmV0dXJuIGI/Yi5zdHlsZT9wYXJzZUZsb2F0KGYuY3NzKGIsYyxhPyJtYXJnaW4iOiJib3JkZXIiKSk6dGhpc1tjXSgpOm51bGx9LGYuZm5bY109ZnVuY3Rpb24oYSl7cmV0dXJuIGYuYWNjZXNzKHRoaXMsZnVuY3Rpb24oYSxjLGgpe3ZhciBpLGosayxsO2lmKGYuaXNXaW5kb3coYSkpe2k9YS5kb2N1bWVudCxqPWkuZG9jdW1lbnRFbGVtZW50W2RdO3JldHVybiBmLnN1cHBvcnQuYm94TW9kZWwmJmp8fGkuYm9keSYmaS5ib2R5W2RdfHxqfWlmKGEubm9kZVR5cGU9PT05KXtpPWEuZG9jdW1lbnRFbGVtZW50O2lmKGlbZF0+PWlbZV0pcmV0dXJuIGlbZF07cmV0dXJuIE1hdGgubWF4KGEuYm9keVtlXSxpW2VdLGEuYm9keVtnXSxpW2ddKX1pZihoPT09Yil7az1mLmNzcyhhLGMpLGw9cGFyc2VGbG9hdChrKTtyZXR1cm4gZi5pc051bWVyaWMobCk/bDprfWYoYSkuY3NzKGMsaCl9LGMsYSxhcmd1bWVudHMubGVuZ3RoLG51bGwpfX0pLGEualF1ZXJ5PWEuJD1mLHR5cGVvZiBkZWZpbmU9PSJmdW5jdGlvbiImJmRlZmluZS5hbWQmJmRlZmluZS5hbWQualF1ZXJ5JiZkZWZpbmUoImpxdWVyeSIsW10sZnVuY3Rpb24oKXtyZXR1cm4gZn0pfSkod2luZG93KTsKLyohIGpRdWVyeSBVSSAtIHYxLjguMjAgLSAyMDEyLTA0LTMwCiogaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkKKiBJbmNsdWRlczoganF1ZXJ5LnVpLmNvcmUuanMKKiBDb3B5cmlnaHQgKGMpIDIwMTIgQVVUSE9SUy50eHQ7IExpY2Vuc2VkIE1JVCwgR1BMICovCihmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGMoYixjKXt2YXIgZT1iLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7aWYoImFyZWEiPT09ZSl7dmFyIGY9Yi5wYXJlbnROb2RlLGc9Zi5uYW1lLGg7cmV0dXJuIWIuaHJlZnx8IWd8fGYubm9kZU5hbWUudG9Mb3dlckNhc2UoKSE9PSJtYXAiPyExOihoPWEoImltZ1t1c2VtYXA9IyIrZysiXSIpWzBdLCEhaCYmZChoKSl9cmV0dXJuKC9pbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9ufG9iamVjdC8udGVzdChlKT8hYi5kaXNhYmxlZDoiYSI9PWU/Yi5ocmVmfHxjOmMpJiZkKGIpfWZ1bmN0aW9uIGQoYil7cmV0dXJuIWEoYikucGFyZW50cygpLmFuZFNlbGYoKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4gYS5jdXJDU1ModGhpcywidmlzaWJpbGl0eSIpPT09ImhpZGRlbiJ8fGEuZXhwci5maWx0ZXJzLmhpZGRlbih0aGlzKX0pLmxlbmd0aH1hLnVpPWEudWl8fHt9O2lmKGEudWkudmVyc2lvbilyZXR1cm47YS5leHRlbmQoYS51aSx7dmVyc2lvbjoiMS44LjIwIixrZXlDb2RlOntBTFQ6MTgsQkFDS1NQQUNFOjgsQ0FQU19MT0NLOjIwLENPTU1BOjE4OCxDT01NQU5EOjkxLENPTU1BTkRfTEVGVDo5MSxDT01NQU5EX1JJR0hUOjkzLENPTlRST0w6MTcsREVMRVRFOjQ2LERPV046NDAsRU5EOjM1LEVOVEVSOjEzLEVTQ0FQRToyNyxIT01FOjM2LElOU0VSVDo0NSxMRUZUOjM3LE1FTlU6OTMsTlVNUEFEX0FERDoxMDcsTlVNUEFEX0RFQ0lNQUw6MTEwLE5VTVBBRF9ESVZJREU6MTExLE5VTVBBRF9FTlRFUjoxMDgsTlVNUEFEX01VTFRJUExZOjEwNixOVU1QQURfU1VCVFJBQ1Q6MTA5LFBBR0VfRE9XTjozNCxQQUdFX1VQOjMzLFBFUklPRDoxOTAsUklHSFQ6MzksU0hJRlQ6MTYsU1BBQ0U6MzIsVEFCOjksVVA6MzgsV0lORE9XUzo5MX19KSxhLmZuLmV4dGVuZCh7cHJvcEF0dHI6YS5mbi5wcm9wfHxhLmZuLmF0dHIsX2ZvY3VzOmEuZm4uZm9jdXMsZm9jdXM6ZnVuY3Rpb24oYixjKXtyZXR1cm4gdHlwZW9mIGI9PSJudW1iZXIiP3RoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBkPXRoaXM7c2V0VGltZW91dChmdW5jdGlvbigpe2EoZCkuZm9jdXMoKSxjJiZjLmNhbGwoZCl9LGIpfSk6dGhpcy5fZm9jdXMuYXBwbHkodGhpcyxhcmd1bWVudHMpfSxzY3JvbGxQYXJlbnQ6ZnVuY3Rpb24oKXt2YXIgYjtyZXR1cm4gYS5icm93c2VyLm1zaWUmJi8oc3RhdGljfHJlbGF0aXZlKS8udGVzdCh0aGlzLmNzcygicG9zaXRpb24iKSl8fC9hYnNvbHV0ZS8udGVzdCh0aGlzLmNzcygicG9zaXRpb24iKSk/Yj10aGlzLnBhcmVudHMoKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4vKHJlbGF0aXZlfGFic29sdXRlfGZpeGVkKS8udGVzdChhLmN1ckNTUyh0aGlzLCJwb3NpdGlvbiIsMSkpJiYvKGF1dG98c2Nyb2xsKS8udGVzdChhLmN1ckNTUyh0aGlzLCJvdmVyZmxvdyIsMSkrYS5jdXJDU1ModGhpcywib3ZlcmZsb3cteSIsMSkrYS5jdXJDU1ModGhpcywib3ZlcmZsb3cteCIsMSkpfSkuZXEoMCk6Yj10aGlzLnBhcmVudHMoKS5maWx0ZXIoZnVuY3Rpb24oKXtyZXR1cm4vKGF1dG98c2Nyb2xsKS8udGVzdChhLmN1ckNTUyh0aGlzLCJvdmVyZmxvdyIsMSkrYS5jdXJDU1ModGhpcywib3ZlcmZsb3cteSIsMSkrYS5jdXJDU1ModGhpcywib3ZlcmZsb3cteCIsMSkpfSkuZXEoMCksL2ZpeGVkLy50ZXN0KHRoaXMuY3NzKCJwb3NpdGlvbiIpKXx8IWIubGVuZ3RoP2EoZG9jdW1lbnQpOmJ9LHpJbmRleDpmdW5jdGlvbihjKXtpZihjIT09YilyZXR1cm4gdGhpcy5jc3MoInpJbmRleCIsYyk7aWYodGhpcy5sZW5ndGgpe3ZhciBkPWEodGhpc1swXSksZSxmO3doaWxlKGQubGVuZ3RoJiZkWzBdIT09ZG9jdW1lbnQpe2U9ZC5jc3MoInBvc2l0aW9uIik7aWYoZT09PSJhYnNvbHV0ZSJ8fGU9PT0icmVsYXRpdmUifHxlPT09ImZpeGVkIil7Zj1wYXJzZUludChkLmNzcygiekluZGV4IiksMTApO2lmKCFpc05hTihmKSYmZiE9PTApcmV0dXJuIGZ9ZD1kLnBhcmVudCgpfX1yZXR1cm4gMH0sZGlzYWJsZVNlbGVjdGlvbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmJpbmQoKGEuc3VwcG9ydC5zZWxlY3RzdGFydD8ic2VsZWN0c3RhcnQiOiJtb3VzZWRvd24iKSsiLnVpLWRpc2FibGVTZWxlY3Rpb24iLGZ1bmN0aW9uKGEpe2EucHJldmVudERlZmF1bHQoKX0pfSxlbmFibGVTZWxlY3Rpb246ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy51bmJpbmQoIi51aS1kaXNhYmxlU2VsZWN0aW9uIil9fSksYS5lYWNoKFsiV2lkdGgiLCJIZWlnaHQiXSxmdW5jdGlvbihjLGQpe2Z1bmN0aW9uIGgoYixjLGQsZil7cmV0dXJuIGEuZWFjaChlLGZ1bmN0aW9uKCl7Yy09cGFyc2VGbG9hdChhLmN1ckNTUyhiLCJwYWRkaW5nIit0aGlzLCEwKSl8fDAsZCYmKGMtPXBhcnNlRmxvYXQoYS5jdXJDU1MoYiwiYm9yZGVyIit0aGlzKyJXaWR0aCIsITApKXx8MCksZiYmKGMtPXBhcnNlRmxvYXQoYS5jdXJDU1MoYiwibWFyZ2luIit0aGlzLCEwKSl8fDApfSksY312YXIgZT1kPT09IldpZHRoIj9bIkxlZnQiLCJSaWdodCJdOlsiVG9wIiwiQm90dG9tIl0sZj1kLnRvTG93ZXJDYXNlKCksZz17aW5uZXJXaWR0aDphLmZuLmlubmVyV2lkdGgsaW5uZXJIZWlnaHQ6YS5mbi5pbm5lckhlaWdodCxvdXRlcldpZHRoOmEuZm4ub3V0ZXJXaWR0aCxvdXRlckhlaWdodDphLmZuLm91dGVySGVpZ2h0fTthLmZuWyJpbm5lciIrZF09ZnVuY3Rpb24oYyl7cmV0dXJuIGM9PT1iP2dbImlubmVyIitkXS5jYWxsKHRoaXMpOnRoaXMuZWFjaChmdW5jdGlvbigpe2EodGhpcykuY3NzKGYsaCh0aGlzLGMpKyJweCIpfSl9LGEuZm5bIm91dGVyIitkXT1mdW5jdGlvbihiLGMpe3JldHVybiB0eXBlb2YgYiE9Im51bWJlciI/Z1sib3V0ZXIiK2RdLmNhbGwodGhpcyxiKTp0aGlzLmVhY2goZnVuY3Rpb24oKXthKHRoaXMpLmNzcyhmLGgodGhpcyxiLCEwLGMpKyJweCIpfSl9fSksYS5leHRlbmQoYS5leHByWyI6Il0se2RhdGE6ZnVuY3Rpb24oYixjLGQpe3JldHVybiEhYS5kYXRhKGIsZFszXSl9LGZvY3VzYWJsZTpmdW5jdGlvbihiKXtyZXR1cm4gYyhiLCFpc05hTihhLmF0dHIoYiwidGFiaW5kZXgiKSkpfSx0YWJiYWJsZTpmdW5jdGlvbihiKXt2YXIgZD1hLmF0dHIoYiwidGFiaW5kZXgiKSxlPWlzTmFOKGQpO3JldHVybihlfHxkPj0wKSYmYyhiLCFlKX19KSxhKGZ1bmN0aW9uKCl7dmFyIGI9ZG9jdW1lbnQuYm9keSxjPWIuYXBwZW5kQ2hpbGQoYz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSk7Yy5vZmZzZXRIZWlnaHQsYS5leHRlbmQoYy5zdHlsZSx7bWluSGVpZ2h0OiIxMDBweCIsaGVpZ2h0OiJhdXRvIixwYWRkaW5nOjAsYm9yZGVyV2lkdGg6MH0pLGEuc3VwcG9ydC5taW5IZWlnaHQ9Yy5vZmZzZXRIZWlnaHQ9PT0xMDAsYS5zdXBwb3J0LnNlbGVjdHN0YXJ0PSJvbnNlbGVjdHN0YXJ0ImluIGMsYi5yZW1vdmVDaGlsZChjKS5zdHlsZS5kaXNwbGF5PSJub25lIn0pLGEuZXh0ZW5kKGEudWkse3BsdWdpbjp7YWRkOmZ1bmN0aW9uKGIsYyxkKXt2YXIgZT1hLnVpW2JdLnByb3RvdHlwZTtmb3IodmFyIGYgaW4gZCllLnBsdWdpbnNbZl09ZS5wbHVnaW5zW2ZdfHxbXSxlLnBsdWdpbnNbZl0ucHVzaChbYyxkW2ZdXSl9LGNhbGw6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPWEucGx1Z2luc1tiXTtpZighZHx8IWEuZWxlbWVudFswXS5wYXJlbnROb2RlKXJldHVybjtmb3IodmFyIGU9MDtlPGQubGVuZ3RoO2UrKylhLm9wdGlvbnNbZFtlXVswXV0mJmRbZV1bMV0uYXBwbHkoYS5lbGVtZW50LGMpfX0sY29udGFpbnM6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZG9jdW1lbnQuY29tcGFyZURvY3VtZW50UG9zaXRpb24/YS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihiKSYxNjphIT09YiYmYS5jb250YWlucyhiKX0saGFzU2Nyb2xsOmZ1bmN0aW9uKGIsYyl7aWYoYShiKS5jc3MoIm92ZXJmbG93Iik9PT0iaGlkZGVuIilyZXR1cm4hMTt2YXIgZD1jJiZjPT09ImxlZnQiPyJzY3JvbGxMZWZ0Ijoic2Nyb2xsVG9wIixlPSExO3JldHVybiBiW2RdPjA/ITA6KGJbZF09MSxlPWJbZF0+MCxiW2RdPTAsZSl9LGlzT3ZlckF4aXM6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBhPmImJmE8YitjfSxpc092ZXI6ZnVuY3Rpb24oYixjLGQsZSxmLGcpe3JldHVybiBhLnVpLmlzT3ZlckF4aXMoYixkLGYpJiZhLnVpLmlzT3ZlckF4aXMoYyxlLGcpfX0pfSkoalF1ZXJ5KTs7LyohIGpRdWVyeSBVSSAtIHYxLjguMjAgLSAyMDEyLTA0LTMwCiogaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkKKiBJbmNsdWRlczoganF1ZXJ5LnVpLndpZGdldC5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKGEsYil7aWYoYS5jbGVhbkRhdGEpe3ZhciBjPWEuY2xlYW5EYXRhO2EuY2xlYW5EYXRhPWZ1bmN0aW9uKGIpe2Zvcih2YXIgZD0wLGU7KGU9YltkXSkhPW51bGw7ZCsrKXRyeXthKGUpLnRyaWdnZXJIYW5kbGVyKCJyZW1vdmUiKX1jYXRjaChmKXt9YyhiKX19ZWxzZXt2YXIgZD1hLmZuLnJlbW92ZTthLmZuLnJlbW92ZT1mdW5jdGlvbihiLGMpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtyZXR1cm4gY3x8KCFifHxhLmZpbHRlcihiLFt0aGlzXSkubGVuZ3RoKSYmYSgiKiIsdGhpcykuYWRkKFt0aGlzXSkuZWFjaChmdW5jdGlvbigpe3RyeXthKHRoaXMpLnRyaWdnZXJIYW5kbGVyKCJyZW1vdmUiKX1jYXRjaChiKXt9fSksZC5jYWxsKGEodGhpcyksYixjKX0pfX1hLndpZGdldD1mdW5jdGlvbihiLGMsZCl7dmFyIGU9Yi5zcGxpdCgiLiIpWzBdLGY7Yj1iLnNwbGl0KCIuIilbMV0sZj1lKyItIitiLGR8fChkPWMsYz1hLldpZGdldCksYS5leHByWyI6Il1bZl09ZnVuY3Rpb24oYyl7cmV0dXJuISFhLmRhdGEoYyxiKX0sYVtlXT1hW2VdfHx7fSxhW2VdW2JdPWZ1bmN0aW9uKGEsYil7YXJndW1lbnRzLmxlbmd0aCYmdGhpcy5fY3JlYXRlV2lkZ2V0KGEsYil9O3ZhciBnPW5ldyBjO2cub3B0aW9ucz1hLmV4dGVuZCghMCx7fSxnLm9wdGlvbnMpLGFbZV1bYl0ucHJvdG90eXBlPWEuZXh0ZW5kKCEwLGcse25hbWVzcGFjZTplLHdpZGdldE5hbWU6Yix3aWRnZXRFdmVudFByZWZpeDphW2VdW2JdLnByb3RvdHlwZS53aWRnZXRFdmVudFByZWZpeHx8Yix3aWRnZXRCYXNlQ2xhc3M6Zn0sZCksYS53aWRnZXQuYnJpZGdlKGIsYVtlXVtiXSl9LGEud2lkZ2V0LmJyaWRnZT1mdW5jdGlvbihjLGQpe2EuZm5bY109ZnVuY3Rpb24oZSl7dmFyIGY9dHlwZW9mIGU9PSJzdHJpbmciLGc9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpLGg9dGhpcztyZXR1cm4gZT0hZiYmZy5sZW5ndGg/YS5leHRlbmQuYXBwbHkobnVsbCxbITAsZV0uY29uY2F0KGcpKTplLGYmJmUuY2hhckF0KDApPT09Il8iP2g6KGY/dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YS5kYXRhKHRoaXMsYyksZj1kJiZhLmlzRnVuY3Rpb24oZFtlXSk/ZFtlXS5hcHBseShkLGcpOmQ7aWYoZiE9PWQmJmYhPT1iKXJldHVybiBoPWYsITF9KTp0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1hLmRhdGEodGhpcyxjKTtiP2Iub3B0aW9uKGV8fHt9KS5faW5pdCgpOmEuZGF0YSh0aGlzLGMsbmV3IGQoZSx0aGlzKSl9KSxoKX19LGEuV2lkZ2V0PWZ1bmN0aW9uKGEsYil7YXJndW1lbnRzLmxlbmd0aCYmdGhpcy5fY3JlYXRlV2lkZ2V0KGEsYil9LGEuV2lkZ2V0LnByb3RvdHlwZT17d2lkZ2V0TmFtZToid2lkZ2V0Iix3aWRnZXRFdmVudFByZWZpeDoiIixvcHRpb25zOntkaXNhYmxlZDohMX0sX2NyZWF0ZVdpZGdldDpmdW5jdGlvbihiLGMpe2EuZGF0YShjLHRoaXMud2lkZ2V0TmFtZSx0aGlzKSx0aGlzLmVsZW1lbnQ9YShjKSx0aGlzLm9wdGlvbnM9YS5leHRlbmQoITAse30sdGhpcy5vcHRpb25zLHRoaXMuX2dldENyZWF0ZU9wdGlvbnMoKSxiKTt2YXIgZD10aGlzO3RoaXMuZWxlbWVudC5iaW5kKCJyZW1vdmUuIit0aGlzLndpZGdldE5hbWUsZnVuY3Rpb24oKXtkLmRlc3Ryb3koKX0pLHRoaXMuX2NyZWF0ZSgpLHRoaXMuX3RyaWdnZXIoImNyZWF0ZSIpLHRoaXMuX2luaXQoKX0sX2dldENyZWF0ZU9wdGlvbnM6ZnVuY3Rpb24oKXtyZXR1cm4gYS5tZXRhZGF0YSYmYS5tZXRhZGF0YS5nZXQodGhpcy5lbGVtZW50WzBdKVt0aGlzLndpZGdldE5hbWVdfSxfY3JlYXRlOmZ1bmN0aW9uKCl7fSxfaW5pdDpmdW5jdGlvbigpe30sZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC51bmJpbmQoIi4iK3RoaXMud2lkZ2V0TmFtZSkucmVtb3ZlRGF0YSh0aGlzLndpZGdldE5hbWUpLHRoaXMud2lkZ2V0KCkudW5iaW5kKCIuIit0aGlzLndpZGdldE5hbWUpLnJlbW92ZUF0dHIoImFyaWEtZGlzYWJsZWQiKS5yZW1vdmVDbGFzcyh0aGlzLndpZGdldEJhc2VDbGFzcysiLWRpc2FibGVkICIrInVpLXN0YXRlLWRpc2FibGVkIil9LHdpZGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVsZW1lbnR9LG9wdGlvbjpmdW5jdGlvbihjLGQpe3ZhciBlPWM7aWYoYXJndW1lbnRzLmxlbmd0aD09PTApcmV0dXJuIGEuZXh0ZW5kKHt9LHRoaXMub3B0aW9ucyk7aWYodHlwZW9mIGM9PSJzdHJpbmciKXtpZihkPT09YilyZXR1cm4gdGhpcy5vcHRpb25zW2NdO2U9e30sZVtjXT1kfXJldHVybiB0aGlzLl9zZXRPcHRpb25zKGUpLHRoaXN9LF9zZXRPcHRpb25zOmZ1bmN0aW9uKGIpe3ZhciBjPXRoaXM7cmV0dXJuIGEuZWFjaChiLGZ1bmN0aW9uKGEsYil7Yy5fc2V0T3B0aW9uKGEsYil9KSx0aGlzfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMub3B0aW9uc1thXT1iLGE9PT0iZGlzYWJsZWQiJiZ0aGlzLndpZGdldCgpW2I/ImFkZENsYXNzIjoicmVtb3ZlQ2xhc3MiXSh0aGlzLndpZGdldEJhc2VDbGFzcysiLWRpc2FibGVkIisiICIrInVpLXN0YXRlLWRpc2FibGVkIikuYXR0cigiYXJpYS1kaXNhYmxlZCIsYiksdGhpc30sZW5hYmxlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3NldE9wdGlvbigiZGlzYWJsZWQiLCExKX0sZGlzYWJsZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zZXRPcHRpb24oImRpc2FibGVkIiwhMCl9LF90cmlnZ2VyOmZ1bmN0aW9uKGIsYyxkKXt2YXIgZSxmLGc9dGhpcy5vcHRpb25zW2JdO2Q9ZHx8e30sYz1hLkV2ZW50KGMpLGMudHlwZT0oYj09PXRoaXMud2lkZ2V0RXZlbnRQcmVmaXg/Yjp0aGlzLndpZGdldEV2ZW50UHJlZml4K2IpLnRvTG93ZXJDYXNlKCksYy50YXJnZXQ9dGhpcy5lbGVtZW50WzBdLGY9Yy5vcmlnaW5hbEV2ZW50O2lmKGYpZm9yKGUgaW4gZillIGluIGN8fChjW2VdPWZbZV0pO3JldHVybiB0aGlzLmVsZW1lbnQudHJpZ2dlcihjLGQpLCEoYS5pc0Z1bmN0aW9uKGcpJiZnLmNhbGwodGhpcy5lbGVtZW50WzBdLGMsZCk9PT0hMXx8Yy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSl9fX0pKGpRdWVyeSk7Oy8qISBqUXVlcnkgVUkgLSB2MS44LjIwIC0gMjAxMi0wNC0zMAoqIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5LXVpCiogSW5jbHVkZXM6IGpxdWVyeS51aS5tb3VzZS5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKGEsYil7dmFyIGM9ITE7YShkb2N1bWVudCkubW91c2V1cChmdW5jdGlvbihhKXtjPSExfSksYS53aWRnZXQoInVpLm1vdXNlIix7b3B0aW9uczp7Y2FuY2VsOiI6aW5wdXQsb3B0aW9uIixkaXN0YW5jZToxLGRlbGF5OjB9LF9tb3VzZUluaXQ6ZnVuY3Rpb24oKXt2YXIgYj10aGlzO3RoaXMuZWxlbWVudC5iaW5kKCJtb3VzZWRvd24uIit0aGlzLndpZGdldE5hbWUsZnVuY3Rpb24oYSl7cmV0dXJuIGIuX21vdXNlRG93bihhKX0pLmJpbmQoImNsaWNrLiIrdGhpcy53aWRnZXROYW1lLGZ1bmN0aW9uKGMpe2lmKCEwPT09YS5kYXRhKGMudGFyZ2V0LGIud2lkZ2V0TmFtZSsiLnByZXZlbnRDbGlja0V2ZW50IikpcmV0dXJuIGEucmVtb3ZlRGF0YShjLnRhcmdldCxiLndpZGdldE5hbWUrIi5wcmV2ZW50Q2xpY2tFdmVudCIpLGMuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksITF9KSx0aGlzLnN0YXJ0ZWQ9ITF9LF9tb3VzZURlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQudW5iaW5kKCIuIit0aGlzLndpZGdldE5hbWUpLGEoZG9jdW1lbnQpLnVuYmluZCgibW91c2Vtb3ZlLiIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlTW92ZURlbGVnYXRlKS51bmJpbmQoIm1vdXNldXAuIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VVcERlbGVnYXRlKX0sX21vdXNlRG93bjpmdW5jdGlvbihiKXtpZihjKXJldHVybjt0aGlzLl9tb3VzZVN0YXJ0ZWQmJnRoaXMuX21vdXNlVXAoYiksdGhpcy5fbW91c2VEb3duRXZlbnQ9Yjt2YXIgZD10aGlzLGU9Yi53aGljaD09MSxmPXR5cGVvZiB0aGlzLm9wdGlvbnMuY2FuY2VsPT0ic3RyaW5nIiYmYi50YXJnZXQubm9kZU5hbWU/YShiLnRhcmdldCkuY2xvc2VzdCh0aGlzLm9wdGlvbnMuY2FuY2VsKS5sZW5ndGg6ITE7aWYoIWV8fGZ8fCF0aGlzLl9tb3VzZUNhcHR1cmUoYikpcmV0dXJuITA7dGhpcy5tb3VzZURlbGF5TWV0PSF0aGlzLm9wdGlvbnMuZGVsYXksdGhpcy5tb3VzZURlbGF5TWV0fHwodGhpcy5fbW91c2VEZWxheVRpbWVyPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtkLm1vdXNlRGVsYXlNZXQ9ITB9LHRoaXMub3B0aW9ucy5kZWxheSkpO2lmKHRoaXMuX21vdXNlRGlzdGFuY2VNZXQoYikmJnRoaXMuX21vdXNlRGVsYXlNZXQoYikpe3RoaXMuX21vdXNlU3RhcnRlZD10aGlzLl9tb3VzZVN0YXJ0KGIpIT09ITE7aWYoIXRoaXMuX21vdXNlU3RhcnRlZClyZXR1cm4gYi5wcmV2ZW50RGVmYXVsdCgpLCEwfXJldHVybiEwPT09YS5kYXRhKGIudGFyZ2V0LHRoaXMud2lkZ2V0TmFtZSsiLnByZXZlbnRDbGlja0V2ZW50IikmJmEucmVtb3ZlRGF0YShiLnRhcmdldCx0aGlzLndpZGdldE5hbWUrIi5wcmV2ZW50Q2xpY2tFdmVudCIpLHRoaXMuX21vdXNlTW92ZURlbGVnYXRlPWZ1bmN0aW9uKGEpe3JldHVybiBkLl9tb3VzZU1vdmUoYSl9LHRoaXMuX21vdXNlVXBEZWxlZ2F0ZT1mdW5jdGlvbihhKXtyZXR1cm4gZC5fbW91c2VVcChhKX0sYShkb2N1bWVudCkuYmluZCgibW91c2Vtb3ZlLiIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlTW92ZURlbGVnYXRlKS5iaW5kKCJtb3VzZXVwLiIrdGhpcy53aWRnZXROYW1lLHRoaXMuX21vdXNlVXBEZWxlZ2F0ZSksYi5wcmV2ZW50RGVmYXVsdCgpLGM9ITAsITB9LF9tb3VzZU1vdmU6ZnVuY3Rpb24oYil7cmV0dXJuIWEuYnJvd3Nlci5tc2llfHxkb2N1bWVudC5kb2N1bWVudE1vZGU+PTl8fCEhYi5idXR0b24/dGhpcy5fbW91c2VTdGFydGVkPyh0aGlzLl9tb3VzZURyYWcoYiksYi5wcmV2ZW50RGVmYXVsdCgpKToodGhpcy5fbW91c2VEaXN0YW5jZU1ldChiKSYmdGhpcy5fbW91c2VEZWxheU1ldChiKSYmKHRoaXMuX21vdXNlU3RhcnRlZD10aGlzLl9tb3VzZVN0YXJ0KHRoaXMuX21vdXNlRG93bkV2ZW50LGIpIT09ITEsdGhpcy5fbW91c2VTdGFydGVkP3RoaXMuX21vdXNlRHJhZyhiKTp0aGlzLl9tb3VzZVVwKGIpKSwhdGhpcy5fbW91c2VTdGFydGVkKTp0aGlzLl9tb3VzZVVwKGIpfSxfbW91c2VVcDpmdW5jdGlvbihiKXtyZXR1cm4gYShkb2N1bWVudCkudW5iaW5kKCJtb3VzZW1vdmUuIit0aGlzLndpZGdldE5hbWUsdGhpcy5fbW91c2VNb3ZlRGVsZWdhdGUpLnVuYmluZCgibW91c2V1cC4iK3RoaXMud2lkZ2V0TmFtZSx0aGlzLl9tb3VzZVVwRGVsZWdhdGUpLHRoaXMuX21vdXNlU3RhcnRlZCYmKHRoaXMuX21vdXNlU3RhcnRlZD0hMSxiLnRhcmdldD09dGhpcy5fbW91c2VEb3duRXZlbnQudGFyZ2V0JiZhLmRhdGEoYi50YXJnZXQsdGhpcy53aWRnZXROYW1lKyIucHJldmVudENsaWNrRXZlbnQiLCEwKSx0aGlzLl9tb3VzZVN0b3AoYikpLCExfSxfbW91c2VEaXN0YW5jZU1ldDpmdW5jdGlvbihhKXtyZXR1cm4gTWF0aC5tYXgoTWF0aC5hYnModGhpcy5fbW91c2VEb3duRXZlbnQucGFnZVgtYS5wYWdlWCksTWF0aC5hYnModGhpcy5fbW91c2VEb3duRXZlbnQucGFnZVktYS5wYWdlWSkpPj10aGlzLm9wdGlvbnMuZGlzdGFuY2V9LF9tb3VzZURlbGF5TWV0OmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLm1vdXNlRGVsYXlNZXR9LF9tb3VzZVN0YXJ0OmZ1bmN0aW9uKGEpe30sX21vdXNlRHJhZzpmdW5jdGlvbihhKXt9LF9tb3VzZVN0b3A6ZnVuY3Rpb24oYSl7fSxfbW91c2VDYXB0dXJlOmZ1bmN0aW9uKGEpe3JldHVybiEwfX0pfSkoalF1ZXJ5KTs7LyohIGpRdWVyeSBVSSAtIHYxLjguMjAgLSAyMDEyLTA0LTMwCiogaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkKKiBJbmNsdWRlczoganF1ZXJ5LnVpLnBvc2l0aW9uLmpzCiogQ29weXJpZ2h0IChjKSAyMDEyIEFVVEhPUlMudHh0OyBMaWNlbnNlZCBNSVQsIEdQTCAqLwooZnVuY3Rpb24oYSxiKXthLnVpPWEudWl8fHt9O3ZhciBjPS9sZWZ0fGNlbnRlcnxyaWdodC8sZD0vdG9wfGNlbnRlcnxib3R0b20vLGU9ImNlbnRlciIsZj17fSxnPWEuZm4ucG9zaXRpb24saD1hLmZuLm9mZnNldDthLmZuLnBvc2l0aW9uPWZ1bmN0aW9uKGIpe2lmKCFifHwhYi5vZilyZXR1cm4gZy5hcHBseSh0aGlzLGFyZ3VtZW50cyk7Yj1hLmV4dGVuZCh7fSxiKTt2YXIgaD1hKGIub2YpLGk9aFswXSxqPShiLmNvbGxpc2lvbnx8ImZsaXAiKS5zcGxpdCgiICIpLGs9Yi5vZmZzZXQ/Yi5vZmZzZXQuc3BsaXQoIiAiKTpbMCwwXSxsLG0sbjtyZXR1cm4gaS5ub2RlVHlwZT09PTk/KGw9aC53aWR0aCgpLG09aC5oZWlnaHQoKSxuPXt0b3A6MCxsZWZ0OjB9KTppLnNldFRpbWVvdXQ/KGw9aC53aWR0aCgpLG09aC5oZWlnaHQoKSxuPXt0b3A6aC5zY3JvbGxUb3AoKSxsZWZ0Omguc2Nyb2xsTGVmdCgpfSk6aS5wcmV2ZW50RGVmYXVsdD8oYi5hdD0ibGVmdCB0b3AiLGw9bT0wLG49e3RvcDpiLm9mLnBhZ2VZLGxlZnQ6Yi5vZi5wYWdlWH0pOihsPWgub3V0ZXJXaWR0aCgpLG09aC5vdXRlckhlaWdodCgpLG49aC5vZmZzZXQoKSksYS5lYWNoKFsibXkiLCJhdCJdLGZ1bmN0aW9uKCl7dmFyIGE9KGJbdGhpc118fCIiKS5zcGxpdCgiICIpO2EubGVuZ3RoPT09MSYmKGE9Yy50ZXN0KGFbMF0pP2EuY29uY2F0KFtlXSk6ZC50ZXN0KGFbMF0pP1tlXS5jb25jYXQoYSk6W2UsZV0pLGFbMF09Yy50ZXN0KGFbMF0pP2FbMF06ZSxhWzFdPWQudGVzdChhWzFdKT9hWzFdOmUsYlt0aGlzXT1hfSksai5sZW5ndGg9PT0xJiYoalsxXT1qWzBdKSxrWzBdPXBhcnNlSW50KGtbMF0sMTApfHwwLGsubGVuZ3RoPT09MSYmKGtbMV09a1swXSksa1sxXT1wYXJzZUludChrWzFdLDEwKXx8MCxiLmF0WzBdPT09InJpZ2h0Ij9uLmxlZnQrPWw6Yi5hdFswXT09PWUmJihuLmxlZnQrPWwvMiksYi5hdFsxXT09PSJib3R0b20iP24udG9wKz1tOmIuYXRbMV09PT1lJiYobi50b3ArPW0vMiksbi5sZWZ0Kz1rWzBdLG4udG9wKz1rWzFdLHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBjPWEodGhpcyksZD1jLm91dGVyV2lkdGgoKSxnPWMub3V0ZXJIZWlnaHQoKSxoPXBhcnNlSW50KGEuY3VyQ1NTKHRoaXMsIm1hcmdpbkxlZnQiLCEwKSl8fDAsaT1wYXJzZUludChhLmN1ckNTUyh0aGlzLCJtYXJnaW5Ub3AiLCEwKSl8fDAsbz1kK2grKHBhcnNlSW50KGEuY3VyQ1NTKHRoaXMsIm1hcmdpblJpZ2h0IiwhMCkpfHwwKSxwPWcraSsocGFyc2VJbnQoYS5jdXJDU1ModGhpcywibWFyZ2luQm90dG9tIiwhMCkpfHwwKSxxPWEuZXh0ZW5kKHt9LG4pLHI7Yi5teVswXT09PSJyaWdodCI/cS5sZWZ0LT1kOmIubXlbMF09PT1lJiYocS5sZWZ0LT1kLzIpLGIubXlbMV09PT0iYm90dG9tIj9xLnRvcC09ZzpiLm15WzFdPT09ZSYmKHEudG9wLT1nLzIpLGYuZnJhY3Rpb25zfHwocS5sZWZ0PU1hdGgucm91bmQocS5sZWZ0KSxxLnRvcD1NYXRoLnJvdW5kKHEudG9wKSkscj17bGVmdDpxLmxlZnQtaCx0b3A6cS50b3AtaX0sYS5lYWNoKFsibGVmdCIsInRvcCJdLGZ1bmN0aW9uKGMsZSl7YS51aS5wb3NpdGlvbltqW2NdXSYmYS51aS5wb3NpdGlvbltqW2NdXVtlXShxLHt0YXJnZXRXaWR0aDpsLHRhcmdldEhlaWdodDptLGVsZW1XaWR0aDpkLGVsZW1IZWlnaHQ6Zyxjb2xsaXNpb25Qb3NpdGlvbjpyLGNvbGxpc2lvbldpZHRoOm8sY29sbGlzaW9uSGVpZ2h0OnAsb2Zmc2V0OmssbXk6Yi5teSxhdDpiLmF0fSl9KSxhLmZuLmJnaWZyYW1lJiZjLmJnaWZyYW1lKCksYy5vZmZzZXQoYS5leHRlbmQocSx7dXNpbmc6Yi51c2luZ30pKX0pfSxhLnVpLnBvc2l0aW9uPXtmaXQ6e2xlZnQ6ZnVuY3Rpb24oYixjKXt2YXIgZD1hKHdpbmRvdyksZT1jLmNvbGxpc2lvblBvc2l0aW9uLmxlZnQrYy5jb2xsaXNpb25XaWR0aC1kLndpZHRoKCktZC5zY3JvbGxMZWZ0KCk7Yi5sZWZ0PWU+MD9iLmxlZnQtZTpNYXRoLm1heChiLmxlZnQtYy5jb2xsaXNpb25Qb3NpdGlvbi5sZWZ0LGIubGVmdCl9LHRvcDpmdW5jdGlvbihiLGMpe3ZhciBkPWEod2luZG93KSxlPWMuY29sbGlzaW9uUG9zaXRpb24udG9wK2MuY29sbGlzaW9uSGVpZ2h0LWQuaGVpZ2h0KCktZC5zY3JvbGxUb3AoKTtiLnRvcD1lPjA/Yi50b3AtZTpNYXRoLm1heChiLnRvcC1jLmNvbGxpc2lvblBvc2l0aW9uLnRvcCxiLnRvcCl9fSxmbGlwOntsZWZ0OmZ1bmN0aW9uKGIsYyl7aWYoYy5hdFswXT09PWUpcmV0dXJuO3ZhciBkPWEod2luZG93KSxmPWMuY29sbGlzaW9uUG9zaXRpb24ubGVmdCtjLmNvbGxpc2lvbldpZHRoLWQud2lkdGgoKS1kLnNjcm9sbExlZnQoKSxnPWMubXlbMF09PT0ibGVmdCI/LWMuZWxlbVdpZHRoOmMubXlbMF09PT0icmlnaHQiP2MuZWxlbVdpZHRoOjAsaD1jLmF0WzBdPT09ImxlZnQiP2MudGFyZ2V0V2lkdGg6LWMudGFyZ2V0V2lkdGgsaT0tMipjLm9mZnNldFswXTtiLmxlZnQrPWMuY29sbGlzaW9uUG9zaXRpb24ubGVmdDwwP2craCtpOmY+MD9nK2graTowfSx0b3A6ZnVuY3Rpb24oYixjKXtpZihjLmF0WzFdPT09ZSlyZXR1cm47dmFyIGQ9YSh3aW5kb3cpLGY9Yy5jb2xsaXNpb25Qb3NpdGlvbi50b3ArYy5jb2xsaXNpb25IZWlnaHQtZC5oZWlnaHQoKS1kLnNjcm9sbFRvcCgpLGc9Yy5teVsxXT09PSJ0b3AiPy1jLmVsZW1IZWlnaHQ6Yy5teVsxXT09PSJib3R0b20iP2MuZWxlbUhlaWdodDowLGg9Yy5hdFsxXT09PSJ0b3AiP2MudGFyZ2V0SGVpZ2h0Oi1jLnRhcmdldEhlaWdodCxpPS0yKmMub2Zmc2V0WzFdO2IudG9wKz1jLmNvbGxpc2lvblBvc2l0aW9uLnRvcDwwP2craCtpOmY+MD9nK2graTowfX19LGEub2Zmc2V0LnNldE9mZnNldHx8KGEub2Zmc2V0LnNldE9mZnNldD1mdW5jdGlvbihiLGMpey9zdGF0aWMvLnRlc3QoYS5jdXJDU1MoYiwicG9zaXRpb24iKSkmJihiLnN0eWxlLnBvc2l0aW9uPSJyZWxhdGl2ZSIpO3ZhciBkPWEoYiksZT1kLm9mZnNldCgpLGY9cGFyc2VJbnQoYS5jdXJDU1MoYiwidG9wIiwhMCksMTApfHwwLGc9cGFyc2VJbnQoYS5jdXJDU1MoYiwibGVmdCIsITApLDEwKXx8MCxoPXt0b3A6Yy50b3AtZS50b3ArZixsZWZ0OmMubGVmdC1lLmxlZnQrZ307InVzaW5nImluIGM/Yy51c2luZy5jYWxsKGIsaCk6ZC5jc3MoaCl9LGEuZm4ub2Zmc2V0PWZ1bmN0aW9uKGIpe3ZhciBjPXRoaXNbMF07cmV0dXJuIWN8fCFjLm93bmVyRG9jdW1lbnQ/bnVsbDpiP3RoaXMuZWFjaChmdW5jdGlvbigpe2Eub2Zmc2V0LnNldE9mZnNldCh0aGlzLGIpfSk6aC5jYWxsKHRoaXMpfSksZnVuY3Rpb24oKXt2YXIgYj1kb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgiYm9keSIpWzBdLGM9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksZCxlLGcsaCxpO2Q9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChiPyJkaXYiOiJib2R5IiksZz17dmlzaWJpbGl0eToiaGlkZGVuIix3aWR0aDowLGhlaWdodDowLGJvcmRlcjowLG1hcmdpbjowLGJhY2tncm91bmQ6Im5vbmUifSxiJiZhLmV4dGVuZChnLHtwb3NpdGlvbjoiYWJzb2x1dGUiLGxlZnQ6Ii0xMDAwcHgiLHRvcDoiLTEwMDBweCJ9KTtmb3IodmFyIGogaW4gZylkLnN0eWxlW2pdPWdbal07ZC5hcHBlbmRDaGlsZChjKSxlPWJ8fGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCxlLmluc2VydEJlZm9yZShkLGUuZmlyc3RDaGlsZCksYy5zdHlsZS5jc3NUZXh0PSJwb3NpdGlvbjogYWJzb2x1dGU7IGxlZnQ6IDEwLjc0MzIyMjJweDsgdG9wOiAxMC40MzIzMjVweDsgaGVpZ2h0OiAzMHB4OyB3aWR0aDogMjAxcHg7IixoPWEoYykub2Zmc2V0KGZ1bmN0aW9uKGEsYil7cmV0dXJuIGJ9KS5vZmZzZXQoKSxkLmlubmVySFRNTD0iIixlLnJlbW92ZUNoaWxkKGQpLGk9aC50b3AraC5sZWZ0KyhiPzJlMzowKSxmLmZyYWN0aW9ucz1pPjIxJiZpPDIyfSgpfSkoalF1ZXJ5KTs7LyohIGpRdWVyeSBVSSAtIHYxLjguMjAgLSAyMDEyLTA0LTMwCiogaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkKKiBJbmNsdWRlczoganF1ZXJ5LnVpLmRyYWdnYWJsZS5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKGEsYil7YS53aWRnZXQoInVpLmRyYWdnYWJsZSIsYS51aS5tb3VzZSx7d2lkZ2V0RXZlbnRQcmVmaXg6ImRyYWciLG9wdGlvbnM6e2FkZENsYXNzZXM6ITAsYXBwZW5kVG86InBhcmVudCIsYXhpczohMSxjb25uZWN0VG9Tb3J0YWJsZTohMSxjb250YWlubWVudDohMSxjdXJzb3I6ImF1dG8iLGN1cnNvckF0OiExLGdyaWQ6ITEsaGFuZGxlOiExLGhlbHBlcjoib3JpZ2luYWwiLGlmcmFtZUZpeDohMSxvcGFjaXR5OiExLHJlZnJlc2hQb3NpdGlvbnM6ITEscmV2ZXJ0OiExLHJldmVydER1cmF0aW9uOjUwMCxzY29wZToiZGVmYXVsdCIsc2Nyb2xsOiEwLHNjcm9sbFNlbnNpdGl2aXR5OjIwLHNjcm9sbFNwZWVkOjIwLHNuYXA6ITEsc25hcE1vZGU6ImJvdGgiLHNuYXBUb2xlcmFuY2U6MjAsc3RhY2s6ITEsekluZGV4OiExfSxfY3JlYXRlOmZ1bmN0aW9uKCl7dGhpcy5vcHRpb25zLmhlbHBlcj09Im9yaWdpbmFsIiYmIS9eKD86cnxhfGYpLy50ZXN0KHRoaXMuZWxlbWVudC5jc3MoInBvc2l0aW9uIikpJiYodGhpcy5lbGVtZW50WzBdLnN0eWxlLnBvc2l0aW9uPSJyZWxhdGl2ZSIpLHRoaXMub3B0aW9ucy5hZGRDbGFzc2VzJiZ0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLWRyYWdnYWJsZSIpLHRoaXMub3B0aW9ucy5kaXNhYmxlZCYmdGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1kcmFnZ2FibGUtZGlzYWJsZWQiKSx0aGlzLl9tb3VzZUluaXQoKX0sZGVzdHJveTpmdW5jdGlvbigpe2lmKCF0aGlzLmVsZW1lbnQuZGF0YSgiZHJhZ2dhYmxlIikpcmV0dXJuO3JldHVybiB0aGlzLmVsZW1lbnQucmVtb3ZlRGF0YSgiZHJhZ2dhYmxlIikudW5iaW5kKCIuZHJhZ2dhYmxlIikucmVtb3ZlQ2xhc3MoInVpLWRyYWdnYWJsZSB1aS1kcmFnZ2FibGUtZHJhZ2dpbmcgdWktZHJhZ2dhYmxlLWRpc2FibGVkIiksdGhpcy5fbW91c2VEZXN0cm95KCksdGhpc30sX21vdXNlQ2FwdHVyZTpmdW5jdGlvbihiKXt2YXIgYz10aGlzLm9wdGlvbnM7cmV0dXJuIHRoaXMuaGVscGVyfHxjLmRpc2FibGVkfHxhKGIudGFyZ2V0KS5pcygiLnVpLXJlc2l6YWJsZS1oYW5kbGUiKT8hMToodGhpcy5oYW5kbGU9dGhpcy5fZ2V0SGFuZGxlKGIpLHRoaXMuaGFuZGxlPyhjLmlmcmFtZUZpeCYmYShjLmlmcmFtZUZpeD09PSEwPyJpZnJhbWUiOmMuaWZyYW1lRml4KS5lYWNoKGZ1bmN0aW9uKCl7YSgnPGRpdiBjbGFzcz0idWktZHJhZ2dhYmxlLWlmcmFtZUZpeCIgc3R5bGU9ImJhY2tncm91bmQ6ICNmZmY7Ij48L2Rpdj4nKS5jc3Moe3dpZHRoOnRoaXMub2Zmc2V0V2lkdGgrInB4IixoZWlnaHQ6dGhpcy5vZmZzZXRIZWlnaHQrInB4Iixwb3NpdGlvbjoiYWJzb2x1dGUiLG9wYWNpdHk6IjAuMDAxIix6SW5kZXg6MWUzfSkuY3NzKGEodGhpcykub2Zmc2V0KCkpLmFwcGVuZFRvKCJib2R5Iil9KSwhMCk6ITEpfSxfbW91c2VTdGFydDpmdW5jdGlvbihiKXt2YXIgYz10aGlzLm9wdGlvbnM7cmV0dXJuIHRoaXMuaGVscGVyPXRoaXMuX2NyZWF0ZUhlbHBlcihiKSx0aGlzLl9jYWNoZUhlbHBlclByb3BvcnRpb25zKCksYS51aS5kZG1hbmFnZXImJihhLnVpLmRkbWFuYWdlci5jdXJyZW50PXRoaXMpLHRoaXMuX2NhY2hlTWFyZ2lucygpLHRoaXMuY3NzUG9zaXRpb249dGhpcy5oZWxwZXIuY3NzKCJwb3NpdGlvbiIpLHRoaXMuc2Nyb2xsUGFyZW50PXRoaXMuaGVscGVyLnNjcm9sbFBhcmVudCgpLHRoaXMub2Zmc2V0PXRoaXMucG9zaXRpb25BYnM9dGhpcy5lbGVtZW50Lm9mZnNldCgpLHRoaXMub2Zmc2V0PXt0b3A6dGhpcy5vZmZzZXQudG9wLXRoaXMubWFyZ2lucy50b3AsbGVmdDp0aGlzLm9mZnNldC5sZWZ0LXRoaXMubWFyZ2lucy5sZWZ0fSxhLmV4dGVuZCh0aGlzLm9mZnNldCx7Y2xpY2s6e2xlZnQ6Yi5wYWdlWC10aGlzLm9mZnNldC5sZWZ0LHRvcDpiLnBhZ2VZLXRoaXMub2Zmc2V0LnRvcH0scGFyZW50OnRoaXMuX2dldFBhcmVudE9mZnNldCgpLHJlbGF0aXZlOnRoaXMuX2dldFJlbGF0aXZlT2Zmc2V0KCl9KSx0aGlzLm9yaWdpbmFsUG9zaXRpb249dGhpcy5wb3NpdGlvbj10aGlzLl9nZW5lcmF0ZVBvc2l0aW9uKGIpLHRoaXMub3JpZ2luYWxQYWdlWD1iLnBhZ2VYLHRoaXMub3JpZ2luYWxQYWdlWT1iLnBhZ2VZLGMuY3Vyc29yQXQmJnRoaXMuX2FkanVzdE9mZnNldEZyb21IZWxwZXIoYy5jdXJzb3JBdCksYy5jb250YWlubWVudCYmdGhpcy5fc2V0Q29udGFpbm1lbnQoKSx0aGlzLl90cmlnZ2VyKCJzdGFydCIsYik9PT0hMT8odGhpcy5fY2xlYXIoKSwhMSk6KHRoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKSxhLnVpLmRkbWFuYWdlciYmIWMuZHJvcEJlaGF2aW91ciYmYS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHModGhpcyxiKSx0aGlzLmhlbHBlci5hZGRDbGFzcygidWktZHJhZ2dhYmxlLWRyYWdnaW5nIiksdGhpcy5fbW91c2VEcmFnKGIsITApLGEudWkuZGRtYW5hZ2VyJiZhLnVpLmRkbWFuYWdlci5kcmFnU3RhcnQodGhpcyxiKSwhMCl9LF9tb3VzZURyYWc6ZnVuY3Rpb24oYixjKXt0aGlzLnBvc2l0aW9uPXRoaXMuX2dlbmVyYXRlUG9zaXRpb24oYiksdGhpcy5wb3NpdGlvbkFicz10aGlzLl9jb252ZXJ0UG9zaXRpb25UbygiYWJzb2x1dGUiKTtpZighYyl7dmFyIGQ9dGhpcy5fdWlIYXNoKCk7aWYodGhpcy5fdHJpZ2dlcigiZHJhZyIsYixkKT09PSExKXJldHVybiB0aGlzLl9tb3VzZVVwKHt9KSwhMTt0aGlzLnBvc2l0aW9uPWQucG9zaXRpb259aWYoIXRoaXMub3B0aW9ucy5heGlzfHx0aGlzLm9wdGlvbnMuYXhpcyE9InkiKXRoaXMuaGVscGVyWzBdLnN0eWxlLmxlZnQ9dGhpcy5wb3NpdGlvbi5sZWZ0KyJweCI7aWYoIXRoaXMub3B0aW9ucy5heGlzfHx0aGlzLm9wdGlvbnMuYXhpcyE9IngiKXRoaXMuaGVscGVyWzBdLnN0eWxlLnRvcD10aGlzLnBvc2l0aW9uLnRvcCsicHgiO3JldHVybiBhLnVpLmRkbWFuYWdlciYmYS51aS5kZG1hbmFnZXIuZHJhZyh0aGlzLGIpLCExfSxfbW91c2VTdG9wOmZ1bmN0aW9uKGIpe3ZhciBjPSExO2EudWkuZGRtYW5hZ2VyJiYhdGhpcy5vcHRpb25zLmRyb3BCZWhhdmlvdXImJihjPWEudWkuZGRtYW5hZ2VyLmRyb3AodGhpcyxiKSksdGhpcy5kcm9wcGVkJiYoYz10aGlzLmRyb3BwZWQsdGhpcy5kcm9wcGVkPSExKTt2YXIgZD10aGlzLmVsZW1lbnRbMF0sZT0hMTt3aGlsZShkJiYoZD1kLnBhcmVudE5vZGUpKWQ9PWRvY3VtZW50JiYoZT0hMCk7aWYoIWUmJnRoaXMub3B0aW9ucy5oZWxwZXI9PT0ib3JpZ2luYWwiKXJldHVybiExO2lmKHRoaXMub3B0aW9ucy5yZXZlcnQ9PSJpbnZhbGlkIiYmIWN8fHRoaXMub3B0aW9ucy5yZXZlcnQ9PSJ2YWxpZCImJmN8fHRoaXMub3B0aW9ucy5yZXZlcnQ9PT0hMHx8YS5pc0Z1bmN0aW9uKHRoaXMub3B0aW9ucy5yZXZlcnQpJiZ0aGlzLm9wdGlvbnMucmV2ZXJ0LmNhbGwodGhpcy5lbGVtZW50LGMpKXt2YXIgZj10aGlzO2EodGhpcy5oZWxwZXIpLmFuaW1hdGUodGhpcy5vcmlnaW5hbFBvc2l0aW9uLHBhcnNlSW50KHRoaXMub3B0aW9ucy5yZXZlcnREdXJhdGlvbiwxMCksZnVuY3Rpb24oKXtmLl90cmlnZ2VyKCJzdG9wIixiKSE9PSExJiZmLl9jbGVhcigpfSl9ZWxzZSB0aGlzLl90cmlnZ2VyKCJzdG9wIixiKSE9PSExJiZ0aGlzLl9jbGVhcigpO3JldHVybiExfSxfbW91c2VVcDpmdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5vcHRpb25zLmlmcmFtZUZpeD09PSEwJiZhKCJkaXYudWktZHJhZ2dhYmxlLWlmcmFtZUZpeCIpLmVhY2goZnVuY3Rpb24oKXt0aGlzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcyl9KSxhLnVpLmRkbWFuYWdlciYmYS51aS5kZG1hbmFnZXIuZHJhZ1N0b3AodGhpcyxiKSxhLnVpLm1vdXNlLnByb3RvdHlwZS5fbW91c2VVcC5jYWxsKHRoaXMsYil9LGNhbmNlbDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmhlbHBlci5pcygiLnVpLWRyYWdnYWJsZS1kcmFnZ2luZyIpP3RoaXMuX21vdXNlVXAoe30pOnRoaXMuX2NsZWFyKCksdGhpc30sX2dldEhhbmRsZTpmdW5jdGlvbihiKXt2YXIgYz0hdGhpcy5vcHRpb25zLmhhbmRsZXx8IWEodGhpcy5vcHRpb25zLmhhbmRsZSx0aGlzLmVsZW1lbnQpLmxlbmd0aD8hMDohMTtyZXR1cm4gYSh0aGlzLm9wdGlvbnMuaGFuZGxlLHRoaXMuZWxlbWVudCkuZmluZCgiKiIpLmFuZFNlbGYoKS5lYWNoKGZ1bmN0aW9uKCl7dGhpcz09Yi50YXJnZXQmJihjPSEwKX0pLGN9LF9jcmVhdGVIZWxwZXI6ZnVuY3Rpb24oYil7dmFyIGM9dGhpcy5vcHRpb25zLGQ9YS5pc0Z1bmN0aW9uKGMuaGVscGVyKT9hKGMuaGVscGVyLmFwcGx5KHRoaXMuZWxlbWVudFswXSxbYl0pKTpjLmhlbHBlcj09ImNsb25lIj90aGlzLmVsZW1lbnQuY2xvbmUoKS5yZW1vdmVBdHRyKCJpZCIpOnRoaXMuZWxlbWVudDtyZXR1cm4gZC5wYXJlbnRzKCJib2R5IikubGVuZ3RofHxkLmFwcGVuZFRvKGMuYXBwZW5kVG89PSJwYXJlbnQiP3RoaXMuZWxlbWVudFswXS5wYXJlbnROb2RlOmMuYXBwZW5kVG8pLGRbMF0hPXRoaXMuZWxlbWVudFswXSYmIS8oZml4ZWR8YWJzb2x1dGUpLy50ZXN0KGQuY3NzKCJwb3NpdGlvbiIpKSYmZC5jc3MoInBvc2l0aW9uIiwiYWJzb2x1dGUiKSxkfSxfYWRqdXN0T2Zmc2V0RnJvbUhlbHBlcjpmdW5jdGlvbihiKXt0eXBlb2YgYj09InN0cmluZyImJihiPWIuc3BsaXQoIiAiKSksYS5pc0FycmF5KGIpJiYoYj17bGVmdDorYlswXSx0b3A6K2JbMV18fDB9KSwibGVmdCJpbiBiJiYodGhpcy5vZmZzZXQuY2xpY2subGVmdD1iLmxlZnQrdGhpcy5tYXJnaW5zLmxlZnQpLCJyaWdodCJpbiBiJiYodGhpcy5vZmZzZXQuY2xpY2subGVmdD10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLWIucmlnaHQrdGhpcy5tYXJnaW5zLmxlZnQpLCJ0b3AiaW4gYiYmKHRoaXMub2Zmc2V0LmNsaWNrLnRvcD1iLnRvcCt0aGlzLm1hcmdpbnMudG9wKSwiYm90dG9tImluIGImJih0aGlzLm9mZnNldC5jbGljay50b3A9dGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtYi5ib3R0b20rdGhpcy5tYXJnaW5zLnRvcCl9LF9nZXRQYXJlbnRPZmZzZXQ6ZnVuY3Rpb24oKXt0aGlzLm9mZnNldFBhcmVudD10aGlzLmhlbHBlci5vZmZzZXRQYXJlbnQoKTt2YXIgYj10aGlzLm9mZnNldFBhcmVudC5vZmZzZXQoKTt0aGlzLmNzc1Bvc2l0aW9uPT0iYWJzb2x1dGUiJiZ0aGlzLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmEudWkuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pJiYoYi5sZWZ0Kz10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCksYi50b3ArPXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpKTtpZih0aGlzLm9mZnNldFBhcmVudFswXT09ZG9jdW1lbnQuYm9keXx8dGhpcy5vZmZzZXRQYXJlbnRbMF0udGFnTmFtZSYmdGhpcy5vZmZzZXRQYXJlbnRbMF0udGFnTmFtZS50b0xvd2VyQ2FzZSgpPT0iaHRtbCImJmEuYnJvd3Nlci5tc2llKWI9e3RvcDowLGxlZnQ6MH07cmV0dXJue3RvcDpiLnRvcCsocGFyc2VJbnQodGhpcy5vZmZzZXRQYXJlbnQuY3NzKCJib3JkZXJUb3BXaWR0aCIpLDEwKXx8MCksbGVmdDpiLmxlZnQrKHBhcnNlSW50KHRoaXMub2Zmc2V0UGFyZW50LmNzcygiYm9yZGVyTGVmdFdpZHRoIiksMTApfHwwKX19LF9nZXRSZWxhdGl2ZU9mZnNldDpmdW5jdGlvbigpe2lmKHRoaXMuY3NzUG9zaXRpb249PSJyZWxhdGl2ZSIpe3ZhciBhPXRoaXMuZWxlbWVudC5wb3NpdGlvbigpO3JldHVybnt0b3A6YS50b3AtKHBhcnNlSW50KHRoaXMuaGVscGVyLmNzcygidG9wIiksMTApfHwwKSt0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSxsZWZ0OmEubGVmdC0ocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKCJsZWZ0IiksMTApfHwwKSt0aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCl9fXJldHVybnt0b3A6MCxsZWZ0OjB9fSxfY2FjaGVNYXJnaW5zOmZ1bmN0aW9uKCl7dGhpcy5tYXJnaW5zPXtsZWZ0OnBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoIm1hcmdpbkxlZnQiKSwxMCl8fDAsdG9wOnBhcnNlSW50KHRoaXMuZWxlbWVudC5jc3MoIm1hcmdpblRvcCIpLDEwKXx8MCxyaWdodDpwYXJzZUludCh0aGlzLmVsZW1lbnQuY3NzKCJtYXJnaW5SaWdodCIpLDEwKXx8MCxib3R0b206cGFyc2VJbnQodGhpcy5lbGVtZW50LmNzcygibWFyZ2luQm90dG9tIiksMTApfHwwfX0sX2NhY2hlSGVscGVyUHJvcG9ydGlvbnM6ZnVuY3Rpb24oKXt0aGlzLmhlbHBlclByb3BvcnRpb25zPXt3aWR0aDp0aGlzLmhlbHBlci5vdXRlcldpZHRoKCksaGVpZ2h0OnRoaXMuaGVscGVyLm91dGVySGVpZ2h0KCl9fSxfc2V0Q29udGFpbm1lbnQ6ZnVuY3Rpb24oKXt2YXIgYj10aGlzLm9wdGlvbnM7Yi5jb250YWlubWVudD09InBhcmVudCImJihiLmNvbnRhaW5tZW50PXRoaXMuaGVscGVyWzBdLnBhcmVudE5vZGUpO2lmKGIuY29udGFpbm1lbnQ9PSJkb2N1bWVudCJ8fGIuY29udGFpbm1lbnQ9PSJ3aW5kb3ciKXRoaXMuY29udGFpbm1lbnQ9W2IuY29udGFpbm1lbnQ9PSJkb2N1bWVudCI/MDphKHdpbmRvdykuc2Nyb2xsTGVmdCgpLXRoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQtdGhpcy5vZmZzZXQucGFyZW50LmxlZnQsYi5jb250YWlubWVudD09ImRvY3VtZW50Ij8wOmEod2luZG93KS5zY3JvbGxUb3AoKS10aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AtdGhpcy5vZmZzZXQucGFyZW50LnRvcCwoYi5jb250YWlubWVudD09ImRvY3VtZW50Ij8wOmEod2luZG93KS5zY3JvbGxMZWZ0KCkpK2EoYi5jb250YWlubWVudD09ImRvY3VtZW50Ij9kb2N1bWVudDp3aW5kb3cpLndpZHRoKCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC10aGlzLm1hcmdpbnMubGVmdCwoYi5jb250YWlubWVudD09ImRvY3VtZW50Ij8wOmEod2luZG93KS5zY3JvbGxUb3AoKSkrKGEoYi5jb250YWlubWVudD09ImRvY3VtZW50Ij9kb2N1bWVudDp3aW5kb3cpLmhlaWdodCgpfHxkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUuc2Nyb2xsSGVpZ2h0KS10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC10aGlzLm1hcmdpbnMudG9wXTtpZighL14oZG9jdW1lbnR8d2luZG93fHBhcmVudCkkLy50ZXN0KGIuY29udGFpbm1lbnQpJiZiLmNvbnRhaW5tZW50LmNvbnN0cnVjdG9yIT1BcnJheSl7dmFyIGM9YShiLmNvbnRhaW5tZW50KSxkPWNbMF07aWYoIWQpcmV0dXJuO3ZhciBlPWMub2Zmc2V0KCksZj1hKGQpLmNzcygib3ZlcmZsb3ciKSE9ImhpZGRlbiI7dGhpcy5jb250YWlubWVudD1bKHBhcnNlSW50KGEoZCkuY3NzKCJib3JkZXJMZWZ0V2lkdGgiKSwxMCl8fDApKyhwYXJzZUludChhKGQpLmNzcygicGFkZGluZ0xlZnQiKSwxMCl8fDApLChwYXJzZUludChhKGQpLmNzcygiYm9yZGVyVG9wV2lkdGgiKSwxMCl8fDApKyhwYXJzZUludChhKGQpLmNzcygicGFkZGluZ1RvcCIpLDEwKXx8MCksKGY/TWF0aC5tYXgoZC5zY3JvbGxXaWR0aCxkLm9mZnNldFdpZHRoKTpkLm9mZnNldFdpZHRoKS0ocGFyc2VJbnQoYShkKS5jc3MoImJvcmRlckxlZnRXaWR0aCIpLDEwKXx8MCktKHBhcnNlSW50KGEoZCkuY3NzKCJwYWRkaW5nUmlnaHQiKSwxMCl8fDApLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgtdGhpcy5tYXJnaW5zLmxlZnQtdGhpcy5tYXJnaW5zLnJpZ2h0LChmP01hdGgubWF4KGQuc2Nyb2xsSGVpZ2h0LGQub2Zmc2V0SGVpZ2h0KTpkLm9mZnNldEhlaWdodCktKHBhcnNlSW50KGEoZCkuY3NzKCJib3JkZXJUb3BXaWR0aCIpLDEwKXx8MCktKHBhcnNlSW50KGEoZCkuY3NzKCJwYWRkaW5nQm90dG9tIiksMTApfHwwKS10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC10aGlzLm1hcmdpbnMudG9wLXRoaXMubWFyZ2lucy5ib3R0b21dLHRoaXMucmVsYXRpdmVfY29udGFpbmVyPWN9ZWxzZSBiLmNvbnRhaW5tZW50LmNvbnN0cnVjdG9yPT1BcnJheSYmKHRoaXMuY29udGFpbm1lbnQ9Yi5jb250YWlubWVudCl9LF9jb252ZXJ0UG9zaXRpb25UbzpmdW5jdGlvbihiLGMpe2N8fChjPXRoaXMucG9zaXRpb24pO3ZhciBkPWI9PSJhYnNvbHV0ZSI/MTotMSxlPXRoaXMub3B0aW9ucyxmPXRoaXMuY3NzUG9zaXRpb249PSJhYnNvbHV0ZSImJih0aGlzLnNjcm9sbFBhcmVudFswXT09ZG9jdW1lbnR8fCFhLnVpLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLHRoaXMub2Zmc2V0UGFyZW50WzBdKSk/dGhpcy5vZmZzZXRQYXJlbnQ6dGhpcy5zY3JvbGxQYXJlbnQsZz0vKGh0bWx8Ym9keSkvaS50ZXN0KGZbMF0udGFnTmFtZSk7cmV0dXJue3RvcDpjLnRvcCt0aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AqZCt0aGlzLm9mZnNldC5wYXJlbnQudG9wKmQtKGEuYnJvd3Nlci5zYWZhcmkmJmEuYnJvd3Nlci52ZXJzaW9uPDUyNiYmdGhpcy5jc3NQb3NpdGlvbj09ImZpeGVkIj8wOih0aGlzLmNzc1Bvc2l0aW9uPT0iZml4ZWQiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKTpnPzA6Zi5zY3JvbGxUb3AoKSkqZCksbGVmdDpjLmxlZnQrdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdCpkK3RoaXMub2Zmc2V0LnBhcmVudC5sZWZ0KmQtKGEuYnJvd3Nlci5zYWZhcmkmJmEuYnJvd3Nlci52ZXJzaW9uPDUyNiYmdGhpcy5jc3NQb3NpdGlvbj09ImZpeGVkIj8wOih0aGlzLmNzc1Bvc2l0aW9uPT0iZml4ZWQiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0KCk6Zz8wOmYuc2Nyb2xsTGVmdCgpKSpkKX19LF9nZW5lcmF0ZVBvc2l0aW9uOmZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMub3B0aW9ucyxkPXRoaXMuY3NzUG9zaXRpb249PSJhYnNvbHV0ZSImJih0aGlzLnNjcm9sbFBhcmVudFswXT09ZG9jdW1lbnR8fCFhLnVpLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLHRoaXMub2Zmc2V0UGFyZW50WzBdKSk/dGhpcy5vZmZzZXRQYXJlbnQ6dGhpcy5zY3JvbGxQYXJlbnQsZT0vKGh0bWx8Ym9keSkvaS50ZXN0KGRbMF0udGFnTmFtZSksZj1iLnBhZ2VYLGc9Yi5wYWdlWTtpZih0aGlzLm9yaWdpbmFsUG9zaXRpb24pe3ZhciBoO2lmKHRoaXMuY29udGFpbm1lbnQpe2lmKHRoaXMucmVsYXRpdmVfY29udGFpbmVyKXt2YXIgaT10aGlzLnJlbGF0aXZlX2NvbnRhaW5lci5vZmZzZXQoKTtoPVt0aGlzLmNvbnRhaW5tZW50WzBdK2kubGVmdCx0aGlzLmNvbnRhaW5tZW50WzFdK2kudG9wLHRoaXMuY29udGFpbm1lbnRbMl0raS5sZWZ0LHRoaXMuY29udGFpbm1lbnRbM10raS50b3BdfWVsc2UgaD10aGlzLmNvbnRhaW5tZW50O2IucGFnZVgtdGhpcy5vZmZzZXQuY2xpY2subGVmdDxoWzBdJiYoZj1oWzBdK3RoaXMub2Zmc2V0LmNsaWNrLmxlZnQpLGIucGFnZVktdGhpcy5vZmZzZXQuY2xpY2sudG9wPGhbMV0mJihnPWhbMV0rdGhpcy5vZmZzZXQuY2xpY2sudG9wKSxiLnBhZ2VYLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ+aFsyXSYmKGY9aFsyXSt0aGlzLm9mZnNldC5jbGljay5sZWZ0KSxiLnBhZ2VZLXRoaXMub2Zmc2V0LmNsaWNrLnRvcD5oWzNdJiYoZz1oWzNdK3RoaXMub2Zmc2V0LmNsaWNrLnRvcCl9aWYoYy5ncmlkKXt2YXIgaj1jLmdyaWRbMV0/dGhpcy5vcmlnaW5hbFBhZ2VZK01hdGgucm91bmQoKGctdGhpcy5vcmlnaW5hbFBhZ2VZKS9jLmdyaWRbMV0pKmMuZ3JpZFsxXTp0aGlzLm9yaWdpbmFsUGFnZVk7Zz1oP2otdGhpcy5vZmZzZXQuY2xpY2sudG9wPGhbMV18fGotdGhpcy5vZmZzZXQuY2xpY2sudG9wPmhbM10/ai10aGlzLm9mZnNldC5jbGljay50b3A8aFsxXT9qK2MuZ3JpZFsxXTpqLWMuZ3JpZFsxXTpqOmo7dmFyIGs9Yy5ncmlkWzBdP3RoaXMub3JpZ2luYWxQYWdlWCtNYXRoLnJvdW5kKChmLXRoaXMub3JpZ2luYWxQYWdlWCkvYy5ncmlkWzBdKSpjLmdyaWRbMF06dGhpcy5vcmlnaW5hbFBhZ2VYO2Y9aD9rLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ8aFswXXx8ay10aGlzLm9mZnNldC5jbGljay5sZWZ0PmhbMl0/ay10aGlzLm9mZnNldC5jbGljay5sZWZ0PGhbMF0/aytjLmdyaWRbMF06ay1jLmdyaWRbMF06azprfX1yZXR1cm57dG9wOmctdGhpcy5vZmZzZXQuY2xpY2sudG9wLXRoaXMub2Zmc2V0LnJlbGF0aXZlLnRvcC10aGlzLm9mZnNldC5wYXJlbnQudG9wKyhhLmJyb3dzZXIuc2FmYXJpJiZhLmJyb3dzZXIudmVyc2lvbjw1MjYmJnRoaXMuY3NzUG9zaXRpb249PSJmaXhlZCI/MDp0aGlzLmNzc1Bvc2l0aW9uPT0iZml4ZWQiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKTplPzA6ZC5zY3JvbGxUb3AoKSksbGVmdDpmLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQtdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdCsoYS5icm93c2VyLnNhZmFyaSYmYS5icm93c2VyLnZlcnNpb248NTI2JiZ0aGlzLmNzc1Bvc2l0aW9uPT0iZml4ZWQiPzA6dGhpcy5jc3NQb3NpdGlvbj09ImZpeGVkIj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpOmU/MDpkLnNjcm9sbExlZnQoKSl9fSxfY2xlYXI6ZnVuY3Rpb24oKXt0aGlzLmhlbHBlci5yZW1vdmVDbGFzcygidWktZHJhZ2dhYmxlLWRyYWdnaW5nIiksdGhpcy5oZWxwZXJbMF0hPXRoaXMuZWxlbWVudFswXSYmIXRoaXMuY2FuY2VsSGVscGVyUmVtb3ZhbCYmdGhpcy5oZWxwZXIucmVtb3ZlKCksdGhpcy5oZWxwZXI9bnVsbCx0aGlzLmNhbmNlbEhlbHBlclJlbW92YWw9ITF9LF90cmlnZ2VyOmZ1bmN0aW9uKGIsYyxkKXtyZXR1cm4gZD1kfHx0aGlzLl91aUhhc2goKSxhLnVpLnBsdWdpbi5jYWxsKHRoaXMsYixbYyxkXSksYj09ImRyYWciJiYodGhpcy5wb3NpdGlvbkFicz10aGlzLl9jb252ZXJ0UG9zaXRpb25UbygiYWJzb2x1dGUiKSksYS5XaWRnZXQucHJvdG90eXBlLl90cmlnZ2VyLmNhbGwodGhpcyxiLGMsZCl9LHBsdWdpbnM6e30sX3VpSGFzaDpmdW5jdGlvbihhKXtyZXR1cm57aGVscGVyOnRoaXMuaGVscGVyLHBvc2l0aW9uOnRoaXMucG9zaXRpb24sb3JpZ2luYWxQb3NpdGlvbjp0aGlzLm9yaWdpbmFsUG9zaXRpb24sb2Zmc2V0OnRoaXMucG9zaXRpb25BYnN9fX0pLGEuZXh0ZW5kKGEudWkuZHJhZ2dhYmxlLHt2ZXJzaW9uOiIxLjguMjAifSksYS51aS5wbHVnaW4uYWRkKCJkcmFnZ2FibGUiLCJjb25uZWN0VG9Tb3J0YWJsZSIse3N0YXJ0OmZ1bmN0aW9uKGIsYyl7dmFyIGQ9YSh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKSxlPWQub3B0aW9ucyxmPWEuZXh0ZW5kKHt9LGMse2l0ZW06ZC5lbGVtZW50fSk7ZC5zb3J0YWJsZXM9W10sYShlLmNvbm5lY3RUb1NvcnRhYmxlKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGM9YS5kYXRhKHRoaXMsInNvcnRhYmxlIik7YyYmIWMub3B0aW9ucy5kaXNhYmxlZCYmKGQuc29ydGFibGVzLnB1c2goe2luc3RhbmNlOmMsc2hvdWxkUmV2ZXJ0OmMub3B0aW9ucy5yZXZlcnR9KSxjLnJlZnJlc2hQb3NpdGlvbnMoKSxjLl90cmlnZ2VyKCJhY3RpdmF0ZSIsYixmKSl9KX0sc3RvcDpmdW5jdGlvbihiLGMpe3ZhciBkPWEodGhpcykuZGF0YSgiZHJhZ2dhYmxlIiksZT1hLmV4dGVuZCh7fSxjLHtpdGVtOmQuZWxlbWVudH0pO2EuZWFjaChkLnNvcnRhYmxlcyxmdW5jdGlvbigpe3RoaXMuaW5zdGFuY2UuaXNPdmVyPyh0aGlzLmluc3RhbmNlLmlzT3Zlcj0wLGQuY2FuY2VsSGVscGVyUmVtb3ZhbD0hMCx0aGlzLmluc3RhbmNlLmNhbmNlbEhlbHBlclJlbW92YWw9ITEsdGhpcy5zaG91bGRSZXZlcnQmJih0aGlzLmluc3RhbmNlLm9wdGlvbnMucmV2ZXJ0PSEwKSx0aGlzLmluc3RhbmNlLl9tb3VzZVN0b3AoYiksdGhpcy5pbnN0YW5jZS5vcHRpb25zLmhlbHBlcj10aGlzLmluc3RhbmNlLm9wdGlvbnMuX2hlbHBlcixkLm9wdGlvbnMuaGVscGVyPT0ib3JpZ2luYWwiJiZ0aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtLmNzcyh7dG9wOiJhdXRvIixsZWZ0OiJhdXRvIn0pKToodGhpcy5pbnN0YW5jZS5jYW5jZWxIZWxwZXJSZW1vdmFsPSExLHRoaXMuaW5zdGFuY2UuX3RyaWdnZXIoImRlYWN0aXZhdGUiLGIsZSkpfSl9LGRyYWc6ZnVuY3Rpb24oYixjKXt2YXIgZD1hKHRoaXMpLmRhdGEoImRyYWdnYWJsZSIpLGU9dGhpcyxmPWZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMub2Zmc2V0LmNsaWNrLnRvcCxkPXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQsZT10aGlzLnBvc2l0aW9uQWJzLnRvcCxmPXRoaXMucG9zaXRpb25BYnMubGVmdCxnPWIuaGVpZ2h0LGg9Yi53aWR0aCxpPWIudG9wLGo9Yi5sZWZ0O3JldHVybiBhLnVpLmlzT3ZlcihlK2MsZitkLGksaixnLGgpfTthLmVhY2goZC5zb3J0YWJsZXMsZnVuY3Rpb24oZil7dGhpcy5pbnN0YW5jZS5wb3NpdGlvbkFicz1kLnBvc2l0aW9uQWJzLHRoaXMuaW5zdGFuY2UuaGVscGVyUHJvcG9ydGlvbnM9ZC5oZWxwZXJQcm9wb3J0aW9ucyx0aGlzLmluc3RhbmNlLm9mZnNldC5jbGljaz1kLm9mZnNldC5jbGljayx0aGlzLmluc3RhbmNlLl9pbnRlcnNlY3RzV2l0aCh0aGlzLmluc3RhbmNlLmNvbnRhaW5lckNhY2hlKT8odGhpcy5pbnN0YW5jZS5pc092ZXJ8fCh0aGlzLmluc3RhbmNlLmlzT3Zlcj0xLHRoaXMuaW5zdGFuY2UuY3VycmVudEl0ZW09YShlKS5jbG9uZSgpLnJlbW92ZUF0dHIoImlkIikuYXBwZW5kVG8odGhpcy5pbnN0YW5jZS5lbGVtZW50KS5kYXRhKCJzb3J0YWJsZS1pdGVtIiwhMCksdGhpcy5pbnN0YW5jZS5vcHRpb25zLl9oZWxwZXI9dGhpcy5pbnN0YW5jZS5vcHRpb25zLmhlbHBlcix0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyPWZ1bmN0aW9uKCl7cmV0dXJuIGMuaGVscGVyWzBdfSxiLnRhcmdldD10aGlzLmluc3RhbmNlLmN1cnJlbnRJdGVtWzBdLHRoaXMuaW5zdGFuY2UuX21vdXNlQ2FwdHVyZShiLCEwKSx0aGlzLmluc3RhbmNlLl9tb3VzZVN0YXJ0KGIsITAsITApLHRoaXMuaW5zdGFuY2Uub2Zmc2V0LmNsaWNrLnRvcD1kLm9mZnNldC5jbGljay50b3AsdGhpcy5pbnN0YW5jZS5vZmZzZXQuY2xpY2subGVmdD1kLm9mZnNldC5jbGljay5sZWZ0LHRoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC5sZWZ0LT1kLm9mZnNldC5wYXJlbnQubGVmdC10aGlzLmluc3RhbmNlLm9mZnNldC5wYXJlbnQubGVmdCx0aGlzLmluc3RhbmNlLm9mZnNldC5wYXJlbnQudG9wLT1kLm9mZnNldC5wYXJlbnQudG9wLXRoaXMuaW5zdGFuY2Uub2Zmc2V0LnBhcmVudC50b3AsZC5fdHJpZ2dlcigidG9Tb3J0YWJsZSIsYiksZC5kcm9wcGVkPXRoaXMuaW5zdGFuY2UuZWxlbWVudCxkLmN1cnJlbnRJdGVtPWQuZWxlbWVudCx0aGlzLmluc3RhbmNlLmZyb21PdXRzaWRlPWQpLHRoaXMuaW5zdGFuY2UuY3VycmVudEl0ZW0mJnRoaXMuaW5zdGFuY2UuX21vdXNlRHJhZyhiKSk6dGhpcy5pbnN0YW5jZS5pc092ZXImJih0aGlzLmluc3RhbmNlLmlzT3Zlcj0wLHRoaXMuaW5zdGFuY2UuY2FuY2VsSGVscGVyUmVtb3ZhbD0hMCx0aGlzLmluc3RhbmNlLm9wdGlvbnMucmV2ZXJ0PSExLHRoaXMuaW5zdGFuY2UuX3RyaWdnZXIoIm91dCIsYix0aGlzLmluc3RhbmNlLl91aUhhc2godGhpcy5pbnN0YW5jZSkpLHRoaXMuaW5zdGFuY2UuX21vdXNlU3RvcChiLCEwKSx0aGlzLmluc3RhbmNlLm9wdGlvbnMuaGVscGVyPXRoaXMuaW5zdGFuY2Uub3B0aW9ucy5faGVscGVyLHRoaXMuaW5zdGFuY2UuY3VycmVudEl0ZW0ucmVtb3ZlKCksdGhpcy5pbnN0YW5jZS5wbGFjZWhvbGRlciYmdGhpcy5pbnN0YW5jZS5wbGFjZWhvbGRlci5yZW1vdmUoKSxkLl90cmlnZ2VyKCJmcm9tU29ydGFibGUiLGIpLGQuZHJvcHBlZD0hMSl9KX19KSxhLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsImN1cnNvciIse3N0YXJ0OmZ1bmN0aW9uKGIsYyl7dmFyIGQ9YSgiYm9keSIpLGU9YSh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKS5vcHRpb25zO2QuY3NzKCJjdXJzb3IiKSYmKGUuX2N1cnNvcj1kLmNzcygiY3Vyc29yIikpLGQuY3NzKCJjdXJzb3IiLGUuY3Vyc29yKX0sc3RvcDpmdW5jdGlvbihiLGMpe3ZhciBkPWEodGhpcykuZGF0YSgiZHJhZ2dhYmxlIikub3B0aW9ucztkLl9jdXJzb3ImJmEoImJvZHkiKS5jc3MoImN1cnNvciIsZC5fY3Vyc29yKX19KSxhLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsIm9wYWNpdHkiLHtzdGFydDpmdW5jdGlvbihiLGMpe3ZhciBkPWEoYy5oZWxwZXIpLGU9YSh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKS5vcHRpb25zO2QuY3NzKCJvcGFjaXR5IikmJihlLl9vcGFjaXR5PWQuY3NzKCJvcGFjaXR5IikpLGQuY3NzKCJvcGFjaXR5IixlLm9wYWNpdHkpfSxzdG9wOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9YSh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKS5vcHRpb25zO2QuX29wYWNpdHkmJmEoYy5oZWxwZXIpLmNzcygib3BhY2l0eSIsZC5fb3BhY2l0eSl9fSksYS51aS5wbHVnaW4uYWRkKCJkcmFnZ2FibGUiLCJzY3JvbGwiLHtzdGFydDpmdW5jdGlvbihiLGMpe3ZhciBkPWEodGhpcykuZGF0YSgiZHJhZ2dhYmxlIik7ZC5zY3JvbGxQYXJlbnRbMF0hPWRvY3VtZW50JiZkLnNjcm9sbFBhcmVudFswXS50YWdOYW1lIT0iSFRNTCImJihkLm92ZXJmbG93T2Zmc2V0PWQuc2Nyb2xsUGFyZW50Lm9mZnNldCgpKX0sZHJhZzpmdW5jdGlvbihiLGMpe3ZhciBkPWEodGhpcykuZGF0YSgiZHJhZ2dhYmxlIiksZT1kLm9wdGlvbnMsZj0hMTtpZihkLnNjcm9sbFBhcmVudFswXSE9ZG9jdW1lbnQmJmQuc2Nyb2xsUGFyZW50WzBdLnRhZ05hbWUhPSJIVE1MIil7aWYoIWUuYXhpc3x8ZS5heGlzIT0ieCIpZC5vdmVyZmxvd09mZnNldC50b3ArZC5zY3JvbGxQYXJlbnRbMF0ub2Zmc2V0SGVpZ2h0LWIucGFnZVk8ZS5zY3JvbGxTZW5zaXRpdml0eT9kLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3A9Zj1kLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3ArZS5zY3JvbGxTcGVlZDpiLnBhZ2VZLWQub3ZlcmZsb3dPZmZzZXQudG9wPGUuc2Nyb2xsU2Vuc2l0aXZpdHkmJihkLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3A9Zj1kLnNjcm9sbFBhcmVudFswXS5zY3JvbGxUb3AtZS5zY3JvbGxTcGVlZCk7aWYoIWUuYXhpc3x8ZS5heGlzIT0ieSIpZC5vdmVyZmxvd09mZnNldC5sZWZ0K2Quc2Nyb2xsUGFyZW50WzBdLm9mZnNldFdpZHRoLWIucGFnZVg8ZS5zY3JvbGxTZW5zaXRpdml0eT9kLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0PWY9ZC5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdCtlLnNjcm9sbFNwZWVkOmIucGFnZVgtZC5vdmVyZmxvd09mZnNldC5sZWZ0PGUuc2Nyb2xsU2Vuc2l0aXZpdHkmJihkLnNjcm9sbFBhcmVudFswXS5zY3JvbGxMZWZ0PWY9ZC5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdC1lLnNjcm9sbFNwZWVkKX1lbHNle2lmKCFlLmF4aXN8fGUuYXhpcyE9IngiKWIucGFnZVktYShkb2N1bWVudCkuc2Nyb2xsVG9wKCk8ZS5zY3JvbGxTZW5zaXRpdml0eT9mPWEoZG9jdW1lbnQpLnNjcm9sbFRvcChhKGRvY3VtZW50KS5zY3JvbGxUb3AoKS1lLnNjcm9sbFNwZWVkKTphKHdpbmRvdykuaGVpZ2h0KCktKGIucGFnZVktYShkb2N1bWVudCkuc2Nyb2xsVG9wKCkpPGUuc2Nyb2xsU2Vuc2l0aXZpdHkmJihmPWEoZG9jdW1lbnQpLnNjcm9sbFRvcChhKGRvY3VtZW50KS5zY3JvbGxUb3AoKStlLnNjcm9sbFNwZWVkKSk7aWYoIWUuYXhpc3x8ZS5heGlzIT0ieSIpYi5wYWdlWC1hKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCk8ZS5zY3JvbGxTZW5zaXRpdml0eT9mPWEoZG9jdW1lbnQpLnNjcm9sbExlZnQoYShkb2N1bWVudCkuc2Nyb2xsTGVmdCgpLWUuc2Nyb2xsU3BlZWQpOmEod2luZG93KS53aWR0aCgpLShiLnBhZ2VYLWEoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSk8ZS5zY3JvbGxTZW5zaXRpdml0eSYmKGY9YShkb2N1bWVudCkuc2Nyb2xsTGVmdChhKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkrZS5zY3JvbGxTcGVlZCkpfWYhPT0hMSYmYS51aS5kZG1hbmFnZXImJiFlLmRyb3BCZWhhdmlvdXImJmEudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKGQsYil9fSksYS51aS5wbHVnaW4uYWRkKCJkcmFnZ2FibGUiLCJzbmFwIix7c3RhcnQ6ZnVuY3Rpb24oYixjKXt2YXIgZD1hKHRoaXMpLmRhdGEoImRyYWdnYWJsZSIpLGU9ZC5vcHRpb25zO2Quc25hcEVsZW1lbnRzPVtdLGEoZS5zbmFwLmNvbnN0cnVjdG9yIT1TdHJpbmc/ZS5zbmFwLml0ZW1zfHwiOmRhdGEoZHJhZ2dhYmxlKSI6ZS5zbmFwKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9YSh0aGlzKSxjPWIub2Zmc2V0KCk7dGhpcyE9ZC5lbGVtZW50WzBdJiZkLnNuYXBFbGVtZW50cy5wdXNoKHtpdGVtOnRoaXMsd2lkdGg6Yi5vdXRlcldpZHRoKCksaGVpZ2h0OmIub3V0ZXJIZWlnaHQoKSx0b3A6Yy50b3AsbGVmdDpjLmxlZnR9KX0pfSxkcmFnOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9YSh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKSxlPWQub3B0aW9ucyxmPWUuc25hcFRvbGVyYW5jZSxnPWMub2Zmc2V0LmxlZnQsaD1nK2QuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgsaT1jLm9mZnNldC50b3Asaj1pK2QuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0O2Zvcih2YXIgaz1kLnNuYXBFbGVtZW50cy5sZW5ndGgtMTtrPj0wO2stLSl7dmFyIGw9ZC5zbmFwRWxlbWVudHNba10ubGVmdCxtPWwrZC5zbmFwRWxlbWVudHNba10ud2lkdGgsbj1kLnNuYXBFbGVtZW50c1trXS50b3Asbz1uK2Quc25hcEVsZW1lbnRzW2tdLmhlaWdodDtpZighKGwtZjxnJiZnPG0rZiYmbi1mPGkmJmk8bytmfHxsLWY8ZyYmZzxtK2YmJm4tZjxqJiZqPG8rZnx8bC1mPGgmJmg8bStmJiZuLWY8aSYmaTxvK2Z8fGwtZjxoJiZoPG0rZiYmbi1mPGomJmo8bytmKSl7ZC5zbmFwRWxlbWVudHNba10uc25hcHBpbmcmJmQub3B0aW9ucy5zbmFwLnJlbGVhc2UmJmQub3B0aW9ucy5zbmFwLnJlbGVhc2UuY2FsbChkLmVsZW1lbnQsYixhLmV4dGVuZChkLl91aUhhc2goKSx7c25hcEl0ZW06ZC5zbmFwRWxlbWVudHNba10uaXRlbX0pKSxkLnNuYXBFbGVtZW50c1trXS5zbmFwcGluZz0hMTtjb250aW51ZX1pZihlLnNuYXBNb2RlIT0iaW5uZXIiKXt2YXIgcD1NYXRoLmFicyhuLWopPD1mLHE9TWF0aC5hYnMoby1pKTw9ZixyPU1hdGguYWJzKGwtaCk8PWYscz1NYXRoLmFicyhtLWcpPD1mO3AmJihjLnBvc2l0aW9uLnRvcD1kLl9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLHt0b3A6bi1kLmhlbHBlclByb3BvcnRpb25zLmhlaWdodCxsZWZ0OjB9KS50b3AtZC5tYXJnaW5zLnRvcCkscSYmKGMucG9zaXRpb24udG9wPWQuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIse3RvcDpvLGxlZnQ6MH0pLnRvcC1kLm1hcmdpbnMudG9wKSxyJiYoYy5wb3NpdGlvbi5sZWZ0PWQuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIse3RvcDowLGxlZnQ6bC1kLmhlbHBlclByb3BvcnRpb25zLndpZHRofSkubGVmdC1kLm1hcmdpbnMubGVmdCkscyYmKGMucG9zaXRpb24ubGVmdD1kLl9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLHt0b3A6MCxsZWZ0Om19KS5sZWZ0LWQubWFyZ2lucy5sZWZ0KX12YXIgdD1wfHxxfHxyfHxzO2lmKGUuc25hcE1vZGUhPSJvdXRlciIpe3ZhciBwPU1hdGguYWJzKG4taSk8PWYscT1NYXRoLmFicyhvLWopPD1mLHI9TWF0aC5hYnMobC1nKTw9ZixzPU1hdGguYWJzKG0taCk8PWY7cCYmKGMucG9zaXRpb24udG9wPWQuX2NvbnZlcnRQb3NpdGlvblRvKCJyZWxhdGl2ZSIse3RvcDpuLGxlZnQ6MH0pLnRvcC1kLm1hcmdpbnMudG9wKSxxJiYoYy5wb3NpdGlvbi50b3A9ZC5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIix7dG9wOm8tZC5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsbGVmdDowfSkudG9wLWQubWFyZ2lucy50b3ApLHImJihjLnBvc2l0aW9uLmxlZnQ9ZC5fY29udmVydFBvc2l0aW9uVG8oInJlbGF0aXZlIix7dG9wOjAsbGVmdDpsfSkubGVmdC1kLm1hcmdpbnMubGVmdCkscyYmKGMucG9zaXRpb24ubGVmdD1kLl9jb252ZXJ0UG9zaXRpb25UbygicmVsYXRpdmUiLHt0b3A6MCxsZWZ0Om0tZC5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aH0pLmxlZnQtZC5tYXJnaW5zLmxlZnQpfSFkLnNuYXBFbGVtZW50c1trXS5zbmFwcGluZyYmKHB8fHF8fHJ8fHN8fHQpJiZkLm9wdGlvbnMuc25hcC5zbmFwJiZkLm9wdGlvbnMuc25hcC5zbmFwLmNhbGwoZC5lbGVtZW50LGIsYS5leHRlbmQoZC5fdWlIYXNoKCkse3NuYXBJdGVtOmQuc25hcEVsZW1lbnRzW2tdLml0ZW19KSksZC5zbmFwRWxlbWVudHNba10uc25hcHBpbmc9cHx8cXx8cnx8c3x8dH19fSksYS51aS5wbHVnaW4uYWRkKCJkcmFnZ2FibGUiLCJzdGFjayIse3N0YXJ0OmZ1bmN0aW9uKGIsYyl7dmFyIGQ9YSh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKS5vcHRpb25zLGU9YS5tYWtlQXJyYXkoYShkLnN0YWNrKSkuc29ydChmdW5jdGlvbihiLGMpe3JldHVybihwYXJzZUludChhKGIpLmNzcygiekluZGV4IiksMTApfHwwKS0ocGFyc2VJbnQoYShjKS5jc3MoInpJbmRleCIpLDEwKXx8MCl9KTtpZighZS5sZW5ndGgpcmV0dXJuO3ZhciBmPXBhcnNlSW50KGVbMF0uc3R5bGUuekluZGV4KXx8MDthKGUpLmVhY2goZnVuY3Rpb24oYSl7dGhpcy5zdHlsZS56SW5kZXg9ZithfSksdGhpc1swXS5zdHlsZS56SW5kZXg9ZitlLmxlbmd0aH19KSxhLnVpLnBsdWdpbi5hZGQoImRyYWdnYWJsZSIsInpJbmRleCIse3N0YXJ0OmZ1bmN0aW9uKGIsYyl7dmFyIGQ9YShjLmhlbHBlciksZT1hKHRoaXMpLmRhdGEoImRyYWdnYWJsZSIpLm9wdGlvbnM7ZC5jc3MoInpJbmRleCIpJiYoZS5fekluZGV4PWQuY3NzKCJ6SW5kZXgiKSksZC5jc3MoInpJbmRleCIsZS56SW5kZXgpfSxzdG9wOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9YSh0aGlzKS5kYXRhKCJkcmFnZ2FibGUiKS5vcHRpb25zO2QuX3pJbmRleCYmYShjLmhlbHBlcikuY3NzKCJ6SW5kZXgiLGQuX3pJbmRleCl9fSl9KShqUXVlcnkpOzsvKiEgalF1ZXJ5IFVJIC0gdjEuOC4yMCAtIDIwMTItMDQtMzAKKiBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS11aQoqIEluY2x1ZGVzOiBqcXVlcnkudWkuZHJvcHBhYmxlLmpzCiogQ29weXJpZ2h0IChjKSAyMDEyIEFVVEhPUlMudHh0OyBMaWNlbnNlZCBNSVQsIEdQTCAqLwooZnVuY3Rpb24oYSxiKXthLndpZGdldCgidWkuZHJvcHBhYmxlIix7d2lkZ2V0RXZlbnRQcmVmaXg6ImRyb3AiLG9wdGlvbnM6e2FjY2VwdDoiKiIsYWN0aXZlQ2xhc3M6ITEsYWRkQ2xhc3NlczohMCxncmVlZHk6ITEsaG92ZXJDbGFzczohMSxzY29wZToiZGVmYXVsdCIsdG9sZXJhbmNlOiJpbnRlcnNlY3QifSxfY3JlYXRlOmZ1bmN0aW9uKCl7dmFyIGI9dGhpcy5vcHRpb25zLGM9Yi5hY2NlcHQ7dGhpcy5pc292ZXI9MCx0aGlzLmlzb3V0PTEsdGhpcy5hY2NlcHQ9YS5pc0Z1bmN0aW9uKGMpP2M6ZnVuY3Rpb24oYSl7cmV0dXJuIGEuaXMoYyl9LHRoaXMucHJvcG9ydGlvbnM9e3dpZHRoOnRoaXMuZWxlbWVudFswXS5vZmZzZXRXaWR0aCxoZWlnaHQ6dGhpcy5lbGVtZW50WzBdLm9mZnNldEhlaWdodH0sYS51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1tiLnNjb3BlXT1hLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW2Iuc2NvcGVdfHxbXSxhLnVpLmRkbWFuYWdlci5kcm9wcGFibGVzW2Iuc2NvcGVdLnB1c2godGhpcyksYi5hZGRDbGFzc2VzJiZ0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLWRyb3BwYWJsZSIpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dmFyIGI9YS51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1t0aGlzLm9wdGlvbnMuc2NvcGVdO2Zvcih2YXIgYz0wO2M8Yi5sZW5ndGg7YysrKWJbY109PXRoaXMmJmIuc3BsaWNlKGMsMSk7cmV0dXJuIHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygidWktZHJvcHBhYmxlIHVpLWRyb3BwYWJsZS1kaXNhYmxlZCIpLnJlbW92ZURhdGEoImRyb3BwYWJsZSIpLnVuYmluZCgiLmRyb3BwYWJsZSIpLHRoaXN9LF9zZXRPcHRpb246ZnVuY3Rpb24oYixjKXtiPT0iYWNjZXB0IiYmKHRoaXMuYWNjZXB0PWEuaXNGdW5jdGlvbihjKT9jOmZ1bmN0aW9uKGEpe3JldHVybiBhLmlzKGMpfSksYS5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpfSxfYWN0aXZhdGU6ZnVuY3Rpb24oYil7dmFyIGM9YS51aS5kZG1hbmFnZXIuY3VycmVudDt0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MmJnRoaXMuZWxlbWVudC5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuYWN0aXZlQ2xhc3MpLGMmJnRoaXMuX3RyaWdnZXIoImFjdGl2YXRlIixiLHRoaXMudWkoYykpfSxfZGVhY3RpdmF0ZTpmdW5jdGlvbihiKXt2YXIgYz1hLnVpLmRkbWFuYWdlci5jdXJyZW50O3RoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyYmdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyksYyYmdGhpcy5fdHJpZ2dlcigiZGVhY3RpdmF0ZSIsYix0aGlzLnVpKGMpKX0sX292ZXI6ZnVuY3Rpb24oYil7dmFyIGM9YS51aS5kZG1hbmFnZXIuY3VycmVudDtpZighY3x8KGMuY3VycmVudEl0ZW18fGMuZWxlbWVudClbMF09PXRoaXMuZWxlbWVudFswXSlyZXR1cm47dGhpcy5hY2NlcHQuY2FsbCh0aGlzLmVsZW1lbnRbMF0sYy5jdXJyZW50SXRlbXx8Yy5lbGVtZW50KSYmKHRoaXMub3B0aW9ucy5ob3ZlckNsYXNzJiZ0aGlzLmVsZW1lbnQuYWRkQ2xhc3ModGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MpLHRoaXMuX3RyaWdnZXIoIm92ZXIiLGIsdGhpcy51aShjKSkpfSxfb3V0OmZ1bmN0aW9uKGIpe3ZhciBjPWEudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7aWYoIWN8fChjLmN1cnJlbnRJdGVtfHxjLmVsZW1lbnQpWzBdPT10aGlzLmVsZW1lbnRbMF0pcmV0dXJuO3RoaXMuYWNjZXB0LmNhbGwodGhpcy5lbGVtZW50WzBdLGMuY3VycmVudEl0ZW18fGMuZWxlbWVudCkmJih0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyYmdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5ob3ZlckNsYXNzKSx0aGlzLl90cmlnZ2VyKCJvdXQiLGIsdGhpcy51aShjKSkpfSxfZHJvcDpmdW5jdGlvbihiLGMpe3ZhciBkPWN8fGEudWkuZGRtYW5hZ2VyLmN1cnJlbnQ7aWYoIWR8fChkLmN1cnJlbnRJdGVtfHxkLmVsZW1lbnQpWzBdPT10aGlzLmVsZW1lbnRbMF0pcmV0dXJuITE7dmFyIGU9ITE7cmV0dXJuIHRoaXMuZWxlbWVudC5maW5kKCI6ZGF0YShkcm9wcGFibGUpIikubm90KCIudWktZHJhZ2dhYmxlLWRyYWdnaW5nIikuZWFjaChmdW5jdGlvbigpe3ZhciBiPWEuZGF0YSh0aGlzLCJkcm9wcGFibGUiKTtpZihiLm9wdGlvbnMuZ3JlZWR5JiYhYi5vcHRpb25zLmRpc2FibGVkJiZiLm9wdGlvbnMuc2NvcGU9PWQub3B0aW9ucy5zY29wZSYmYi5hY2NlcHQuY2FsbChiLmVsZW1lbnRbMF0sZC5jdXJyZW50SXRlbXx8ZC5lbGVtZW50KSYmYS51aS5pbnRlcnNlY3QoZCxhLmV4dGVuZChiLHtvZmZzZXQ6Yi5lbGVtZW50Lm9mZnNldCgpfSksYi5vcHRpb25zLnRvbGVyYW5jZSkpcmV0dXJuIGU9ITAsITF9KSxlPyExOnRoaXMuYWNjZXB0LmNhbGwodGhpcy5lbGVtZW50WzBdLGQuY3VycmVudEl0ZW18fGQuZWxlbWVudCk/KHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyYmdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5hY3RpdmVDbGFzcyksdGhpcy5vcHRpb25zLmhvdmVyQ2xhc3MmJnRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcyh0aGlzLm9wdGlvbnMuaG92ZXJDbGFzcyksdGhpcy5fdHJpZ2dlcigiZHJvcCIsYix0aGlzLnVpKGQpKSx0aGlzLmVsZW1lbnQpOiExfSx1aTpmdW5jdGlvbihhKXtyZXR1cm57ZHJhZ2dhYmxlOmEuY3VycmVudEl0ZW18fGEuZWxlbWVudCxoZWxwZXI6YS5oZWxwZXIscG9zaXRpb246YS5wb3NpdGlvbixvZmZzZXQ6YS5wb3NpdGlvbkFic319fSksYS5leHRlbmQoYS51aS5kcm9wcGFibGUse3ZlcnNpb246IjEuOC4yMCJ9KSxhLnVpLmludGVyc2VjdD1mdW5jdGlvbihiLGMsZCl7aWYoIWMub2Zmc2V0KXJldHVybiExO3ZhciBlPShiLnBvc2l0aW9uQWJzfHxiLnBvc2l0aW9uLmFic29sdXRlKS5sZWZ0LGY9ZStiLmhlbHBlclByb3BvcnRpb25zLndpZHRoLGc9KGIucG9zaXRpb25BYnN8fGIucG9zaXRpb24uYWJzb2x1dGUpLnRvcCxoPWcrYi5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsaT1jLm9mZnNldC5sZWZ0LGo9aStjLnByb3BvcnRpb25zLndpZHRoLGs9Yy5vZmZzZXQudG9wLGw9aytjLnByb3BvcnRpb25zLmhlaWdodDtzd2l0Y2goZCl7Y2FzZSJmaXQiOnJldHVybiBpPD1lJiZmPD1qJiZrPD1nJiZoPD1sO2Nhc2UiaW50ZXJzZWN0IjpyZXR1cm4gaTxlK2IuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgvMiYmZi1iLmhlbHBlclByb3BvcnRpb25zLndpZHRoLzI8aiYmazxnK2IuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LzImJmgtYi5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQvMjxsO2Nhc2UicG9pbnRlciI6dmFyIG09KGIucG9zaXRpb25BYnN8fGIucG9zaXRpb24uYWJzb2x1dGUpLmxlZnQrKGIuY2xpY2tPZmZzZXR8fGIub2Zmc2V0LmNsaWNrKS5sZWZ0LG49KGIucG9zaXRpb25BYnN8fGIucG9zaXRpb24uYWJzb2x1dGUpLnRvcCsoYi5jbGlja09mZnNldHx8Yi5vZmZzZXQuY2xpY2spLnRvcCxvPWEudWkuaXNPdmVyKG4sbSxrLGksYy5wcm9wb3J0aW9ucy5oZWlnaHQsYy5wcm9wb3J0aW9ucy53aWR0aCk7cmV0dXJuIG87Y2FzZSJ0b3VjaCI6cmV0dXJuKGc+PWsmJmc8PWx8fGg+PWsmJmg8PWx8fGc8ayYmaD5sKSYmKGU+PWkmJmU8PWp8fGY+PWkmJmY8PWp8fGU8aSYmZj5qKTtkZWZhdWx0OnJldHVybiExfX0sYS51aS5kZG1hbmFnZXI9e2N1cnJlbnQ6bnVsbCxkcm9wcGFibGVzOnsiZGVmYXVsdCI6W119LHByZXBhcmVPZmZzZXRzOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9YS51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1tiLm9wdGlvbnMuc2NvcGVdfHxbXSxlPWM/Yy50eXBlOm51bGwsZj0oYi5jdXJyZW50SXRlbXx8Yi5lbGVtZW50KS5maW5kKCI6ZGF0YShkcm9wcGFibGUpIikuYW5kU2VsZigpO2c6Zm9yKHZhciBoPTA7aDxkLmxlbmd0aDtoKyspe2lmKGRbaF0ub3B0aW9ucy5kaXNhYmxlZHx8YiYmIWRbaF0uYWNjZXB0LmNhbGwoZFtoXS5lbGVtZW50WzBdLGIuY3VycmVudEl0ZW18fGIuZWxlbWVudCkpY29udGludWU7Zm9yKHZhciBpPTA7aTxmLmxlbmd0aDtpKyspaWYoZltpXT09ZFtoXS5lbGVtZW50WzBdKXtkW2hdLnByb3BvcnRpb25zLmhlaWdodD0wO2NvbnRpbnVlIGd9ZFtoXS52aXNpYmxlPWRbaF0uZWxlbWVudC5jc3MoImRpc3BsYXkiKSE9Im5vbmUiO2lmKCFkW2hdLnZpc2libGUpY29udGludWU7ZT09Im1vdXNlZG93biImJmRbaF0uX2FjdGl2YXRlLmNhbGwoZFtoXSxjKSxkW2hdLm9mZnNldD1kW2hdLmVsZW1lbnQub2Zmc2V0KCksZFtoXS5wcm9wb3J0aW9ucz17d2lkdGg6ZFtoXS5lbGVtZW50WzBdLm9mZnNldFdpZHRoLGhlaWdodDpkW2hdLmVsZW1lbnRbMF0ub2Zmc2V0SGVpZ2h0fX19LGRyb3A6ZnVuY3Rpb24oYixjKXt2YXIgZD0hMTtyZXR1cm4gYS5lYWNoKGEudWkuZGRtYW5hZ2VyLmRyb3BwYWJsZXNbYi5vcHRpb25zLnNjb3BlXXx8W10sZnVuY3Rpb24oKXtpZighdGhpcy5vcHRpb25zKXJldHVybjshdGhpcy5vcHRpb25zLmRpc2FibGVkJiZ0aGlzLnZpc2libGUmJmEudWkuaW50ZXJzZWN0KGIsdGhpcyx0aGlzLm9wdGlvbnMudG9sZXJhbmNlKSYmKGQ9dGhpcy5fZHJvcC5jYWxsKHRoaXMsYyl8fGQpLCF0aGlzLm9wdGlvbnMuZGlzYWJsZWQmJnRoaXMudmlzaWJsZSYmdGhpcy5hY2NlcHQuY2FsbCh0aGlzLmVsZW1lbnRbMF0sYi5jdXJyZW50SXRlbXx8Yi5lbGVtZW50KSYmKHRoaXMuaXNvdXQ9MSx0aGlzLmlzb3Zlcj0wLHRoaXMuX2RlYWN0aXZhdGUuY2FsbCh0aGlzLGMpKX0pLGR9LGRyYWdTdGFydDpmdW5jdGlvbihiLGMpe2IuZWxlbWVudC5wYXJlbnRzKCI6bm90KGJvZHksaHRtbCkiKS5iaW5kKCJzY3JvbGwuZHJvcHBhYmxlIixmdW5jdGlvbigpe2Iub3B0aW9ucy5yZWZyZXNoUG9zaXRpb25zfHxhLnVpLmRkbWFuYWdlci5wcmVwYXJlT2Zmc2V0cyhiLGMpfSl9LGRyYWc6ZnVuY3Rpb24oYixjKXtiLm9wdGlvbnMucmVmcmVzaFBvc2l0aW9ucyYmYS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHMoYixjKSxhLmVhY2goYS51aS5kZG1hbmFnZXIuZHJvcHBhYmxlc1tiLm9wdGlvbnMuc2NvcGVdfHxbXSxmdW5jdGlvbigpe2lmKHRoaXMub3B0aW9ucy5kaXNhYmxlZHx8dGhpcy5ncmVlZHlDaGlsZHx8IXRoaXMudmlzaWJsZSlyZXR1cm47dmFyIGQ9YS51aS5pbnRlcnNlY3QoYix0aGlzLHRoaXMub3B0aW9ucy50b2xlcmFuY2UpLGU9IWQmJnRoaXMuaXNvdmVyPT0xPyJpc291dCI6ZCYmdGhpcy5pc292ZXI9PTA/Imlzb3ZlciI6bnVsbDtpZighZSlyZXR1cm47dmFyIGY7aWYodGhpcy5vcHRpb25zLmdyZWVkeSl7dmFyIGc9dGhpcy5lbGVtZW50LnBhcmVudHMoIjpkYXRhKGRyb3BwYWJsZSk6ZXEoMCkiKTtnLmxlbmd0aCYmKGY9YS5kYXRhKGdbMF0sImRyb3BwYWJsZSIpLGYuZ3JlZWR5Q2hpbGQ9ZT09Imlzb3ZlciI/MTowKX1mJiZlPT0iaXNvdmVyIiYmKGYuaXNvdmVyPTAsZi5pc291dD0xLGYuX291dC5jYWxsKGYsYykpLHRoaXNbZV09MSx0aGlzW2U9PSJpc291dCI/Imlzb3ZlciI6Imlzb3V0Il09MCx0aGlzW2U9PSJpc292ZXIiPyJfb3ZlciI6Il9vdXQiXS5jYWxsKHRoaXMsYyksZiYmZT09Imlzb3V0IiYmKGYuaXNvdXQ9MCxmLmlzb3Zlcj0xLGYuX292ZXIuY2FsbChmLGMpKX0pfSxkcmFnU3RvcDpmdW5jdGlvbihiLGMpe2IuZWxlbWVudC5wYXJlbnRzKCI6bm90KGJvZHksaHRtbCkiKS51bmJpbmQoInNjcm9sbC5kcm9wcGFibGUiKSxiLm9wdGlvbnMucmVmcmVzaFBvc2l0aW9uc3x8YS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHMoYixjKX19fSkoalF1ZXJ5KTs7LyohIGpRdWVyeSBVSSAtIHYxLjguMjAgLSAyMDEyLTA0LTMwCiogaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkKKiBJbmNsdWRlczoganF1ZXJ5LnVpLnJlc2l6YWJsZS5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKGEsYil7YS53aWRnZXQoInVpLnJlc2l6YWJsZSIsYS51aS5tb3VzZSx7d2lkZ2V0RXZlbnRQcmVmaXg6InJlc2l6ZSIsb3B0aW9uczp7YWxzb1Jlc2l6ZTohMSxhbmltYXRlOiExLGFuaW1hdGVEdXJhdGlvbjoic2xvdyIsYW5pbWF0ZUVhc2luZzoic3dpbmciLGFzcGVjdFJhdGlvOiExLGF1dG9IaWRlOiExLGNvbnRhaW5tZW50OiExLGdob3N0OiExLGdyaWQ6ITEsaGFuZGxlczoiZSxzLHNlIixoZWxwZXI6ITEsbWF4SGVpZ2h0Om51bGwsbWF4V2lkdGg6bnVsbCxtaW5IZWlnaHQ6MTAsbWluV2lkdGg6MTAsekluZGV4OjFlM30sX2NyZWF0ZTpmdW5jdGlvbigpe3ZhciBiPXRoaXMsYz10aGlzLm9wdGlvbnM7dGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1yZXNpemFibGUiKSxhLmV4dGVuZCh0aGlzLHtfYXNwZWN0UmF0aW86ISFjLmFzcGVjdFJhdGlvLGFzcGVjdFJhdGlvOmMuYXNwZWN0UmF0aW8sb3JpZ2luYWxFbGVtZW50OnRoaXMuZWxlbWVudCxfcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50czpbXSxfaGVscGVyOmMuaGVscGVyfHxjLmdob3N0fHxjLmFuaW1hdGU/Yy5oZWxwZXJ8fCJ1aS1yZXNpemFibGUtaGVscGVyIjpudWxsfSksdGhpcy5lbGVtZW50WzBdLm5vZGVOYW1lLm1hdGNoKC9jYW52YXN8dGV4dGFyZWF8aW5wdXR8c2VsZWN0fGJ1dHRvbnxpbWcvaSkmJih0aGlzLmVsZW1lbnQud3JhcChhKCc8ZGl2IGNsYXNzPSJ1aS13cmFwcGVyIiBzdHlsZT0ib3ZlcmZsb3c6IGhpZGRlbjsiPjwvZGl2PicpLmNzcyh7cG9zaXRpb246dGhpcy5lbGVtZW50LmNzcygicG9zaXRpb24iKSx3aWR0aDp0aGlzLmVsZW1lbnQub3V0ZXJXaWR0aCgpLGhlaWdodDp0aGlzLmVsZW1lbnQub3V0ZXJIZWlnaHQoKSx0b3A6dGhpcy5lbGVtZW50LmNzcygidG9wIiksbGVmdDp0aGlzLmVsZW1lbnQuY3NzKCJsZWZ0Iil9KSksdGhpcy5lbGVtZW50PXRoaXMuZWxlbWVudC5wYXJlbnQoKS5kYXRhKCJyZXNpemFibGUiLHRoaXMuZWxlbWVudC5kYXRhKCJyZXNpemFibGUiKSksdGhpcy5lbGVtZW50SXNXcmFwcGVyPSEwLHRoaXMuZWxlbWVudC5jc3Moe21hcmdpbkxlZnQ6dGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKCJtYXJnaW5MZWZ0IiksbWFyZ2luVG9wOnRoaXMub3JpZ2luYWxFbGVtZW50LmNzcygibWFyZ2luVG9wIiksbWFyZ2luUmlnaHQ6dGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKCJtYXJnaW5SaWdodCIpLG1hcmdpbkJvdHRvbTp0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoIm1hcmdpbkJvdHRvbSIpfSksdGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKHttYXJnaW5MZWZ0OjAsbWFyZ2luVG9wOjAsbWFyZ2luUmlnaHQ6MCxtYXJnaW5Cb3R0b206MH0pLHRoaXMub3JpZ2luYWxSZXNpemVTdHlsZT10aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoInJlc2l6ZSIpLHRoaXMub3JpZ2luYWxFbGVtZW50LmNzcygicmVzaXplIiwibm9uZSIpLHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMucHVzaCh0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3Moe3Bvc2l0aW9uOiJzdGF0aWMiLHpvb206MSxkaXNwbGF5OiJibG9jayJ9KSksdGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKHttYXJnaW46dGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKCJtYXJnaW4iKX0pLHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplKCkpLHRoaXMuaGFuZGxlcz1jLmhhbmRsZXN8fChhKCIudWktcmVzaXphYmxlLWhhbmRsZSIsdGhpcy5lbGVtZW50KS5sZW5ndGg/e246Ii51aS1yZXNpemFibGUtbiIsZToiLnVpLXJlc2l6YWJsZS1lIixzOiIudWktcmVzaXphYmxlLXMiLHc6Ii51aS1yZXNpemFibGUtdyIsc2U6Ii51aS1yZXNpemFibGUtc2UiLHN3OiIudWktcmVzaXphYmxlLXN3IixuZToiLnVpLXJlc2l6YWJsZS1uZSIsbnc6Ii51aS1yZXNpemFibGUtbncifToiZSxzLHNlIik7aWYodGhpcy5oYW5kbGVzLmNvbnN0cnVjdG9yPT1TdHJpbmcpe3RoaXMuaGFuZGxlcz09ImFsbCImJih0aGlzLmhhbmRsZXM9Im4sZSxzLHcsc2Usc3csbmUsbnciKTt2YXIgZD10aGlzLmhhbmRsZXMuc3BsaXQoIiwiKTt0aGlzLmhhbmRsZXM9e307Zm9yKHZhciBlPTA7ZTxkLmxlbmd0aDtlKyspe3ZhciBmPWEudHJpbShkW2VdKSxnPSJ1aS1yZXNpemFibGUtIitmLGg9YSgnPGRpdiBjbGFzcz0idWktcmVzaXphYmxlLWhhbmRsZSAnK2crJyI+PC9kaXY+Jyk7aC5jc3Moe3pJbmRleDpjLnpJbmRleH0pLCJzZSI9PWYmJmguYWRkQ2xhc3MoInVpLWljb24gdWktaWNvbi1ncmlwc21hbGwtZGlhZ29uYWwtc2UiKSx0aGlzLmhhbmRsZXNbZl09Ii51aS1yZXNpemFibGUtIitmLHRoaXMuZWxlbWVudC5hcHBlbmQoaCl9fXRoaXMuX3JlbmRlckF4aXM9ZnVuY3Rpb24oYil7Yj1ifHx0aGlzLmVsZW1lbnQ7Zm9yKHZhciBjIGluIHRoaXMuaGFuZGxlcyl7dGhpcy5oYW5kbGVzW2NdLmNvbnN0cnVjdG9yPT1TdHJpbmcmJih0aGlzLmhhbmRsZXNbY109YSh0aGlzLmhhbmRsZXNbY10sdGhpcy5lbGVtZW50KS5zaG93KCkpO2lmKHRoaXMuZWxlbWVudElzV3JhcHBlciYmdGhpcy5vcmlnaW5hbEVsZW1lbnRbMF0ubm9kZU5hbWUubWF0Y2goL3RleHRhcmVhfGlucHV0fHNlbGVjdHxidXR0b24vaSkpe3ZhciBkPWEodGhpcy5oYW5kbGVzW2NdLHRoaXMuZWxlbWVudCksZT0wO2U9L3N3fG5lfG53fHNlfG58cy8udGVzdChjKT9kLm91dGVySGVpZ2h0KCk6ZC5vdXRlcldpZHRoKCk7dmFyIGY9WyJwYWRkaW5nIiwvbmV8bnd8bi8udGVzdChjKT8iVG9wIjovc2V8c3d8cy8udGVzdChjKT8iQm90dG9tIjovXmUkLy50ZXN0KGMpPyJSaWdodCI6IkxlZnQiXS5qb2luKCIiKTtiLmNzcyhmLGUpLHRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplKCl9aWYoIWEodGhpcy5oYW5kbGVzW2NdKS5sZW5ndGgpY29udGludWV9fSx0aGlzLl9yZW5kZXJBeGlzKHRoaXMuZWxlbWVudCksdGhpcy5faGFuZGxlcz1hKCIudWktcmVzaXphYmxlLWhhbmRsZSIsdGhpcy5lbGVtZW50KS5kaXNhYmxlU2VsZWN0aW9uKCksdGhpcy5faGFuZGxlcy5tb3VzZW92ZXIoZnVuY3Rpb24oKXtpZighYi5yZXNpemluZyl7aWYodGhpcy5jbGFzc05hbWUpdmFyIGE9dGhpcy5jbGFzc05hbWUubWF0Y2goL3VpLXJlc2l6YWJsZS0oc2V8c3d8bmV8bnd8bnxlfHN8dykvaSk7Yi5heGlzPWEmJmFbMV0/YVsxXToic2UifX0pLGMuYXV0b0hpZGUmJih0aGlzLl9oYW5kbGVzLmhpZGUoKSxhKHRoaXMuZWxlbWVudCkuYWRkQ2xhc3MoInVpLXJlc2l6YWJsZS1hdXRvaGlkZSIpLmhvdmVyKGZ1bmN0aW9uKCl7aWYoYy5kaXNhYmxlZClyZXR1cm47YSh0aGlzKS5yZW1vdmVDbGFzcygidWktcmVzaXphYmxlLWF1dG9oaWRlIiksYi5faGFuZGxlcy5zaG93KCl9LGZ1bmN0aW9uKCl7aWYoYy5kaXNhYmxlZClyZXR1cm47Yi5yZXNpemluZ3x8KGEodGhpcykuYWRkQ2xhc3MoInVpLXJlc2l6YWJsZS1hdXRvaGlkZSIpLGIuX2hhbmRsZXMuaGlkZSgpKX0pKSx0aGlzLl9tb3VzZUluaXQoKX0sZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuX21vdXNlRGVzdHJveSgpO3ZhciBiPWZ1bmN0aW9uKGIpe2EoYikucmVtb3ZlQ2xhc3MoInVpLXJlc2l6YWJsZSB1aS1yZXNpemFibGUtZGlzYWJsZWQgdWktcmVzaXphYmxlLXJlc2l6aW5nIikucmVtb3ZlRGF0YSgicmVzaXphYmxlIikudW5iaW5kKCIucmVzaXphYmxlIikuZmluZCgiLnVpLXJlc2l6YWJsZS1oYW5kbGUiKS5yZW1vdmUoKX07aWYodGhpcy5lbGVtZW50SXNXcmFwcGVyKXtiKHRoaXMuZWxlbWVudCk7dmFyIGM9dGhpcy5lbGVtZW50O2MuYWZ0ZXIodGhpcy5vcmlnaW5hbEVsZW1lbnQuY3NzKHtwb3NpdGlvbjpjLmNzcygicG9zaXRpb24iKSx3aWR0aDpjLm91dGVyV2lkdGgoKSxoZWlnaHQ6Yy5vdXRlckhlaWdodCgpLHRvcDpjLmNzcygidG9wIiksbGVmdDpjLmNzcygibGVmdCIpfSkpLnJlbW92ZSgpfXJldHVybiB0aGlzLm9yaWdpbmFsRWxlbWVudC5jc3MoInJlc2l6ZSIsdGhpcy5vcmlnaW5hbFJlc2l6ZVN0eWxlKSxiKHRoaXMub3JpZ2luYWxFbGVtZW50KSx0aGlzfSxfbW91c2VDYXB0dXJlOmZ1bmN0aW9uKGIpe3ZhciBjPSExO2Zvcih2YXIgZCBpbiB0aGlzLmhhbmRsZXMpYSh0aGlzLmhhbmRsZXNbZF0pWzBdPT1iLnRhcmdldCYmKGM9ITApO3JldHVybiF0aGlzLm9wdGlvbnMuZGlzYWJsZWQmJmN9LF9tb3VzZVN0YXJ0OmZ1bmN0aW9uKGIpe3ZhciBkPXRoaXMub3B0aW9ucyxlPXRoaXMuZWxlbWVudC5wb3NpdGlvbigpLGY9dGhpcy5lbGVtZW50O3RoaXMucmVzaXppbmc9ITAsdGhpcy5kb2N1bWVudFNjcm9sbD17dG9wOmEoZG9jdW1lbnQpLnNjcm9sbFRvcCgpLGxlZnQ6YShkb2N1bWVudCkuc2Nyb2xsTGVmdCgpfSwoZi5pcygiLnVpLWRyYWdnYWJsZSIpfHwvYWJzb2x1dGUvLnRlc3QoZi5jc3MoInBvc2l0aW9uIikpKSYmZi5jc3Moe3Bvc2l0aW9uOiJhYnNvbHV0ZSIsdG9wOmUudG9wLGxlZnQ6ZS5sZWZ0fSksdGhpcy5fcmVuZGVyUHJveHkoKTt2YXIgZz1jKHRoaXMuaGVscGVyLmNzcygibGVmdCIpKSxoPWModGhpcy5oZWxwZXIuY3NzKCJ0b3AiKSk7ZC5jb250YWlubWVudCYmKGcrPWEoZC5jb250YWlubWVudCkuc2Nyb2xsTGVmdCgpfHwwLGgrPWEoZC5jb250YWlubWVudCkuc2Nyb2xsVG9wKCl8fDApLHRoaXMub2Zmc2V0PXRoaXMuaGVscGVyLm9mZnNldCgpLHRoaXMucG9zaXRpb249e2xlZnQ6Zyx0b3A6aH0sdGhpcy5zaXplPXRoaXMuX2hlbHBlcj97d2lkdGg6Zi5vdXRlcldpZHRoKCksaGVpZ2h0OmYub3V0ZXJIZWlnaHQoKX06e3dpZHRoOmYud2lkdGgoKSxoZWlnaHQ6Zi5oZWlnaHQoKX0sdGhpcy5vcmlnaW5hbFNpemU9dGhpcy5faGVscGVyP3t3aWR0aDpmLm91dGVyV2lkdGgoKSxoZWlnaHQ6Zi5vdXRlckhlaWdodCgpfTp7d2lkdGg6Zi53aWR0aCgpLGhlaWdodDpmLmhlaWdodCgpfSx0aGlzLm9yaWdpbmFsUG9zaXRpb249e2xlZnQ6Zyx0b3A6aH0sdGhpcy5zaXplRGlmZj17d2lkdGg6Zi5vdXRlcldpZHRoKCktZi53aWR0aCgpLGhlaWdodDpmLm91dGVySGVpZ2h0KCktZi5oZWlnaHQoKX0sdGhpcy5vcmlnaW5hbE1vdXNlUG9zaXRpb249e2xlZnQ6Yi5wYWdlWCx0b3A6Yi5wYWdlWX0sdGhpcy5hc3BlY3RSYXRpbz10eXBlb2YgZC5hc3BlY3RSYXRpbz09Im51bWJlciI/ZC5hc3BlY3RSYXRpbzp0aGlzLm9yaWdpbmFsU2l6ZS53aWR0aC90aGlzLm9yaWdpbmFsU2l6ZS5oZWlnaHR8fDE7dmFyIGk9YSgiLnVpLXJlc2l6YWJsZS0iK3RoaXMuYXhpcykuY3NzKCJjdXJzb3IiKTtyZXR1cm4gYSgiYm9keSIpLmNzcygiY3Vyc29yIixpPT0iYXV0byI/dGhpcy5heGlzKyItcmVzaXplIjppKSxmLmFkZENsYXNzKCJ1aS1yZXNpemFibGUtcmVzaXppbmciKSx0aGlzLl9wcm9wYWdhdGUoInN0YXJ0IixiKSwhMH0sX21vdXNlRHJhZzpmdW5jdGlvbihiKXt2YXIgYz10aGlzLmhlbHBlcixkPXRoaXMub3B0aW9ucyxlPXt9LGY9dGhpcyxnPXRoaXMub3JpZ2luYWxNb3VzZVBvc2l0aW9uLGg9dGhpcy5heGlzLGk9Yi5wYWdlWC1nLmxlZnR8fDAsaj1iLnBhZ2VZLWcudG9wfHwwLGs9dGhpcy5fY2hhbmdlW2hdO2lmKCFrKXJldHVybiExO3ZhciBsPWsuYXBwbHkodGhpcyxbYixpLGpdKSxtPWEuYnJvd3Nlci5tc2llJiZhLmJyb3dzZXIudmVyc2lvbjw3LG49dGhpcy5zaXplRGlmZjt0aGlzLl91cGRhdGVWaXJ0dWFsQm91bmRhcmllcyhiLnNoaWZ0S2V5KTtpZih0aGlzLl9hc3BlY3RSYXRpb3x8Yi5zaGlmdEtleSlsPXRoaXMuX3VwZGF0ZVJhdGlvKGwsYik7cmV0dXJuIGw9dGhpcy5fcmVzcGVjdFNpemUobCxiKSx0aGlzLl9wcm9wYWdhdGUoInJlc2l6ZSIsYiksYy5jc3Moe3RvcDp0aGlzLnBvc2l0aW9uLnRvcCsicHgiLGxlZnQ6dGhpcy5wb3NpdGlvbi5sZWZ0KyJweCIsd2lkdGg6dGhpcy5zaXplLndpZHRoKyJweCIsaGVpZ2h0OnRoaXMuc2l6ZS5oZWlnaHQrInB4In0pLCF0aGlzLl9oZWxwZXImJnRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMubGVuZ3RoJiZ0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZSgpLHRoaXMuX3VwZGF0ZUNhY2hlKGwpLHRoaXMuX3RyaWdnZXIoInJlc2l6ZSIsYix0aGlzLnVpKCkpLCExfSxfbW91c2VTdG9wOmZ1bmN0aW9uKGIpe3RoaXMucmVzaXppbmc9ITE7dmFyIGM9dGhpcy5vcHRpb25zLGQ9dGhpcztpZih0aGlzLl9oZWxwZXIpe3ZhciBlPXRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMsZj1lLmxlbmd0aCYmL3RleHRhcmVhL2kudGVzdChlWzBdLm5vZGVOYW1lKSxnPWYmJmEudWkuaGFzU2Nyb2xsKGVbMF0sImxlZnQiKT8wOmQuc2l6ZURpZmYuaGVpZ2h0LGg9Zj8wOmQuc2l6ZURpZmYud2lkdGgsaT17d2lkdGg6ZC5oZWxwZXIud2lkdGgoKS1oLGhlaWdodDpkLmhlbHBlci5oZWlnaHQoKS1nfSxqPXBhcnNlSW50KGQuZWxlbWVudC5jc3MoImxlZnQiKSwxMCkrKGQucG9zaXRpb24ubGVmdC1kLm9yaWdpbmFsUG9zaXRpb24ubGVmdCl8fG51bGwsaz1wYXJzZUludChkLmVsZW1lbnQuY3NzKCJ0b3AiKSwxMCkrKGQucG9zaXRpb24udG9wLWQub3JpZ2luYWxQb3NpdGlvbi50b3ApfHxudWxsO2MuYW5pbWF0ZXx8dGhpcy5lbGVtZW50LmNzcyhhLmV4dGVuZChpLHt0b3A6ayxsZWZ0Omp9KSksZC5oZWxwZXIuaGVpZ2h0KGQuc2l6ZS5oZWlnaHQpLGQuaGVscGVyLndpZHRoKGQuc2l6ZS53aWR0aCksdGhpcy5faGVscGVyJiYhYy5hbmltYXRlJiZ0aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZSgpfXJldHVybiBhKCJib2R5IikuY3NzKCJjdXJzb3IiLCJhdXRvIiksdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1yZXNpemFibGUtcmVzaXppbmciKSx0aGlzLl9wcm9wYWdhdGUoInN0b3AiLGIpLHRoaXMuX2hlbHBlciYmdGhpcy5oZWxwZXIucmVtb3ZlKCksITF9LF91cGRhdGVWaXJ0dWFsQm91bmRhcmllczpmdW5jdGlvbihhKXt2YXIgYj10aGlzLm9wdGlvbnMsYyxlLGYsZyxoO2g9e21pbldpZHRoOmQoYi5taW5XaWR0aCk/Yi5taW5XaWR0aDowLG1heFdpZHRoOmQoYi5tYXhXaWR0aCk/Yi5tYXhXaWR0aDpJbmZpbml0eSxtaW5IZWlnaHQ6ZChiLm1pbkhlaWdodCk/Yi5taW5IZWlnaHQ6MCxtYXhIZWlnaHQ6ZChiLm1heEhlaWdodCk/Yi5tYXhIZWlnaHQ6SW5maW5pdHl9O2lmKHRoaXMuX2FzcGVjdFJhdGlvfHxhKWM9aC5taW5IZWlnaHQqdGhpcy5hc3BlY3RSYXRpbyxmPWgubWluV2lkdGgvdGhpcy5hc3BlY3RSYXRpbyxlPWgubWF4SGVpZ2h0KnRoaXMuYXNwZWN0UmF0aW8sZz1oLm1heFdpZHRoL3RoaXMuYXNwZWN0UmF0aW8sYz5oLm1pbldpZHRoJiYoaC5taW5XaWR0aD1jKSxmPmgubWluSGVpZ2h0JiYoaC5taW5IZWlnaHQ9ZiksZTxoLm1heFdpZHRoJiYoaC5tYXhXaWR0aD1lKSxnPGgubWF4SGVpZ2h0JiYoaC5tYXhIZWlnaHQ9Zyk7dGhpcy5fdkJvdW5kYXJpZXM9aH0sX3VwZGF0ZUNhY2hlOmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMub3B0aW9uczt0aGlzLm9mZnNldD10aGlzLmhlbHBlci5vZmZzZXQoKSxkKGEubGVmdCkmJih0aGlzLnBvc2l0aW9uLmxlZnQ9YS5sZWZ0KSxkKGEudG9wKSYmKHRoaXMucG9zaXRpb24udG9wPWEudG9wKSxkKGEuaGVpZ2h0KSYmKHRoaXMuc2l6ZS5oZWlnaHQ9YS5oZWlnaHQpLGQoYS53aWR0aCkmJih0aGlzLnNpemUud2lkdGg9YS53aWR0aCl9LF91cGRhdGVSYXRpbzpmdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMub3B0aW9ucyxlPXRoaXMucG9zaXRpb24sZj10aGlzLnNpemUsZz10aGlzLmF4aXM7cmV0dXJuIGQoYS5oZWlnaHQpP2Eud2lkdGg9YS5oZWlnaHQqdGhpcy5hc3BlY3RSYXRpbzpkKGEud2lkdGgpJiYoYS5oZWlnaHQ9YS53aWR0aC90aGlzLmFzcGVjdFJhdGlvKSxnPT0ic3ciJiYoYS5sZWZ0PWUubGVmdCsoZi53aWR0aC1hLndpZHRoKSxhLnRvcD1udWxsKSxnPT0ibnciJiYoYS50b3A9ZS50b3ArKGYuaGVpZ2h0LWEuaGVpZ2h0KSxhLmxlZnQ9ZS5sZWZ0KyhmLndpZHRoLWEud2lkdGgpKSxhfSxfcmVzcGVjdFNpemU6ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLmhlbHBlcixlPXRoaXMuX3ZCb3VuZGFyaWVzLGY9dGhpcy5fYXNwZWN0UmF0aW98fGIuc2hpZnRLZXksZz10aGlzLmF4aXMsaD1kKGEud2lkdGgpJiZlLm1heFdpZHRoJiZlLm1heFdpZHRoPGEud2lkdGgsaT1kKGEuaGVpZ2h0KSYmZS5tYXhIZWlnaHQmJmUubWF4SGVpZ2h0PGEuaGVpZ2h0LGo9ZChhLndpZHRoKSYmZS5taW5XaWR0aCYmZS5taW5XaWR0aD5hLndpZHRoLGs9ZChhLmhlaWdodCkmJmUubWluSGVpZ2h0JiZlLm1pbkhlaWdodD5hLmhlaWdodDtqJiYoYS53aWR0aD1lLm1pbldpZHRoKSxrJiYoYS5oZWlnaHQ9ZS5taW5IZWlnaHQpLGgmJihhLndpZHRoPWUubWF4V2lkdGgpLGkmJihhLmhlaWdodD1lLm1heEhlaWdodCk7dmFyIGw9dGhpcy5vcmlnaW5hbFBvc2l0aW9uLmxlZnQrdGhpcy5vcmlnaW5hbFNpemUud2lkdGgsbT10aGlzLnBvc2l0aW9uLnRvcCt0aGlzLnNpemUuaGVpZ2h0LG49L3N3fG53fHcvLnRlc3QoZyksbz0vbnd8bmV8bi8udGVzdChnKTtqJiZuJiYoYS5sZWZ0PWwtZS5taW5XaWR0aCksaCYmbiYmKGEubGVmdD1sLWUubWF4V2lkdGgpLGsmJm8mJihhLnRvcD1tLWUubWluSGVpZ2h0KSxpJiZvJiYoYS50b3A9bS1lLm1heEhlaWdodCk7dmFyIHA9IWEud2lkdGgmJiFhLmhlaWdodDtyZXR1cm4gcCYmIWEubGVmdCYmYS50b3A/YS50b3A9bnVsbDpwJiYhYS50b3AmJmEubGVmdCYmKGEubGVmdD1udWxsKSxhfSxfcHJvcG9ydGlvbmFsbHlSZXNpemU6ZnVuY3Rpb24oKXt2YXIgYj10aGlzLm9wdGlvbnM7aWYoIXRoaXMuX3Byb3BvcnRpb25hbGx5UmVzaXplRWxlbWVudHMubGVuZ3RoKXJldHVybjt2YXIgYz10aGlzLmhlbHBlcnx8dGhpcy5lbGVtZW50O2Zvcih2YXIgZD0wO2Q8dGhpcy5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50cy5sZW5ndGg7ZCsrKXt2YXIgZT10aGlzLl9wcm9wb3J0aW9uYWxseVJlc2l6ZUVsZW1lbnRzW2RdO2lmKCF0aGlzLmJvcmRlckRpZil7dmFyIGY9W2UuY3NzKCJib3JkZXJUb3BXaWR0aCIpLGUuY3NzKCJib3JkZXJSaWdodFdpZHRoIiksZS5jc3MoImJvcmRlckJvdHRvbVdpZHRoIiksZS5jc3MoImJvcmRlckxlZnRXaWR0aCIpXSxnPVtlLmNzcygicGFkZGluZ1RvcCIpLGUuY3NzKCJwYWRkaW5nUmlnaHQiKSxlLmNzcygicGFkZGluZ0JvdHRvbSIpLGUuY3NzKCJwYWRkaW5nTGVmdCIpXTt0aGlzLmJvcmRlckRpZj1hLm1hcChmLGZ1bmN0aW9uKGEsYil7dmFyIGM9cGFyc2VJbnQoYSwxMCl8fDAsZD1wYXJzZUludChnW2JdLDEwKXx8MDtyZXR1cm4gYytkfSl9aWYoIWEuYnJvd3Nlci5tc2llfHwhYShjKS5pcygiOmhpZGRlbiIpJiYhYShjKS5wYXJlbnRzKCI6aGlkZGVuIikubGVuZ3RoKWUuY3NzKHtoZWlnaHQ6Yy5oZWlnaHQoKS10aGlzLmJvcmRlckRpZlswXS10aGlzLmJvcmRlckRpZlsyXXx8MCx3aWR0aDpjLndpZHRoKCktdGhpcy5ib3JkZXJEaWZbMV0tdGhpcy5ib3JkZXJEaWZbM118fDB9KTtlbHNlIGNvbnRpbnVlfX0sX3JlbmRlclByb3h5OmZ1bmN0aW9uKCl7dmFyIGI9dGhpcy5lbGVtZW50LGM9dGhpcy5vcHRpb25zO3RoaXMuZWxlbWVudE9mZnNldD1iLm9mZnNldCgpO2lmKHRoaXMuX2hlbHBlcil7dGhpcy5oZWxwZXI9dGhpcy5oZWxwZXJ8fGEoJzxkaXYgc3R5bGU9Im92ZXJmbG93OmhpZGRlbjsiPjwvZGl2PicpO3ZhciBkPWEuYnJvd3Nlci5tc2llJiZhLmJyb3dzZXIudmVyc2lvbjw3LGU9ZD8xOjAsZj1kPzI6LTE7dGhpcy5oZWxwZXIuYWRkQ2xhc3ModGhpcy5faGVscGVyKS5jc3Moe3dpZHRoOnRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCkrZixoZWlnaHQ6dGhpcy5lbGVtZW50Lm91dGVySGVpZ2h0KCkrZixwb3NpdGlvbjoiYWJzb2x1dGUiLGxlZnQ6dGhpcy5lbGVtZW50T2Zmc2V0LmxlZnQtZSsicHgiLHRvcDp0aGlzLmVsZW1lbnRPZmZzZXQudG9wLWUrInB4Iix6SW5kZXg6KytjLnpJbmRleH0pLHRoaXMuaGVscGVyLmFwcGVuZFRvKCJib2R5IikuZGlzYWJsZVNlbGVjdGlvbigpfWVsc2UgdGhpcy5oZWxwZXI9dGhpcy5lbGVtZW50fSxfY2hhbmdlOntlOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm57d2lkdGg6dGhpcy5vcmlnaW5hbFNpemUud2lkdGgrYn19LHc6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPXRoaXMub3B0aW9ucyxlPXRoaXMub3JpZ2luYWxTaXplLGY9dGhpcy5vcmlnaW5hbFBvc2l0aW9uO3JldHVybntsZWZ0OmYubGVmdCtiLHdpZHRoOmUud2lkdGgtYn19LG46ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPXRoaXMub3B0aW9ucyxlPXRoaXMub3JpZ2luYWxTaXplLGY9dGhpcy5vcmlnaW5hbFBvc2l0aW9uO3JldHVybnt0b3A6Zi50b3ArYyxoZWlnaHQ6ZS5oZWlnaHQtY319LHM6ZnVuY3Rpb24oYSxiLGMpe3JldHVybntoZWlnaHQ6dGhpcy5vcmlnaW5hbFNpemUuaGVpZ2h0K2N9fSxzZTpmdW5jdGlvbihiLGMsZCl7cmV0dXJuIGEuZXh0ZW5kKHRoaXMuX2NoYW5nZS5zLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0aGlzLl9jaGFuZ2UuZS5hcHBseSh0aGlzLFtiLGMsZF0pKX0sc3c6ZnVuY3Rpb24oYixjLGQpe3JldHVybiBhLmV4dGVuZCh0aGlzLl9jaGFuZ2Uucy5hcHBseSh0aGlzLGFyZ3VtZW50cyksdGhpcy5fY2hhbmdlLncuYXBwbHkodGhpcyxbYixjLGRdKSl9LG5lOmZ1bmN0aW9uKGIsYyxkKXtyZXR1cm4gYS5leHRlbmQodGhpcy5fY2hhbmdlLm4uYXBwbHkodGhpcyxhcmd1bWVudHMpLHRoaXMuX2NoYW5nZS5lLmFwcGx5KHRoaXMsW2IsYyxkXSkpfSxudzpmdW5jdGlvbihiLGMsZCl7cmV0dXJuIGEuZXh0ZW5kKHRoaXMuX2NoYW5nZS5uLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0aGlzLl9jaGFuZ2Uudy5hcHBseSh0aGlzLFtiLGMsZF0pKX19LF9wcm9wYWdhdGU6ZnVuY3Rpb24oYixjKXthLnVpLnBsdWdpbi5jYWxsKHRoaXMsYixbYyx0aGlzLnVpKCldKSxiIT0icmVzaXplIiYmdGhpcy5fdHJpZ2dlcihiLGMsdGhpcy51aSgpKX0scGx1Z2luczp7fSx1aTpmdW5jdGlvbigpe3JldHVybntvcmlnaW5hbEVsZW1lbnQ6dGhpcy5vcmlnaW5hbEVsZW1lbnQsZWxlbWVudDp0aGlzLmVsZW1lbnQsaGVscGVyOnRoaXMuaGVscGVyLHBvc2l0aW9uOnRoaXMucG9zaXRpb24sc2l6ZTp0aGlzLnNpemUsb3JpZ2luYWxTaXplOnRoaXMub3JpZ2luYWxTaXplLG9yaWdpbmFsUG9zaXRpb246dGhpcy5vcmlnaW5hbFBvc2l0aW9ufX19KSxhLmV4dGVuZChhLnVpLnJlc2l6YWJsZSx7dmVyc2lvbjoiMS44LjIwIn0pLGEudWkucGx1Z2luLmFkZCgicmVzaXphYmxlIiwiYWxzb1Jlc2l6ZSIse3N0YXJ0OmZ1bmN0aW9uKGIsYyl7dmFyIGQ9YSh0aGlzKS5kYXRhKCJyZXNpemFibGUiKSxlPWQub3B0aW9ucyxmPWZ1bmN0aW9uKGIpe2EoYikuZWFjaChmdW5jdGlvbigpe3ZhciBiPWEodGhpcyk7Yi5kYXRhKCJyZXNpemFibGUtYWxzb3Jlc2l6ZSIse3dpZHRoOnBhcnNlSW50KGIud2lkdGgoKSwxMCksaGVpZ2h0OnBhcnNlSW50KGIuaGVpZ2h0KCksMTApLGxlZnQ6cGFyc2VJbnQoYi5jc3MoImxlZnQiKSwxMCksdG9wOnBhcnNlSW50KGIuY3NzKCJ0b3AiKSwxMCl9KX0pfTt0eXBlb2YgZS5hbHNvUmVzaXplPT0ib2JqZWN0IiYmIWUuYWxzb1Jlc2l6ZS5wYXJlbnROb2RlP2UuYWxzb1Jlc2l6ZS5sZW5ndGg/KGUuYWxzb1Jlc2l6ZT1lLmFsc29SZXNpemVbMF0sZihlLmFsc29SZXNpemUpKTphLmVhY2goZS5hbHNvUmVzaXplLGZ1bmN0aW9uKGEpe2YoYSl9KTpmKGUuYWxzb1Jlc2l6ZSl9LHJlc2l6ZTpmdW5jdGlvbihiLGMpe3ZhciBkPWEodGhpcykuZGF0YSgicmVzaXphYmxlIiksZT1kLm9wdGlvbnMsZj1kLm9yaWdpbmFsU2l6ZSxnPWQub3JpZ2luYWxQb3NpdGlvbixoPXtoZWlnaHQ6ZC5zaXplLmhlaWdodC1mLmhlaWdodHx8MCx3aWR0aDpkLnNpemUud2lkdGgtZi53aWR0aHx8MCx0b3A6ZC5wb3NpdGlvbi50b3AtZy50b3B8fDAsbGVmdDpkLnBvc2l0aW9uLmxlZnQtZy5sZWZ0fHwwfSxpPWZ1bmN0aW9uKGIsZCl7YShiKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9YSh0aGlzKSxlPWEodGhpcykuZGF0YSgicmVzaXphYmxlLWFsc29yZXNpemUiKSxmPXt9LGc9ZCYmZC5sZW5ndGg/ZDpiLnBhcmVudHMoYy5vcmlnaW5hbEVsZW1lbnRbMF0pLmxlbmd0aD9bIndpZHRoIiwiaGVpZ2h0Il06WyJ3aWR0aCIsImhlaWdodCIsInRvcCIsImxlZnQiXTthLmVhY2goZyxmdW5jdGlvbihhLGIpe3ZhciBjPShlW2JdfHwwKSsoaFtiXXx8MCk7YyYmYz49MCYmKGZbYl09Y3x8bnVsbCl9KSxiLmNzcyhmKX0pfTt0eXBlb2YgZS5hbHNvUmVzaXplPT0ib2JqZWN0IiYmIWUuYWxzb1Jlc2l6ZS5ub2RlVHlwZT9hLmVhY2goZS5hbHNvUmVzaXplLGZ1bmN0aW9uKGEsYil7aShhLGIpfSk6aShlLmFsc29SZXNpemUpfSxzdG9wOmZ1bmN0aW9uKGIsYyl7YSh0aGlzKS5yZW1vdmVEYXRhKCJyZXNpemFibGUtYWxzb3Jlc2l6ZSIpfX0pLGEudWkucGx1Z2luLmFkZCgicmVzaXphYmxlIiwiYW5pbWF0ZSIse3N0b3A6ZnVuY3Rpb24oYixjKXt2YXIgZD1hKHRoaXMpLmRhdGEoInJlc2l6YWJsZSIpLGU9ZC5vcHRpb25zLGY9ZC5fcHJvcG9ydGlvbmFsbHlSZXNpemVFbGVtZW50cyxnPWYubGVuZ3RoJiYvdGV4dGFyZWEvaS50ZXN0KGZbMF0ubm9kZU5hbWUpLGg9ZyYmYS51aS5oYXNTY3JvbGwoZlswXSwibGVmdCIpPzA6ZC5zaXplRGlmZi5oZWlnaHQsaT1nPzA6ZC5zaXplRGlmZi53aWR0aCxqPXt3aWR0aDpkLnNpemUud2lkdGgtaSxoZWlnaHQ6ZC5zaXplLmhlaWdodC1ofSxrPXBhcnNlSW50KGQuZWxlbWVudC5jc3MoImxlZnQiKSwxMCkrKGQucG9zaXRpb24ubGVmdC1kLm9yaWdpbmFsUG9zaXRpb24ubGVmdCl8fG51bGwsbD1wYXJzZUludChkLmVsZW1lbnQuY3NzKCJ0b3AiKSwxMCkrKGQucG9zaXRpb24udG9wLWQub3JpZ2luYWxQb3NpdGlvbi50b3ApfHxudWxsO2QuZWxlbWVudC5hbmltYXRlKGEuZXh0ZW5kKGosbCYmaz97dG9wOmwsbGVmdDprfTp7fSkse2R1cmF0aW9uOmUuYW5pbWF0ZUR1cmF0aW9uLGVhc2luZzplLmFuaW1hdGVFYXNpbmcsc3RlcDpmdW5jdGlvbigpe3ZhciBjPXt3aWR0aDpwYXJzZUludChkLmVsZW1lbnQuY3NzKCJ3aWR0aCIpLDEwKSxoZWlnaHQ6cGFyc2VJbnQoZC5lbGVtZW50LmNzcygiaGVpZ2h0IiksMTApLHRvcDpwYXJzZUludChkLmVsZW1lbnQuY3NzKCJ0b3AiKSwxMCksbGVmdDpwYXJzZUludChkLmVsZW1lbnQuY3NzKCJsZWZ0IiksMTApfTtmJiZmLmxlbmd0aCYmYShmWzBdKS5jc3Moe3dpZHRoOmMud2lkdGgsaGVpZ2h0OmMuaGVpZ2h0fSksZC5fdXBkYXRlQ2FjaGUoYyksZC5fcHJvcGFnYXRlKCJyZXNpemUiLGIpfX0pfX0pLGEudWkucGx1Z2luLmFkZCgicmVzaXphYmxlIiwiY29udGFpbm1lbnQiLHtzdGFydDpmdW5jdGlvbihiLGQpe3ZhciBlPWEodGhpcykuZGF0YSgicmVzaXphYmxlIiksZj1lLm9wdGlvbnMsZz1lLmVsZW1lbnQsaD1mLmNvbnRhaW5tZW50LGk9aCBpbnN0YW5jZW9mIGE/aC5nZXQoMCk6L3BhcmVudC8udGVzdChoKT9nLnBhcmVudCgpLmdldCgwKTpoO2lmKCFpKXJldHVybjtlLmNvbnRhaW5lckVsZW1lbnQ9YShpKTtpZigvZG9jdW1lbnQvLnRlc3QoaCl8fGg9PWRvY3VtZW50KWUuY29udGFpbmVyT2Zmc2V0PXtsZWZ0OjAsdG9wOjB9LGUuY29udGFpbmVyUG9zaXRpb249e2xlZnQ6MCx0b3A6MH0sZS5wYXJlbnREYXRhPXtlbGVtZW50OmEoZG9jdW1lbnQpLGxlZnQ6MCx0b3A6MCx3aWR0aDphKGRvY3VtZW50KS53aWR0aCgpLGhlaWdodDphKGRvY3VtZW50KS5oZWlnaHQoKXx8ZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlLnNjcm9sbEhlaWdodH07ZWxzZXt2YXIgaj1hKGkpLGs9W107YShbIlRvcCIsIlJpZ2h0IiwiTGVmdCIsIkJvdHRvbSJdKS5lYWNoKGZ1bmN0aW9uKGEsYil7a1thXT1jKGouY3NzKCJwYWRkaW5nIitiKSl9KSxlLmNvbnRhaW5lck9mZnNldD1qLm9mZnNldCgpLGUuY29udGFpbmVyUG9zaXRpb249ai5wb3NpdGlvbigpLGUuY29udGFpbmVyU2l6ZT17aGVpZ2h0OmouaW5uZXJIZWlnaHQoKS1rWzNdLHdpZHRoOmouaW5uZXJXaWR0aCgpLWtbMV19O3ZhciBsPWUuY29udGFpbmVyT2Zmc2V0LG09ZS5jb250YWluZXJTaXplLmhlaWdodCxuPWUuY29udGFpbmVyU2l6ZS53aWR0aCxvPWEudWkuaGFzU2Nyb2xsKGksImxlZnQiKT9pLnNjcm9sbFdpZHRoOm4scD1hLnVpLmhhc1Njcm9sbChpKT9pLnNjcm9sbEhlaWdodDptO2UucGFyZW50RGF0YT17ZWxlbWVudDppLGxlZnQ6bC5sZWZ0LHRvcDpsLnRvcCx3aWR0aDpvLGhlaWdodDpwfX19LHJlc2l6ZTpmdW5jdGlvbihiLGMpe3ZhciBkPWEodGhpcykuZGF0YSgicmVzaXphYmxlIiksZT1kLm9wdGlvbnMsZj1kLmNvbnRhaW5lclNpemUsZz1kLmNvbnRhaW5lck9mZnNldCxoPWQuc2l6ZSxpPWQucG9zaXRpb24saj1kLl9hc3BlY3RSYXRpb3x8Yi5zaGlmdEtleSxrPXt0b3A6MCxsZWZ0OjB9LGw9ZC5jb250YWluZXJFbGVtZW50O2xbMF0hPWRvY3VtZW50JiYvc3RhdGljLy50ZXN0KGwuY3NzKCJwb3NpdGlvbiIpKSYmKGs9ZyksaS5sZWZ0PChkLl9oZWxwZXI/Zy5sZWZ0OjApJiYoZC5zaXplLndpZHRoPWQuc2l6ZS53aWR0aCsoZC5faGVscGVyP2QucG9zaXRpb24ubGVmdC1nLmxlZnQ6ZC5wb3NpdGlvbi5sZWZ0LWsubGVmdCksaiYmKGQuc2l6ZS5oZWlnaHQ9ZC5zaXplLndpZHRoL2QuYXNwZWN0UmF0aW8pLGQucG9zaXRpb24ubGVmdD1lLmhlbHBlcj9nLmxlZnQ6MCksaS50b3A8KGQuX2hlbHBlcj9nLnRvcDowKSYmKGQuc2l6ZS5oZWlnaHQ9ZC5zaXplLmhlaWdodCsoZC5faGVscGVyP2QucG9zaXRpb24udG9wLWcudG9wOmQucG9zaXRpb24udG9wKSxqJiYoZC5zaXplLndpZHRoPWQuc2l6ZS5oZWlnaHQqZC5hc3BlY3RSYXRpbyksZC5wb3NpdGlvbi50b3A9ZC5faGVscGVyP2cudG9wOjApLGQub2Zmc2V0LmxlZnQ9ZC5wYXJlbnREYXRhLmxlZnQrZC5wb3NpdGlvbi5sZWZ0LGQub2Zmc2V0LnRvcD1kLnBhcmVudERhdGEudG9wK2QucG9zaXRpb24udG9wO3ZhciBtPU1hdGguYWJzKChkLl9oZWxwZXI/ZC5vZmZzZXQubGVmdC1rLmxlZnQ6ZC5vZmZzZXQubGVmdC1rLmxlZnQpK2Quc2l6ZURpZmYud2lkdGgpLG49TWF0aC5hYnMoKGQuX2hlbHBlcj9kLm9mZnNldC50b3Atay50b3A6ZC5vZmZzZXQudG9wLWcudG9wKStkLnNpemVEaWZmLmhlaWdodCksbz1kLmNvbnRhaW5lckVsZW1lbnQuZ2V0KDApPT1kLmVsZW1lbnQucGFyZW50KCkuZ2V0KDApLHA9L3JlbGF0aXZlfGFic29sdXRlLy50ZXN0KGQuY29udGFpbmVyRWxlbWVudC5jc3MoInBvc2l0aW9uIikpO28mJnAmJihtLT1kLnBhcmVudERhdGEubGVmdCksbStkLnNpemUud2lkdGg+PWQucGFyZW50RGF0YS53aWR0aCYmKGQuc2l6ZS53aWR0aD1kLnBhcmVudERhdGEud2lkdGgtbSxqJiYoZC5zaXplLmhlaWdodD1kLnNpemUud2lkdGgvZC5hc3BlY3RSYXRpbykpLG4rZC5zaXplLmhlaWdodD49ZC5wYXJlbnREYXRhLmhlaWdodCYmKGQuc2l6ZS5oZWlnaHQ9ZC5wYXJlbnREYXRhLmhlaWdodC1uLGomJihkLnNpemUud2lkdGg9ZC5zaXplLmhlaWdodCpkLmFzcGVjdFJhdGlvKSl9LHN0b3A6ZnVuY3Rpb24oYixjKXt2YXIgZD1hKHRoaXMpLmRhdGEoInJlc2l6YWJsZSIpLGU9ZC5vcHRpb25zLGY9ZC5wb3NpdGlvbixnPWQuY29udGFpbmVyT2Zmc2V0LGg9ZC5jb250YWluZXJQb3NpdGlvbixpPWQuY29udGFpbmVyRWxlbWVudCxqPWEoZC5oZWxwZXIpLGs9ai5vZmZzZXQoKSxsPWoub3V0ZXJXaWR0aCgpLWQuc2l6ZURpZmYud2lkdGgsbT1qLm91dGVySGVpZ2h0KCktZC5zaXplRGlmZi5oZWlnaHQ7ZC5faGVscGVyJiYhZS5hbmltYXRlJiYvcmVsYXRpdmUvLnRlc3QoaS5jc3MoInBvc2l0aW9uIikpJiZhKHRoaXMpLmNzcyh7bGVmdDprLmxlZnQtaC5sZWZ0LWcubGVmdCx3aWR0aDpsLGhlaWdodDptfSksZC5faGVscGVyJiYhZS5hbmltYXRlJiYvc3RhdGljLy50ZXN0KGkuY3NzKCJwb3NpdGlvbiIpKSYmYSh0aGlzKS5jc3Moe2xlZnQ6ay5sZWZ0LWgubGVmdC1nLmxlZnQsd2lkdGg6bCxoZWlnaHQ6bX0pfX0pLGEudWkucGx1Z2luLmFkZCgicmVzaXphYmxlIiwiZ2hvc3QiLHtzdGFydDpmdW5jdGlvbihiLGMpe3ZhciBkPWEodGhpcykuZGF0YSgicmVzaXphYmxlIiksZT1kLm9wdGlvbnMsZj1kLnNpemU7ZC5naG9zdD1kLm9yaWdpbmFsRWxlbWVudC5jbG9uZSgpLGQuZ2hvc3QuY3NzKHtvcGFjaXR5Oi4yNSxkaXNwbGF5OiJibG9jayIscG9zaXRpb246InJlbGF0aXZlIixoZWlnaHQ6Zi5oZWlnaHQsd2lkdGg6Zi53aWR0aCxtYXJnaW46MCxsZWZ0OjAsdG9wOjB9KS5hZGRDbGFzcygidWktcmVzaXphYmxlLWdob3N0IikuYWRkQ2xhc3ModHlwZW9mIGUuZ2hvc3Q9PSJzdHJpbmciP2UuZ2hvc3Q6IiIpLGQuZ2hvc3QuYXBwZW5kVG8oZC5oZWxwZXIpfSxyZXNpemU6ZnVuY3Rpb24oYixjKXt2YXIgZD1hKHRoaXMpLmRhdGEoInJlc2l6YWJsZSIpLGU9ZC5vcHRpb25zO2QuZ2hvc3QmJmQuZ2hvc3QuY3NzKHtwb3NpdGlvbjoicmVsYXRpdmUiLGhlaWdodDpkLnNpemUuaGVpZ2h0LHdpZHRoOmQuc2l6ZS53aWR0aH0pfSxzdG9wOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9YSh0aGlzKS5kYXRhKCJyZXNpemFibGUiKSxlPWQub3B0aW9ucztkLmdob3N0JiZkLmhlbHBlciYmZC5oZWxwZXIuZ2V0KDApLnJlbW92ZUNoaWxkKGQuZ2hvc3QuZ2V0KDApKX19KSxhLnVpLnBsdWdpbi5hZGQoInJlc2l6YWJsZSIsImdyaWQiLHtyZXNpemU6ZnVuY3Rpb24oYixjKXt2YXIgZD1hKHRoaXMpLmRhdGEoInJlc2l6YWJsZSIpLGU9ZC5vcHRpb25zLGY9ZC5zaXplLGc9ZC5vcmlnaW5hbFNpemUsaD1kLm9yaWdpbmFsUG9zaXRpb24saT1kLmF4aXMsaj1lLl9hc3BlY3RSYXRpb3x8Yi5zaGlmdEtleTtlLmdyaWQ9dHlwZW9mIGUuZ3JpZD09Im51bWJlciI/W2UuZ3JpZCxlLmdyaWRdOmUuZ3JpZDt2YXIgaz1NYXRoLnJvdW5kKChmLndpZHRoLWcud2lkdGgpLyhlLmdyaWRbMF18fDEpKSooZS5ncmlkWzBdfHwxKSxsPU1hdGgucm91bmQoKGYuaGVpZ2h0LWcuaGVpZ2h0KS8oZS5ncmlkWzFdfHwxKSkqKGUuZ3JpZFsxXXx8MSk7L14oc2V8c3xlKSQvLnRlc3QoaSk/KGQuc2l6ZS53aWR0aD1nLndpZHRoK2ssZC5zaXplLmhlaWdodD1nLmhlaWdodCtsKTovXihuZSkkLy50ZXN0KGkpPyhkLnNpemUud2lkdGg9Zy53aWR0aCtrLGQuc2l6ZS5oZWlnaHQ9Zy5oZWlnaHQrbCxkLnBvc2l0aW9uLnRvcD1oLnRvcC1sKTovXihzdykkLy50ZXN0KGkpPyhkLnNpemUud2lkdGg9Zy53aWR0aCtrLGQuc2l6ZS5oZWlnaHQ9Zy5oZWlnaHQrbCxkLnBvc2l0aW9uLmxlZnQ9aC5sZWZ0LWspOihkLnNpemUud2lkdGg9Zy53aWR0aCtrLGQuc2l6ZS5oZWlnaHQ9Zy5oZWlnaHQrbCxkLnBvc2l0aW9uLnRvcD1oLnRvcC1sLGQucG9zaXRpb24ubGVmdD1oLmxlZnQtayl9fSk7dmFyIGM9ZnVuY3Rpb24oYSl7cmV0dXJuIHBhcnNlSW50KGEsMTApfHwwfSxkPWZ1bmN0aW9uKGEpe3JldHVybiFpc05hTihwYXJzZUludChhLDEwKSl9fSkoalF1ZXJ5KTs7LyohIGpRdWVyeSBVSSAtIHYxLjguMjAgLSAyMDEyLTA0LTMwCiogaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkKKiBJbmNsdWRlczoganF1ZXJ5LnVpLnNlbGVjdGFibGUuanMKKiBDb3B5cmlnaHQgKGMpIDIwMTIgQVVUSE9SUy50eHQ7IExpY2Vuc2VkIE1JVCwgR1BMICovCihmdW5jdGlvbihhLGIpe2Eud2lkZ2V0KCJ1aS5zZWxlY3RhYmxlIixhLnVpLm1vdXNlLHtvcHRpb25zOnthcHBlbmRUbzoiYm9keSIsYXV0b1JlZnJlc2g6ITAsZGlzdGFuY2U6MCxmaWx0ZXI6IioiLHRvbGVyYW5jZToidG91Y2gifSxfY3JlYXRlOmZ1bmN0aW9uKCl7dmFyIGI9dGhpczt0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLXNlbGVjdGFibGUiKSx0aGlzLmRyYWdnZWQ9ITE7dmFyIGM7dGhpcy5yZWZyZXNoPWZ1bmN0aW9uKCl7Yz1hKGIub3B0aW9ucy5maWx0ZXIsYi5lbGVtZW50WzBdKSxjLmFkZENsYXNzKCJ1aS1zZWxlY3RlZSIpLGMuZWFjaChmdW5jdGlvbigpe3ZhciBiPWEodGhpcyksYz1iLm9mZnNldCgpO2EuZGF0YSh0aGlzLCJzZWxlY3RhYmxlLWl0ZW0iLHtlbGVtZW50OnRoaXMsJGVsZW1lbnQ6YixsZWZ0OmMubGVmdCx0b3A6Yy50b3AscmlnaHQ6Yy5sZWZ0K2Iub3V0ZXJXaWR0aCgpLGJvdHRvbTpjLnRvcCtiLm91dGVySGVpZ2h0KCksc3RhcnRzZWxlY3RlZDohMSxzZWxlY3RlZDpiLmhhc0NsYXNzKCJ1aS1zZWxlY3RlZCIpLHNlbGVjdGluZzpiLmhhc0NsYXNzKCJ1aS1zZWxlY3RpbmciKSx1bnNlbGVjdGluZzpiLmhhc0NsYXNzKCJ1aS11bnNlbGVjdGluZyIpfSl9KX0sdGhpcy5yZWZyZXNoKCksdGhpcy5zZWxlY3RlZXM9Yy5hZGRDbGFzcygidWktc2VsZWN0ZWUiKSx0aGlzLl9tb3VzZUluaXQoKSx0aGlzLmhlbHBlcj1hKCI8ZGl2IGNsYXNzPSd1aS1zZWxlY3RhYmxlLWhlbHBlcic+PC9kaXY+Iil9LGRlc3Ryb3k6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zZWxlY3RlZXMucmVtb3ZlQ2xhc3MoInVpLXNlbGVjdGVlIikucmVtb3ZlRGF0YSgic2VsZWN0YWJsZS1pdGVtIiksdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1zZWxlY3RhYmxlIHVpLXNlbGVjdGFibGUtZGlzYWJsZWQiKS5yZW1vdmVEYXRhKCJzZWxlY3RhYmxlIikudW5iaW5kKCIuc2VsZWN0YWJsZSIpLHRoaXMuX21vdXNlRGVzdHJveSgpLHRoaXN9LF9tb3VzZVN0YXJ0OmZ1bmN0aW9uKGIpe3ZhciBjPXRoaXM7dGhpcy5vcG9zPVtiLnBhZ2VYLGIucGFnZVldO2lmKHRoaXMub3B0aW9ucy5kaXNhYmxlZClyZXR1cm47dmFyIGQ9dGhpcy5vcHRpb25zO3RoaXMuc2VsZWN0ZWVzPWEoZC5maWx0ZXIsdGhpcy5lbGVtZW50WzBdKSx0aGlzLl90cmlnZ2VyKCJzdGFydCIsYiksYShkLmFwcGVuZFRvKS5hcHBlbmQodGhpcy5oZWxwZXIpLHRoaXMuaGVscGVyLmNzcyh7bGVmdDpiLmNsaWVudFgsdG9wOmIuY2xpZW50WSx3aWR0aDowLGhlaWdodDowfSksZC5hdXRvUmVmcmVzaCYmdGhpcy5yZWZyZXNoKCksdGhpcy5zZWxlY3RlZXMuZmlsdGVyKCIudWktc2VsZWN0ZWQiKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YS5kYXRhKHRoaXMsInNlbGVjdGFibGUtaXRlbSIpO2Quc3RhcnRzZWxlY3RlZD0hMCwhYi5tZXRhS2V5JiYhYi5jdHJsS2V5JiYoZC4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2VsZWN0ZWQiKSxkLnNlbGVjdGVkPSExLGQuJGVsZW1lbnQuYWRkQ2xhc3MoInVpLXVuc2VsZWN0aW5nIiksZC51bnNlbGVjdGluZz0hMCxjLl90cmlnZ2VyKCJ1bnNlbGVjdGluZyIsYix7dW5zZWxlY3Rpbmc6ZC5lbGVtZW50fSkpfSksYShiLnRhcmdldCkucGFyZW50cygpLmFuZFNlbGYoKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YS5kYXRhKHRoaXMsInNlbGVjdGFibGUtaXRlbSIpO2lmKGQpe3ZhciBlPSFiLm1ldGFLZXkmJiFiLmN0cmxLZXl8fCFkLiRlbGVtZW50Lmhhc0NsYXNzKCJ1aS1zZWxlY3RlZCIpO3JldHVybiBkLiRlbGVtZW50LnJlbW92ZUNsYXNzKGU/InVpLXVuc2VsZWN0aW5nIjoidWktc2VsZWN0ZWQiKS5hZGRDbGFzcyhlPyJ1aS1zZWxlY3RpbmciOiJ1aS11bnNlbGVjdGluZyIpLGQudW5zZWxlY3Rpbmc9IWUsZC5zZWxlY3Rpbmc9ZSxkLnNlbGVjdGVkPWUsZT9jLl90cmlnZ2VyKCJzZWxlY3RpbmciLGIse3NlbGVjdGluZzpkLmVsZW1lbnR9KTpjLl90cmlnZ2VyKCJ1bnNlbGVjdGluZyIsYix7dW5zZWxlY3Rpbmc6ZC5lbGVtZW50fSksITF9fSl9LF9tb3VzZURyYWc6ZnVuY3Rpb24oYil7dmFyIGM9dGhpczt0aGlzLmRyYWdnZWQ9ITA7aWYodGhpcy5vcHRpb25zLmRpc2FibGVkKXJldHVybjt2YXIgZD10aGlzLm9wdGlvbnMsZT10aGlzLm9wb3NbMF0sZj10aGlzLm9wb3NbMV0sZz1iLnBhZ2VYLGg9Yi5wYWdlWTtpZihlPmcpe3ZhciBpPWc7Zz1lLGU9aX1pZihmPmgpe3ZhciBpPWg7aD1mLGY9aX1yZXR1cm4gdGhpcy5oZWxwZXIuY3NzKHtsZWZ0OmUsdG9wOmYsd2lkdGg6Zy1lLGhlaWdodDpoLWZ9KSx0aGlzLnNlbGVjdGVlcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGk9YS5kYXRhKHRoaXMsInNlbGVjdGFibGUtaXRlbSIpO2lmKCFpfHxpLmVsZW1lbnQ9PWMuZWxlbWVudFswXSlyZXR1cm47dmFyIGo9ITE7ZC50b2xlcmFuY2U9PSJ0b3VjaCI/aj0hKGkubGVmdD5nfHxpLnJpZ2h0PGV8fGkudG9wPmh8fGkuYm90dG9tPGYpOmQudG9sZXJhbmNlPT0iZml0IiYmKGo9aS5sZWZ0PmUmJmkucmlnaHQ8ZyYmaS50b3A+ZiYmaS5ib3R0b208aCksaj8oaS5zZWxlY3RlZCYmKGkuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXNlbGVjdGVkIiksaS5zZWxlY3RlZD0hMSksaS51bnNlbGVjdGluZyYmKGkuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXVuc2VsZWN0aW5nIiksaS51bnNlbGVjdGluZz0hMSksaS5zZWxlY3Rpbmd8fChpLiRlbGVtZW50LmFkZENsYXNzKCJ1aS1zZWxlY3RpbmciKSxpLnNlbGVjdGluZz0hMCxjLl90cmlnZ2VyKCJzZWxlY3RpbmciLGIse3NlbGVjdGluZzppLmVsZW1lbnR9KSkpOihpLnNlbGVjdGluZyYmKChiLm1ldGFLZXl8fGIuY3RybEtleSkmJmkuc3RhcnRzZWxlY3RlZD8oaS4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2VsZWN0aW5nIiksaS5zZWxlY3Rpbmc9ITEsaS4kZWxlbWVudC5hZGRDbGFzcygidWktc2VsZWN0ZWQiKSxpLnNlbGVjdGVkPSEwKTooaS4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2VsZWN0aW5nIiksaS5zZWxlY3Rpbmc9ITEsaS5zdGFydHNlbGVjdGVkJiYoaS4kZWxlbWVudC5hZGRDbGFzcygidWktdW5zZWxlY3RpbmciKSxpLnVuc2VsZWN0aW5nPSEwKSxjLl90cmlnZ2VyKCJ1bnNlbGVjdGluZyIsYix7dW5zZWxlY3Rpbmc6aS5lbGVtZW50fSkpKSxpLnNlbGVjdGVkJiYhYi5tZXRhS2V5JiYhYi5jdHJsS2V5JiYhaS5zdGFydHNlbGVjdGVkJiYoaS4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2VsZWN0ZWQiKSxpLnNlbGVjdGVkPSExLGkuJGVsZW1lbnQuYWRkQ2xhc3MoInVpLXVuc2VsZWN0aW5nIiksaS51bnNlbGVjdGluZz0hMCxjLl90cmlnZ2VyKCJ1bnNlbGVjdGluZyIsYix7dW5zZWxlY3Rpbmc6aS5lbGVtZW50fSkpKX0pLCExfSxfbW91c2VTdG9wOmZ1bmN0aW9uKGIpe3ZhciBjPXRoaXM7dGhpcy5kcmFnZ2VkPSExO3ZhciBkPXRoaXMub3B0aW9ucztyZXR1cm4gYSgiLnVpLXVuc2VsZWN0aW5nIix0aGlzLmVsZW1lbnRbMF0pLmVhY2goZnVuY3Rpb24oKXt2YXIgZD1hLmRhdGEodGhpcywic2VsZWN0YWJsZS1pdGVtIik7ZC4kZWxlbWVudC5yZW1vdmVDbGFzcygidWktdW5zZWxlY3RpbmciKSxkLnVuc2VsZWN0aW5nPSExLGQuc3RhcnRzZWxlY3RlZD0hMSxjLl90cmlnZ2VyKCJ1bnNlbGVjdGVkIixiLHt1bnNlbGVjdGVkOmQuZWxlbWVudH0pfSksYSgiLnVpLXNlbGVjdGluZyIsdGhpcy5lbGVtZW50WzBdKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGQ9YS5kYXRhKHRoaXMsInNlbGVjdGFibGUtaXRlbSIpO2QuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXNlbGVjdGluZyIpLmFkZENsYXNzKCJ1aS1zZWxlY3RlZCIpLGQuc2VsZWN0aW5nPSExLGQuc2VsZWN0ZWQ9ITAsZC5zdGFydHNlbGVjdGVkPSEwLGMuX3RyaWdnZXIoInNlbGVjdGVkIixiLHtzZWxlY3RlZDpkLmVsZW1lbnR9KX0pLHRoaXMuX3RyaWdnZXIoInN0b3AiLGIpLHRoaXMuaGVscGVyLnJlbW92ZSgpLCExfX0pLGEuZXh0ZW5kKGEudWkuc2VsZWN0YWJsZSx7dmVyc2lvbjoiMS44LjIwIn0pfSkoalF1ZXJ5KTs7LyohIGpRdWVyeSBVSSAtIHYxLjguMjAgLSAyMDEyLTA0LTMwCiogaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkKKiBJbmNsdWRlczoganF1ZXJ5LnVpLnNvcnRhYmxlLmpzCiogQ29weXJpZ2h0IChjKSAyMDEyIEFVVEhPUlMudHh0OyBMaWNlbnNlZCBNSVQsIEdQTCAqLwooZnVuY3Rpb24oYSxiKXthLndpZGdldCgidWkuc29ydGFibGUiLGEudWkubW91c2Use3dpZGdldEV2ZW50UHJlZml4OiJzb3J0IixyZWFkeTohMSxvcHRpb25zOnthcHBlbmRUbzoicGFyZW50IixheGlzOiExLGNvbm5lY3RXaXRoOiExLGNvbnRhaW5tZW50OiExLGN1cnNvcjoiYXV0byIsY3Vyc29yQXQ6ITEsZHJvcE9uRW1wdHk6ITAsZm9yY2VQbGFjZWhvbGRlclNpemU6ITEsZm9yY2VIZWxwZXJTaXplOiExLGdyaWQ6ITEsaGFuZGxlOiExLGhlbHBlcjoib3JpZ2luYWwiLGl0ZW1zOiI+ICoiLG9wYWNpdHk6ITEscGxhY2Vob2xkZXI6ITEscmV2ZXJ0OiExLHNjcm9sbDohMCxzY3JvbGxTZW5zaXRpdml0eToyMCxzY3JvbGxTcGVlZDoyMCxzY29wZToiZGVmYXVsdCIsdG9sZXJhbmNlOiJpbnRlcnNlY3QiLHpJbmRleDoxZTN9LF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnM7dGhpcy5jb250YWluZXJDYWNoZT17fSx0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLXNvcnRhYmxlIiksdGhpcy5yZWZyZXNoKCksdGhpcy5mbG9hdGluZz10aGlzLml0ZW1zLmxlbmd0aD9hLmF4aXM9PT0ieCJ8fC9sZWZ0fHJpZ2h0Ly50ZXN0KHRoaXMuaXRlbXNbMF0uaXRlbS5jc3MoImZsb2F0IikpfHwvaW5saW5lfHRhYmxlLWNlbGwvLnRlc3QodGhpcy5pdGVtc1swXS5pdGVtLmNzcygiZGlzcGxheSIpKTohMSx0aGlzLm9mZnNldD10aGlzLmVsZW1lbnQub2Zmc2V0KCksdGhpcy5fbW91c2VJbml0KCksdGhpcy5yZWFkeT0hMH0sZGVzdHJveTpmdW5jdGlvbigpe2EuV2lkZ2V0LnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcyksdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1zb3J0YWJsZSB1aS1zb3J0YWJsZS1kaXNhYmxlZCIpLHRoaXMuX21vdXNlRGVzdHJveSgpO2Zvcih2YXIgYj10aGlzLml0ZW1zLmxlbmd0aC0xO2I+PTA7Yi0tKXRoaXMuaXRlbXNbYl0uaXRlbS5yZW1vdmVEYXRhKHRoaXMud2lkZ2V0TmFtZSsiLWl0ZW0iKTtyZXR1cm4gdGhpc30sX3NldE9wdGlvbjpmdW5jdGlvbihiLGMpe2I9PT0iZGlzYWJsZWQiPyh0aGlzLm9wdGlvbnNbYl09Yyx0aGlzLndpZGdldCgpW2M/ImFkZENsYXNzIjoicmVtb3ZlQ2xhc3MiXSgidWktc29ydGFibGUtZGlzYWJsZWQiKSk6YS5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpfSxfbW91c2VDYXB0dXJlOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9dGhpcztpZih0aGlzLnJldmVydGluZylyZXR1cm4hMTtpZih0aGlzLm9wdGlvbnMuZGlzYWJsZWR8fHRoaXMub3B0aW9ucy50eXBlPT0ic3RhdGljIilyZXR1cm4hMTt0aGlzLl9yZWZyZXNoSXRlbXMoYik7dmFyIGU9bnVsbCxmPXRoaXMsZz1hKGIudGFyZ2V0KS5wYXJlbnRzKCkuZWFjaChmdW5jdGlvbigpe2lmKGEuZGF0YSh0aGlzLGQud2lkZ2V0TmFtZSsiLWl0ZW0iKT09ZilyZXR1cm4gZT1hKHRoaXMpLCExfSk7YS5kYXRhKGIudGFyZ2V0LGQud2lkZ2V0TmFtZSsiLWl0ZW0iKT09ZiYmKGU9YShiLnRhcmdldCkpO2lmKCFlKXJldHVybiExO2lmKHRoaXMub3B0aW9ucy5oYW5kbGUmJiFjKXt2YXIgaD0hMTthKHRoaXMub3B0aW9ucy5oYW5kbGUsZSkuZmluZCgiKiIpLmFuZFNlbGYoKS5lYWNoKGZ1bmN0aW9uKCl7dGhpcz09Yi50YXJnZXQmJihoPSEwKX0pO2lmKCFoKXJldHVybiExfXJldHVybiB0aGlzLmN1cnJlbnRJdGVtPWUsdGhpcy5fcmVtb3ZlQ3VycmVudHNGcm9tSXRlbXMoKSwhMH0sX21vdXNlU3RhcnQ6ZnVuY3Rpb24oYixjLGQpe3ZhciBlPXRoaXMub3B0aW9ucyxmPXRoaXM7dGhpcy5jdXJyZW50Q29udGFpbmVyPXRoaXMsdGhpcy5yZWZyZXNoUG9zaXRpb25zKCksdGhpcy5oZWxwZXI9dGhpcy5fY3JlYXRlSGVscGVyKGIpLHRoaXMuX2NhY2hlSGVscGVyUHJvcG9ydGlvbnMoKSx0aGlzLl9jYWNoZU1hcmdpbnMoKSx0aGlzLnNjcm9sbFBhcmVudD10aGlzLmhlbHBlci5zY3JvbGxQYXJlbnQoKSx0aGlzLm9mZnNldD10aGlzLmN1cnJlbnRJdGVtLm9mZnNldCgpLHRoaXMub2Zmc2V0PXt0b3A6dGhpcy5vZmZzZXQudG9wLXRoaXMubWFyZ2lucy50b3AsbGVmdDp0aGlzLm9mZnNldC5sZWZ0LXRoaXMubWFyZ2lucy5sZWZ0fSx0aGlzLmhlbHBlci5jc3MoInBvc2l0aW9uIiwiYWJzb2x1dGUiKSx0aGlzLmNzc1Bvc2l0aW9uPXRoaXMuaGVscGVyLmNzcygicG9zaXRpb24iKSxhLmV4dGVuZCh0aGlzLm9mZnNldCx7Y2xpY2s6e2xlZnQ6Yi5wYWdlWC10aGlzLm9mZnNldC5sZWZ0LHRvcDpiLnBhZ2VZLXRoaXMub2Zmc2V0LnRvcH0scGFyZW50OnRoaXMuX2dldFBhcmVudE9mZnNldCgpLHJlbGF0aXZlOnRoaXMuX2dldFJlbGF0aXZlT2Zmc2V0KCl9KSx0aGlzLm9yaWdpbmFsUG9zaXRpb249dGhpcy5fZ2VuZXJhdGVQb3NpdGlvbihiKSx0aGlzLm9yaWdpbmFsUGFnZVg9Yi5wYWdlWCx0aGlzLm9yaWdpbmFsUGFnZVk9Yi5wYWdlWSxlLmN1cnNvckF0JiZ0aGlzLl9hZGp1c3RPZmZzZXRGcm9tSGVscGVyKGUuY3Vyc29yQXQpLHRoaXMuZG9tUG9zaXRpb249e3ByZXY6dGhpcy5jdXJyZW50SXRlbS5wcmV2KClbMF0scGFyZW50OnRoaXMuY3VycmVudEl0ZW0ucGFyZW50KClbMF19LHRoaXMuaGVscGVyWzBdIT10aGlzLmN1cnJlbnRJdGVtWzBdJiZ0aGlzLmN1cnJlbnRJdGVtLmhpZGUoKSx0aGlzLl9jcmVhdGVQbGFjZWhvbGRlcigpLGUuY29udGFpbm1lbnQmJnRoaXMuX3NldENvbnRhaW5tZW50KCksZS5jdXJzb3ImJihhKCJib2R5IikuY3NzKCJjdXJzb3IiKSYmKHRoaXMuX3N0b3JlZEN1cnNvcj1hKCJib2R5IikuY3NzKCJjdXJzb3IiKSksYSgiYm9keSIpLmNzcygiY3Vyc29yIixlLmN1cnNvcikpLGUub3BhY2l0eSYmKHRoaXMuaGVscGVyLmNzcygib3BhY2l0eSIpJiYodGhpcy5fc3RvcmVkT3BhY2l0eT10aGlzLmhlbHBlci5jc3MoIm9wYWNpdHkiKSksdGhpcy5oZWxwZXIuY3NzKCJvcGFjaXR5IixlLm9wYWNpdHkpKSxlLnpJbmRleCYmKHRoaXMuaGVscGVyLmNzcygiekluZGV4IikmJih0aGlzLl9zdG9yZWRaSW5kZXg9dGhpcy5oZWxwZXIuY3NzKCJ6SW5kZXgiKSksdGhpcy5oZWxwZXIuY3NzKCJ6SW5kZXgiLGUuekluZGV4KSksdGhpcy5zY3JvbGxQYXJlbnRbMF0hPWRvY3VtZW50JiZ0aGlzLnNjcm9sbFBhcmVudFswXS50YWdOYW1lIT0iSFRNTCImJih0aGlzLm92ZXJmbG93T2Zmc2V0PXRoaXMuc2Nyb2xsUGFyZW50Lm9mZnNldCgpKSx0aGlzLl90cmlnZ2VyKCJzdGFydCIsYix0aGlzLl91aUhhc2goKSksdGhpcy5fcHJlc2VydmVIZWxwZXJQcm9wb3J0aW9uc3x8dGhpcy5fY2FjaGVIZWxwZXJQcm9wb3J0aW9ucygpO2lmKCFkKWZvcih2YXIgZz10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7Zz49MDtnLS0pdGhpcy5jb250YWluZXJzW2ddLl90cmlnZ2VyKCJhY3RpdmF0ZSIsYixmLl91aUhhc2godGhpcykpO3JldHVybiBhLnVpLmRkbWFuYWdlciYmKGEudWkuZGRtYW5hZ2VyLmN1cnJlbnQ9dGhpcyksYS51aS5kZG1hbmFnZXImJiFlLmRyb3BCZWhhdmlvdXImJmEudWkuZGRtYW5hZ2VyLnByZXBhcmVPZmZzZXRzKHRoaXMsYiksdGhpcy5kcmFnZ2luZz0hMCx0aGlzLmhlbHBlci5hZGRDbGFzcygidWktc29ydGFibGUtaGVscGVyIiksdGhpcy5fbW91c2VEcmFnKGIpLCEwfSxfbW91c2VEcmFnOmZ1bmN0aW9uKGIpe3RoaXMucG9zaXRpb249dGhpcy5fZ2VuZXJhdGVQb3NpdGlvbihiKSx0aGlzLnBvc2l0aW9uQWJzPXRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKCJhYnNvbHV0ZSIpLHRoaXMubGFzdFBvc2l0aW9uQWJzfHwodGhpcy5sYXN0UG9zaXRpb25BYnM9dGhpcy5wb3NpdGlvbkFicyk7aWYodGhpcy5vcHRpb25zLnNjcm9sbCl7dmFyIGM9dGhpcy5vcHRpb25zLGQ9ITE7dGhpcy5zY3JvbGxQYXJlbnRbMF0hPWRvY3VtZW50JiZ0aGlzLnNjcm9sbFBhcmVudFswXS50YWdOYW1lIT0iSFRNTCI/KHRoaXMub3ZlcmZsb3dPZmZzZXQudG9wK3RoaXMuc2Nyb2xsUGFyZW50WzBdLm9mZnNldEhlaWdodC1iLnBhZ2VZPGMuc2Nyb2xsU2Vuc2l0aXZpdHk/dGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wPWQ9dGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wK2Muc2Nyb2xsU3BlZWQ6Yi5wYWdlWS10aGlzLm92ZXJmbG93T2Zmc2V0LnRvcDxjLnNjcm9sbFNlbnNpdGl2aXR5JiYodGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wPWQ9dGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsVG9wLWMuc2Nyb2xsU3BlZWQpLHRoaXMub3ZlcmZsb3dPZmZzZXQubGVmdCt0aGlzLnNjcm9sbFBhcmVudFswXS5vZmZzZXRXaWR0aC1iLnBhZ2VYPGMuc2Nyb2xsU2Vuc2l0aXZpdHk/dGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1kPXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQrYy5zY3JvbGxTcGVlZDpiLnBhZ2VYLXRoaXMub3ZlcmZsb3dPZmZzZXQubGVmdDxjLnNjcm9sbFNlbnNpdGl2aXR5JiYodGhpcy5zY3JvbGxQYXJlbnRbMF0uc2Nyb2xsTGVmdD1kPXRoaXMuc2Nyb2xsUGFyZW50WzBdLnNjcm9sbExlZnQtYy5zY3JvbGxTcGVlZCkpOihiLnBhZ2VZLWEoZG9jdW1lbnQpLnNjcm9sbFRvcCgpPGMuc2Nyb2xsU2Vuc2l0aXZpdHk/ZD1hKGRvY3VtZW50KS5zY3JvbGxUb3AoYShkb2N1bWVudCkuc2Nyb2xsVG9wKCktYy5zY3JvbGxTcGVlZCk6YSh3aW5kb3cpLmhlaWdodCgpLShiLnBhZ2VZLWEoZG9jdW1lbnQpLnNjcm9sbFRvcCgpKTxjLnNjcm9sbFNlbnNpdGl2aXR5JiYoZD1hKGRvY3VtZW50KS5zY3JvbGxUb3AoYShkb2N1bWVudCkuc2Nyb2xsVG9wKCkrYy5zY3JvbGxTcGVlZCkpLGIucGFnZVgtYShkb2N1bWVudCkuc2Nyb2xsTGVmdCgpPGMuc2Nyb2xsU2Vuc2l0aXZpdHk/ZD1hKGRvY3VtZW50KS5zY3JvbGxMZWZ0KGEoZG9jdW1lbnQpLnNjcm9sbExlZnQoKS1jLnNjcm9sbFNwZWVkKTphKHdpbmRvdykud2lkdGgoKS0oYi5wYWdlWC1hKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkpPGMuc2Nyb2xsU2Vuc2l0aXZpdHkmJihkPWEoZG9jdW1lbnQpLnNjcm9sbExlZnQoYShkb2N1bWVudCkuc2Nyb2xsTGVmdCgpK2Muc2Nyb2xsU3BlZWQpKSksZCE9PSExJiZhLnVpLmRkbWFuYWdlciYmIWMuZHJvcEJlaGF2aW91ciYmYS51aS5kZG1hbmFnZXIucHJlcGFyZU9mZnNldHModGhpcyxiKX10aGlzLnBvc2l0aW9uQWJzPXRoaXMuX2NvbnZlcnRQb3NpdGlvblRvKCJhYnNvbHV0ZSIpO2lmKCF0aGlzLm9wdGlvbnMuYXhpc3x8dGhpcy5vcHRpb25zLmF4aXMhPSJ5Iil0aGlzLmhlbHBlclswXS5zdHlsZS5sZWZ0PXRoaXMucG9zaXRpb24ubGVmdCsicHgiO2lmKCF0aGlzLm9wdGlvbnMuYXhpc3x8dGhpcy5vcHRpb25zLmF4aXMhPSJ4Iil0aGlzLmhlbHBlclswXS5zdHlsZS50b3A9dGhpcy5wb3NpdGlvbi50b3ArInB4Ijtmb3IodmFyIGU9dGhpcy5pdGVtcy5sZW5ndGgtMTtlPj0wO2UtLSl7dmFyIGY9dGhpcy5pdGVtc1tlXSxnPWYuaXRlbVswXSxoPXRoaXMuX2ludGVyc2VjdHNXaXRoUG9pbnRlcihmKTtpZighaCljb250aW51ZTtpZihnIT10aGlzLmN1cnJlbnRJdGVtWzBdJiZ0aGlzLnBsYWNlaG9sZGVyW2g9PTE/Im5leHQiOiJwcmV2Il0oKVswXSE9ZyYmIWEudWkuY29udGFpbnModGhpcy5wbGFjZWhvbGRlclswXSxnKSYmKHRoaXMub3B0aW9ucy50eXBlPT0ic2VtaS1keW5hbWljIj8hYS51aS5jb250YWlucyh0aGlzLmVsZW1lbnRbMF0sZyk6ITApKXt0aGlzLmRpcmVjdGlvbj1oPT0xPyJkb3duIjoidXAiO2lmKHRoaXMub3B0aW9ucy50b2xlcmFuY2U9PSJwb2ludGVyInx8dGhpcy5faW50ZXJzZWN0c1dpdGhTaWRlcyhmKSl0aGlzLl9yZWFycmFuZ2UoYixmKTtlbHNlIGJyZWFrO3RoaXMuX3RyaWdnZXIoImNoYW5nZSIsYix0aGlzLl91aUhhc2goKSk7YnJlYWt9fXJldHVybiB0aGlzLl9jb250YWN0Q29udGFpbmVycyhiKSxhLnVpLmRkbWFuYWdlciYmYS51aS5kZG1hbmFnZXIuZHJhZyh0aGlzLGIpLHRoaXMuX3RyaWdnZXIoInNvcnQiLGIsdGhpcy5fdWlIYXNoKCkpLHRoaXMubGFzdFBvc2l0aW9uQWJzPXRoaXMucG9zaXRpb25BYnMsITF9LF9tb3VzZVN0b3A6ZnVuY3Rpb24oYixjKXtpZighYilyZXR1cm47YS51aS5kZG1hbmFnZXImJiF0aGlzLm9wdGlvbnMuZHJvcEJlaGF2aW91ciYmYS51aS5kZG1hbmFnZXIuZHJvcCh0aGlzLGIpO2lmKHRoaXMub3B0aW9ucy5yZXZlcnQpe3ZhciBkPXRoaXMsZT1kLnBsYWNlaG9sZGVyLm9mZnNldCgpO2QucmV2ZXJ0aW5nPSEwLGEodGhpcy5oZWxwZXIpLmFuaW1hdGUoe2xlZnQ6ZS5sZWZ0LXRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0LWQubWFyZ2lucy5sZWZ0Kyh0aGlzLm9mZnNldFBhcmVudFswXT09ZG9jdW1lbnQuYm9keT8wOnRoaXMub2Zmc2V0UGFyZW50WzBdLnNjcm9sbExlZnQpLHRvcDplLnRvcC10aGlzLm9mZnNldC5wYXJlbnQudG9wLWQubWFyZ2lucy50b3ArKHRoaXMub2Zmc2V0UGFyZW50WzBdPT1kb2N1bWVudC5ib2R5PzA6dGhpcy5vZmZzZXRQYXJlbnRbMF0uc2Nyb2xsVG9wKX0scGFyc2VJbnQodGhpcy5vcHRpb25zLnJldmVydCwxMCl8fDUwMCxmdW5jdGlvbigpe2QuX2NsZWFyKGIpfSl9ZWxzZSB0aGlzLl9jbGVhcihiLGMpO3JldHVybiExfSxjYW5jZWw6ZnVuY3Rpb24oKXt2YXIgYj10aGlzO2lmKHRoaXMuZHJhZ2dpbmcpe3RoaXMuX21vdXNlVXAoe3RhcmdldDpudWxsfSksdGhpcy5vcHRpb25zLmhlbHBlcj09Im9yaWdpbmFsIj90aGlzLmN1cnJlbnRJdGVtLmNzcyh0aGlzLl9zdG9yZWRDU1MpLnJlbW92ZUNsYXNzKCJ1aS1zb3J0YWJsZS1oZWxwZXIiKTp0aGlzLmN1cnJlbnRJdGVtLnNob3coKTtmb3IodmFyIGM9dGhpcy5jb250YWluZXJzLmxlbmd0aC0xO2M+PTA7Yy0tKXRoaXMuY29udGFpbmVyc1tjXS5fdHJpZ2dlcigiZGVhY3RpdmF0ZSIsbnVsbCxiLl91aUhhc2godGhpcykpLHRoaXMuY29udGFpbmVyc1tjXS5jb250YWluZXJDYWNoZS5vdmVyJiYodGhpcy5jb250YWluZXJzW2NdLl90cmlnZ2VyKCJvdXQiLG51bGwsYi5fdWlIYXNoKHRoaXMpKSx0aGlzLmNvbnRhaW5lcnNbY10uY29udGFpbmVyQ2FjaGUub3Zlcj0wKX1yZXR1cm4gdGhpcy5wbGFjZWhvbGRlciYmKHRoaXMucGxhY2Vob2xkZXJbMF0ucGFyZW50Tm9kZSYmdGhpcy5wbGFjZWhvbGRlclswXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMucGxhY2Vob2xkZXJbMF0pLHRoaXMub3B0aW9ucy5oZWxwZXIhPSJvcmlnaW5hbCImJnRoaXMuaGVscGVyJiZ0aGlzLmhlbHBlclswXS5wYXJlbnROb2RlJiZ0aGlzLmhlbHBlci5yZW1vdmUoKSxhLmV4dGVuZCh0aGlzLHtoZWxwZXI6bnVsbCxkcmFnZ2luZzohMSxyZXZlcnRpbmc6ITEsX25vRmluYWxTb3J0Om51bGx9KSx0aGlzLmRvbVBvc2l0aW9uLnByZXY/YSh0aGlzLmRvbVBvc2l0aW9uLnByZXYpLmFmdGVyKHRoaXMuY3VycmVudEl0ZW0pOmEodGhpcy5kb21Qb3NpdGlvbi5wYXJlbnQpLnByZXBlbmQodGhpcy5jdXJyZW50SXRlbSkpLHRoaXN9LHNlcmlhbGl6ZTpmdW5jdGlvbihiKXt2YXIgYz10aGlzLl9nZXRJdGVtc0FzalF1ZXJ5KGImJmIuY29ubmVjdGVkKSxkPVtdO3JldHVybiBiPWJ8fHt9LGEoYykuZWFjaChmdW5jdGlvbigpe3ZhciBjPShhKGIuaXRlbXx8dGhpcykuYXR0cihiLmF0dHJpYnV0ZXx8ImlkIil8fCIiKS5tYXRjaChiLmV4cHJlc3Npb258fC8oLispWy09X10oLispLyk7YyYmZC5wdXNoKChiLmtleXx8Y1sxXSsiW10iKSsiPSIrKGIua2V5JiZiLmV4cHJlc3Npb24/Y1sxXTpjWzJdKSl9KSwhZC5sZW5ndGgmJmIua2V5JiZkLnB1c2goYi5rZXkrIj0iKSxkLmpvaW4oIiYiKX0sdG9BcnJheTpmdW5jdGlvbihiKXt2YXIgYz10aGlzLl9nZXRJdGVtc0FzalF1ZXJ5KGImJmIuY29ubmVjdGVkKSxkPVtdO3JldHVybiBiPWJ8fHt9LGMuZWFjaChmdW5jdGlvbigpe2QucHVzaChhKGIuaXRlbXx8dGhpcykuYXR0cihiLmF0dHJpYnV0ZXx8ImlkIil8fCIiKX0pLGR9LF9pbnRlcnNlY3RzV2l0aDpmdW5jdGlvbihhKXt2YXIgYj10aGlzLnBvc2l0aW9uQWJzLmxlZnQsYz1iK3RoaXMuaGVscGVyUHJvcG9ydGlvbnMud2lkdGgsZD10aGlzLnBvc2l0aW9uQWJzLnRvcCxlPWQrdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQsZj1hLmxlZnQsZz1mK2Eud2lkdGgsaD1hLnRvcCxpPWgrYS5oZWlnaHQsaj10aGlzLm9mZnNldC5jbGljay50b3Asaz10aGlzLm9mZnNldC5jbGljay5sZWZ0LGw9ZCtqPmgmJmQrajxpJiZiK2s+ZiYmYitrPGc7cmV0dXJuIHRoaXMub3B0aW9ucy50b2xlcmFuY2U9PSJwb2ludGVyInx8dGhpcy5vcHRpb25zLmZvcmNlUG9pbnRlckZvckNvbnRhaW5lcnN8fHRoaXMub3B0aW9ucy50b2xlcmFuY2UhPSJwb2ludGVyIiYmdGhpcy5oZWxwZXJQcm9wb3J0aW9uc1t0aGlzLmZsb2F0aW5nPyJ3aWR0aCI6ImhlaWdodCJdPmFbdGhpcy5mbG9hdGluZz8id2lkdGgiOiJoZWlnaHQiXT9sOmY8Yit0aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLzImJmMtdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC8yPGcmJmg8ZCt0aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC8yJiZlLXRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LzI8aX0sX2ludGVyc2VjdHNXaXRoUG9pbnRlcjpmdW5jdGlvbihiKXt2YXIgYz10aGlzLm9wdGlvbnMuYXhpcz09PSJ4Inx8YS51aS5pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMudG9wK3RoaXMub2Zmc2V0LmNsaWNrLnRvcCxiLnRvcCxiLmhlaWdodCksZD10aGlzLm9wdGlvbnMuYXhpcz09PSJ5Inx8YS51aS5pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMubGVmdCt0aGlzLm9mZnNldC5jbGljay5sZWZ0LGIubGVmdCxiLndpZHRoKSxlPWMmJmQsZj10aGlzLl9nZXREcmFnVmVydGljYWxEaXJlY3Rpb24oKSxnPXRoaXMuX2dldERyYWdIb3Jpem9udGFsRGlyZWN0aW9uKCk7cmV0dXJuIGU/dGhpcy5mbG9hdGluZz9nJiZnPT0icmlnaHQifHxmPT0iZG93biI/MjoxOmYmJihmPT0iZG93biI/MjoxKTohMX0sX2ludGVyc2VjdHNXaXRoU2lkZXM6ZnVuY3Rpb24oYil7dmFyIGM9YS51aS5pc092ZXJBeGlzKHRoaXMucG9zaXRpb25BYnMudG9wK3RoaXMub2Zmc2V0LmNsaWNrLnRvcCxiLnRvcCtiLmhlaWdodC8yLGIuaGVpZ2h0KSxkPWEudWkuaXNPdmVyQXhpcyh0aGlzLnBvc2l0aW9uQWJzLmxlZnQrdGhpcy5vZmZzZXQuY2xpY2subGVmdCxiLmxlZnQrYi53aWR0aC8yLGIud2lkdGgpLGU9dGhpcy5fZ2V0RHJhZ1ZlcnRpY2FsRGlyZWN0aW9uKCksZj10aGlzLl9nZXREcmFnSG9yaXpvbnRhbERpcmVjdGlvbigpO3JldHVybiB0aGlzLmZsb2F0aW5nJiZmP2Y9PSJyaWdodCImJmR8fGY9PSJsZWZ0IiYmIWQ6ZSYmKGU9PSJkb3duIiYmY3x8ZT09InVwIiYmIWMpfSxfZ2V0RHJhZ1ZlcnRpY2FsRGlyZWN0aW9uOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5wb3NpdGlvbkFicy50b3AtdGhpcy5sYXN0UG9zaXRpb25BYnMudG9wO3JldHVybiBhIT0wJiYoYT4wPyJkb3duIjoidXAiKX0sX2dldERyYWdIb3Jpem9udGFsRGlyZWN0aW9uOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5wb3NpdGlvbkFicy5sZWZ0LXRoaXMubGFzdFBvc2l0aW9uQWJzLmxlZnQ7cmV0dXJuIGEhPTAmJihhPjA/InJpZ2h0IjoibGVmdCIpfSxyZWZyZXNoOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLl9yZWZyZXNoSXRlbXMoYSksdGhpcy5yZWZyZXNoUG9zaXRpb25zKCksdGhpc30sX2Nvbm5lY3RXaXRoOmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5vcHRpb25zO3JldHVybiBhLmNvbm5lY3RXaXRoLmNvbnN0cnVjdG9yPT1TdHJpbmc/W2EuY29ubmVjdFdpdGhdOmEuY29ubmVjdFdpdGh9LF9nZXRJdGVtc0FzalF1ZXJ5OmZ1bmN0aW9uKGIpe3ZhciBjPXRoaXMsZD1bXSxlPVtdLGY9dGhpcy5fY29ubmVjdFdpdGgoKTtpZihmJiZiKWZvcih2YXIgZz1mLmxlbmd0aC0xO2c+PTA7Zy0tKXt2YXIgaD1hKGZbZ10pO2Zvcih2YXIgaT1oLmxlbmd0aC0xO2k+PTA7aS0tKXt2YXIgaj1hLmRhdGEoaFtpXSx0aGlzLndpZGdldE5hbWUpO2omJmohPXRoaXMmJiFqLm9wdGlvbnMuZGlzYWJsZWQmJmUucHVzaChbYS5pc0Z1bmN0aW9uKGoub3B0aW9ucy5pdGVtcyk/ai5vcHRpb25zLml0ZW1zLmNhbGwoai5lbGVtZW50KTphKGoub3B0aW9ucy5pdGVtcyxqLmVsZW1lbnQpLm5vdCgiLnVpLXNvcnRhYmxlLWhlbHBlciIpLm5vdCgiLnVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyIiksal0pfX1lLnB1c2goW2EuaXNGdW5jdGlvbih0aGlzLm9wdGlvbnMuaXRlbXMpP3RoaXMub3B0aW9ucy5pdGVtcy5jYWxsKHRoaXMuZWxlbWVudCxudWxsLHtvcHRpb25zOnRoaXMub3B0aW9ucyxpdGVtOnRoaXMuY3VycmVudEl0ZW19KTphKHRoaXMub3B0aW9ucy5pdGVtcyx0aGlzLmVsZW1lbnQpLm5vdCgiLnVpLXNvcnRhYmxlLWhlbHBlciIpLm5vdCgiLnVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyIiksdGhpc10pO2Zvcih2YXIgZz1lLmxlbmd0aC0xO2c+PTA7Zy0tKWVbZ11bMF0uZWFjaChmdW5jdGlvbigpe2QucHVzaCh0aGlzKX0pO3JldHVybiBhKGQpfSxfcmVtb3ZlQ3VycmVudHNGcm9tSXRlbXM6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmN1cnJlbnRJdGVtLmZpbmQoIjpkYXRhKCIrdGhpcy53aWRnZXROYW1lKyItaXRlbSkiKTtmb3IodmFyIGI9MDtiPHRoaXMuaXRlbXMubGVuZ3RoO2IrKylmb3IodmFyIGM9MDtjPGEubGVuZ3RoO2MrKylhW2NdPT10aGlzLml0ZW1zW2JdLml0ZW1bMF0mJnRoaXMuaXRlbXMuc3BsaWNlKGIsMSl9LF9yZWZyZXNoSXRlbXM6ZnVuY3Rpb24oYil7dGhpcy5pdGVtcz1bXSx0aGlzLmNvbnRhaW5lcnM9W3RoaXNdO3ZhciBjPXRoaXMuaXRlbXMsZD10aGlzLGU9W1thLmlzRnVuY3Rpb24odGhpcy5vcHRpb25zLml0ZW1zKT90aGlzLm9wdGlvbnMuaXRlbXMuY2FsbCh0aGlzLmVsZW1lbnRbMF0sYix7aXRlbTp0aGlzLmN1cnJlbnRJdGVtfSk6YSh0aGlzLm9wdGlvbnMuaXRlbXMsdGhpcy5lbGVtZW50KSx0aGlzXV0sZj10aGlzLl9jb25uZWN0V2l0aCgpO2lmKGYmJnRoaXMucmVhZHkpZm9yKHZhciBnPWYubGVuZ3RoLTE7Zz49MDtnLS0pe3ZhciBoPWEoZltnXSk7Zm9yKHZhciBpPWgubGVuZ3RoLTE7aT49MDtpLS0pe3ZhciBqPWEuZGF0YShoW2ldLHRoaXMud2lkZ2V0TmFtZSk7aiYmaiE9dGhpcyYmIWoub3B0aW9ucy5kaXNhYmxlZCYmKGUucHVzaChbYS5pc0Z1bmN0aW9uKGoub3B0aW9ucy5pdGVtcyk/ai5vcHRpb25zLml0ZW1zLmNhbGwoai5lbGVtZW50WzBdLGIse2l0ZW06dGhpcy5jdXJyZW50SXRlbX0pOmEoai5vcHRpb25zLml0ZW1zLGouZWxlbWVudCksal0pLHRoaXMuY29udGFpbmVycy5wdXNoKGopKX19Zm9yKHZhciBnPWUubGVuZ3RoLTE7Zz49MDtnLS0pe3ZhciBrPWVbZ11bMV0sbD1lW2ddWzBdO2Zvcih2YXIgaT0wLG09bC5sZW5ndGg7aTxtO2krKyl7dmFyIG49YShsW2ldKTtuLmRhdGEodGhpcy53aWRnZXROYW1lKyItaXRlbSIsayksYy5wdXNoKHtpdGVtOm4saW5zdGFuY2U6ayx3aWR0aDowLGhlaWdodDowLGxlZnQ6MCx0b3A6MH0pfX19LHJlZnJlc2hQb3NpdGlvbnM6ZnVuY3Rpb24oYil7dGhpcy5vZmZzZXRQYXJlbnQmJnRoaXMuaGVscGVyJiYodGhpcy5vZmZzZXQucGFyZW50PXRoaXMuX2dldFBhcmVudE9mZnNldCgpKTtmb3IodmFyIGM9dGhpcy5pdGVtcy5sZW5ndGgtMTtjPj0wO2MtLSl7dmFyIGQ9dGhpcy5pdGVtc1tjXTtpZihkLmluc3RhbmNlIT10aGlzLmN1cnJlbnRDb250YWluZXImJnRoaXMuY3VycmVudENvbnRhaW5lciYmZC5pdGVtWzBdIT10aGlzLmN1cnJlbnRJdGVtWzBdKWNvbnRpbnVlO3ZhciBlPXRoaXMub3B0aW9ucy50b2xlcmFuY2VFbGVtZW50P2EodGhpcy5vcHRpb25zLnRvbGVyYW5jZUVsZW1lbnQsZC5pdGVtKTpkLml0ZW07Ynx8KGQud2lkdGg9ZS5vdXRlcldpZHRoKCksZC5oZWlnaHQ9ZS5vdXRlckhlaWdodCgpKTt2YXIgZj1lLm9mZnNldCgpO2QubGVmdD1mLmxlZnQsZC50b3A9Zi50b3B9aWYodGhpcy5vcHRpb25zLmN1c3RvbSYmdGhpcy5vcHRpb25zLmN1c3RvbS5yZWZyZXNoQ29udGFpbmVycyl0aGlzLm9wdGlvbnMuY3VzdG9tLnJlZnJlc2hDb250YWluZXJzLmNhbGwodGhpcyk7ZWxzZSBmb3IodmFyIGM9dGhpcy5jb250YWluZXJzLmxlbmd0aC0xO2M+PTA7Yy0tKXt2YXIgZj10aGlzLmNvbnRhaW5lcnNbY10uZWxlbWVudC5vZmZzZXQoKTt0aGlzLmNvbnRhaW5lcnNbY10uY29udGFpbmVyQ2FjaGUubGVmdD1mLmxlZnQsdGhpcy5jb250YWluZXJzW2NdLmNvbnRhaW5lckNhY2hlLnRvcD1mLnRvcCx0aGlzLmNvbnRhaW5lcnNbY10uY29udGFpbmVyQ2FjaGUud2lkdGg9dGhpcy5jb250YWluZXJzW2NdLmVsZW1lbnQub3V0ZXJXaWR0aCgpLHRoaXMuY29udGFpbmVyc1tjXS5jb250YWluZXJDYWNoZS5oZWlnaHQ9dGhpcy5jb250YWluZXJzW2NdLmVsZW1lbnQub3V0ZXJIZWlnaHQoKX1yZXR1cm4gdGhpc30sX2NyZWF0ZVBsYWNlaG9sZGVyOmZ1bmN0aW9uKGIpe3ZhciBjPWJ8fHRoaXMsZD1jLm9wdGlvbnM7aWYoIWQucGxhY2Vob2xkZXJ8fGQucGxhY2Vob2xkZXIuY29uc3RydWN0b3I9PVN0cmluZyl7dmFyIGU9ZC5wbGFjZWhvbGRlcjtkLnBsYWNlaG9sZGVyPXtlbGVtZW50OmZ1bmN0aW9uKCl7dmFyIGI9YShkb2N1bWVudC5jcmVhdGVFbGVtZW50KGMuY3VycmVudEl0ZW1bMF0ubm9kZU5hbWUpKS5hZGRDbGFzcyhlfHxjLmN1cnJlbnRJdGVtWzBdLmNsYXNzTmFtZSsiIHVpLXNvcnRhYmxlLXBsYWNlaG9sZGVyIikucmVtb3ZlQ2xhc3MoInVpLXNvcnRhYmxlLWhlbHBlciIpWzBdO3JldHVybiBlfHwoYi5zdHlsZS52aXNpYmlsaXR5PSJoaWRkZW4iKSxifSx1cGRhdGU6ZnVuY3Rpb24oYSxiKXtpZihlJiYhZC5mb3JjZVBsYWNlaG9sZGVyU2l6ZSlyZXR1cm47Yi5oZWlnaHQoKXx8Yi5oZWlnaHQoYy5jdXJyZW50SXRlbS5pbm5lckhlaWdodCgpLXBhcnNlSW50KGMuY3VycmVudEl0ZW0uY3NzKCJwYWRkaW5nVG9wIil8fDAsMTApLXBhcnNlSW50KGMuY3VycmVudEl0ZW0uY3NzKCJwYWRkaW5nQm90dG9tIil8fDAsMTApKSxiLndpZHRoKCl8fGIud2lkdGgoYy5jdXJyZW50SXRlbS5pbm5lcldpZHRoKCktcGFyc2VJbnQoYy5jdXJyZW50SXRlbS5jc3MoInBhZGRpbmdMZWZ0Iil8fDAsMTApLXBhcnNlSW50KGMuY3VycmVudEl0ZW0uY3NzKCJwYWRkaW5nUmlnaHQiKXx8MCwxMCkpfX19Yy5wbGFjZWhvbGRlcj1hKGQucGxhY2Vob2xkZXIuZWxlbWVudC5jYWxsKGMuZWxlbWVudCxjLmN1cnJlbnRJdGVtKSksYy5jdXJyZW50SXRlbS5hZnRlcihjLnBsYWNlaG9sZGVyKSxkLnBsYWNlaG9sZGVyLnVwZGF0ZShjLGMucGxhY2Vob2xkZXIpfSxfY29udGFjdENvbnRhaW5lcnM6ZnVuY3Rpb24oYil7dmFyIGM9bnVsbCxkPW51bGw7Zm9yKHZhciBlPXRoaXMuY29udGFpbmVycy5sZW5ndGgtMTtlPj0wO2UtLSl7aWYoYS51aS5jb250YWlucyh0aGlzLmN1cnJlbnRJdGVtWzBdLHRoaXMuY29udGFpbmVyc1tlXS5lbGVtZW50WzBdKSljb250aW51ZTtpZih0aGlzLl9pbnRlcnNlY3RzV2l0aCh0aGlzLmNvbnRhaW5lcnNbZV0uY29udGFpbmVyQ2FjaGUpKXtpZihjJiZhLnVpLmNvbnRhaW5zKHRoaXMuY29udGFpbmVyc1tlXS5lbGVtZW50WzBdLGMuZWxlbWVudFswXSkpY29udGludWU7Yz10aGlzLmNvbnRhaW5lcnNbZV0sZD1lfWVsc2UgdGhpcy5jb250YWluZXJzW2VdLmNvbnRhaW5lckNhY2hlLm92ZXImJih0aGlzLmNvbnRhaW5lcnNbZV0uX3RyaWdnZXIoIm91dCIsYix0aGlzLl91aUhhc2godGhpcykpLHRoaXMuY29udGFpbmVyc1tlXS5jb250YWluZXJDYWNoZS5vdmVyPTApfWlmKCFjKXJldHVybjtpZih0aGlzLmNvbnRhaW5lcnMubGVuZ3RoPT09MSl0aGlzLmNvbnRhaW5lcnNbZF0uX3RyaWdnZXIoIm92ZXIiLGIsdGhpcy5fdWlIYXNoKHRoaXMpKSx0aGlzLmNvbnRhaW5lcnNbZF0uY29udGFpbmVyQ2FjaGUub3Zlcj0xO2Vsc2UgaWYodGhpcy5jdXJyZW50Q29udGFpbmVyIT10aGlzLmNvbnRhaW5lcnNbZF0pe3ZhciBmPTFlNCxnPW51bGwsaD10aGlzLnBvc2l0aW9uQWJzW3RoaXMuY29udGFpbmVyc1tkXS5mbG9hdGluZz8ibGVmdCI6InRvcCJdO2Zvcih2YXIgaT10aGlzLml0ZW1zLmxlbmd0aC0xO2k+PTA7aS0tKXtpZighYS51aS5jb250YWlucyh0aGlzLmNvbnRhaW5lcnNbZF0uZWxlbWVudFswXSx0aGlzLml0ZW1zW2ldLml0ZW1bMF0pKWNvbnRpbnVlO3ZhciBqPXRoaXMuaXRlbXNbaV1bdGhpcy5jb250YWluZXJzW2RdLmZsb2F0aW5nPyJsZWZ0IjoidG9wIl07TWF0aC5hYnMoai1oKTxmJiYoZj1NYXRoLmFicyhqLWgpLGc9dGhpcy5pdGVtc1tpXSl9aWYoIWcmJiF0aGlzLm9wdGlvbnMuZHJvcE9uRW1wdHkpcmV0dXJuO3RoaXMuY3VycmVudENvbnRhaW5lcj10aGlzLmNvbnRhaW5lcnNbZF0sZz90aGlzLl9yZWFycmFuZ2UoYixnLG51bGwsITApOnRoaXMuX3JlYXJyYW5nZShiLG51bGwsdGhpcy5jb250YWluZXJzW2RdLmVsZW1lbnQsITApLHRoaXMuX3RyaWdnZXIoImNoYW5nZSIsYix0aGlzLl91aUhhc2goKSksdGhpcy5jb250YWluZXJzW2RdLl90cmlnZ2VyKCJjaGFuZ2UiLGIsdGhpcy5fdWlIYXNoKHRoaXMpKSx0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIudXBkYXRlKHRoaXMuY3VycmVudENvbnRhaW5lcix0aGlzLnBsYWNlaG9sZGVyKSx0aGlzLmNvbnRhaW5lcnNbZF0uX3RyaWdnZXIoIm92ZXIiLGIsdGhpcy5fdWlIYXNoKHRoaXMpKSx0aGlzLmNvbnRhaW5lcnNbZF0uY29udGFpbmVyQ2FjaGUub3Zlcj0xfX0sX2NyZWF0ZUhlbHBlcjpmdW5jdGlvbihiKXt2YXIgYz10aGlzLm9wdGlvbnMsZD1hLmlzRnVuY3Rpb24oYy5oZWxwZXIpP2EoYy5oZWxwZXIuYXBwbHkodGhpcy5lbGVtZW50WzBdLFtiLHRoaXMuY3VycmVudEl0ZW1dKSk6Yy5oZWxwZXI9PSJjbG9uZSI/dGhpcy5jdXJyZW50SXRlbS5jbG9uZSgpOnRoaXMuY3VycmVudEl0ZW07cmV0dXJuIGQucGFyZW50cygiYm9keSIpLmxlbmd0aHx8YShjLmFwcGVuZFRvIT0icGFyZW50Ij9jLmFwcGVuZFRvOnRoaXMuY3VycmVudEl0ZW1bMF0ucGFyZW50Tm9kZSlbMF0uYXBwZW5kQ2hpbGQoZFswXSksZFswXT09dGhpcy5jdXJyZW50SXRlbVswXSYmKHRoaXMuX3N0b3JlZENTUz17d2lkdGg6dGhpcy5jdXJyZW50SXRlbVswXS5zdHlsZS53aWR0aCxoZWlnaHQ6dGhpcy5jdXJyZW50SXRlbVswXS5zdHlsZS5oZWlnaHQscG9zaXRpb246dGhpcy5jdXJyZW50SXRlbS5jc3MoInBvc2l0aW9uIiksdG9wOnRoaXMuY3VycmVudEl0ZW0uY3NzKCJ0b3AiKSxsZWZ0OnRoaXMuY3VycmVudEl0ZW0uY3NzKCJsZWZ0Iil9KSwoZFswXS5zdHlsZS53aWR0aD09IiJ8fGMuZm9yY2VIZWxwZXJTaXplKSYmZC53aWR0aCh0aGlzLmN1cnJlbnRJdGVtLndpZHRoKCkpLChkWzBdLnN0eWxlLmhlaWdodD09IiJ8fGMuZm9yY2VIZWxwZXJTaXplKSYmZC5oZWlnaHQodGhpcy5jdXJyZW50SXRlbS5oZWlnaHQoKSksZH0sX2FkanVzdE9mZnNldEZyb21IZWxwZXI6ZnVuY3Rpb24oYil7dHlwZW9mIGI9PSJzdHJpbmciJiYoYj1iLnNwbGl0KCIgIikpLGEuaXNBcnJheShiKSYmKGI9e2xlZnQ6K2JbMF0sdG9wOitiWzFdfHwwfSksImxlZnQiaW4gYiYmKHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ9Yi5sZWZ0K3RoaXMubWFyZ2lucy5sZWZ0KSwicmlnaHQiaW4gYiYmKHRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ9dGhpcy5oZWxwZXJQcm9wb3J0aW9ucy53aWR0aC1iLnJpZ2h0K3RoaXMubWFyZ2lucy5sZWZ0KSwidG9wImluIGImJih0aGlzLm9mZnNldC5jbGljay50b3A9Yi50b3ArdGhpcy5tYXJnaW5zLnRvcCksImJvdHRvbSJpbiBiJiYodGhpcy5vZmZzZXQuY2xpY2sudG9wPXRoaXMuaGVscGVyUHJvcG9ydGlvbnMuaGVpZ2h0LWIuYm90dG9tK3RoaXMubWFyZ2lucy50b3ApfSxfZ2V0UGFyZW50T2Zmc2V0OmZ1bmN0aW9uKCl7dGhpcy5vZmZzZXRQYXJlbnQ9dGhpcy5oZWxwZXIub2Zmc2V0UGFyZW50KCk7dmFyIGI9dGhpcy5vZmZzZXRQYXJlbnQub2Zmc2V0KCk7dGhpcy5jc3NQb3NpdGlvbj09ImFic29sdXRlIiYmdGhpcy5zY3JvbGxQYXJlbnRbMF0hPWRvY3VtZW50JiZhLnVpLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLHRoaXMub2Zmc2V0UGFyZW50WzBdKSYmKGIubGVmdCs9dGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCgpLGIudG9wKz10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKSk7aWYodGhpcy5vZmZzZXRQYXJlbnRbMF09PWRvY3VtZW50LmJvZHl8fHRoaXMub2Zmc2V0UGFyZW50WzBdLnRhZ05hbWUmJnRoaXMub2Zmc2V0UGFyZW50WzBdLnRhZ05hbWUudG9Mb3dlckNhc2UoKT09Imh0bWwiJiZhLmJyb3dzZXIubXNpZSliPXt0b3A6MCxsZWZ0OjB9O3JldHVybnt0b3A6Yi50b3ArKHBhcnNlSW50KHRoaXMub2Zmc2V0UGFyZW50LmNzcygiYm9yZGVyVG9wV2lkdGgiKSwxMCl8fDApLGxlZnQ6Yi5sZWZ0KyhwYXJzZUludCh0aGlzLm9mZnNldFBhcmVudC5jc3MoImJvcmRlckxlZnRXaWR0aCIpLDEwKXx8MCl9fSxfZ2V0UmVsYXRpdmVPZmZzZXQ6ZnVuY3Rpb24oKXtpZih0aGlzLmNzc1Bvc2l0aW9uPT0icmVsYXRpdmUiKXt2YXIgYT10aGlzLmN1cnJlbnRJdGVtLnBvc2l0aW9uKCk7cmV0dXJue3RvcDphLnRvcC0ocGFyc2VJbnQodGhpcy5oZWxwZXIuY3NzKCJ0b3AiKSwxMCl8fDApK3RoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCgpLGxlZnQ6YS5sZWZ0LShwYXJzZUludCh0aGlzLmhlbHBlci5jc3MoImxlZnQiKSwxMCl8fDApK3RoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKX19cmV0dXJue3RvcDowLGxlZnQ6MH19LF9jYWNoZU1hcmdpbnM6ZnVuY3Rpb24oKXt0aGlzLm1hcmdpbnM9e2xlZnQ6cGFyc2VJbnQodGhpcy5jdXJyZW50SXRlbS5jc3MoIm1hcmdpbkxlZnQiKSwxMCl8fDAsdG9wOnBhcnNlSW50KHRoaXMuY3VycmVudEl0ZW0uY3NzKCJtYXJnaW5Ub3AiKSwxMCl8fDB9fSxfY2FjaGVIZWxwZXJQcm9wb3J0aW9uczpmdW5jdGlvbigpe3RoaXMuaGVscGVyUHJvcG9ydGlvbnM9e3dpZHRoOnRoaXMuaGVscGVyLm91dGVyV2lkdGgoKSxoZWlnaHQ6dGhpcy5oZWxwZXIub3V0ZXJIZWlnaHQoKX19LF9zZXRDb250YWlubWVudDpmdW5jdGlvbigpe3ZhciBiPXRoaXMub3B0aW9ucztiLmNvbnRhaW5tZW50PT0icGFyZW50IiYmKGIuY29udGFpbm1lbnQ9dGhpcy5oZWxwZXJbMF0ucGFyZW50Tm9kZSk7aWYoYi5jb250YWlubWVudD09ImRvY3VtZW50Inx8Yi5jb250YWlubWVudD09IndpbmRvdyIpdGhpcy5jb250YWlubWVudD1bMC10aGlzLm9mZnNldC5yZWxhdGl2ZS5sZWZ0LXRoaXMub2Zmc2V0LnBhcmVudC5sZWZ0LDAtdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wLXRoaXMub2Zmc2V0LnBhcmVudC50b3AsYShiLmNvbnRhaW5tZW50PT0iZG9jdW1lbnQiP2RvY3VtZW50OndpbmRvdykud2lkdGgoKS10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLXRoaXMubWFyZ2lucy5sZWZ0LChhKGIuY29udGFpbm1lbnQ9PSJkb2N1bWVudCI/ZG9jdW1lbnQ6d2luZG93KS5oZWlnaHQoKXx8ZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlLnNjcm9sbEhlaWdodCktdGhpcy5oZWxwZXJQcm9wb3J0aW9ucy5oZWlnaHQtdGhpcy5tYXJnaW5zLnRvcF07aWYoIS9eKGRvY3VtZW50fHdpbmRvd3xwYXJlbnQpJC8udGVzdChiLmNvbnRhaW5tZW50KSl7dmFyIGM9YShiLmNvbnRhaW5tZW50KVswXSxkPWEoYi5jb250YWlubWVudCkub2Zmc2V0KCksZT1hKGMpLmNzcygib3ZlcmZsb3ciKSE9ImhpZGRlbiI7dGhpcy5jb250YWlubWVudD1bZC5sZWZ0KyhwYXJzZUludChhKGMpLmNzcygiYm9yZGVyTGVmdFdpZHRoIiksMTApfHwwKSsocGFyc2VJbnQoYShjKS5jc3MoInBhZGRpbmdMZWZ0IiksMTApfHwwKS10aGlzLm1hcmdpbnMubGVmdCxkLnRvcCsocGFyc2VJbnQoYShjKS5jc3MoImJvcmRlclRvcFdpZHRoIiksMTApfHwwKSsocGFyc2VJbnQoYShjKS5jc3MoInBhZGRpbmdUb3AiKSwxMCl8fDApLXRoaXMubWFyZ2lucy50b3AsZC5sZWZ0KyhlP01hdGgubWF4KGMuc2Nyb2xsV2lkdGgsYy5vZmZzZXRXaWR0aCk6Yy5vZmZzZXRXaWR0aCktKHBhcnNlSW50KGEoYykuY3NzKCJib3JkZXJMZWZ0V2lkdGgiKSwxMCl8fDApLShwYXJzZUludChhKGMpLmNzcygicGFkZGluZ1JpZ2h0IiksMTApfHwwKS10aGlzLmhlbHBlclByb3BvcnRpb25zLndpZHRoLXRoaXMubWFyZ2lucy5sZWZ0LGQudG9wKyhlP01hdGgubWF4KGMuc2Nyb2xsSGVpZ2h0LGMub2Zmc2V0SGVpZ2h0KTpjLm9mZnNldEhlaWdodCktKHBhcnNlSW50KGEoYykuY3NzKCJib3JkZXJUb3BXaWR0aCIpLDEwKXx8MCktKHBhcnNlSW50KGEoYykuY3NzKCJwYWRkaW5nQm90dG9tIiksMTApfHwwKS10aGlzLmhlbHBlclByb3BvcnRpb25zLmhlaWdodC10aGlzLm1hcmdpbnMudG9wXX19LF9jb252ZXJ0UG9zaXRpb25UbzpmdW5jdGlvbihiLGMpe2N8fChjPXRoaXMucG9zaXRpb24pO3ZhciBkPWI9PSJhYnNvbHV0ZSI/MTotMSxlPXRoaXMub3B0aW9ucyxmPXRoaXMuY3NzUG9zaXRpb249PSJhYnNvbHV0ZSImJih0aGlzLnNjcm9sbFBhcmVudFswXT09ZG9jdW1lbnR8fCFhLnVpLmNvbnRhaW5zKHRoaXMuc2Nyb2xsUGFyZW50WzBdLHRoaXMub2Zmc2V0UGFyZW50WzBdKSk/dGhpcy5vZmZzZXRQYXJlbnQ6dGhpcy5zY3JvbGxQYXJlbnQsZz0vKGh0bWx8Ym9keSkvaS50ZXN0KGZbMF0udGFnTmFtZSk7cmV0dXJue3RvcDpjLnRvcCt0aGlzLm9mZnNldC5yZWxhdGl2ZS50b3AqZCt0aGlzLm9mZnNldC5wYXJlbnQudG9wKmQtKGEuYnJvd3Nlci5zYWZhcmkmJnRoaXMuY3NzUG9zaXRpb249PSJmaXhlZCI/MDoodGhpcy5jc3NQb3NpdGlvbj09ImZpeGVkIj8tdGhpcy5zY3JvbGxQYXJlbnQuc2Nyb2xsVG9wKCk6Zz8wOmYuc2Nyb2xsVG9wKCkpKmQpLGxlZnQ6Yy5sZWZ0K3RoaXMub2Zmc2V0LnJlbGF0aXZlLmxlZnQqZCt0aGlzLm9mZnNldC5wYXJlbnQubGVmdCpkLShhLmJyb3dzZXIuc2FmYXJpJiZ0aGlzLmNzc1Bvc2l0aW9uPT0iZml4ZWQiPzA6KHRoaXMuY3NzUG9zaXRpb249PSJmaXhlZCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKTpnPzA6Zi5zY3JvbGxMZWZ0KCkpKmQpfX0sX2dlbmVyYXRlUG9zaXRpb246ZnVuY3Rpb24oYil7dmFyIGM9dGhpcy5vcHRpb25zLGQ9dGhpcy5jc3NQb3NpdGlvbj09ImFic29sdXRlIiYmKHRoaXMuc2Nyb2xsUGFyZW50WzBdPT1kb2N1bWVudHx8IWEudWkuY29udGFpbnModGhpcy5zY3JvbGxQYXJlbnRbMF0sdGhpcy5vZmZzZXRQYXJlbnRbMF0pKT90aGlzLm9mZnNldFBhcmVudDp0aGlzLnNjcm9sbFBhcmVudCxlPS8oaHRtbHxib2R5KS9pLnRlc3QoZFswXS50YWdOYW1lKTt0aGlzLmNzc1Bvc2l0aW9uPT0icmVsYXRpdmUiJiYodGhpcy5zY3JvbGxQYXJlbnRbMF09PWRvY3VtZW50fHx0aGlzLnNjcm9sbFBhcmVudFswXT09dGhpcy5vZmZzZXRQYXJlbnRbMF0pJiYodGhpcy5vZmZzZXQucmVsYXRpdmU9dGhpcy5fZ2V0UmVsYXRpdmVPZmZzZXQoKSk7dmFyIGY9Yi5wYWdlWCxnPWIucGFnZVk7aWYodGhpcy5vcmlnaW5hbFBvc2l0aW9uKXt0aGlzLmNvbnRhaW5tZW50JiYoYi5wYWdlWC10aGlzLm9mZnNldC5jbGljay5sZWZ0PHRoaXMuY29udGFpbm1lbnRbMF0mJihmPXRoaXMuY29udGFpbm1lbnRbMF0rdGhpcy5vZmZzZXQuY2xpY2subGVmdCksYi5wYWdlWS10aGlzLm9mZnNldC5jbGljay50b3A8dGhpcy5jb250YWlubWVudFsxXSYmKGc9dGhpcy5jb250YWlubWVudFsxXSt0aGlzLm9mZnNldC5jbGljay50b3ApLGIucGFnZVgtdGhpcy5vZmZzZXQuY2xpY2subGVmdD50aGlzLmNvbnRhaW5tZW50WzJdJiYoZj10aGlzLmNvbnRhaW5tZW50WzJdK3RoaXMub2Zmc2V0LmNsaWNrLmxlZnQpLGIucGFnZVktdGhpcy5vZmZzZXQuY2xpY2sudG9wPnRoaXMuY29udGFpbm1lbnRbM10mJihnPXRoaXMuY29udGFpbm1lbnRbM10rdGhpcy5vZmZzZXQuY2xpY2sudG9wKSk7aWYoYy5ncmlkKXt2YXIgaD10aGlzLm9yaWdpbmFsUGFnZVkrTWF0aC5yb3VuZCgoZy10aGlzLm9yaWdpbmFsUGFnZVkpL2MuZ3JpZFsxXSkqYy5ncmlkWzFdO2c9dGhpcy5jb250YWlubWVudD9oLXRoaXMub2Zmc2V0LmNsaWNrLnRvcDx0aGlzLmNvbnRhaW5tZW50WzFdfHxoLXRoaXMub2Zmc2V0LmNsaWNrLnRvcD50aGlzLmNvbnRhaW5tZW50WzNdP2gtdGhpcy5vZmZzZXQuY2xpY2sudG9wPHRoaXMuY29udGFpbm1lbnRbMV0/aCtjLmdyaWRbMV06aC1jLmdyaWRbMV06aDpoO3ZhciBpPXRoaXMub3JpZ2luYWxQYWdlWCtNYXRoLnJvdW5kKChmLXRoaXMub3JpZ2luYWxQYWdlWCkvYy5ncmlkWzBdKSpjLmdyaWRbMF07Zj10aGlzLmNvbnRhaW5tZW50P2ktdGhpcy5vZmZzZXQuY2xpY2subGVmdDx0aGlzLmNvbnRhaW5tZW50WzBdfHxpLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ+dGhpcy5jb250YWlubWVudFsyXT9pLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQ8dGhpcy5jb250YWlubWVudFswXT9pK2MuZ3JpZFswXTppLWMuZ3JpZFswXTppOml9fXJldHVybnt0b3A6Zy10aGlzLm9mZnNldC5jbGljay50b3AtdGhpcy5vZmZzZXQucmVsYXRpdmUudG9wLXRoaXMub2Zmc2V0LnBhcmVudC50b3ArKGEuYnJvd3Nlci5zYWZhcmkmJnRoaXMuY3NzUG9zaXRpb249PSJmaXhlZCI/MDp0aGlzLmNzc1Bvc2l0aW9uPT0iZml4ZWQiPy10aGlzLnNjcm9sbFBhcmVudC5zY3JvbGxUb3AoKTplPzA6ZC5zY3JvbGxUb3AoKSksbGVmdDpmLXRoaXMub2Zmc2V0LmNsaWNrLmxlZnQtdGhpcy5vZmZzZXQucmVsYXRpdmUubGVmdC10aGlzLm9mZnNldC5wYXJlbnQubGVmdCsoYS5icm93c2VyLnNhZmFyaSYmdGhpcy5jc3NQb3NpdGlvbj09ImZpeGVkIj8wOnRoaXMuY3NzUG9zaXRpb249PSJmaXhlZCI/LXRoaXMuc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQoKTplPzA6ZC5zY3JvbGxMZWZ0KCkpfX0sX3JlYXJyYW5nZTpmdW5jdGlvbihhLGIsYyxkKXtjP2NbMF0uYXBwZW5kQ2hpbGQodGhpcy5wbGFjZWhvbGRlclswXSk6Yi5pdGVtWzBdLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMucGxhY2Vob2xkZXJbMF0sdGhpcy5kaXJlY3Rpb249PSJkb3duIj9iLml0ZW1bMF06Yi5pdGVtWzBdLm5leHRTaWJsaW5nKSx0aGlzLmNvdW50ZXI9dGhpcy5jb3VudGVyPysrdGhpcy5jb3VudGVyOjE7dmFyIGU9dGhpcyxmPXRoaXMuY291bnRlcjt3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpe2Y9PWUuY291bnRlciYmZS5yZWZyZXNoUG9zaXRpb25zKCFkKX0sMCl9LF9jbGVhcjpmdW5jdGlvbihiLGMpe3RoaXMucmV2ZXJ0aW5nPSExO3ZhciBkPVtdLGU9dGhpczshdGhpcy5fbm9GaW5hbFNvcnQmJnRoaXMuY3VycmVudEl0ZW0ucGFyZW50KCkubGVuZ3RoJiZ0aGlzLnBsYWNlaG9sZGVyLmJlZm9yZSh0aGlzLmN1cnJlbnRJdGVtKSx0aGlzLl9ub0ZpbmFsU29ydD1udWxsO2lmKHRoaXMuaGVscGVyWzBdPT10aGlzLmN1cnJlbnRJdGVtWzBdKXtmb3IodmFyIGYgaW4gdGhpcy5fc3RvcmVkQ1NTKWlmKHRoaXMuX3N0b3JlZENTU1tmXT09ImF1dG8ifHx0aGlzLl9zdG9yZWRDU1NbZl09PSJzdGF0aWMiKXRoaXMuX3N0b3JlZENTU1tmXT0iIjt0aGlzLmN1cnJlbnRJdGVtLmNzcyh0aGlzLl9zdG9yZWRDU1MpLnJlbW92ZUNsYXNzKCJ1aS1zb3J0YWJsZS1oZWxwZXIiKX1lbHNlIHRoaXMuY3VycmVudEl0ZW0uc2hvdygpO3RoaXMuZnJvbU91dHNpZGUmJiFjJiZkLnB1c2goZnVuY3Rpb24oYSl7dGhpcy5fdHJpZ2dlcigicmVjZWl2ZSIsYSx0aGlzLl91aUhhc2godGhpcy5mcm9tT3V0c2lkZSkpfSksKHRoaXMuZnJvbU91dHNpZGV8fHRoaXMuZG9tUG9zaXRpb24ucHJldiE9dGhpcy5jdXJyZW50SXRlbS5wcmV2KCkubm90KCIudWktc29ydGFibGUtaGVscGVyIilbMF18fHRoaXMuZG9tUG9zaXRpb24ucGFyZW50IT10aGlzLmN1cnJlbnRJdGVtLnBhcmVudCgpWzBdKSYmIWMmJmQucHVzaChmdW5jdGlvbihhKXt0aGlzLl90cmlnZ2VyKCJ1cGRhdGUiLGEsdGhpcy5fdWlIYXNoKCkpfSk7aWYoIWEudWkuY29udGFpbnModGhpcy5lbGVtZW50WzBdLHRoaXMuY3VycmVudEl0ZW1bMF0pKXtjfHxkLnB1c2goZnVuY3Rpb24oYSl7dGhpcy5fdHJpZ2dlcigicmVtb3ZlIixhLHRoaXMuX3VpSGFzaCgpKX0pO2Zvcih2YXIgZj10aGlzLmNvbnRhaW5lcnMubGVuZ3RoLTE7Zj49MDtmLS0pYS51aS5jb250YWlucyh0aGlzLmNvbnRhaW5lcnNbZl0uZWxlbWVudFswXSx0aGlzLmN1cnJlbnRJdGVtWzBdKSYmIWMmJihkLnB1c2goZnVuY3Rpb24oYSl7cmV0dXJuIGZ1bmN0aW9uKGIpe2EuX3RyaWdnZXIoInJlY2VpdmUiLGIsdGhpcy5fdWlIYXNoKHRoaXMpKX19LmNhbGwodGhpcyx0aGlzLmNvbnRhaW5lcnNbZl0pKSxkLnB1c2goZnVuY3Rpb24oYSl7cmV0dXJuIGZ1bmN0aW9uKGIpe2EuX3RyaWdnZXIoInVwZGF0ZSIsYix0aGlzLl91aUhhc2godGhpcykpfX0uY2FsbCh0aGlzLHRoaXMuY29udGFpbmVyc1tmXSkpKX1mb3IodmFyIGY9dGhpcy5jb250YWluZXJzLmxlbmd0aC0xO2Y+PTA7Zi0tKWN8fGQucHVzaChmdW5jdGlvbihhKXtyZXR1cm4gZnVuY3Rpb24oYil7YS5fdHJpZ2dlcigiZGVhY3RpdmF0ZSIsYix0aGlzLl91aUhhc2godGhpcykpfX0uY2FsbCh0aGlzLHRoaXMuY29udGFpbmVyc1tmXSkpLHRoaXMuY29udGFpbmVyc1tmXS5jb250YWluZXJDYWNoZS5vdmVyJiYoZC5wdXNoKGZ1bmN0aW9uKGEpe3JldHVybiBmdW5jdGlvbihiKXthLl90cmlnZ2VyKCJvdXQiLGIsdGhpcy5fdWlIYXNoKHRoaXMpKX19LmNhbGwodGhpcyx0aGlzLmNvbnRhaW5lcnNbZl0pKSx0aGlzLmNvbnRhaW5lcnNbZl0uY29udGFpbmVyQ2FjaGUub3Zlcj0wKTt0aGlzLl9zdG9yZWRDdXJzb3ImJmEoImJvZHkiKS5jc3MoImN1cnNvciIsdGhpcy5fc3RvcmVkQ3Vyc29yKSx0aGlzLl9zdG9yZWRPcGFjaXR5JiZ0aGlzLmhlbHBlci5jc3MoIm9wYWNpdHkiLHRoaXMuX3N0b3JlZE9wYWNpdHkpLHRoaXMuX3N0b3JlZFpJbmRleCYmdGhpcy5oZWxwZXIuY3NzKCJ6SW5kZXgiLHRoaXMuX3N0b3JlZFpJbmRleD09ImF1dG8iPyIiOnRoaXMuX3N0b3JlZFpJbmRleCksdGhpcy5kcmFnZ2luZz0hMTtpZih0aGlzLmNhbmNlbEhlbHBlclJlbW92YWwpe2lmKCFjKXt0aGlzLl90cmlnZ2VyKCJiZWZvcmVTdG9wIixiLHRoaXMuX3VpSGFzaCgpKTtmb3IodmFyIGY9MDtmPGQubGVuZ3RoO2YrKylkW2ZdLmNhbGwodGhpcyxiKTt0aGlzLl90cmlnZ2VyKCJzdG9wIixiLHRoaXMuX3VpSGFzaCgpKX1yZXR1cm4hMX1jfHx0aGlzLl90cmlnZ2VyKCJiZWZvcmVTdG9wIixiLHRoaXMuX3VpSGFzaCgpKSx0aGlzLnBsYWNlaG9sZGVyWzBdLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5wbGFjZWhvbGRlclswXSksdGhpcy5oZWxwZXJbMF0hPXRoaXMuY3VycmVudEl0ZW1bMF0mJnRoaXMuaGVscGVyLnJlbW92ZSgpLHRoaXMuaGVscGVyPW51bGw7aWYoIWMpe2Zvcih2YXIgZj0wO2Y8ZC5sZW5ndGg7ZisrKWRbZl0uY2FsbCh0aGlzLGIpO3RoaXMuX3RyaWdnZXIoInN0b3AiLGIsdGhpcy5fdWlIYXNoKCkpfXJldHVybiB0aGlzLmZyb21PdXRzaWRlPSExLCEwfSxfdHJpZ2dlcjpmdW5jdGlvbigpe2EuV2lkZ2V0LnByb3RvdHlwZS5fdHJpZ2dlci5hcHBseSh0aGlzLGFyZ3VtZW50cyk9PT0hMSYmdGhpcy5jYW5jZWwoKX0sX3VpSGFzaDpmdW5jdGlvbihiKXt2YXIgYz1ifHx0aGlzO3JldHVybntoZWxwZXI6Yy5oZWxwZXIscGxhY2Vob2xkZXI6Yy5wbGFjZWhvbGRlcnx8YShbXSkscG9zaXRpb246Yy5wb3NpdGlvbixvcmlnaW5hbFBvc2l0aW9uOmMub3JpZ2luYWxQb3NpdGlvbixvZmZzZXQ6Yy5wb3NpdGlvbkFicyxpdGVtOmMuY3VycmVudEl0ZW0sc2VuZGVyOmI/Yi5lbGVtZW50Om51bGx9fX0pLGEuZXh0ZW5kKGEudWkuc29ydGFibGUse3ZlcnNpb246IjEuOC4yMCJ9KX0pKGpRdWVyeSk7Oy8qISBqUXVlcnkgVUkgLSB2MS44LjIwIC0gMjAxMi0wNC0zMAoqIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5LXVpCiogSW5jbHVkZXM6IGpxdWVyeS51aS5hY2NvcmRpb24uanMKKiBDb3B5cmlnaHQgKGMpIDIwMTIgQVVUSE9SUy50eHQ7IExpY2Vuc2VkIE1JVCwgR1BMICovCihmdW5jdGlvbihhLGIpe2Eud2lkZ2V0KCJ1aS5hY2NvcmRpb24iLHtvcHRpb25zOnthY3RpdmU6MCxhbmltYXRlZDoic2xpZGUiLGF1dG9IZWlnaHQ6ITAsY2xlYXJTdHlsZTohMSxjb2xsYXBzaWJsZTohMSxldmVudDoiY2xpY2siLGZpbGxTcGFjZTohMSxoZWFkZXI6Ij4gbGkgPiA6Zmlyc3QtY2hpbGQsPiA6bm90KGxpKTpldmVuIixpY29uczp7aGVhZGVyOiJ1aS1pY29uLXRyaWFuZ2xlLTEtZSIsaGVhZGVyU2VsZWN0ZWQ6InVpLWljb24tdHJpYW5nbGUtMS1zIn0sbmF2aWdhdGlvbjohMSxuYXZpZ2F0aW9uRmlsdGVyOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaHJlZi50b0xvd2VyQ2FzZSgpPT09bG9jYXRpb24uaHJlZi50b0xvd2VyQ2FzZSgpfX0sX2NyZWF0ZTpmdW5jdGlvbigpe3ZhciBiPXRoaXMsYz1iLm9wdGlvbnM7Yi5ydW5uaW5nPTAsYi5lbGVtZW50LmFkZENsYXNzKCJ1aS1hY2NvcmRpb24gdWktd2lkZ2V0IHVpLWhlbHBlci1yZXNldCIpLmNoaWxkcmVuKCJsaSIpLmFkZENsYXNzKCJ1aS1hY2NvcmRpb24tbGktZml4IiksYi5oZWFkZXJzPWIuZWxlbWVudC5maW5kKGMuaGVhZGVyKS5hZGRDbGFzcygidWktYWNjb3JkaW9uLWhlYWRlciB1aS1oZWxwZXItcmVzZXQgdWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsIikuYmluZCgibW91c2VlbnRlci5hY2NvcmRpb24iLGZ1bmN0aW9uKCl7aWYoYy5kaXNhYmxlZClyZXR1cm47YSh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtaG92ZXIiKX0pLmJpbmQoIm1vdXNlbGVhdmUuYWNjb3JkaW9uIixmdW5jdGlvbigpe2lmKGMuZGlzYWJsZWQpcmV0dXJuO2EodGhpcykucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWhvdmVyIil9KS5iaW5kKCJmb2N1cy5hY2NvcmRpb24iLGZ1bmN0aW9uKCl7aWYoYy5kaXNhYmxlZClyZXR1cm47YSh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtZm9jdXMiKX0pLmJpbmQoImJsdXIuYWNjb3JkaW9uIixmdW5jdGlvbigpe2lmKGMuZGlzYWJsZWQpcmV0dXJuO2EodGhpcykucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWZvY3VzIil9KSxiLmhlYWRlcnMubmV4dCgpLmFkZENsYXNzKCJ1aS1hY2NvcmRpb24tY29udGVudCB1aS1oZWxwZXItcmVzZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWJvdHRvbSIpO2lmKGMubmF2aWdhdGlvbil7dmFyIGQ9Yi5lbGVtZW50LmZpbmQoImEiKS5maWx0ZXIoYy5uYXZpZ2F0aW9uRmlsdGVyKS5lcSgwKTtpZihkLmxlbmd0aCl7dmFyIGU9ZC5jbG9zZXN0KCIudWktYWNjb3JkaW9uLWhlYWRlciIpO2UubGVuZ3RoP2IuYWN0aXZlPWU6Yi5hY3RpdmU9ZC5jbG9zZXN0KCIudWktYWNjb3JkaW9uLWNvbnRlbnQiKS5wcmV2KCl9fWIuYWN0aXZlPWIuX2ZpbmRBY3RpdmUoYi5hY3RpdmV8fGMuYWN0aXZlKS5hZGRDbGFzcygidWktc3RhdGUtZGVmYXVsdCB1aS1zdGF0ZS1hY3RpdmUiKS50b2dnbGVDbGFzcygidWktY29ybmVyLWFsbCIpLnRvZ2dsZUNsYXNzKCJ1aS1jb3JuZXItdG9wIiksYi5hY3RpdmUubmV4dCgpLmFkZENsYXNzKCJ1aS1hY2NvcmRpb24tY29udGVudC1hY3RpdmUiKSxiLl9jcmVhdGVJY29ucygpLGIucmVzaXplKCksYi5lbGVtZW50LmF0dHIoInJvbGUiLCJ0YWJsaXN0IiksYi5oZWFkZXJzLmF0dHIoInJvbGUiLCJ0YWIiKS5iaW5kKCJrZXlkb3duLmFjY29yZGlvbiIsZnVuY3Rpb24oYSl7cmV0dXJuIGIuX2tleWRvd24oYSl9KS5uZXh0KCkuYXR0cigicm9sZSIsInRhYnBhbmVsIiksYi5oZWFkZXJzLm5vdChiLmFjdGl2ZXx8IiIpLmF0dHIoeyJhcmlhLWV4cGFuZGVkIjoiZmFsc2UiLCJhcmlhLXNlbGVjdGVkIjoiZmFsc2UiLHRhYkluZGV4Oi0xfSkubmV4dCgpLmhpZGUoKSxiLmFjdGl2ZS5sZW5ndGg/Yi5hY3RpdmUuYXR0cih7ImFyaWEtZXhwYW5kZWQiOiJ0cnVlIiwiYXJpYS1zZWxlY3RlZCI6InRydWUiLHRhYkluZGV4OjB9KTpiLmhlYWRlcnMuZXEoMCkuYXR0cigidGFiSW5kZXgiLDApLGEuYnJvd3Nlci5zYWZhcml8fGIuaGVhZGVycy5maW5kKCJhIikuYXR0cigidGFiSW5kZXgiLC0xKSxjLmV2ZW50JiZiLmhlYWRlcnMuYmluZChjLmV2ZW50LnNwbGl0KCIgIikuam9pbigiLmFjY29yZGlvbiAiKSsiLmFjY29yZGlvbiIsZnVuY3Rpb24oYSl7Yi5fY2xpY2tIYW5kbGVyLmNhbGwoYixhLHRoaXMpLGEucHJldmVudERlZmF1bHQoKX0pfSxfY3JlYXRlSWNvbnM6ZnVuY3Rpb24oKXt2YXIgYj10aGlzLm9wdGlvbnM7Yi5pY29ucyYmKGEoIjxzcGFuPjwvc3Bhbj4iKS5hZGRDbGFzcygidWktaWNvbiAiK2IuaWNvbnMuaGVhZGVyKS5wcmVwZW5kVG8odGhpcy5oZWFkZXJzKSx0aGlzLmFjdGl2ZS5jaGlsZHJlbigiLnVpLWljb24iKS50b2dnbGVDbGFzcyhiLmljb25zLmhlYWRlcikudG9nZ2xlQ2xhc3MoYi5pY29ucy5oZWFkZXJTZWxlY3RlZCksdGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1hY2NvcmRpb24taWNvbnMiKSl9LF9kZXN0cm95SWNvbnM6ZnVuY3Rpb24oKXt0aGlzLmhlYWRlcnMuY2hpbGRyZW4oIi51aS1pY29uIikucmVtb3ZlKCksdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1hY2NvcmRpb24taWNvbnMiKX0sZGVzdHJveTpmdW5jdGlvbigpe3ZhciBiPXRoaXMub3B0aW9uczt0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLWFjY29yZGlvbiB1aS13aWRnZXQgdWktaGVscGVyLXJlc2V0IikucmVtb3ZlQXR0cigicm9sZSIpLHRoaXMuaGVhZGVycy51bmJpbmQoIi5hY2NvcmRpb24iKS5yZW1vdmVDbGFzcygidWktYWNjb3JkaW9uLWhlYWRlciB1aS1hY2NvcmRpb24tZGlzYWJsZWQgdWktaGVscGVyLXJlc2V0IHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbCB1aS1zdGF0ZS1hY3RpdmUgdWktc3RhdGUtZGlzYWJsZWQgdWktY29ybmVyLXRvcCIpLnJlbW92ZUF0dHIoInJvbGUiKS5yZW1vdmVBdHRyKCJhcmlhLWV4cGFuZGVkIikucmVtb3ZlQXR0cigiYXJpYS1zZWxlY3RlZCIpLnJlbW92ZUF0dHIoInRhYkluZGV4IiksdGhpcy5oZWFkZXJzLmZpbmQoImEiKS5yZW1vdmVBdHRyKCJ0YWJJbmRleCIpLHRoaXMuX2Rlc3Ryb3lJY29ucygpO3ZhciBjPXRoaXMuaGVhZGVycy5uZXh0KCkuY3NzKCJkaXNwbGF5IiwiIikucmVtb3ZlQXR0cigicm9sZSIpLnJlbW92ZUNsYXNzKCJ1aS1oZWxwZXItcmVzZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWJvdHRvbSB1aS1hY2NvcmRpb24tY29udGVudCB1aS1hY2NvcmRpb24tY29udGVudC1hY3RpdmUgdWktYWNjb3JkaW9uLWRpc2FibGVkIHVpLXN0YXRlLWRpc2FibGVkIik7cmV0dXJuKGIuYXV0b0hlaWdodHx8Yi5maWxsSGVpZ2h0KSYmYy5jc3MoImhlaWdodCIsIiIpLGEuV2lkZ2V0LnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcyl9LF9zZXRPcHRpb246ZnVuY3Rpb24oYixjKXthLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyksYj09ImFjdGl2ZSImJnRoaXMuYWN0aXZhdGUoYyksYj09Imljb25zIiYmKHRoaXMuX2Rlc3Ryb3lJY29ucygpLGMmJnRoaXMuX2NyZWF0ZUljb25zKCkpLGI9PSJkaXNhYmxlZCImJnRoaXMuaGVhZGVycy5hZGQodGhpcy5oZWFkZXJzLm5leHQoKSlbYz8iYWRkQ2xhc3MiOiJyZW1vdmVDbGFzcyJdKCJ1aS1hY2NvcmRpb24tZGlzYWJsZWQgdWktc3RhdGUtZGlzYWJsZWQiKX0sX2tleWRvd246ZnVuY3Rpb24oYil7aWYodGhpcy5vcHRpb25zLmRpc2FibGVkfHxiLmFsdEtleXx8Yi5jdHJsS2V5KXJldHVybjt2YXIgYz1hLnVpLmtleUNvZGUsZD10aGlzLmhlYWRlcnMubGVuZ3RoLGU9dGhpcy5oZWFkZXJzLmluZGV4KGIudGFyZ2V0KSxmPSExO3N3aXRjaChiLmtleUNvZGUpe2Nhc2UgYy5SSUdIVDpjYXNlIGMuRE9XTjpmPXRoaXMuaGVhZGVyc1soZSsxKSVkXTticmVhaztjYXNlIGMuTEVGVDpjYXNlIGMuVVA6Zj10aGlzLmhlYWRlcnNbKGUtMStkKSVkXTticmVhaztjYXNlIGMuU1BBQ0U6Y2FzZSBjLkVOVEVSOnRoaXMuX2NsaWNrSGFuZGxlcih7dGFyZ2V0OmIudGFyZ2V0fSxiLnRhcmdldCksYi5wcmV2ZW50RGVmYXVsdCgpfXJldHVybiBmPyhhKGIudGFyZ2V0KS5hdHRyKCJ0YWJJbmRleCIsLTEpLGEoZikuYXR0cigidGFiSW5kZXgiLDApLGYuZm9jdXMoKSwhMSk6ITB9LHJlc2l6ZTpmdW5jdGlvbigpe3ZhciBiPXRoaXMub3B0aW9ucyxjO2lmKGIuZmlsbFNwYWNlKXtpZihhLmJyb3dzZXIubXNpZSl7dmFyIGQ9dGhpcy5lbGVtZW50LnBhcmVudCgpLmNzcygib3ZlcmZsb3ciKTt0aGlzLmVsZW1lbnQucGFyZW50KCkuY3NzKCJvdmVyZmxvdyIsImhpZGRlbiIpfWM9dGhpcy5lbGVtZW50LnBhcmVudCgpLmhlaWdodCgpLGEuYnJvd3Nlci5tc2llJiZ0aGlzLmVsZW1lbnQucGFyZW50KCkuY3NzKCJvdmVyZmxvdyIsZCksdGhpcy5oZWFkZXJzLmVhY2goZnVuY3Rpb24oKXtjLT1hKHRoaXMpLm91dGVySGVpZ2h0KCEwKX0pLHRoaXMuaGVhZGVycy5uZXh0KCkuZWFjaChmdW5jdGlvbigpe2EodGhpcykuaGVpZ2h0KE1hdGgubWF4KDAsYy1hKHRoaXMpLmlubmVySGVpZ2h0KCkrYSh0aGlzKS5oZWlnaHQoKSkpfSkuY3NzKCJvdmVyZmxvdyIsImF1dG8iKX1lbHNlIGIuYXV0b0hlaWdodCYmKGM9MCx0aGlzLmhlYWRlcnMubmV4dCgpLmVhY2goZnVuY3Rpb24oKXtjPU1hdGgubWF4KGMsYSh0aGlzKS5oZWlnaHQoIiIpLmhlaWdodCgpKX0pLmhlaWdodChjKSk7cmV0dXJuIHRoaXN9LGFjdGl2YXRlOmZ1bmN0aW9uKGEpe3RoaXMub3B0aW9ucy5hY3RpdmU9YTt2YXIgYj10aGlzLl9maW5kQWN0aXZlKGEpWzBdO3JldHVybiB0aGlzLl9jbGlja0hhbmRsZXIoe3RhcmdldDpifSxiKSx0aGlzfSxfZmluZEFjdGl2ZTpmdW5jdGlvbihiKXtyZXR1cm4gYj90eXBlb2YgYj09Im51bWJlciI/dGhpcy5oZWFkZXJzLmZpbHRlcigiOmVxKCIrYisiKSIpOnRoaXMuaGVhZGVycy5ub3QodGhpcy5oZWFkZXJzLm5vdChiKSk6Yj09PSExP2EoW10pOnRoaXMuaGVhZGVycy5maWx0ZXIoIjplcSgwKSIpfSxfY2xpY2tIYW5kbGVyOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9dGhpcy5vcHRpb25zO2lmKGQuZGlzYWJsZWQpcmV0dXJuO2lmKCFiLnRhcmdldCl7aWYoIWQuY29sbGFwc2libGUpcmV0dXJuO3RoaXMuYWN0aXZlLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUgdWktY29ybmVyLXRvcCIpLmFkZENsYXNzKCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwiKS5jaGlsZHJlbigiLnVpLWljb24iKS5yZW1vdmVDbGFzcyhkLmljb25zLmhlYWRlclNlbGVjdGVkKS5hZGRDbGFzcyhkLmljb25zLmhlYWRlciksdGhpcy5hY3RpdmUubmV4dCgpLmFkZENsYXNzKCJ1aS1hY2NvcmRpb24tY29udGVudC1hY3RpdmUiKTt2YXIgZT10aGlzLmFjdGl2ZS5uZXh0KCksZj17b3B0aW9uczpkLG5ld0hlYWRlcjphKFtdKSxvbGRIZWFkZXI6ZC5hY3RpdmUsbmV3Q29udGVudDphKFtdKSxvbGRDb250ZW50OmV9LGc9dGhpcy5hY3RpdmU9YShbXSk7dGhpcy5fdG9nZ2xlKGcsZSxmKTtyZXR1cm59dmFyIGg9YShiLmN1cnJlbnRUYXJnZXR8fGMpLGk9aFswXT09PXRoaXMuYWN0aXZlWzBdO2QuYWN0aXZlPWQuY29sbGFwc2libGUmJmk/ITE6dGhpcy5oZWFkZXJzLmluZGV4KGgpO2lmKHRoaXMucnVubmluZ3x8IWQuY29sbGFwc2libGUmJmkpcmV0dXJuO3ZhciBqPXRoaXMuYWN0aXZlLGc9aC5uZXh0KCksZT10aGlzLmFjdGl2ZS5uZXh0KCksZj17b3B0aW9uczpkLG5ld0hlYWRlcjppJiZkLmNvbGxhcHNpYmxlP2EoW10pOmgsb2xkSGVhZGVyOnRoaXMuYWN0aXZlLG5ld0NvbnRlbnQ6aSYmZC5jb2xsYXBzaWJsZT9hKFtdKTpnLG9sZENvbnRlbnQ6ZX0saz10aGlzLmhlYWRlcnMuaW5kZXgodGhpcy5hY3RpdmVbMF0pPnRoaXMuaGVhZGVycy5pbmRleChoWzBdKTt0aGlzLmFjdGl2ZT1pP2EoW10pOmgsdGhpcy5fdG9nZ2xlKGcsZSxmLGksayksai5yZW1vdmVDbGFzcygidWktc3RhdGUtYWN0aXZlIHVpLWNvcm5lci10b3AiKS5hZGRDbGFzcygidWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItYWxsIikuY2hpbGRyZW4oIi51aS1pY29uIikucmVtb3ZlQ2xhc3MoZC5pY29ucy5oZWFkZXJTZWxlY3RlZCkuYWRkQ2xhc3MoZC5pY29ucy5oZWFkZXIpLGl8fChoLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwiKS5hZGRDbGFzcygidWktc3RhdGUtYWN0aXZlIHVpLWNvcm5lci10b3AiKS5jaGlsZHJlbigiLnVpLWljb24iKS5yZW1vdmVDbGFzcyhkLmljb25zLmhlYWRlcikuYWRkQ2xhc3MoZC5pY29ucy5oZWFkZXJTZWxlY3RlZCksaC5uZXh0KCkuYWRkQ2xhc3MoInVpLWFjY29yZGlvbi1jb250ZW50LWFjdGl2ZSIpKTtyZXR1cm59LF90b2dnbGU6ZnVuY3Rpb24oYixjLGQsZSxmKXt2YXIgZz10aGlzLGg9Zy5vcHRpb25zO2cudG9TaG93PWIsZy50b0hpZGU9YyxnLmRhdGE9ZDt2YXIgaT1mdW5jdGlvbigpe2lmKCFnKXJldHVybjtyZXR1cm4gZy5fY29tcGxldGVkLmFwcGx5KGcsYXJndW1lbnRzKX07Zy5fdHJpZ2dlcigiY2hhbmdlc3RhcnQiLG51bGwsZy5kYXRhKSxnLnJ1bm5pbmc9Yy5zaXplKCk9PT0wP2Iuc2l6ZSgpOmMuc2l6ZSgpO2lmKGguYW5pbWF0ZWQpe3ZhciBqPXt9O2guY29sbGFwc2libGUmJmU/aj17dG9TaG93OmEoW10pLHRvSGlkZTpjLGNvbXBsZXRlOmksZG93bjpmLGF1dG9IZWlnaHQ6aC5hdXRvSGVpZ2h0fHxoLmZpbGxTcGFjZX06aj17dG9TaG93OmIsdG9IaWRlOmMsY29tcGxldGU6aSxkb3duOmYsYXV0b0hlaWdodDpoLmF1dG9IZWlnaHR8fGguZmlsbFNwYWNlfSxoLnByb3hpZWR8fChoLnByb3hpZWQ9aC5hbmltYXRlZCksaC5wcm94aWVkRHVyYXRpb258fChoLnByb3hpZWREdXJhdGlvbj1oLmR1cmF0aW9uKSxoLmFuaW1hdGVkPWEuaXNGdW5jdGlvbihoLnByb3hpZWQpP2gucHJveGllZChqKTpoLnByb3hpZWQsaC5kdXJhdGlvbj1hLmlzRnVuY3Rpb24oaC5wcm94aWVkRHVyYXRpb24pP2gucHJveGllZER1cmF0aW9uKGopOmgucHJveGllZER1cmF0aW9uO3ZhciBrPWEudWkuYWNjb3JkaW9uLmFuaW1hdGlvbnMsbD1oLmR1cmF0aW9uLG09aC5hbmltYXRlZDttJiYha1ttXSYmIWEuZWFzaW5nW21dJiYobT0ic2xpZGUiKSxrW21dfHwoa1ttXT1mdW5jdGlvbihhKXt0aGlzLnNsaWRlKGEse2Vhc2luZzptLGR1cmF0aW9uOmx8fDcwMH0pfSksa1ttXShqKX1lbHNlIGguY29sbGFwc2libGUmJmU/Yi50b2dnbGUoKTooYy5oaWRlKCksYi5zaG93KCkpLGkoITApO2MucHJldigpLmF0dHIoeyJhcmlhLWV4cGFuZGVkIjoiZmFsc2UiLCJhcmlhLXNlbGVjdGVkIjoiZmFsc2UiLHRhYkluZGV4Oi0xfSkuYmx1cigpLGIucHJldigpLmF0dHIoeyJhcmlhLWV4cGFuZGVkIjoidHJ1ZSIsImFyaWEtc2VsZWN0ZWQiOiJ0cnVlIix0YWJJbmRleDowfSkuZm9jdXMoKX0sX2NvbXBsZXRlZDpmdW5jdGlvbihhKXt0aGlzLnJ1bm5pbmc9YT8wOi0tdGhpcy5ydW5uaW5nO2lmKHRoaXMucnVubmluZylyZXR1cm47dGhpcy5vcHRpb25zLmNsZWFyU3R5bGUmJnRoaXMudG9TaG93LmFkZCh0aGlzLnRvSGlkZSkuY3NzKHtoZWlnaHQ6IiIsb3ZlcmZsb3c6IiJ9KSx0aGlzLnRvSGlkZS5yZW1vdmVDbGFzcygidWktYWNjb3JkaW9uLWNvbnRlbnQtYWN0aXZlIiksdGhpcy50b0hpZGUubGVuZ3RoJiYodGhpcy50b0hpZGUucGFyZW50KClbMF0uY2xhc3NOYW1lPXRoaXMudG9IaWRlLnBhcmVudCgpWzBdLmNsYXNzTmFtZSksdGhpcy5fdHJpZ2dlcigiY2hhbmdlIixudWxsLHRoaXMuZGF0YSl9fSksYS5leHRlbmQoYS51aS5hY2NvcmRpb24se3ZlcnNpb246IjEuOC4yMCIsYW5pbWF0aW9uczp7c2xpZGU6ZnVuY3Rpb24oYixjKXtiPWEuZXh0ZW5kKHtlYXNpbmc6InN3aW5nIixkdXJhdGlvbjozMDB9LGIsYyk7aWYoIWIudG9IaWRlLnNpemUoKSl7Yi50b1Nob3cuYW5pbWF0ZSh7aGVpZ2h0OiJzaG93IixwYWRkaW5nVG9wOiJzaG93IixwYWRkaW5nQm90dG9tOiJzaG93In0sYik7cmV0dXJufWlmKCFiLnRvU2hvdy5zaXplKCkpe2IudG9IaWRlLmFuaW1hdGUoe2hlaWdodDoiaGlkZSIscGFkZGluZ1RvcDoiaGlkZSIscGFkZGluZ0JvdHRvbToiaGlkZSJ9LGIpO3JldHVybn12YXIgZD1iLnRvU2hvdy5jc3MoIm92ZXJmbG93IiksZT0wLGY9e30sZz17fSxoPVsiaGVpZ2h0IiwicGFkZGluZ1RvcCIsInBhZGRpbmdCb3R0b20iXSxpLGo9Yi50b1Nob3c7aT1qWzBdLnN0eWxlLndpZHRoLGoud2lkdGgoai5wYXJlbnQoKS53aWR0aCgpLXBhcnNlRmxvYXQoai5jc3MoInBhZGRpbmdMZWZ0IikpLXBhcnNlRmxvYXQoai5jc3MoInBhZGRpbmdSaWdodCIpKS0ocGFyc2VGbG9hdChqLmNzcygiYm9yZGVyTGVmdFdpZHRoIikpfHwwKS0ocGFyc2VGbG9hdChqLmNzcygiYm9yZGVyUmlnaHRXaWR0aCIpKXx8MCkpLGEuZWFjaChoLGZ1bmN0aW9uKGMsZCl7Z1tkXT0iaGlkZSI7dmFyIGU9KCIiK2EuY3NzKGIudG9TaG93WzBdLGQpKS5tYXRjaCgvXihbXGQrLS5dKykoLiopJC8pO2ZbZF09e3ZhbHVlOmVbMV0sdW5pdDplWzJdfHwicHgifX0pLGIudG9TaG93LmNzcyh7aGVpZ2h0OjAsb3ZlcmZsb3c6ImhpZGRlbiJ9KS5zaG93KCksYi50b0hpZGUuZmlsdGVyKCI6aGlkZGVuIikuZWFjaChiLmNvbXBsZXRlKS5lbmQoKS5maWx0ZXIoIjp2aXNpYmxlIikuYW5pbWF0ZShnLHtzdGVwOmZ1bmN0aW9uKGEsYyl7Yy5wcm9wPT0iaGVpZ2h0IiYmKGU9Yy5lbmQtYy5zdGFydD09PTA/MDooYy5ub3ctYy5zdGFydCkvKGMuZW5kLWMuc3RhcnQpKSxiLnRvU2hvd1swXS5zdHlsZVtjLnByb3BdPWUqZltjLnByb3BdLnZhbHVlK2ZbYy5wcm9wXS51bml0fSxkdXJhdGlvbjpiLmR1cmF0aW9uLGVhc2luZzpiLmVhc2luZyxjb21wbGV0ZTpmdW5jdGlvbigpe2IuYXV0b0hlaWdodHx8Yi50b1Nob3cuY3NzKCJoZWlnaHQiLCIiKSxiLnRvU2hvdy5jc3Moe3dpZHRoOmksb3ZlcmZsb3c6ZH0pLGIuY29tcGxldGUoKX19KX0sYm91bmNlc2xpZGU6ZnVuY3Rpb24oYSl7dGhpcy5zbGlkZShhLHtlYXNpbmc6YS5kb3duPyJlYXNlT3V0Qm91bmNlIjoic3dpbmciLGR1cmF0aW9uOmEuZG93bj8xZTM6MjAwfSl9fX0pfSkoalF1ZXJ5KTs7LyohIGpRdWVyeSBVSSAtIHYxLjguMjAgLSAyMDEyLTA0LTMwCiogaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkKKiBJbmNsdWRlczoganF1ZXJ5LnVpLmF1dG9jb21wbGV0ZS5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKGEsYil7dmFyIGM9MDthLndpZGdldCgidWkuYXV0b2NvbXBsZXRlIix7b3B0aW9uczp7YXBwZW5kVG86ImJvZHkiLGF1dG9Gb2N1czohMSxkZWxheTozMDAsbWluTGVuZ3RoOjEscG9zaXRpb246e215OiJsZWZ0IHRvcCIsYXQ6ImxlZnQgYm90dG9tIixjb2xsaXNpb246Im5vbmUifSxzb3VyY2U6bnVsbH0scGVuZGluZzowLF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgYj10aGlzLGM9dGhpcy5lbGVtZW50WzBdLm93bmVyRG9jdW1lbnQsZDt0aGlzLmlzTXVsdGlMaW5lPXRoaXMuZWxlbWVudC5pcygidGV4dGFyZWEiKSx0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLWF1dG9jb21wbGV0ZS1pbnB1dCIpLmF0dHIoImF1dG9jb21wbGV0ZSIsIm9mZiIpLmF0dHIoe3JvbGU6InRleHRib3giLCJhcmlhLWF1dG9jb21wbGV0ZSI6Imxpc3QiLCJhcmlhLWhhc3BvcHVwIjoidHJ1ZSJ9KS5iaW5kKCJrZXlkb3duLmF1dG9jb21wbGV0ZSIsZnVuY3Rpb24oYyl7aWYoYi5vcHRpb25zLmRpc2FibGVkfHxiLmVsZW1lbnQucHJvcEF0dHIoInJlYWRPbmx5IikpcmV0dXJuO2Q9ITE7dmFyIGU9YS51aS5rZXlDb2RlO3N3aXRjaChjLmtleUNvZGUpe2Nhc2UgZS5QQUdFX1VQOmIuX21vdmUoInByZXZpb3VzUGFnZSIsYyk7YnJlYWs7Y2FzZSBlLlBBR0VfRE9XTjpiLl9tb3ZlKCJuZXh0UGFnZSIsYyk7YnJlYWs7Y2FzZSBlLlVQOmIuX2tleUV2ZW50KCJwcmV2aW91cyIsYyk7YnJlYWs7Y2FzZSBlLkRPV046Yi5fa2V5RXZlbnQoIm5leHQiLGMpO2JyZWFrO2Nhc2UgZS5FTlRFUjpjYXNlIGUuTlVNUEFEX0VOVEVSOmIubWVudS5hY3RpdmUmJihkPSEwLGMucHJldmVudERlZmF1bHQoKSk7Y2FzZSBlLlRBQjppZighYi5tZW51LmFjdGl2ZSlyZXR1cm47Yi5tZW51LnNlbGVjdChjKTticmVhaztjYXNlIGUuRVNDQVBFOmIuZWxlbWVudC52YWwoYi50ZXJtKSxiLmNsb3NlKGMpO2JyZWFrO2RlZmF1bHQ6Y2xlYXJUaW1lb3V0KGIuc2VhcmNoaW5nKSxiLnNlYXJjaGluZz1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yi50ZXJtIT1iLmVsZW1lbnQudmFsKCkmJihiLnNlbGVjdGVkSXRlbT1udWxsLGIuc2VhcmNoKG51bGwsYykpfSxiLm9wdGlvbnMuZGVsYXkpfX0pLmJpbmQoImtleXByZXNzLmF1dG9jb21wbGV0ZSIsZnVuY3Rpb24oYSl7ZCYmKGQ9ITEsYS5wcmV2ZW50RGVmYXVsdCgpKX0pLmJpbmQoImZvY3VzLmF1dG9jb21wbGV0ZSIsZnVuY3Rpb24oKXtpZihiLm9wdGlvbnMuZGlzYWJsZWQpcmV0dXJuO2Iuc2VsZWN0ZWRJdGVtPW51bGwsYi5wcmV2aW91cz1iLmVsZW1lbnQudmFsKCl9KS5iaW5kKCJibHVyLmF1dG9jb21wbGV0ZSIsZnVuY3Rpb24oYSl7aWYoYi5vcHRpb25zLmRpc2FibGVkKXJldHVybjtjbGVhclRpbWVvdXQoYi5zZWFyY2hpbmcpLGIuY2xvc2luZz1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yi5jbG9zZShhKSxiLl9jaGFuZ2UoYSl9LDE1MCl9KSx0aGlzLl9pbml0U291cmNlKCksdGhpcy5tZW51PWEoIjx1bD48L3VsPiIpLmFkZENsYXNzKCJ1aS1hdXRvY29tcGxldGUiKS5hcHBlbmRUbyhhKHRoaXMub3B0aW9ucy5hcHBlbmRUb3x8ImJvZHkiLGMpWzBdKS5tb3VzZWRvd24oZnVuY3Rpb24oYyl7dmFyIGQ9Yi5tZW51LmVsZW1lbnRbMF07YShjLnRhcmdldCkuY2xvc2VzdCgiLnVpLW1lbnUtaXRlbSIpLmxlbmd0aHx8c2V0VGltZW91dChmdW5jdGlvbigpe2EoZG9jdW1lbnQpLm9uZSgibW91c2Vkb3duIixmdW5jdGlvbihjKXtjLnRhcmdldCE9PWIuZWxlbWVudFswXSYmYy50YXJnZXQhPT1kJiYhYS51aS5jb250YWlucyhkLGMudGFyZ2V0KSYmYi5jbG9zZSgpfSl9LDEpLHNldFRpbWVvdXQoZnVuY3Rpb24oKXtjbGVhclRpbWVvdXQoYi5jbG9zaW5nKX0sMTMpfSkubWVudSh7Zm9jdXM6ZnVuY3Rpb24oYSxjKXt2YXIgZD1jLml0ZW0uZGF0YSgiaXRlbS5hdXRvY29tcGxldGUiKTshMSE9PWIuX3RyaWdnZXIoImZvY3VzIixhLHtpdGVtOmR9KSYmL15rZXkvLnRlc3QoYS5vcmlnaW5hbEV2ZW50LnR5cGUpJiZiLmVsZW1lbnQudmFsKGQudmFsdWUpfSxzZWxlY3RlZDpmdW5jdGlvbihhLGQpe3ZhciBlPWQuaXRlbS5kYXRhKCJpdGVtLmF1dG9jb21wbGV0ZSIpLGY9Yi5wcmV2aW91cztiLmVsZW1lbnRbMF0hPT1jLmFjdGl2ZUVsZW1lbnQmJihiLmVsZW1lbnQuZm9jdXMoKSxiLnByZXZpb3VzPWYsc2V0VGltZW91dChmdW5jdGlvbigpe2IucHJldmlvdXM9ZixiLnNlbGVjdGVkSXRlbT1lfSwxKSksITEhPT1iLl90cmlnZ2VyKCJzZWxlY3QiLGEse2l0ZW06ZX0pJiZiLmVsZW1lbnQudmFsKGUudmFsdWUpLGIudGVybT1iLmVsZW1lbnQudmFsKCksYi5jbG9zZShhKSxiLnNlbGVjdGVkSXRlbT1lfSxibHVyOmZ1bmN0aW9uKGEsYyl7Yi5tZW51LmVsZW1lbnQuaXMoIjp2aXNpYmxlIikmJmIuZWxlbWVudC52YWwoKSE9PWIudGVybSYmYi5lbGVtZW50LnZhbChiLnRlcm0pfX0pLnpJbmRleCh0aGlzLmVsZW1lbnQuekluZGV4KCkrMSkuY3NzKHt0b3A6MCxsZWZ0OjB9KS5oaWRlKCkuZGF0YSgibWVudSIpLGEuZm4uYmdpZnJhbWUmJnRoaXMubWVudS5lbGVtZW50LmJnaWZyYW1lKCksYi5iZWZvcmV1bmxvYWRIYW5kbGVyPWZ1bmN0aW9uKCl7Yi5lbGVtZW50LnJlbW92ZUF0dHIoImF1dG9jb21wbGV0ZSIpfSxhKHdpbmRvdykuYmluZCgiYmVmb3JldW5sb2FkIixiLmJlZm9yZXVubG9hZEhhbmRsZXIpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1hdXRvY29tcGxldGUtaW5wdXQiKS5yZW1vdmVBdHRyKCJhdXRvY29tcGxldGUiKS5yZW1vdmVBdHRyKCJyb2xlIikucmVtb3ZlQXR0cigiYXJpYS1hdXRvY29tcGxldGUiKS5yZW1vdmVBdHRyKCJhcmlhLWhhc3BvcHVwIiksdGhpcy5tZW51LmVsZW1lbnQucmVtb3ZlKCksYSh3aW5kb3cpLnVuYmluZCgiYmVmb3JldW5sb2FkIix0aGlzLmJlZm9yZXVubG9hZEhhbmRsZXIpLGEuV2lkZ2V0LnByb3RvdHlwZS5kZXN0cm95LmNhbGwodGhpcyl9LF9zZXRPcHRpb246ZnVuY3Rpb24oYixjKXthLldpZGdldC5wcm90b3R5cGUuX3NldE9wdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyksYj09PSJzb3VyY2UiJiZ0aGlzLl9pbml0U291cmNlKCksYj09PSJhcHBlbmRUbyImJnRoaXMubWVudS5lbGVtZW50LmFwcGVuZFRvKGEoY3x8ImJvZHkiLHRoaXMuZWxlbWVudFswXS5vd25lckRvY3VtZW50KVswXSksYj09PSJkaXNhYmxlZCImJmMmJnRoaXMueGhyJiZ0aGlzLnhoci5hYm9ydCgpfSxfaW5pdFNvdXJjZTpmdW5jdGlvbigpe3ZhciBiPXRoaXMsYyxkO2EuaXNBcnJheSh0aGlzLm9wdGlvbnMuc291cmNlKT8oYz10aGlzLm9wdGlvbnMuc291cmNlLHRoaXMuc291cmNlPWZ1bmN0aW9uKGIsZCl7ZChhLnVpLmF1dG9jb21wbGV0ZS5maWx0ZXIoYyxiLnRlcm0pKX0pOnR5cGVvZiB0aGlzLm9wdGlvbnMuc291cmNlPT0ic3RyaW5nIj8oZD10aGlzLm9wdGlvbnMuc291cmNlLHRoaXMuc291cmNlPWZ1bmN0aW9uKGMsZSl7Yi54aHImJmIueGhyLmFib3J0KCksYi54aHI9YS5hamF4KHt1cmw6ZCxkYXRhOmMsZGF0YVR5cGU6Impzb24iLHN1Y2Nlc3M6ZnVuY3Rpb24oYSxiKXtlKGEpfSxlcnJvcjpmdW5jdGlvbigpe2UoW10pfX0pfSk6dGhpcy5zb3VyY2U9dGhpcy5vcHRpb25zLnNvdXJjZX0sc2VhcmNoOmZ1bmN0aW9uKGEsYil7YT1hIT1udWxsP2E6dGhpcy5lbGVtZW50LnZhbCgpLHRoaXMudGVybT10aGlzLmVsZW1lbnQudmFsKCk7aWYoYS5sZW5ndGg8dGhpcy5vcHRpb25zLm1pbkxlbmd0aClyZXR1cm4gdGhpcy5jbG9zZShiKTtjbGVhclRpbWVvdXQodGhpcy5jbG9zaW5nKTtpZih0aGlzLl90cmlnZ2VyKCJzZWFyY2giLGIpPT09ITEpcmV0dXJuO3JldHVybiB0aGlzLl9zZWFyY2goYSl9LF9zZWFyY2g6ZnVuY3Rpb24oYSl7dGhpcy5wZW5kaW5nKyssdGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1hdXRvY29tcGxldGUtbG9hZGluZyIpLHRoaXMuc291cmNlKHt0ZXJtOmF9LHRoaXMuX3Jlc3BvbnNlKCkpfSxfcmVzcG9uc2U6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLGI9KytjO3JldHVybiBmdW5jdGlvbihkKXtiPT09YyYmYS5fX3Jlc3BvbnNlKGQpLGEucGVuZGluZy0tLGEucGVuZGluZ3x8YS5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1hdXRvY29tcGxldGUtbG9hZGluZyIpfX0sX19yZXNwb25zZTpmdW5jdGlvbihhKXshdGhpcy5vcHRpb25zLmRpc2FibGVkJiZhJiZhLmxlbmd0aD8oYT10aGlzLl9ub3JtYWxpemUoYSksdGhpcy5fc3VnZ2VzdChhKSx0aGlzLl90cmlnZ2VyKCJvcGVuIikpOnRoaXMuY2xvc2UoKX0sY2xvc2U6ZnVuY3Rpb24oYSl7Y2xlYXJUaW1lb3V0KHRoaXMuY2xvc2luZyksdGhpcy5tZW51LmVsZW1lbnQuaXMoIjp2aXNpYmxlIikmJih0aGlzLm1lbnUuZWxlbWVudC5oaWRlKCksdGhpcy5tZW51LmRlYWN0aXZhdGUoKSx0aGlzLl90cmlnZ2VyKCJjbG9zZSIsYSkpfSxfY2hhbmdlOmZ1bmN0aW9uKGEpe3RoaXMucHJldmlvdXMhPT10aGlzLmVsZW1lbnQudmFsKCkmJnRoaXMuX3RyaWdnZXIoImNoYW5nZSIsYSx7aXRlbTp0aGlzLnNlbGVjdGVkSXRlbX0pfSxfbm9ybWFsaXplOmZ1bmN0aW9uKGIpe3JldHVybiBiLmxlbmd0aCYmYlswXS5sYWJlbCYmYlswXS52YWx1ZT9iOmEubWFwKGIsZnVuY3Rpb24oYil7cmV0dXJuIHR5cGVvZiBiPT0ic3RyaW5nIj97bGFiZWw6Yix2YWx1ZTpifTphLmV4dGVuZCh7bGFiZWw6Yi5sYWJlbHx8Yi52YWx1ZSx2YWx1ZTpiLnZhbHVlfHxiLmxhYmVsfSxiKX0pfSxfc3VnZ2VzdDpmdW5jdGlvbihiKXt2YXIgYz10aGlzLm1lbnUuZWxlbWVudC5lbXB0eSgpLnpJbmRleCh0aGlzLmVsZW1lbnQuekluZGV4KCkrMSk7dGhpcy5fcmVuZGVyTWVudShjLGIpLHRoaXMubWVudS5kZWFjdGl2YXRlKCksdGhpcy5tZW51LnJlZnJlc2goKSxjLnNob3coKSx0aGlzLl9yZXNpemVNZW51KCksYy5wb3NpdGlvbihhLmV4dGVuZCh7b2Y6dGhpcy5lbGVtZW50fSx0aGlzLm9wdGlvbnMucG9zaXRpb24pKSx0aGlzLm9wdGlvbnMuYXV0b0ZvY3VzJiZ0aGlzLm1lbnUubmV4dChuZXcgYS5FdmVudCgibW91c2VvdmVyIikpfSxfcmVzaXplTWVudTpmdW5jdGlvbigpe3ZhciBhPXRoaXMubWVudS5lbGVtZW50O2Eub3V0ZXJXaWR0aChNYXRoLm1heChhLndpZHRoKCIiKS5vdXRlcldpZHRoKCkrMSx0aGlzLmVsZW1lbnQub3V0ZXJXaWR0aCgpKSl9LF9yZW5kZXJNZW51OmZ1bmN0aW9uKGIsYyl7dmFyIGQ9dGhpczthLmVhY2goYyxmdW5jdGlvbihhLGMpe2QuX3JlbmRlckl0ZW0oYixjKX0pfSxfcmVuZGVySXRlbTpmdW5jdGlvbihiLGMpe3JldHVybiBhKCI8bGk+PC9saT4iKS5kYXRhKCJpdGVtLmF1dG9jb21wbGV0ZSIsYykuYXBwZW5kKGEoIjxhPjwvYT4iKS50ZXh0KGMubGFiZWwpKS5hcHBlbmRUbyhiKX0sX21vdmU6ZnVuY3Rpb24oYSxiKXtpZighdGhpcy5tZW51LmVsZW1lbnQuaXMoIjp2aXNpYmxlIikpe3RoaXMuc2VhcmNoKG51bGwsYik7cmV0dXJufWlmKHRoaXMubWVudS5maXJzdCgpJiYvXnByZXZpb3VzLy50ZXN0KGEpfHx0aGlzLm1lbnUubGFzdCgpJiYvXm5leHQvLnRlc3QoYSkpe3RoaXMuZWxlbWVudC52YWwodGhpcy50ZXJtKSx0aGlzLm1lbnUuZGVhY3RpdmF0ZSgpO3JldHVybn10aGlzLm1lbnVbYV0oYil9LHdpZGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1lbnUuZWxlbWVudH0sX2tleUV2ZW50OmZ1bmN0aW9uKGEsYil7aWYoIXRoaXMuaXNNdWx0aUxpbmV8fHRoaXMubWVudS5lbGVtZW50LmlzKCI6dmlzaWJsZSIpKXRoaXMuX21vdmUoYSxiKSxiLnByZXZlbnREZWZhdWx0KCl9fSksYS5leHRlbmQoYS51aS5hdXRvY29tcGxldGUse2VzY2FwZVJlZ2V4OmZ1bmN0aW9uKGEpe3JldHVybiBhLnJlcGxhY2UoL1stW1xde30oKSorPy4sXFxeJHwjXHNdL2csIlxcJCYiKX0sZmlsdGVyOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9bmV3IFJlZ0V4cChhLnVpLmF1dG9jb21wbGV0ZS5lc2NhcGVSZWdleChjKSwiaSIpO3JldHVybiBhLmdyZXAoYixmdW5jdGlvbihhKXtyZXR1cm4gZC50ZXN0KGEubGFiZWx8fGEudmFsdWV8fGEpfSl9fSl9KShqUXVlcnkpLGZ1bmN0aW9uKGEpe2Eud2lkZ2V0KCJ1aS5tZW51Iix7X2NyZWF0ZTpmdW5jdGlvbigpe3ZhciBiPXRoaXM7dGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1tZW51IHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsIikuYXR0cih7cm9sZToibGlzdGJveCIsImFyaWEtYWN0aXZlZGVzY2VuZGFudCI6InVpLWFjdGl2ZS1tZW51aXRlbSJ9KS5jbGljayhmdW5jdGlvbihjKXtpZighYShjLnRhcmdldCkuY2xvc2VzdCgiLnVpLW1lbnUtaXRlbSBhIikubGVuZ3RoKXJldHVybjtjLnByZXZlbnREZWZhdWx0KCksYi5zZWxlY3QoYyl9KSx0aGlzLnJlZnJlc2goKX0scmVmcmVzaDpmdW5jdGlvbigpe3ZhciBiPXRoaXMsYz10aGlzLmVsZW1lbnQuY2hpbGRyZW4oImxpOm5vdCgudWktbWVudS1pdGVtKTpoYXMoYSkiKS5hZGRDbGFzcygidWktbWVudS1pdGVtIikuYXR0cigicm9sZSIsIm1lbnVpdGVtIik7Yy5jaGlsZHJlbigiYSIpLmFkZENsYXNzKCJ1aS1jb3JuZXItYWxsIikuYXR0cigidGFiaW5kZXgiLC0xKS5tb3VzZWVudGVyKGZ1bmN0aW9uKGMpe2IuYWN0aXZhdGUoYyxhKHRoaXMpLnBhcmVudCgpKX0pLm1vdXNlbGVhdmUoZnVuY3Rpb24oKXtiLmRlYWN0aXZhdGUoKX0pfSxhY3RpdmF0ZTpmdW5jdGlvbihhLGIpe3RoaXMuZGVhY3RpdmF0ZSgpO2lmKHRoaXMuaGFzU2Nyb2xsKCkpe3ZhciBjPWIub2Zmc2V0KCkudG9wLXRoaXMuZWxlbWVudC5vZmZzZXQoKS50b3AsZD10aGlzLmVsZW1lbnQuc2Nyb2xsVG9wKCksZT10aGlzLmVsZW1lbnQuaGVpZ2h0KCk7YzwwP3RoaXMuZWxlbWVudC5zY3JvbGxUb3AoZCtjKTpjPj1lJiZ0aGlzLmVsZW1lbnQuc2Nyb2xsVG9wKGQrYy1lK2IuaGVpZ2h0KCkpfXRoaXMuYWN0aXZlPWIuZXEoMCkuY2hpbGRyZW4oImEiKS5hZGRDbGFzcygidWktc3RhdGUtaG92ZXIiKS5hdHRyKCJpZCIsInVpLWFjdGl2ZS1tZW51aXRlbSIpLmVuZCgpLHRoaXMuX3RyaWdnZXIoImZvY3VzIixhLHtpdGVtOmJ9KX0sZGVhY3RpdmF0ZTpmdW5jdGlvbigpe2lmKCF0aGlzLmFjdGl2ZSlyZXR1cm47dGhpcy5hY3RpdmUuY2hpbGRyZW4oImEiKS5yZW1vdmVDbGFzcygidWktc3RhdGUtaG92ZXIiKS5yZW1vdmVBdHRyKCJpZCIpLHRoaXMuX3RyaWdnZXIoImJsdXIiKSx0aGlzLmFjdGl2ZT1udWxsfSxuZXh0OmZ1bmN0aW9uKGEpe3RoaXMubW92ZSgibmV4dCIsIi51aS1tZW51LWl0ZW06Zmlyc3QiLGEpfSxwcmV2aW91czpmdW5jdGlvbihhKXt0aGlzLm1vdmUoInByZXYiLCIudWktbWVudS1pdGVtOmxhc3QiLGEpfSxmaXJzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmFjdGl2ZSYmIXRoaXMuYWN0aXZlLnByZXZBbGwoIi51aS1tZW51LWl0ZW0iKS5sZW5ndGh9LGxhc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5hY3RpdmUmJiF0aGlzLmFjdGl2ZS5uZXh0QWxsKCIudWktbWVudS1pdGVtIikubGVuZ3RofSxtb3ZlOmZ1bmN0aW9uKGEsYixjKXtpZighdGhpcy5hY3RpdmUpe3RoaXMuYWN0aXZhdGUoYyx0aGlzLmVsZW1lbnQuY2hpbGRyZW4oYikpO3JldHVybn12YXIgZD10aGlzLmFjdGl2ZVthKyJBbGwiXSgiLnVpLW1lbnUtaXRlbSIpLmVxKDApO2QubGVuZ3RoP3RoaXMuYWN0aXZhdGUoYyxkKTp0aGlzLmFjdGl2YXRlKGMsdGhpcy5lbGVtZW50LmNoaWxkcmVuKGIpKX0sbmV4dFBhZ2U6ZnVuY3Rpb24oYil7aWYodGhpcy5oYXNTY3JvbGwoKSl7aWYoIXRoaXMuYWN0aXZlfHx0aGlzLmxhc3QoKSl7dGhpcy5hY3RpdmF0ZShiLHRoaXMuZWxlbWVudC5jaGlsZHJlbigiLnVpLW1lbnUtaXRlbTpmaXJzdCIpKTtyZXR1cm59dmFyIGM9dGhpcy5hY3RpdmUub2Zmc2V0KCkudG9wLGQ9dGhpcy5lbGVtZW50LmhlaWdodCgpLGU9dGhpcy5lbGVtZW50LmNoaWxkcmVuKCIudWktbWVudS1pdGVtIikuZmlsdGVyKGZ1bmN0aW9uKCl7dmFyIGI9YSh0aGlzKS5vZmZzZXQoKS50b3AtYy1kK2EodGhpcykuaGVpZ2h0KCk7cmV0dXJuIGI8MTAmJmI+LTEwfSk7ZS5sZW5ndGh8fChlPXRoaXMuZWxlbWVudC5jaGlsZHJlbigiLnVpLW1lbnUtaXRlbTpsYXN0IikpLHRoaXMuYWN0aXZhdGUoYixlKX1lbHNlIHRoaXMuYWN0aXZhdGUoYix0aGlzLmVsZW1lbnQuY2hpbGRyZW4oIi51aS1tZW51LWl0ZW0iKS5maWx0ZXIoIXRoaXMuYWN0aXZlfHx0aGlzLmxhc3QoKT8iOmZpcnN0IjoiOmxhc3QiKSl9LHByZXZpb3VzUGFnZTpmdW5jdGlvbihiKXtpZih0aGlzLmhhc1Njcm9sbCgpKXtpZighdGhpcy5hY3RpdmV8fHRoaXMuZmlyc3QoKSl7dGhpcy5hY3RpdmF0ZShiLHRoaXMuZWxlbWVudC5jaGlsZHJlbigiLnVpLW1lbnUtaXRlbTpsYXN0IikpO3JldHVybn12YXIgYz10aGlzLmFjdGl2ZS5vZmZzZXQoKS50b3AsZD10aGlzLmVsZW1lbnQuaGVpZ2h0KCksZT10aGlzLmVsZW1lbnQuY2hpbGRyZW4oIi51aS1tZW51LWl0ZW0iKS5maWx0ZXIoZnVuY3Rpb24oKXt2YXIgYj1hKHRoaXMpLm9mZnNldCgpLnRvcC1jK2QtYSh0aGlzKS5oZWlnaHQoKTtyZXR1cm4gYjwxMCYmYj4tMTB9KTtlLmxlbmd0aHx8KGU9dGhpcy5lbGVtZW50LmNoaWxkcmVuKCIudWktbWVudS1pdGVtOmZpcnN0IikpLHRoaXMuYWN0aXZhdGUoYixlKX1lbHNlIHRoaXMuYWN0aXZhdGUoYix0aGlzLmVsZW1lbnQuY2hpbGRyZW4oIi51aS1tZW51LWl0ZW0iKS5maWx0ZXIoIXRoaXMuYWN0aXZlfHx0aGlzLmZpcnN0KCk/IjpsYXN0IjoiOmZpcnN0IikpfSxoYXNTY3JvbGw6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lbGVtZW50LmhlaWdodCgpPHRoaXMuZWxlbWVudFthLmZuLnByb3A/InByb3AiOiJhdHRyIl0oInNjcm9sbEhlaWdodCIpfSxzZWxlY3Q6ZnVuY3Rpb24oYSl7dGhpcy5fdHJpZ2dlcigic2VsZWN0ZWQiLGEse2l0ZW06dGhpcy5hY3RpdmV9KX19KX0oalF1ZXJ5KTs7LyohIGpRdWVyeSBVSSAtIHYxLjguMjAgLSAyMDEyLTA0LTMwCiogaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkKKiBJbmNsdWRlczoganF1ZXJ5LnVpLmJ1dHRvbi5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKGEsYil7dmFyIGMsZCxlLGYsZz0idWktYnV0dG9uIHVpLXdpZGdldCB1aS1zdGF0ZS1kZWZhdWx0IHVpLWNvcm5lci1hbGwiLGg9InVpLXN0YXRlLWhvdmVyIHVpLXN0YXRlLWFjdGl2ZSAiLGk9InVpLWJ1dHRvbi1pY29ucy1vbmx5IHVpLWJ1dHRvbi1pY29uLW9ubHkgdWktYnV0dG9uLXRleHQtaWNvbnMgdWktYnV0dG9uLXRleHQtaWNvbi1wcmltYXJ5IHVpLWJ1dHRvbi10ZXh0LWljb24tc2Vjb25kYXJ5IHVpLWJ1dHRvbi10ZXh0LW9ubHkiLGo9ZnVuY3Rpb24oKXt2YXIgYj1hKHRoaXMpLmZpbmQoIjp1aS1idXR0b24iKTtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yi5idXR0b24oInJlZnJlc2giKX0sMSl9LGs9ZnVuY3Rpb24oYil7dmFyIGM9Yi5uYW1lLGQ9Yi5mb3JtLGU9YShbXSk7cmV0dXJuIGMmJihkP2U9YShkKS5maW5kKCJbbmFtZT0nIitjKyInXSIpOmU9YSgiW25hbWU9JyIrYysiJ10iLGIub3duZXJEb2N1bWVudCkuZmlsdGVyKGZ1bmN0aW9uKCl7cmV0dXJuIXRoaXMuZm9ybX0pKSxlfTthLndpZGdldCgidWkuYnV0dG9uIix7b3B0aW9uczp7ZGlzYWJsZWQ6bnVsbCx0ZXh0OiEwLGxhYmVsOm51bGwsaWNvbnM6e3ByaW1hcnk6bnVsbCxzZWNvbmRhcnk6bnVsbH19LF9jcmVhdGU6ZnVuY3Rpb24oKXt0aGlzLmVsZW1lbnQuY2xvc2VzdCgiZm9ybSIpLnVuYmluZCgicmVzZXQuYnV0dG9uIikuYmluZCgicmVzZXQuYnV0dG9uIixqKSx0eXBlb2YgdGhpcy5vcHRpb25zLmRpc2FibGVkIT0iYm9vbGVhbiI/dGhpcy5vcHRpb25zLmRpc2FibGVkPSEhdGhpcy5lbGVtZW50LnByb3BBdHRyKCJkaXNhYmxlZCIpOnRoaXMuZWxlbWVudC5wcm9wQXR0cigiZGlzYWJsZWQiLHRoaXMub3B0aW9ucy5kaXNhYmxlZCksdGhpcy5fZGV0ZXJtaW5lQnV0dG9uVHlwZSgpLHRoaXMuaGFzVGl0bGU9ISF0aGlzLmJ1dHRvbkVsZW1lbnQuYXR0cigidGl0bGUiKTt2YXIgYj10aGlzLGg9dGhpcy5vcHRpb25zLGk9dGhpcy50eXBlPT09ImNoZWNrYm94Inx8dGhpcy50eXBlPT09InJhZGlvIixsPSJ1aS1zdGF0ZS1ob3ZlciIrKGk/IiI6IiB1aS1zdGF0ZS1hY3RpdmUiKSxtPSJ1aS1zdGF0ZS1mb2N1cyI7aC5sYWJlbD09PW51bGwmJihoLmxhYmVsPXRoaXMuYnV0dG9uRWxlbWVudC5odG1sKCkpLHRoaXMuYnV0dG9uRWxlbWVudC5hZGRDbGFzcyhnKS5hdHRyKCJyb2xlIiwiYnV0dG9uIikuYmluZCgibW91c2VlbnRlci5idXR0b24iLGZ1bmN0aW9uKCl7aWYoaC5kaXNhYmxlZClyZXR1cm47YSh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtaG92ZXIiKSx0aGlzPT09YyYmYSh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtYWN0aXZlIil9KS5iaW5kKCJtb3VzZWxlYXZlLmJ1dHRvbiIsZnVuY3Rpb24oKXtpZihoLmRpc2FibGVkKXJldHVybjthKHRoaXMpLnJlbW92ZUNsYXNzKGwpfSkuYmluZCgiY2xpY2suYnV0dG9uIixmdW5jdGlvbihhKXtoLmRpc2FibGVkJiYoYS5wcmV2ZW50RGVmYXVsdCgpLGEuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCkpfSksdGhpcy5lbGVtZW50LmJpbmQoImZvY3VzLmJ1dHRvbiIsZnVuY3Rpb24oKXtiLmJ1dHRvbkVsZW1lbnQuYWRkQ2xhc3MobSl9KS5iaW5kKCJibHVyLmJ1dHRvbiIsZnVuY3Rpb24oKXtiLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQ2xhc3MobSl9KSxpJiYodGhpcy5lbGVtZW50LmJpbmQoImNoYW5nZS5idXR0b24iLGZ1bmN0aW9uKCl7aWYoZilyZXR1cm47Yi5yZWZyZXNoKCl9KSx0aGlzLmJ1dHRvbkVsZW1lbnQuYmluZCgibW91c2Vkb3duLmJ1dHRvbiIsZnVuY3Rpb24oYSl7aWYoaC5kaXNhYmxlZClyZXR1cm47Zj0hMSxkPWEucGFnZVgsZT1hLnBhZ2VZfSkuYmluZCgibW91c2V1cC5idXR0b24iLGZ1bmN0aW9uKGEpe2lmKGguZGlzYWJsZWQpcmV0dXJuO2lmKGQhPT1hLnBhZ2VYfHxlIT09YS5wYWdlWSlmPSEwfSkpLHRoaXMudHlwZT09PSJjaGVja2JveCI/dGhpcy5idXR0b25FbGVtZW50LmJpbmQoImNsaWNrLmJ1dHRvbiIsZnVuY3Rpb24oKXtpZihoLmRpc2FibGVkfHxmKXJldHVybiExO2EodGhpcykudG9nZ2xlQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpLGIuYnV0dG9uRWxlbWVudC5hdHRyKCJhcmlhLXByZXNzZWQiLGIuZWxlbWVudFswXS5jaGVja2VkKX0pOnRoaXMudHlwZT09PSJyYWRpbyI/dGhpcy5idXR0b25FbGVtZW50LmJpbmQoImNsaWNrLmJ1dHRvbiIsZnVuY3Rpb24oKXtpZihoLmRpc2FibGVkfHxmKXJldHVybiExO2EodGhpcykuYWRkQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpLGIuYnV0dG9uRWxlbWVudC5hdHRyKCJhcmlhLXByZXNzZWQiLCJ0cnVlIik7dmFyIGM9Yi5lbGVtZW50WzBdO2soYykubm90KGMpLm1hcChmdW5jdGlvbigpe3JldHVybiBhKHRoaXMpLmJ1dHRvbigid2lkZ2V0IilbMF19KS5yZW1vdmVDbGFzcygidWktc3RhdGUtYWN0aXZlIikuYXR0cigiYXJpYS1wcmVzc2VkIiwiZmFsc2UiKX0pOih0aGlzLmJ1dHRvbkVsZW1lbnQuYmluZCgibW91c2Vkb3duLmJ1dHRvbiIsZnVuY3Rpb24oKXtpZihoLmRpc2FibGVkKXJldHVybiExO2EodGhpcykuYWRkQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpLGM9dGhpcyxhKGRvY3VtZW50KS5vbmUoIm1vdXNldXAiLGZ1bmN0aW9uKCl7Yz1udWxsfSl9KS5iaW5kKCJtb3VzZXVwLmJ1dHRvbiIsZnVuY3Rpb24oKXtpZihoLmRpc2FibGVkKXJldHVybiExO2EodGhpcykucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpfSkuYmluZCgia2V5ZG93bi5idXR0b24iLGZ1bmN0aW9uKGIpe2lmKGguZGlzYWJsZWQpcmV0dXJuITE7KGIua2V5Q29kZT09YS51aS5rZXlDb2RlLlNQQUNFfHxiLmtleUNvZGU9PWEudWkua2V5Q29kZS5FTlRFUikmJmEodGhpcykuYWRkQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpfSkuYmluZCgia2V5dXAuYnV0dG9uIixmdW5jdGlvbigpe2EodGhpcykucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpfSksdGhpcy5idXR0b25FbGVtZW50LmlzKCJhIikmJnRoaXMuYnV0dG9uRWxlbWVudC5rZXl1cChmdW5jdGlvbihiKXtiLmtleUNvZGU9PT1hLnVpLmtleUNvZGUuU1BBQ0UmJmEodGhpcykuY2xpY2soKX0pKSx0aGlzLl9zZXRPcHRpb24oImRpc2FibGVkIixoLmRpc2FibGVkKSx0aGlzLl9yZXNldEJ1dHRvbigpfSxfZGV0ZXJtaW5lQnV0dG9uVHlwZTpmdW5jdGlvbigpe3RoaXMuZWxlbWVudC5pcygiOmNoZWNrYm94Iik/dGhpcy50eXBlPSJjaGVja2JveCI6dGhpcy5lbGVtZW50LmlzKCI6cmFkaW8iKT90aGlzLnR5cGU9InJhZGlvIjp0aGlzLmVsZW1lbnQuaXMoImlucHV0Iik/dGhpcy50eXBlPSJpbnB1dCI6dGhpcy50eXBlPSJidXR0b24iO2lmKHRoaXMudHlwZT09PSJjaGVja2JveCJ8fHRoaXMudHlwZT09PSJyYWRpbyIpe3ZhciBhPXRoaXMuZWxlbWVudC5wYXJlbnRzKCkuZmlsdGVyKCI6bGFzdCIpLGI9ImxhYmVsW2Zvcj0nIit0aGlzLmVsZW1lbnQuYXR0cigiaWQiKSsiJ10iO3RoaXMuYnV0dG9uRWxlbWVudD1hLmZpbmQoYiksdGhpcy5idXR0b25FbGVtZW50Lmxlbmd0aHx8KGE9YS5sZW5ndGg/YS5zaWJsaW5ncygpOnRoaXMuZWxlbWVudC5zaWJsaW5ncygpLHRoaXMuYnV0dG9uRWxlbWVudD1hLmZpbHRlcihiKSx0aGlzLmJ1dHRvbkVsZW1lbnQubGVuZ3RofHwodGhpcy5idXR0b25FbGVtZW50PWEuZmluZChiKSkpLHRoaXMuZWxlbWVudC5hZGRDbGFzcygidWktaGVscGVyLWhpZGRlbi1hY2Nlc3NpYmxlIik7dmFyIGM9dGhpcy5lbGVtZW50LmlzKCI6Y2hlY2tlZCIpO2MmJnRoaXMuYnV0dG9uRWxlbWVudC5hZGRDbGFzcygidWktc3RhdGUtYWN0aXZlIiksdGhpcy5idXR0b25FbGVtZW50LmF0dHIoImFyaWEtcHJlc3NlZCIsYyl9ZWxzZSB0aGlzLmJ1dHRvbkVsZW1lbnQ9dGhpcy5lbGVtZW50fSx3aWRnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5idXR0b25FbGVtZW50fSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1oZWxwZXItaGlkZGVuLWFjY2Vzc2libGUiKSx0aGlzLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQ2xhc3MoZysiICIraCsiICIraSkucmVtb3ZlQXR0cigicm9sZSIpLnJlbW92ZUF0dHIoImFyaWEtcHJlc3NlZCIpLmh0bWwodGhpcy5idXR0b25FbGVtZW50LmZpbmQoIi51aS1idXR0b24tdGV4dCIpLmh0bWwoKSksdGhpcy5oYXNUaXRsZXx8dGhpcy5idXR0b25FbGVtZW50LnJlbW92ZUF0dHIoInRpdGxlIiksYS5XaWRnZXQucHJvdG90eXBlLmRlc3Ryb3kuY2FsbCh0aGlzKX0sX3NldE9wdGlvbjpmdW5jdGlvbihiLGMpe2EuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtpZihiPT09ImRpc2FibGVkIil7Yz90aGlzLmVsZW1lbnQucHJvcEF0dHIoImRpc2FibGVkIiwhMCk6dGhpcy5lbGVtZW50LnByb3BBdHRyKCJkaXNhYmxlZCIsITEpO3JldHVybn10aGlzLl9yZXNldEJ1dHRvbigpfSxyZWZyZXNoOmZ1bmN0aW9uKCl7dmFyIGI9dGhpcy5lbGVtZW50LmlzKCI6ZGlzYWJsZWQiKTtiIT09dGhpcy5vcHRpb25zLmRpc2FibGVkJiZ0aGlzLl9zZXRPcHRpb24oImRpc2FibGVkIixiKSx0aGlzLnR5cGU9PT0icmFkaW8iP2sodGhpcy5lbGVtZW50WzBdKS5lYWNoKGZ1bmN0aW9uKCl7YSh0aGlzKS5pcygiOmNoZWNrZWQiKT9hKHRoaXMpLmJ1dHRvbigid2lkZ2V0IikuYWRkQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpLmF0dHIoImFyaWEtcHJlc3NlZCIsInRydWUiKTphKHRoaXMpLmJ1dHRvbigid2lkZ2V0IikucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpLmF0dHIoImFyaWEtcHJlc3NlZCIsImZhbHNlIil9KTp0aGlzLnR5cGU9PT0iY2hlY2tib3giJiYodGhpcy5lbGVtZW50LmlzKCI6Y2hlY2tlZCIpP3RoaXMuYnV0dG9uRWxlbWVudC5hZGRDbGFzcygidWktc3RhdGUtYWN0aXZlIikuYXR0cigiYXJpYS1wcmVzc2VkIiwidHJ1ZSIpOnRoaXMuYnV0dG9uRWxlbWVudC5yZW1vdmVDbGFzcygidWktc3RhdGUtYWN0aXZlIikuYXR0cigiYXJpYS1wcmVzc2VkIiwiZmFsc2UiKSl9LF9yZXNldEJ1dHRvbjpmdW5jdGlvbigpe2lmKHRoaXMudHlwZT09PSJpbnB1dCIpe3RoaXMub3B0aW9ucy5sYWJlbCYmdGhpcy5lbGVtZW50LnZhbCh0aGlzLm9wdGlvbnMubGFiZWwpO3JldHVybn12YXIgYj10aGlzLmJ1dHRvbkVsZW1lbnQucmVtb3ZlQ2xhc3MoaSksYz1hKCI8c3Bhbj48L3NwYW4+Iix0aGlzLmVsZW1lbnRbMF0ub3duZXJEb2N1bWVudCkuYWRkQ2xhc3MoInVpLWJ1dHRvbi10ZXh0IikuaHRtbCh0aGlzLm9wdGlvbnMubGFiZWwpLmFwcGVuZFRvKGIuZW1wdHkoKSkudGV4dCgpLGQ9dGhpcy5vcHRpb25zLmljb25zLGU9ZC5wcmltYXJ5JiZkLnNlY29uZGFyeSxmPVtdO2QucHJpbWFyeXx8ZC5zZWNvbmRhcnk/KHRoaXMub3B0aW9ucy50ZXh0JiZmLnB1c2goInVpLWJ1dHRvbi10ZXh0LWljb24iKyhlPyJzIjpkLnByaW1hcnk/Ii1wcmltYXJ5IjoiLXNlY29uZGFyeSIpKSxkLnByaW1hcnkmJmIucHJlcGVuZCgiPHNwYW4gY2xhc3M9J3VpLWJ1dHRvbi1pY29uLXByaW1hcnkgdWktaWNvbiAiK2QucHJpbWFyeSsiJz48L3NwYW4+IiksZC5zZWNvbmRhcnkmJmIuYXBwZW5kKCI8c3BhbiBjbGFzcz0ndWktYnV0dG9uLWljb24tc2Vjb25kYXJ5IHVpLWljb24gIitkLnNlY29uZGFyeSsiJz48L3NwYW4+IiksdGhpcy5vcHRpb25zLnRleHR8fChmLnB1c2goZT8idWktYnV0dG9uLWljb25zLW9ubHkiOiJ1aS1idXR0b24taWNvbi1vbmx5IiksdGhpcy5oYXNUaXRsZXx8Yi5hdHRyKCJ0aXRsZSIsYykpKTpmLnB1c2goInVpLWJ1dHRvbi10ZXh0LW9ubHkiKSxiLmFkZENsYXNzKGYuam9pbigiICIpKX19KSxhLndpZGdldCgidWkuYnV0dG9uc2V0Iix7b3B0aW9uczp7aXRlbXM6IjpidXR0b24sIDpzdWJtaXQsIDpyZXNldCwgOmNoZWNrYm94LCA6cmFkaW8sIGEsIDpkYXRhKGJ1dHRvbikifSxfY3JlYXRlOmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1idXR0b25zZXQiKX0sX2luaXQ6ZnVuY3Rpb24oKXt0aGlzLnJlZnJlc2goKX0sX3NldE9wdGlvbjpmdW5jdGlvbihiLGMpe2I9PT0iZGlzYWJsZWQiJiZ0aGlzLmJ1dHRvbnMuYnV0dG9uKCJvcHRpb24iLGIsYyksYS5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpfSxyZWZyZXNoOmZ1bmN0aW9uKCl7dmFyIGI9dGhpcy5lbGVtZW50LmNzcygiZGlyZWN0aW9uIik9PT0icnRsIjt0aGlzLmJ1dHRvbnM9dGhpcy5lbGVtZW50LmZpbmQodGhpcy5vcHRpb25zLml0ZW1zKS5maWx0ZXIoIjp1aS1idXR0b24iKS5idXR0b24oInJlZnJlc2giKS5lbmQoKS5ub3QoIjp1aS1idXR0b24iKS5idXR0b24oKS5lbmQoKS5tYXAoZnVuY3Rpb24oKXtyZXR1cm4gYSh0aGlzKS5idXR0b24oIndpZGdldCIpWzBdfSkucmVtb3ZlQ2xhc3MoInVpLWNvcm5lci1hbGwgdWktY29ybmVyLWxlZnQgdWktY29ybmVyLXJpZ2h0IikuZmlsdGVyKCI6Zmlyc3QiKS5hZGRDbGFzcyhiPyJ1aS1jb3JuZXItcmlnaHQiOiJ1aS1jb3JuZXItbGVmdCIpLmVuZCgpLmZpbHRlcigiOmxhc3QiKS5hZGRDbGFzcyhiPyJ1aS1jb3JuZXItbGVmdCI6InVpLWNvcm5lci1yaWdodCIpLmVuZCgpLmVuZCgpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1idXR0b25zZXQiKSx0aGlzLmJ1dHRvbnMubWFwKGZ1bmN0aW9uKCl7cmV0dXJuIGEodGhpcykuYnV0dG9uKCJ3aWRnZXQiKVswXX0pLnJlbW92ZUNsYXNzKCJ1aS1jb3JuZXItbGVmdCB1aS1jb3JuZXItcmlnaHQiKS5lbmQoKS5idXR0b24oImRlc3Ryb3kiKSxhLldpZGdldC5wcm90b3R5cGUuZGVzdHJveS5jYWxsKHRoaXMpfX0pfSkoalF1ZXJ5KTs7LyohIGpRdWVyeSBVSSAtIHYxLjguMjAgLSAyMDEyLTA0LTMwCiogaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkKKiBJbmNsdWRlczoganF1ZXJ5LnVpLmRpYWxvZy5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKGEsYil7dmFyIGM9InVpLWRpYWxvZyB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCAiLGQ9e2J1dHRvbnM6ITAsaGVpZ2h0OiEwLG1heEhlaWdodDohMCxtYXhXaWR0aDohMCxtaW5IZWlnaHQ6ITAsbWluV2lkdGg6ITAsd2lkdGg6ITB9LGU9e21heEhlaWdodDohMCxtYXhXaWR0aDohMCxtaW5IZWlnaHQ6ITAsbWluV2lkdGg6ITB9LGY9YS5hdHRyRm58fHt2YWw6ITAsY3NzOiEwLGh0bWw6ITAsdGV4dDohMCxkYXRhOiEwLHdpZHRoOiEwLGhlaWdodDohMCxvZmZzZXQ6ITAsY2xpY2s6ITB9O2Eud2lkZ2V0KCJ1aS5kaWFsb2ciLHtvcHRpb25zOnthdXRvT3BlbjohMCxidXR0b25zOnt9LGNsb3NlT25Fc2NhcGU6ITAsY2xvc2VUZXh0OiJjbG9zZSIsZGlhbG9nQ2xhc3M6IiIsZHJhZ2dhYmxlOiEwLGhpZGU6bnVsbCxoZWlnaHQ6ImF1dG8iLG1heEhlaWdodDohMSxtYXhXaWR0aDohMSxtaW5IZWlnaHQ6MTUwLG1pbldpZHRoOjE1MCxtb2RhbDohMSxwb3NpdGlvbjp7bXk6ImNlbnRlciIsYXQ6ImNlbnRlciIsY29sbGlzaW9uOiJmaXQiLHVzaW5nOmZ1bmN0aW9uKGIpe3ZhciBjPWEodGhpcykuY3NzKGIpLm9mZnNldCgpLnRvcDtjPDAmJmEodGhpcykuY3NzKCJ0b3AiLGIudG9wLWMpfX0scmVzaXphYmxlOiEwLHNob3c6bnVsbCxzdGFjazohMCx0aXRsZToiIix3aWR0aDozMDAsekluZGV4OjFlM30sX2NyZWF0ZTpmdW5jdGlvbigpe3RoaXMub3JpZ2luYWxUaXRsZT10aGlzLmVsZW1lbnQuYXR0cigidGl0bGUiKSx0eXBlb2YgdGhpcy5vcmlnaW5hbFRpdGxlIT0ic3RyaW5nIiYmKHRoaXMub3JpZ2luYWxUaXRsZT0iIiksdGhpcy5vcHRpb25zLnRpdGxlPXRoaXMub3B0aW9ucy50aXRsZXx8dGhpcy5vcmlnaW5hbFRpdGxlO3ZhciBiPXRoaXMsZD1iLm9wdGlvbnMsZT1kLnRpdGxlfHwiJiMxNjA7IixmPWEudWkuZGlhbG9nLmdldFRpdGxlSWQoYi5lbGVtZW50KSxnPShiLnVpRGlhbG9nPWEoIjxkaXY+PC9kaXY+IikpLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpLmhpZGUoKS5hZGRDbGFzcyhjK2QuZGlhbG9nQ2xhc3MpLmNzcyh7ekluZGV4OmQuekluZGV4fSkuYXR0cigidGFiSW5kZXgiLC0xKS5jc3MoIm91dGxpbmUiLDApLmtleWRvd24oZnVuY3Rpb24oYyl7ZC5jbG9zZU9uRXNjYXBlJiYhYy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSYmYy5rZXlDb2RlJiZjLmtleUNvZGU9PT1hLnVpLmtleUNvZGUuRVNDQVBFJiYoYi5jbG9zZShjKSxjLnByZXZlbnREZWZhdWx0KCkpfSkuYXR0cih7cm9sZToiZGlhbG9nIiwiYXJpYS1sYWJlbGxlZGJ5IjpmfSkubW91c2Vkb3duKGZ1bmN0aW9uKGEpe2IubW92ZVRvVG9wKCExLGEpfSksaD1iLmVsZW1lbnQuc2hvdygpLnJlbW92ZUF0dHIoInRpdGxlIikuYWRkQ2xhc3MoInVpLWRpYWxvZy1jb250ZW50IHVpLXdpZGdldC1jb250ZW50IikuYXBwZW5kVG8oZyksaT0oYi51aURpYWxvZ1RpdGxlYmFyPWEoIjxkaXY+PC9kaXY+IikpLmFkZENsYXNzKCJ1aS1kaWFsb2ctdGl0bGViYXIgdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItYWxsIHVpLWhlbHBlci1jbGVhcmZpeCIpLnByZXBlbmRUbyhnKSxqPWEoJzxhIGhyZWY9IiMiPjwvYT4nKS5hZGRDbGFzcygidWktZGlhbG9nLXRpdGxlYmFyLWNsb3NlIHVpLWNvcm5lci1hbGwiKS5hdHRyKCJyb2xlIiwiYnV0dG9uIikuaG92ZXIoZnVuY3Rpb24oKXtqLmFkZENsYXNzKCJ1aS1zdGF0ZS1ob3ZlciIpfSxmdW5jdGlvbigpe2oucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWhvdmVyIil9KS5mb2N1cyhmdW5jdGlvbigpe2ouYWRkQ2xhc3MoInVpLXN0YXRlLWZvY3VzIil9KS5ibHVyKGZ1bmN0aW9uKCl7ai5yZW1vdmVDbGFzcygidWktc3RhdGUtZm9jdXMiKX0pLmNsaWNrKGZ1bmN0aW9uKGEpe3JldHVybiBiLmNsb3NlKGEpLCExfSkuYXBwZW5kVG8oaSksaz0oYi51aURpYWxvZ1RpdGxlYmFyQ2xvc2VUZXh0PWEoIjxzcGFuPjwvc3Bhbj4iKSkuYWRkQ2xhc3MoInVpLWljb24gdWktaWNvbi1jbG9zZXRoaWNrIikudGV4dChkLmNsb3NlVGV4dCkuYXBwZW5kVG8oaiksbD1hKCI8c3Bhbj48L3NwYW4+IikuYWRkQ2xhc3MoInVpLWRpYWxvZy10aXRsZSIpLmF0dHIoImlkIixmKS5odG1sKGUpLnByZXBlbmRUbyhpKTthLmlzRnVuY3Rpb24oZC5iZWZvcmVjbG9zZSkmJiFhLmlzRnVuY3Rpb24oZC5iZWZvcmVDbG9zZSkmJihkLmJlZm9yZUNsb3NlPWQuYmVmb3JlY2xvc2UpLGkuZmluZCgiKiIpLmFkZChpKS5kaXNhYmxlU2VsZWN0aW9uKCksZC5kcmFnZ2FibGUmJmEuZm4uZHJhZ2dhYmxlJiZiLl9tYWtlRHJhZ2dhYmxlKCksZC5yZXNpemFibGUmJmEuZm4ucmVzaXphYmxlJiZiLl9tYWtlUmVzaXphYmxlKCksYi5fY3JlYXRlQnV0dG9ucyhkLmJ1dHRvbnMpLGIuX2lzT3Blbj0hMSxhLmZuLmJnaWZyYW1lJiZnLmJnaWZyYW1lKCl9LF9pbml0OmZ1bmN0aW9uKCl7dGhpcy5vcHRpb25zLmF1dG9PcGVuJiZ0aGlzLm9wZW4oKX0sZGVzdHJveTpmdW5jdGlvbigpe3ZhciBhPXRoaXM7cmV0dXJuIGEub3ZlcmxheSYmYS5vdmVybGF5LmRlc3Ryb3koKSxhLnVpRGlhbG9nLmhpZGUoKSxhLmVsZW1lbnQudW5iaW5kKCIuZGlhbG9nIikucmVtb3ZlRGF0YSgiZGlhbG9nIikucmVtb3ZlQ2xhc3MoInVpLWRpYWxvZy1jb250ZW50IHVpLXdpZGdldC1jb250ZW50IikuaGlkZSgpLmFwcGVuZFRvKCJib2R5IiksYS51aURpYWxvZy5yZW1vdmUoKSxhLm9yaWdpbmFsVGl0bGUmJmEuZWxlbWVudC5hdHRyKCJ0aXRsZSIsYS5vcmlnaW5hbFRpdGxlKSxhfSx3aWRnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy51aURpYWxvZ30sY2xvc2U6ZnVuY3Rpb24oYil7dmFyIGM9dGhpcyxkLGU7aWYoITE9PT1jLl90cmlnZ2VyKCJiZWZvcmVDbG9zZSIsYikpcmV0dXJuO3JldHVybiBjLm92ZXJsYXkmJmMub3ZlcmxheS5kZXN0cm95KCksYy51aURpYWxvZy51bmJpbmQoImtleXByZXNzLnVpLWRpYWxvZyIpLGMuX2lzT3Blbj0hMSxjLm9wdGlvbnMuaGlkZT9jLnVpRGlhbG9nLmhpZGUoYy5vcHRpb25zLmhpZGUsZnVuY3Rpb24oKXtjLl90cmlnZ2VyKCJjbG9zZSIsYil9KTooYy51aURpYWxvZy5oaWRlKCksYy5fdHJpZ2dlcigiY2xvc2UiLGIpKSxhLnVpLmRpYWxvZy5vdmVybGF5LnJlc2l6ZSgpLGMub3B0aW9ucy5tb2RhbCYmKGQ9MCxhKCIudWktZGlhbG9nIikuZWFjaChmdW5jdGlvbigpe3RoaXMhPT1jLnVpRGlhbG9nWzBdJiYoZT1hKHRoaXMpLmNzcygiei1pbmRleCIpLGlzTmFOKGUpfHwoZD1NYXRoLm1heChkLGUpKSl9KSxhLnVpLmRpYWxvZy5tYXhaPWQpLGN9LGlzT3BlbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9pc09wZW59LG1vdmVUb1RvcDpmdW5jdGlvbihiLGMpe3ZhciBkPXRoaXMsZT1kLm9wdGlvbnMsZjtyZXR1cm4gZS5tb2RhbCYmIWJ8fCFlLnN0YWNrJiYhZS5tb2RhbD9kLl90cmlnZ2VyKCJmb2N1cyIsYyk6KGUuekluZGV4PmEudWkuZGlhbG9nLm1heFomJihhLnVpLmRpYWxvZy5tYXhaPWUuekluZGV4KSxkLm92ZXJsYXkmJihhLnVpLmRpYWxvZy5tYXhaKz0xLGQub3ZlcmxheS4kZWwuY3NzKCJ6LWluZGV4IixhLnVpLmRpYWxvZy5vdmVybGF5Lm1heFo9YS51aS5kaWFsb2cubWF4WikpLGY9e3Njcm9sbFRvcDpkLmVsZW1lbnQuc2Nyb2xsVG9wKCksc2Nyb2xsTGVmdDpkLmVsZW1lbnQuc2Nyb2xsTGVmdCgpfSxhLnVpLmRpYWxvZy5tYXhaKz0xLGQudWlEaWFsb2cuY3NzKCJ6LWluZGV4IixhLnVpLmRpYWxvZy5tYXhaKSxkLmVsZW1lbnQuYXR0cihmKSxkLl90cmlnZ2VyKCJmb2N1cyIsYyksZCl9LG9wZW46ZnVuY3Rpb24oKXtpZih0aGlzLl9pc09wZW4pcmV0dXJuO3ZhciBiPXRoaXMsYz1iLm9wdGlvbnMsZD1iLnVpRGlhbG9nO3JldHVybiBiLm92ZXJsYXk9Yy5tb2RhbD9uZXcgYS51aS5kaWFsb2cub3ZlcmxheShiKTpudWxsLGIuX3NpemUoKSxiLl9wb3NpdGlvbihjLnBvc2l0aW9uKSxkLnNob3coYy5zaG93KSxiLm1vdmVUb1RvcCghMCksYy5tb2RhbCYmZC5iaW5kKCJrZXlkb3duLnVpLWRpYWxvZyIsZnVuY3Rpb24oYil7aWYoYi5rZXlDb2RlIT09YS51aS5rZXlDb2RlLlRBQilyZXR1cm47dmFyIGM9YSgiOnRhYmJhYmxlIix0aGlzKSxkPWMuZmlsdGVyKCI6Zmlyc3QiKSxlPWMuZmlsdGVyKCI6bGFzdCIpO2lmKGIudGFyZ2V0PT09ZVswXSYmIWIuc2hpZnRLZXkpcmV0dXJuIGQuZm9jdXMoMSksITE7aWYoYi50YXJnZXQ9PT1kWzBdJiZiLnNoaWZ0S2V5KXJldHVybiBlLmZvY3VzKDEpLCExfSksYShiLmVsZW1lbnQuZmluZCgiOnRhYmJhYmxlIikuZ2V0KCkuY29uY2F0KGQuZmluZCgiLnVpLWRpYWxvZy1idXR0b25wYW5lIDp0YWJiYWJsZSIpLmdldCgpLmNvbmNhdChkLmdldCgpKSkpLmVxKDApLmZvY3VzKCksYi5faXNPcGVuPSEwLGIuX3RyaWdnZXIoIm9wZW4iKSxifSxfY3JlYXRlQnV0dG9uczpmdW5jdGlvbihiKXt2YXIgYz10aGlzLGQ9ITEsZT1hKCI8ZGl2PjwvZGl2PiIpLmFkZENsYXNzKCJ1aS1kaWFsb2ctYnV0dG9ucGFuZSB1aS13aWRnZXQtY29udGVudCB1aS1oZWxwZXItY2xlYXJmaXgiKSxnPWEoIjxkaXY+PC9kaXY+IikuYWRkQ2xhc3MoInVpLWRpYWxvZy1idXR0b25zZXQiKS5hcHBlbmRUbyhlKTtjLnVpRGlhbG9nLmZpbmQoIi51aS1kaWFsb2ctYnV0dG9ucGFuZSIpLnJlbW92ZSgpLHR5cGVvZiBiPT0ib2JqZWN0IiYmYiE9PW51bGwmJmEuZWFjaChiLGZ1bmN0aW9uKCl7cmV0dXJuIShkPSEwKX0pLGQmJihhLmVhY2goYixmdW5jdGlvbihiLGQpe2Q9YS5pc0Z1bmN0aW9uKGQpP3tjbGljazpkLHRleHQ6Yn06ZDt2YXIgZT1hKCc8YnV0dG9uIHR5cGU9ImJ1dHRvbiI+PC9idXR0b24+JykuY2xpY2soZnVuY3Rpb24oKXtkLmNsaWNrLmFwcGx5KGMuZWxlbWVudFswXSxhcmd1bWVudHMpfSkuYXBwZW5kVG8oZyk7YS5lYWNoKGQsZnVuY3Rpb24oYSxiKXtpZihhPT09ImNsaWNrIilyZXR1cm47YSBpbiBmP2VbYV0oYik6ZS5hdHRyKGEsYil9KSxhLmZuLmJ1dHRvbiYmZS5idXR0b24oKX0pLGUuYXBwZW5kVG8oYy51aURpYWxvZykpfSxfbWFrZURyYWdnYWJsZTpmdW5jdGlvbigpe2Z1bmN0aW9uIGYoYSl7cmV0dXJue3Bvc2l0aW9uOmEucG9zaXRpb24sb2Zmc2V0OmEub2Zmc2V0fX12YXIgYj10aGlzLGM9Yi5vcHRpb25zLGQ9YShkb2N1bWVudCksZTtiLnVpRGlhbG9nLmRyYWdnYWJsZSh7Y2FuY2VsOiIudWktZGlhbG9nLWNvbnRlbnQsIC51aS1kaWFsb2ctdGl0bGViYXItY2xvc2UiLGhhbmRsZToiLnVpLWRpYWxvZy10aXRsZWJhciIsY29udGFpbm1lbnQ6ImRvY3VtZW50IixzdGFydDpmdW5jdGlvbihkLGcpe2U9Yy5oZWlnaHQ9PT0iYXV0byI/ImF1dG8iOmEodGhpcykuaGVpZ2h0KCksYSh0aGlzKS5oZWlnaHQoYSh0aGlzKS5oZWlnaHQoKSkuYWRkQ2xhc3MoInVpLWRpYWxvZy1kcmFnZ2luZyIpLGIuX3RyaWdnZXIoImRyYWdTdGFydCIsZCxmKGcpKX0sZHJhZzpmdW5jdGlvbihhLGMpe2IuX3RyaWdnZXIoImRyYWciLGEsZihjKSl9LHN0b3A6ZnVuY3Rpb24oZyxoKXtjLnBvc2l0aW9uPVtoLnBvc2l0aW9uLmxlZnQtZC5zY3JvbGxMZWZ0KCksaC5wb3NpdGlvbi50b3AtZC5zY3JvbGxUb3AoKV0sYSh0aGlzKS5yZW1vdmVDbGFzcygidWktZGlhbG9nLWRyYWdnaW5nIikuaGVpZ2h0KGUpLGIuX3RyaWdnZXIoImRyYWdTdG9wIixnLGYoaCkpLGEudWkuZGlhbG9nLm92ZXJsYXkucmVzaXplKCl9fSl9LF9tYWtlUmVzaXphYmxlOmZ1bmN0aW9uKGMpe2Z1bmN0aW9uIGgoYSl7cmV0dXJue29yaWdpbmFsUG9zaXRpb246YS5vcmlnaW5hbFBvc2l0aW9uLG9yaWdpbmFsU2l6ZTphLm9yaWdpbmFsU2l6ZSxwb3NpdGlvbjphLnBvc2l0aW9uLHNpemU6YS5zaXplfX1jPWM9PT1iP3RoaXMub3B0aW9ucy5yZXNpemFibGU6Yzt2YXIgZD10aGlzLGU9ZC5vcHRpb25zLGY9ZC51aURpYWxvZy5jc3MoInBvc2l0aW9uIiksZz10eXBlb2YgYz09InN0cmluZyI/YzoibixlLHMsdyxzZSxzdyxuZSxudyI7ZC51aURpYWxvZy5yZXNpemFibGUoe2NhbmNlbDoiLnVpLWRpYWxvZy1jb250ZW50Iixjb250YWlubWVudDoiZG9jdW1lbnQiLGFsc29SZXNpemU6ZC5lbGVtZW50LG1heFdpZHRoOmUubWF4V2lkdGgsbWF4SGVpZ2h0OmUubWF4SGVpZ2h0LG1pbldpZHRoOmUubWluV2lkdGgsbWluSGVpZ2h0OmQuX21pbkhlaWdodCgpLGhhbmRsZXM6ZyxzdGFydDpmdW5jdGlvbihiLGMpe2EodGhpcykuYWRkQ2xhc3MoInVpLWRpYWxvZy1yZXNpemluZyIpLGQuX3RyaWdnZXIoInJlc2l6ZVN0YXJ0IixiLGgoYykpfSxyZXNpemU6ZnVuY3Rpb24oYSxiKXtkLl90cmlnZ2VyKCJyZXNpemUiLGEsaChiKSl9LHN0b3A6ZnVuY3Rpb24oYixjKXthKHRoaXMpLnJlbW92ZUNsYXNzKCJ1aS1kaWFsb2ctcmVzaXppbmciKSxlLmhlaWdodD1hKHRoaXMpLmhlaWdodCgpLGUud2lkdGg9YSh0aGlzKS53aWR0aCgpLGQuX3RyaWdnZXIoInJlc2l6ZVN0b3AiLGIsaChjKSksYS51aS5kaWFsb2cub3ZlcmxheS5yZXNpemUoKX19KS5jc3MoInBvc2l0aW9uIixmKS5maW5kKCIudWktcmVzaXphYmxlLXNlIikuYWRkQ2xhc3MoInVpLWljb24gdWktaWNvbi1ncmlwLWRpYWdvbmFsLXNlIil9LF9taW5IZWlnaHQ6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnM7cmV0dXJuIGEuaGVpZ2h0PT09ImF1dG8iP2EubWluSGVpZ2h0Ok1hdGgubWluKGEubWluSGVpZ2h0LGEuaGVpZ2h0KX0sX3Bvc2l0aW9uOmZ1bmN0aW9uKGIpe3ZhciBjPVtdLGQ9WzAsMF0sZTtpZihiKXtpZih0eXBlb2YgYj09InN0cmluZyJ8fHR5cGVvZiBiPT0ib2JqZWN0IiYmIjAiaW4gYiljPWIuc3BsaXQ/Yi5zcGxpdCgiICIpOltiWzBdLGJbMV1dLGMubGVuZ3RoPT09MSYmKGNbMV09Y1swXSksYS5lYWNoKFsibGVmdCIsInRvcCJdLGZ1bmN0aW9uKGEsYil7K2NbYV09PT1jW2FdJiYoZFthXT1jW2FdLGNbYV09Yil9KSxiPXtteTpjLmpvaW4oIiAiKSxhdDpjLmpvaW4oIiAiKSxvZmZzZXQ6ZC5qb2luKCIgIil9O2I9YS5leHRlbmQoe30sYS51aS5kaWFsb2cucHJvdG90eXBlLm9wdGlvbnMucG9zaXRpb24sYil9ZWxzZSBiPWEudWkuZGlhbG9nLnByb3RvdHlwZS5vcHRpb25zLnBvc2l0aW9uO2U9dGhpcy51aURpYWxvZy5pcygiOnZpc2libGUiKSxlfHx0aGlzLnVpRGlhbG9nLnNob3coKSx0aGlzLnVpRGlhbG9nLmNzcyh7dG9wOjAsbGVmdDowfSkucG9zaXRpb24oYS5leHRlbmQoe29mOndpbmRvd30sYikpLGV8fHRoaXMudWlEaWFsb2cuaGlkZSgpfSxfc2V0T3B0aW9uczpmdW5jdGlvbihiKXt2YXIgYz10aGlzLGY9e30sZz0hMTthLmVhY2goYixmdW5jdGlvbihhLGIpe2MuX3NldE9wdGlvbihhLGIpLGEgaW4gZCYmKGc9ITApLGEgaW4gZSYmKGZbYV09Yil9KSxnJiZ0aGlzLl9zaXplKCksdGhpcy51aURpYWxvZy5pcygiOmRhdGEocmVzaXphYmxlKSIpJiZ0aGlzLnVpRGlhbG9nLnJlc2l6YWJsZSgib3B0aW9uIixmKX0sX3NldE9wdGlvbjpmdW5jdGlvbihiLGQpe3ZhciBlPXRoaXMsZj1lLnVpRGlhbG9nO3N3aXRjaChiKXtjYXNlImJlZm9yZWNsb3NlIjpiPSJiZWZvcmVDbG9zZSI7YnJlYWs7Y2FzZSJidXR0b25zIjplLl9jcmVhdGVCdXR0b25zKGQpO2JyZWFrO2Nhc2UiY2xvc2VUZXh0IjplLnVpRGlhbG9nVGl0bGViYXJDbG9zZVRleHQudGV4dCgiIitkKTticmVhaztjYXNlImRpYWxvZ0NsYXNzIjpmLnJlbW92ZUNsYXNzKGUub3B0aW9ucy5kaWFsb2dDbGFzcykuYWRkQ2xhc3MoYytkKTticmVhaztjYXNlImRpc2FibGVkIjpkP2YuYWRkQ2xhc3MoInVpLWRpYWxvZy1kaXNhYmxlZCIpOmYucmVtb3ZlQ2xhc3MoInVpLWRpYWxvZy1kaXNhYmxlZCIpO2JyZWFrO2Nhc2UiZHJhZ2dhYmxlIjp2YXIgZz1mLmlzKCI6ZGF0YShkcmFnZ2FibGUpIik7ZyYmIWQmJmYuZHJhZ2dhYmxlKCJkZXN0cm95IiksIWcmJmQmJmUuX21ha2VEcmFnZ2FibGUoKTticmVhaztjYXNlInBvc2l0aW9uIjplLl9wb3NpdGlvbihkKTticmVhaztjYXNlInJlc2l6YWJsZSI6dmFyIGg9Zi5pcygiOmRhdGEocmVzaXphYmxlKSIpO2gmJiFkJiZmLnJlc2l6YWJsZSgiZGVzdHJveSIpLGgmJnR5cGVvZiBkPT0ic3RyaW5nIiYmZi5yZXNpemFibGUoIm9wdGlvbiIsImhhbmRsZXMiLGQpLCFoJiZkIT09ITEmJmUuX21ha2VSZXNpemFibGUoZCk7YnJlYWs7Y2FzZSJ0aXRsZSI6YSgiLnVpLWRpYWxvZy10aXRsZSIsZS51aURpYWxvZ1RpdGxlYmFyKS5odG1sKCIiKyhkfHwiJiMxNjA7IikpfWEuV2lkZ2V0LnByb3RvdHlwZS5fc2V0T3B0aW9uLmFwcGx5KGUsYXJndW1lbnRzKX0sX3NpemU6ZnVuY3Rpb24oKXt2YXIgYj10aGlzLm9wdGlvbnMsYyxkLGU9dGhpcy51aURpYWxvZy5pcygiOnZpc2libGUiKTt0aGlzLmVsZW1lbnQuc2hvdygpLmNzcyh7d2lkdGg6ImF1dG8iLG1pbkhlaWdodDowLGhlaWdodDowfSksYi5taW5XaWR0aD5iLndpZHRoJiYoYi53aWR0aD1iLm1pbldpZHRoKSxjPXRoaXMudWlEaWFsb2cuY3NzKHtoZWlnaHQ6ImF1dG8iLHdpZHRoOmIud2lkdGh9KS5oZWlnaHQoKSxkPU1hdGgubWF4KDAsYi5taW5IZWlnaHQtYyk7aWYoYi5oZWlnaHQ9PT0iYXV0byIpaWYoYS5zdXBwb3J0Lm1pbkhlaWdodCl0aGlzLmVsZW1lbnQuY3NzKHttaW5IZWlnaHQ6ZCxoZWlnaHQ6ImF1dG8ifSk7ZWxzZXt0aGlzLnVpRGlhbG9nLnNob3coKTt2YXIgZj10aGlzLmVsZW1lbnQuY3NzKCJoZWlnaHQiLCJhdXRvIikuaGVpZ2h0KCk7ZXx8dGhpcy51aURpYWxvZy5oaWRlKCksdGhpcy5lbGVtZW50LmhlaWdodChNYXRoLm1heChmLGQpKX1lbHNlIHRoaXMuZWxlbWVudC5oZWlnaHQoTWF0aC5tYXgoYi5oZWlnaHQtYywwKSk7dGhpcy51aURpYWxvZy5pcygiOmRhdGEocmVzaXphYmxlKSIpJiZ0aGlzLnVpRGlhbG9nLnJlc2l6YWJsZSgib3B0aW9uIiwibWluSGVpZ2h0Iix0aGlzLl9taW5IZWlnaHQoKSl9fSksYS5leHRlbmQoYS51aS5kaWFsb2cse3ZlcnNpb246IjEuOC4yMCIsdXVpZDowLG1heFo6MCxnZXRUaXRsZUlkOmZ1bmN0aW9uKGEpe3ZhciBiPWEuYXR0cigiaWQiKTtyZXR1cm4gYnx8KHRoaXMudXVpZCs9MSxiPXRoaXMudXVpZCksInVpLWRpYWxvZy10aXRsZS0iK2J9LG92ZXJsYXk6ZnVuY3Rpb24oYil7dGhpcy4kZWw9YS51aS5kaWFsb2cub3ZlcmxheS5jcmVhdGUoYil9fSksYS5leHRlbmQoYS51aS5kaWFsb2cub3ZlcmxheSx7aW5zdGFuY2VzOltdLG9sZEluc3RhbmNlczpbXSxtYXhaOjAsZXZlbnRzOmEubWFwKCJmb2N1cyxtb3VzZWRvd24sbW91c2V1cCxrZXlkb3duLGtleXByZXNzLGNsaWNrIi5zcGxpdCgiLCIpLGZ1bmN0aW9uKGEpe3JldHVybiBhKyIuZGlhbG9nLW92ZXJsYXkifSkuam9pbigiICIpLGNyZWF0ZTpmdW5jdGlvbihiKXt0aGlzLmluc3RhbmNlcy5sZW5ndGg9PT0wJiYoc2V0VGltZW91dChmdW5jdGlvbigpe2EudWkuZGlhbG9nLm92ZXJsYXkuaW5zdGFuY2VzLmxlbmd0aCYmYShkb2N1bWVudCkuYmluZChhLnVpLmRpYWxvZy5vdmVybGF5LmV2ZW50cyxmdW5jdGlvbihiKXtpZihhKGIudGFyZ2V0KS56SW5kZXgoKTxhLnVpLmRpYWxvZy5vdmVybGF5Lm1heFopcmV0dXJuITF9KX0sMSksYShkb2N1bWVudCkuYmluZCgia2V5ZG93bi5kaWFsb2ctb3ZlcmxheSIsZnVuY3Rpb24oYyl7Yi5vcHRpb25zLmNsb3NlT25Fc2NhcGUmJiFjLmlzRGVmYXVsdFByZXZlbnRlZCgpJiZjLmtleUNvZGUmJmMua2V5Q29kZT09PWEudWkua2V5Q29kZS5FU0NBUEUmJihiLmNsb3NlKGMpLGMucHJldmVudERlZmF1bHQoKSl9KSxhKHdpbmRvdykuYmluZCgicmVzaXplLmRpYWxvZy1vdmVybGF5IixhLnVpLmRpYWxvZy5vdmVybGF5LnJlc2l6ZSkpO3ZhciBjPSh0aGlzLm9sZEluc3RhbmNlcy5wb3AoKXx8YSgiPGRpdj48L2Rpdj4iKS5hZGRDbGFzcygidWktd2lkZ2V0LW92ZXJsYXkiKSkuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSkuY3NzKHt3aWR0aDp0aGlzLndpZHRoKCksaGVpZ2h0OnRoaXMuaGVpZ2h0KCl9KTtyZXR1cm4gYS5mbi5iZ2lmcmFtZSYmYy5iZ2lmcmFtZSgpLHRoaXMuaW5zdGFuY2VzLnB1c2goYyksY30sZGVzdHJveTpmdW5jdGlvbihiKXt2YXIgYz1hLmluQXJyYXkoYix0aGlzLmluc3RhbmNlcyk7YyE9LTEmJnRoaXMub2xkSW5zdGFuY2VzLnB1c2godGhpcy5pbnN0YW5jZXMuc3BsaWNlKGMsMSlbMF0pLHRoaXMuaW5zdGFuY2VzLmxlbmd0aD09PTAmJmEoW2RvY3VtZW50LHdpbmRvd10pLnVuYmluZCgiLmRpYWxvZy1vdmVybGF5IiksYi5yZW1vdmUoKTt2YXIgZD0wO2EuZWFjaCh0aGlzLmluc3RhbmNlcyxmdW5jdGlvbigpe2Q9TWF0aC5tYXgoZCx0aGlzLmNzcygiei1pbmRleCIpKX0pLHRoaXMubWF4Wj1kfSxoZWlnaHQ6ZnVuY3Rpb24oKXt2YXIgYixjO3JldHVybiBhLmJyb3dzZXIubXNpZSYmYS5icm93c2VyLnZlcnNpb248Nz8oYj1NYXRoLm1heChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0LGRvY3VtZW50LmJvZHkuc2Nyb2xsSGVpZ2h0KSxjPU1hdGgubWF4KGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRIZWlnaHQsZG9jdW1lbnQuYm9keS5vZmZzZXRIZWlnaHQpLGI8Yz9hKHdpbmRvdykuaGVpZ2h0KCkrInB4IjpiKyJweCIpOmEoZG9jdW1lbnQpLmhlaWdodCgpKyJweCJ9LHdpZHRoOmZ1bmN0aW9uKCl7dmFyIGIsYztyZXR1cm4gYS5icm93c2VyLm1zaWU/KGI9TWF0aC5tYXgoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFdpZHRoLGRvY3VtZW50LmJvZHkuc2Nyb2xsV2lkdGgpLGM9TWF0aC5tYXgoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldFdpZHRoLGRvY3VtZW50LmJvZHkub2Zmc2V0V2lkdGgpLGI8Yz9hKHdpbmRvdykud2lkdGgoKSsicHgiOmIrInB4Iik6YShkb2N1bWVudCkud2lkdGgoKSsicHgifSxyZXNpemU6ZnVuY3Rpb24oKXt2YXIgYj1hKFtdKTthLmVhY2goYS51aS5kaWFsb2cub3ZlcmxheS5pbnN0YW5jZXMsZnVuY3Rpb24oKXtiPWIuYWRkKHRoaXMpfSksYi5jc3Moe3dpZHRoOjAsaGVpZ2h0OjB9KS5jc3Moe3dpZHRoOmEudWkuZGlhbG9nLm92ZXJsYXkud2lkdGgoKSxoZWlnaHQ6YS51aS5kaWFsb2cub3ZlcmxheS5oZWlnaHQoKX0pfX0pLGEuZXh0ZW5kKGEudWkuZGlhbG9nLm92ZXJsYXkucHJvdG90eXBlLHtkZXN0cm95OmZ1bmN0aW9uKCl7YS51aS5kaWFsb2cub3ZlcmxheS5kZXN0cm95KHRoaXMuJGVsKX19KX0pKGpRdWVyeSk7Oy8qISBqUXVlcnkgVUkgLSB2MS44LjIwIC0gMjAxMi0wNC0zMAoqIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5LXVpCiogSW5jbHVkZXM6IGpxdWVyeS51aS5zbGlkZXIuanMKKiBDb3B5cmlnaHQgKGMpIDIwMTIgQVVUSE9SUy50eHQ7IExpY2Vuc2VkIE1JVCwgR1BMICovCihmdW5jdGlvbihhLGIpe3ZhciBjPTU7YS53aWRnZXQoInVpLnNsaWRlciIsYS51aS5tb3VzZSx7d2lkZ2V0RXZlbnRQcmVmaXg6InNsaWRlIixvcHRpb25zOnthbmltYXRlOiExLGRpc3RhbmNlOjAsbWF4OjEwMCxtaW46MCxvcmllbnRhdGlvbjoiaG9yaXpvbnRhbCIscmFuZ2U6ITEsc3RlcDoxLHZhbHVlOjAsdmFsdWVzOm51bGx9LF9jcmVhdGU6ZnVuY3Rpb24oKXt2YXIgYj10aGlzLGQ9dGhpcy5vcHRpb25zLGU9dGhpcy5lbGVtZW50LmZpbmQoIi51aS1zbGlkZXItaGFuZGxlIikuYWRkQ2xhc3MoInVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbCIpLGY9IjxhIGNsYXNzPSd1aS1zbGlkZXItaGFuZGxlIHVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLWFsbCcgaHJlZj0nIyc+PC9hPiIsZz1kLnZhbHVlcyYmZC52YWx1ZXMubGVuZ3RofHwxLGg9W107dGhpcy5fa2V5U2xpZGluZz0hMSx0aGlzLl9tb3VzZVNsaWRpbmc9ITEsdGhpcy5fYW5pbWF0ZU9mZj0hMCx0aGlzLl9oYW5kbGVJbmRleD1udWxsLHRoaXMuX2RldGVjdE9yaWVudGF0aW9uKCksdGhpcy5fbW91c2VJbml0KCksdGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1zbGlkZXIgdWktc2xpZGVyLSIrdGhpcy5vcmllbnRhdGlvbisiIHVpLXdpZGdldCIrIiB1aS13aWRnZXQtY29udGVudCIrIiB1aS1jb3JuZXItYWxsIisoZC5kaXNhYmxlZD8iIHVpLXNsaWRlci1kaXNhYmxlZCB1aS1kaXNhYmxlZCI6IiIpKSx0aGlzLnJhbmdlPWEoW10pLGQucmFuZ2UmJihkLnJhbmdlPT09ITAmJihkLnZhbHVlc3x8KGQudmFsdWVzPVt0aGlzLl92YWx1ZU1pbigpLHRoaXMuX3ZhbHVlTWluKCldKSxkLnZhbHVlcy5sZW5ndGgmJmQudmFsdWVzLmxlbmd0aCE9PTImJihkLnZhbHVlcz1bZC52YWx1ZXNbMF0sZC52YWx1ZXNbMF1dKSksdGhpcy5yYW5nZT1hKCI8ZGl2PjwvZGl2PiIpLmFwcGVuZFRvKHRoaXMuZWxlbWVudCkuYWRkQ2xhc3MoInVpLXNsaWRlci1yYW5nZSB1aS13aWRnZXQtaGVhZGVyIisoZC5yYW5nZT09PSJtaW4ifHxkLnJhbmdlPT09Im1heCI/IiB1aS1zbGlkZXItcmFuZ2UtIitkLnJhbmdlOiIiKSkpO2Zvcih2YXIgaT1lLmxlbmd0aDtpPGc7aSs9MSloLnB1c2goZik7dGhpcy5oYW5kbGVzPWUuYWRkKGEoaC5qb2luKCIiKSkuYXBwZW5kVG8oYi5lbGVtZW50KSksdGhpcy5oYW5kbGU9dGhpcy5oYW5kbGVzLmVxKDApLHRoaXMuaGFuZGxlcy5hZGQodGhpcy5yYW5nZSkuZmlsdGVyKCJhIikuY2xpY2soZnVuY3Rpb24oYSl7YS5wcmV2ZW50RGVmYXVsdCgpfSkuaG92ZXIoZnVuY3Rpb24oKXtkLmRpc2FibGVkfHxhKHRoaXMpLmFkZENsYXNzKCJ1aS1zdGF0ZS1ob3ZlciIpfSxmdW5jdGlvbigpe2EodGhpcykucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWhvdmVyIil9KS5mb2N1cyhmdW5jdGlvbigpe2QuZGlzYWJsZWQ/YSh0aGlzKS5ibHVyKCk6KGEoIi51aS1zbGlkZXIgLnVpLXN0YXRlLWZvY3VzIikucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWZvY3VzIiksYSh0aGlzKS5hZGRDbGFzcygidWktc3RhdGUtZm9jdXMiKSl9KS5ibHVyKGZ1bmN0aW9uKCl7YSh0aGlzKS5yZW1vdmVDbGFzcygidWktc3RhdGUtZm9jdXMiKX0pLHRoaXMuaGFuZGxlcy5lYWNoKGZ1bmN0aW9uKGIpe2EodGhpcykuZGF0YSgiaW5kZXgudWktc2xpZGVyLWhhbmRsZSIsYil9KSx0aGlzLmhhbmRsZXMua2V5ZG93bihmdW5jdGlvbihkKXt2YXIgZT1hKHRoaXMpLmRhdGEoImluZGV4LnVpLXNsaWRlci1oYW5kbGUiKSxmLGcsaCxpO2lmKGIub3B0aW9ucy5kaXNhYmxlZClyZXR1cm47c3dpdGNoKGQua2V5Q29kZSl7Y2FzZSBhLnVpLmtleUNvZGUuSE9NRTpjYXNlIGEudWkua2V5Q29kZS5FTkQ6Y2FzZSBhLnVpLmtleUNvZGUuUEFHRV9VUDpjYXNlIGEudWkua2V5Q29kZS5QQUdFX0RPV046Y2FzZSBhLnVpLmtleUNvZGUuVVA6Y2FzZSBhLnVpLmtleUNvZGUuUklHSFQ6Y2FzZSBhLnVpLmtleUNvZGUuRE9XTjpjYXNlIGEudWkua2V5Q29kZS5MRUZUOmQucHJldmVudERlZmF1bHQoKTtpZighYi5fa2V5U2xpZGluZyl7Yi5fa2V5U2xpZGluZz0hMCxhKHRoaXMpLmFkZENsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUiKSxmPWIuX3N0YXJ0KGQsZSk7aWYoZj09PSExKXJldHVybn19aT1iLm9wdGlvbnMuc3RlcCxiLm9wdGlvbnMudmFsdWVzJiZiLm9wdGlvbnMudmFsdWVzLmxlbmd0aD9nPWg9Yi52YWx1ZXMoZSk6Zz1oPWIudmFsdWUoKTtzd2l0Y2goZC5rZXlDb2RlKXtjYXNlIGEudWkua2V5Q29kZS5IT01FOmg9Yi5fdmFsdWVNaW4oKTticmVhaztjYXNlIGEudWkua2V5Q29kZS5FTkQ6aD1iLl92YWx1ZU1heCgpO2JyZWFrO2Nhc2UgYS51aS5rZXlDb2RlLlBBR0VfVVA6aD1iLl90cmltQWxpZ25WYWx1ZShnKyhiLl92YWx1ZU1heCgpLWIuX3ZhbHVlTWluKCkpL2MpO2JyZWFrO2Nhc2UgYS51aS5rZXlDb2RlLlBBR0VfRE9XTjpoPWIuX3RyaW1BbGlnblZhbHVlKGctKGIuX3ZhbHVlTWF4KCktYi5fdmFsdWVNaW4oKSkvYyk7YnJlYWs7Y2FzZSBhLnVpLmtleUNvZGUuVVA6Y2FzZSBhLnVpLmtleUNvZGUuUklHSFQ6aWYoZz09PWIuX3ZhbHVlTWF4KCkpcmV0dXJuO2g9Yi5fdHJpbUFsaWduVmFsdWUoZytpKTticmVhaztjYXNlIGEudWkua2V5Q29kZS5ET1dOOmNhc2UgYS51aS5rZXlDb2RlLkxFRlQ6aWYoZz09PWIuX3ZhbHVlTWluKCkpcmV0dXJuO2g9Yi5fdHJpbUFsaWduVmFsdWUoZy1pKX1iLl9zbGlkZShkLGUsaCl9KS5rZXl1cChmdW5jdGlvbihjKXt2YXIgZD1hKHRoaXMpLmRhdGEoImluZGV4LnVpLXNsaWRlci1oYW5kbGUiKTtiLl9rZXlTbGlkaW5nJiYoYi5fa2V5U2xpZGluZz0hMSxiLl9zdG9wKGMsZCksYi5fY2hhbmdlKGMsZCksYSh0aGlzKS5yZW1vdmVDbGFzcygidWktc3RhdGUtYWN0aXZlIikpfSksdGhpcy5fcmVmcmVzaFZhbHVlKCksdGhpcy5fYW5pbWF0ZU9mZj0hMX0sZGVzdHJveTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmhhbmRsZXMucmVtb3ZlKCksdGhpcy5yYW5nZS5yZW1vdmUoKSx0aGlzLmVsZW1lbnQucmVtb3ZlQ2xhc3MoInVpLXNsaWRlciB1aS1zbGlkZXItaG9yaXpvbnRhbCB1aS1zbGlkZXItdmVydGljYWwgdWktc2xpZGVyLWRpc2FibGVkIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYWxsIikucmVtb3ZlRGF0YSgic2xpZGVyIikudW5iaW5kKCIuc2xpZGVyIiksdGhpcy5fbW91c2VEZXN0cm95KCksdGhpc30sX21vdXNlQ2FwdHVyZTpmdW5jdGlvbihiKXt2YXIgYz10aGlzLm9wdGlvbnMsZCxlLGYsZyxoLGksaixrLGw7cmV0dXJuIGMuZGlzYWJsZWQ/ITE6KHRoaXMuZWxlbWVudFNpemU9e3dpZHRoOnRoaXMuZWxlbWVudC5vdXRlcldpZHRoKCksaGVpZ2h0OnRoaXMuZWxlbWVudC5vdXRlckhlaWdodCgpfSx0aGlzLmVsZW1lbnRPZmZzZXQ9dGhpcy5lbGVtZW50Lm9mZnNldCgpLGQ9e3g6Yi5wYWdlWCx5OmIucGFnZVl9LGU9dGhpcy5fbm9ybVZhbHVlRnJvbU1vdXNlKGQpLGY9dGhpcy5fdmFsdWVNYXgoKS10aGlzLl92YWx1ZU1pbigpKzEsaD10aGlzLHRoaXMuaGFuZGxlcy5lYWNoKGZ1bmN0aW9uKGIpe3ZhciBjPU1hdGguYWJzKGUtaC52YWx1ZXMoYikpO2Y+YyYmKGY9YyxnPWEodGhpcyksaT1iKX0pLGMucmFuZ2U9PT0hMCYmdGhpcy52YWx1ZXMoMSk9PT1jLm1pbiYmKGkrPTEsZz1hKHRoaXMuaGFuZGxlc1tpXSkpLGo9dGhpcy5fc3RhcnQoYixpKSxqPT09ITE/ITE6KHRoaXMuX21vdXNlU2xpZGluZz0hMCxoLl9oYW5kbGVJbmRleD1pLGcuYWRkQ2xhc3MoInVpLXN0YXRlLWFjdGl2ZSIpLmZvY3VzKCksaz1nLm9mZnNldCgpLGw9IWEoYi50YXJnZXQpLnBhcmVudHMoKS5hbmRTZWxmKCkuaXMoIi51aS1zbGlkZXItaGFuZGxlIiksdGhpcy5fY2xpY2tPZmZzZXQ9bD97bGVmdDowLHRvcDowfTp7bGVmdDpiLnBhZ2VYLWsubGVmdC1nLndpZHRoKCkvMix0b3A6Yi5wYWdlWS1rLnRvcC1nLmhlaWdodCgpLzItKHBhcnNlSW50KGcuY3NzKCJib3JkZXJUb3BXaWR0aCIpLDEwKXx8MCktKHBhcnNlSW50KGcuY3NzKCJib3JkZXJCb3R0b21XaWR0aCIpLDEwKXx8MCkrKHBhcnNlSW50KGcuY3NzKCJtYXJnaW5Ub3AiKSwxMCl8fDApfSx0aGlzLmhhbmRsZXMuaGFzQ2xhc3MoInVpLXN0YXRlLWhvdmVyIil8fHRoaXMuX3NsaWRlKGIsaSxlKSx0aGlzLl9hbmltYXRlT2ZmPSEwLCEwKSl9LF9tb3VzZVN0YXJ0OmZ1bmN0aW9uKGEpe3JldHVybiEwfSxfbW91c2VEcmFnOmZ1bmN0aW9uKGEpe3ZhciBiPXt4OmEucGFnZVgseTphLnBhZ2VZfSxjPXRoaXMuX25vcm1WYWx1ZUZyb21Nb3VzZShiKTtyZXR1cm4gdGhpcy5fc2xpZGUoYSx0aGlzLl9oYW5kbGVJbmRleCxjKSwhMX0sX21vdXNlU3RvcDpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5oYW5kbGVzLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1hY3RpdmUiKSx0aGlzLl9tb3VzZVNsaWRpbmc9ITEsdGhpcy5fc3RvcChhLHRoaXMuX2hhbmRsZUluZGV4KSx0aGlzLl9jaGFuZ2UoYSx0aGlzLl9oYW5kbGVJbmRleCksdGhpcy5faGFuZGxlSW5kZXg9bnVsbCx0aGlzLl9jbGlja09mZnNldD1udWxsLHRoaXMuX2FuaW1hdGVPZmY9ITEsITF9LF9kZXRlY3RPcmllbnRhdGlvbjpmdW5jdGlvbigpe3RoaXMub3JpZW50YXRpb249dGhpcy5vcHRpb25zLm9yaWVudGF0aW9uPT09InZlcnRpY2FsIj8idmVydGljYWwiOiJob3Jpem9udGFsIn0sX25vcm1WYWx1ZUZyb21Nb3VzZTpmdW5jdGlvbihhKXt2YXIgYixjLGQsZSxmO3JldHVybiB0aGlzLm9yaWVudGF0aW9uPT09Imhvcml6b250YWwiPyhiPXRoaXMuZWxlbWVudFNpemUud2lkdGgsYz1hLngtdGhpcy5lbGVtZW50T2Zmc2V0LmxlZnQtKHRoaXMuX2NsaWNrT2Zmc2V0P3RoaXMuX2NsaWNrT2Zmc2V0LmxlZnQ6MCkpOihiPXRoaXMuZWxlbWVudFNpemUuaGVpZ2h0LGM9YS55LXRoaXMuZWxlbWVudE9mZnNldC50b3AtKHRoaXMuX2NsaWNrT2Zmc2V0P3RoaXMuX2NsaWNrT2Zmc2V0LnRvcDowKSksZD1jL2IsZD4xJiYoZD0xKSxkPDAmJihkPTApLHRoaXMub3JpZW50YXRpb249PT0idmVydGljYWwiJiYoZD0xLWQpLGU9dGhpcy5fdmFsdWVNYXgoKS10aGlzLl92YWx1ZU1pbigpLGY9dGhpcy5fdmFsdWVNaW4oKStkKmUsdGhpcy5fdHJpbUFsaWduVmFsdWUoZil9LF9zdGFydDpmdW5jdGlvbihhLGIpe3ZhciBjPXtoYW5kbGU6dGhpcy5oYW5kbGVzW2JdLHZhbHVlOnRoaXMudmFsdWUoKX07cmV0dXJuIHRoaXMub3B0aW9ucy52YWx1ZXMmJnRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoJiYoYy52YWx1ZT10aGlzLnZhbHVlcyhiKSxjLnZhbHVlcz10aGlzLnZhbHVlcygpKSx0aGlzLl90cmlnZ2VyKCJzdGFydCIsYSxjKX0sX3NsaWRlOmZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlLGY7dGhpcy5vcHRpb25zLnZhbHVlcyYmdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGg/KGQ9dGhpcy52YWx1ZXMoYj8wOjEpLHRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoPT09MiYmdGhpcy5vcHRpb25zLnJhbmdlPT09ITAmJihiPT09MCYmYz5kfHxiPT09MSYmYzxkKSYmKGM9ZCksYyE9PXRoaXMudmFsdWVzKGIpJiYoZT10aGlzLnZhbHVlcygpLGVbYl09YyxmPXRoaXMuX3RyaWdnZXIoInNsaWRlIixhLHtoYW5kbGU6dGhpcy5oYW5kbGVzW2JdLHZhbHVlOmMsdmFsdWVzOmV9KSxkPXRoaXMudmFsdWVzKGI/MDoxKSxmIT09ITEmJnRoaXMudmFsdWVzKGIsYywhMCkpKTpjIT09dGhpcy52YWx1ZSgpJiYoZj10aGlzLl90cmlnZ2VyKCJzbGlkZSIsYSx7aGFuZGxlOnRoaXMuaGFuZGxlc1tiXSx2YWx1ZTpjfSksZiE9PSExJiZ0aGlzLnZhbHVlKGMpKX0sX3N0b3A6ZnVuY3Rpb24oYSxiKXt2YXIgYz17aGFuZGxlOnRoaXMuaGFuZGxlc1tiXSx2YWx1ZTp0aGlzLnZhbHVlKCl9O3RoaXMub3B0aW9ucy52YWx1ZXMmJnRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoJiYoYy52YWx1ZT10aGlzLnZhbHVlcyhiKSxjLnZhbHVlcz10aGlzLnZhbHVlcygpKSx0aGlzLl90cmlnZ2VyKCJzdG9wIixhLGMpfSxfY2hhbmdlOmZ1bmN0aW9uKGEsYil7aWYoIXRoaXMuX2tleVNsaWRpbmcmJiF0aGlzLl9tb3VzZVNsaWRpbmcpe3ZhciBjPXtoYW5kbGU6dGhpcy5oYW5kbGVzW2JdLHZhbHVlOnRoaXMudmFsdWUoKX07dGhpcy5vcHRpb25zLnZhbHVlcyYmdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGgmJihjLnZhbHVlPXRoaXMudmFsdWVzKGIpLGMudmFsdWVzPXRoaXMudmFsdWVzKCkpLHRoaXMuX3RyaWdnZXIoImNoYW5nZSIsYSxjKX19LHZhbHVlOmZ1bmN0aW9uKGEpe2lmKGFyZ3VtZW50cy5sZW5ndGgpe3RoaXMub3B0aW9ucy52YWx1ZT10aGlzLl90cmltQWxpZ25WYWx1ZShhKSx0aGlzLl9yZWZyZXNoVmFsdWUoKSx0aGlzLl9jaGFuZ2UobnVsbCwwKTtyZXR1cm59cmV0dXJuIHRoaXMuX3ZhbHVlKCl9LHZhbHVlczpmdW5jdGlvbihiLGMpe3ZhciBkLGUsZjtpZihhcmd1bWVudHMubGVuZ3RoPjEpe3RoaXMub3B0aW9ucy52YWx1ZXNbYl09dGhpcy5fdHJpbUFsaWduVmFsdWUoYyksdGhpcy5fcmVmcmVzaFZhbHVlKCksdGhpcy5fY2hhbmdlKG51bGwsYik7cmV0dXJufWlmKCFhcmd1bWVudHMubGVuZ3RoKXJldHVybiB0aGlzLl92YWx1ZXMoKTtpZighYS5pc0FycmF5KGFyZ3VtZW50c1swXSkpcmV0dXJuIHRoaXMub3B0aW9ucy52YWx1ZXMmJnRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoP3RoaXMuX3ZhbHVlcyhiKTp0aGlzLnZhbHVlKCk7ZD10aGlzLm9wdGlvbnMudmFsdWVzLGU9YXJndW1lbnRzWzBdO2ZvcihmPTA7ZjxkLmxlbmd0aDtmKz0xKWRbZl09dGhpcy5fdHJpbUFsaWduVmFsdWUoZVtmXSksdGhpcy5fY2hhbmdlKG51bGwsZik7dGhpcy5fcmVmcmVzaFZhbHVlKCl9LF9zZXRPcHRpb246ZnVuY3Rpb24oYixjKXt2YXIgZCxlPTA7YS5pc0FycmF5KHRoaXMub3B0aW9ucy52YWx1ZXMpJiYoZT10aGlzLm9wdGlvbnMudmFsdWVzLmxlbmd0aCksYS5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpO3N3aXRjaChiKXtjYXNlImRpc2FibGVkIjpjPyh0aGlzLmhhbmRsZXMuZmlsdGVyKCIudWktc3RhdGUtZm9jdXMiKS5ibHVyKCksdGhpcy5oYW5kbGVzLnJlbW92ZUNsYXNzKCJ1aS1zdGF0ZS1ob3ZlciIpLHRoaXMuaGFuZGxlcy5wcm9wQXR0cigiZGlzYWJsZWQiLCEwKSx0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLWRpc2FibGVkIikpOih0aGlzLmhhbmRsZXMucHJvcEF0dHIoImRpc2FibGVkIiwhMSksdGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1kaXNhYmxlZCIpKTticmVhaztjYXNlIm9yaWVudGF0aW9uIjp0aGlzLl9kZXRlY3RPcmllbnRhdGlvbigpLHRoaXMuZWxlbWVudC5yZW1vdmVDbGFzcygidWktc2xpZGVyLWhvcml6b250YWwgdWktc2xpZGVyLXZlcnRpY2FsIikuYWRkQ2xhc3MoInVpLXNsaWRlci0iK3RoaXMub3JpZW50YXRpb24pLHRoaXMuX3JlZnJlc2hWYWx1ZSgpO2JyZWFrO2Nhc2UidmFsdWUiOnRoaXMuX2FuaW1hdGVPZmY9ITAsdGhpcy5fcmVmcmVzaFZhbHVlKCksdGhpcy5fY2hhbmdlKG51bGwsMCksdGhpcy5fYW5pbWF0ZU9mZj0hMTticmVhaztjYXNlInZhbHVlcyI6dGhpcy5fYW5pbWF0ZU9mZj0hMCx0aGlzLl9yZWZyZXNoVmFsdWUoKTtmb3IoZD0wO2Q8ZTtkKz0xKXRoaXMuX2NoYW5nZShudWxsLGQpO3RoaXMuX2FuaW1hdGVPZmY9ITF9fSxfdmFsdWU6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnMudmFsdWU7cmV0dXJuIGE9dGhpcy5fdHJpbUFsaWduVmFsdWUoYSksYX0sX3ZhbHVlczpmdW5jdGlvbihhKXt2YXIgYixjLGQ7aWYoYXJndW1lbnRzLmxlbmd0aClyZXR1cm4gYj10aGlzLm9wdGlvbnMudmFsdWVzW2FdLGI9dGhpcy5fdHJpbUFsaWduVmFsdWUoYiksYjtjPXRoaXMub3B0aW9ucy52YWx1ZXMuc2xpY2UoKTtmb3IoZD0wO2Q8Yy5sZW5ndGg7ZCs9MSljW2RdPXRoaXMuX3RyaW1BbGlnblZhbHVlKGNbZF0pO3JldHVybiBjfSxfdHJpbUFsaWduVmFsdWU6ZnVuY3Rpb24oYSl7aWYoYTw9dGhpcy5fdmFsdWVNaW4oKSlyZXR1cm4gdGhpcy5fdmFsdWVNaW4oKTtpZihhPj10aGlzLl92YWx1ZU1heCgpKXJldHVybiB0aGlzLl92YWx1ZU1heCgpO3ZhciBiPXRoaXMub3B0aW9ucy5zdGVwPjA/dGhpcy5vcHRpb25zLnN0ZXA6MSxjPShhLXRoaXMuX3ZhbHVlTWluKCkpJWIsZD1hLWM7cmV0dXJuIE1hdGguYWJzKGMpKjI+PWImJihkKz1jPjA/YjotYikscGFyc2VGbG9hdChkLnRvRml4ZWQoNSkpfSxfdmFsdWVNaW46ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vcHRpb25zLm1pbn0sX3ZhbHVlTWF4OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub3B0aW9ucy5tYXh9LF9yZWZyZXNoVmFsdWU6ZnVuY3Rpb24oKXt2YXIgYj10aGlzLm9wdGlvbnMucmFuZ2UsYz10aGlzLm9wdGlvbnMsZD10aGlzLGU9dGhpcy5fYW5pbWF0ZU9mZj8hMTpjLmFuaW1hdGUsZixnPXt9LGgsaSxqLGs7dGhpcy5vcHRpb25zLnZhbHVlcyYmdGhpcy5vcHRpb25zLnZhbHVlcy5sZW5ndGg/dGhpcy5oYW5kbGVzLmVhY2goZnVuY3Rpb24oYixpKXtmPShkLnZhbHVlcyhiKS1kLl92YWx1ZU1pbigpKS8oZC5fdmFsdWVNYXgoKS1kLl92YWx1ZU1pbigpKSoxMDAsZ1tkLm9yaWVudGF0aW9uPT09Imhvcml6b250YWwiPyJsZWZ0IjoiYm90dG9tIl09ZisiJSIsYSh0aGlzKS5zdG9wKDEsMSlbZT8iYW5pbWF0ZSI6ImNzcyJdKGcsYy5hbmltYXRlKSxkLm9wdGlvbnMucmFuZ2U9PT0hMCYmKGQub3JpZW50YXRpb249PT0iaG9yaXpvbnRhbCI/KGI9PT0wJiZkLnJhbmdlLnN0b3AoMSwxKVtlPyJhbmltYXRlIjoiY3NzIl0oe2xlZnQ6ZisiJSJ9LGMuYW5pbWF0ZSksYj09PTEmJmQucmFuZ2VbZT8iYW5pbWF0ZSI6ImNzcyJdKHt3aWR0aDpmLWgrIiUifSx7cXVldWU6ITEsZHVyYXRpb246Yy5hbmltYXRlfSkpOihiPT09MCYmZC5yYW5nZS5zdG9wKDEsMSlbZT8iYW5pbWF0ZSI6ImNzcyJdKHtib3R0b206ZisiJSJ9LGMuYW5pbWF0ZSksYj09PTEmJmQucmFuZ2VbZT8iYW5pbWF0ZSI6ImNzcyJdKHtoZWlnaHQ6Zi1oKyIlIn0se3F1ZXVlOiExLGR1cmF0aW9uOmMuYW5pbWF0ZX0pKSksaD1mfSk6KGk9dGhpcy52YWx1ZSgpLGo9dGhpcy5fdmFsdWVNaW4oKSxrPXRoaXMuX3ZhbHVlTWF4KCksZj1rIT09aj8oaS1qKS8oay1qKSoxMDA6MCxnW2Qub3JpZW50YXRpb249PT0iaG9yaXpvbnRhbCI/ImxlZnQiOiJib3R0b20iXT1mKyIlIix0aGlzLmhhbmRsZS5zdG9wKDEsMSlbZT8iYW5pbWF0ZSI6ImNzcyJdKGcsYy5hbmltYXRlKSxiPT09Im1pbiImJnRoaXMub3JpZW50YXRpb249PT0iaG9yaXpvbnRhbCImJnRoaXMucmFuZ2Uuc3RvcCgxLDEpW2U/ImFuaW1hdGUiOiJjc3MiXSh7d2lkdGg6ZisiJSJ9LGMuYW5pbWF0ZSksYj09PSJtYXgiJiZ0aGlzLm9yaWVudGF0aW9uPT09Imhvcml6b250YWwiJiZ0aGlzLnJhbmdlW2U/ImFuaW1hdGUiOiJjc3MiXSh7d2lkdGg6MTAwLWYrIiUifSx7cXVldWU6ITEsZHVyYXRpb246Yy5hbmltYXRlfSksYj09PSJtaW4iJiZ0aGlzLm9yaWVudGF0aW9uPT09InZlcnRpY2FsIiYmdGhpcy5yYW5nZS5zdG9wKDEsMSlbZT8iYW5pbWF0ZSI6ImNzcyJdKHtoZWlnaHQ6ZisiJSJ9LGMuYW5pbWF0ZSksYj09PSJtYXgiJiZ0aGlzLm9yaWVudGF0aW9uPT09InZlcnRpY2FsIiYmdGhpcy5yYW5nZVtlPyJhbmltYXRlIjoiY3NzIl0oe2hlaWdodDoxMDAtZisiJSJ9LHtxdWV1ZTohMSxkdXJhdGlvbjpjLmFuaW1hdGV9KSl9fSksYS5leHRlbmQoYS51aS5zbGlkZXIse3ZlcnNpb246IjEuOC4yMCJ9KX0pKGpRdWVyeSk7Oy8qISBqUXVlcnkgVUkgLSB2MS44LjIwIC0gMjAxMi0wNC0zMAoqIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5LXVpCiogSW5jbHVkZXM6IGpxdWVyeS51aS50YWJzLmpzCiogQ29weXJpZ2h0IChjKSAyMDEyIEFVVEhPUlMudHh0OyBMaWNlbnNlZCBNSVQsIEdQTCAqLwooZnVuY3Rpb24oYSxiKXtmdW5jdGlvbiBlKCl7cmV0dXJuKytjfWZ1bmN0aW9uIGYoKXtyZXR1cm4rK2R9dmFyIGM9MCxkPTA7YS53aWRnZXQoInVpLnRhYnMiLHtvcHRpb25zOnthZGQ6bnVsbCxhamF4T3B0aW9uczpudWxsLGNhY2hlOiExLGNvb2tpZTpudWxsLGNvbGxhcHNpYmxlOiExLGRpc2FibGU6bnVsbCxkaXNhYmxlZDpbXSxlbmFibGU6bnVsbCxldmVudDoiY2xpY2siLGZ4Om51bGwsaWRQcmVmaXg6InVpLXRhYnMtIixsb2FkOm51bGwscGFuZWxUZW1wbGF0ZToiPGRpdj48L2Rpdj4iLHJlbW92ZTpudWxsLHNlbGVjdDpudWxsLHNob3c6bnVsbCxzcGlubmVyOiI8ZW0+TG9hZGluZyYjODIzMDs8L2VtPiIsdGFiVGVtcGxhdGU6IjxsaT48YSBocmVmPScje2hyZWZ9Jz48c3Bhbj4je2xhYmVsfTwvc3Bhbj48L2E+PC9saT4ifSxfY3JlYXRlOmZ1bmN0aW9uKCl7dGhpcy5fdGFiaWZ5KCEwKX0sX3NldE9wdGlvbjpmdW5jdGlvbihhLGIpe2lmKGE9PSJzZWxlY3RlZCIpe2lmKHRoaXMub3B0aW9ucy5jb2xsYXBzaWJsZSYmYj09dGhpcy5vcHRpb25zLnNlbGVjdGVkKXJldHVybjt0aGlzLnNlbGVjdChiKX1lbHNlIHRoaXMub3B0aW9uc1thXT1iLHRoaXMuX3RhYmlmeSgpfSxfdGFiSWQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGEudGl0bGUmJmEudGl0bGUucmVwbGFjZSgvXHMvZywiXyIpLnJlcGxhY2UoL1teXHdcdTAwYzAtXHVGRkZGLV0vZywiIil8fHRoaXMub3B0aW9ucy5pZFByZWZpeCtlKCl9LF9zYW5pdGl6ZVNlbGVjdG9yOmZ1bmN0aW9uKGEpe3JldHVybiBhLnJlcGxhY2UoLzovZywiXFw6Iil9LF9jb29raWU6ZnVuY3Rpb24oKXt2YXIgYj10aGlzLmNvb2tpZXx8KHRoaXMuY29va2llPXRoaXMub3B0aW9ucy5jb29raWUubmFtZXx8InVpLXRhYnMtIitmKCkpO3JldHVybiBhLmNvb2tpZS5hcHBseShudWxsLFtiXS5jb25jYXQoYS5tYWtlQXJyYXkoYXJndW1lbnRzKSkpfSxfdWk6ZnVuY3Rpb24oYSxiKXtyZXR1cm57dGFiOmEscGFuZWw6YixpbmRleDp0aGlzLmFuY2hvcnMuaW5kZXgoYSl9fSxfY2xlYW51cDpmdW5jdGlvbigpe3RoaXMubGlzLmZpbHRlcigiLnVpLXN0YXRlLXByb2Nlc3NpbmciKS5yZW1vdmVDbGFzcygidWktc3RhdGUtcHJvY2Vzc2luZyIpLmZpbmQoInNwYW46ZGF0YShsYWJlbC50YWJzKSIpLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1hKHRoaXMpO2IuaHRtbChiLmRhdGEoImxhYmVsLnRhYnMiKSkucmVtb3ZlRGF0YSgibGFiZWwudGFicyIpfSl9LF90YWJpZnk6ZnVuY3Rpb24oYyl7ZnVuY3Rpb24gbShiLGMpe2IuY3NzKCJkaXNwbGF5IiwiIiksIWEuc3VwcG9ydC5vcGFjaXR5JiZjLm9wYWNpdHkmJmJbMF0uc3R5bGUucmVtb3ZlQXR0cmlidXRlKCJmaWx0ZXIiKX12YXIgZD10aGlzLGU9dGhpcy5vcHRpb25zLGY9L14jLisvO3RoaXMubGlzdD10aGlzLmVsZW1lbnQuZmluZCgib2wsdWwiKS5lcSgwKSx0aGlzLmxpcz1hKCIgPiBsaTpoYXMoYVtocmVmXSkiLHRoaXMubGlzdCksdGhpcy5hbmNob3JzPXRoaXMubGlzLm1hcChmdW5jdGlvbigpe3JldHVybiBhKCJhIix0aGlzKVswXX0pLHRoaXMucGFuZWxzPWEoW10pLHRoaXMuYW5jaG9ycy5lYWNoKGZ1bmN0aW9uKGIsYyl7dmFyIGc9YShjKS5hdHRyKCJocmVmIiksaD1nLnNwbGl0KCIjIilbMF0saTtoJiYoaD09PWxvY2F0aW9uLnRvU3RyaW5nKCkuc3BsaXQoIiMiKVswXXx8KGk9YSgiYmFzZSIpWzBdKSYmaD09PWkuaHJlZikmJihnPWMuaGFzaCxjLmhyZWY9Zyk7aWYoZi50ZXN0KGcpKWQucGFuZWxzPWQucGFuZWxzLmFkZChkLmVsZW1lbnQuZmluZChkLl9zYW5pdGl6ZVNlbGVjdG9yKGcpKSk7ZWxzZSBpZihnJiZnIT09IiMiKXthLmRhdGEoYywiaHJlZi50YWJzIixnKSxhLmRhdGEoYywibG9hZC50YWJzIixnLnJlcGxhY2UoLyMuKiQvLCIiKSk7dmFyIGo9ZC5fdGFiSWQoYyk7Yy5ocmVmPSIjIitqO3ZhciBrPWQuZWxlbWVudC5maW5kKCIjIitqKTtrLmxlbmd0aHx8KGs9YShlLnBhbmVsVGVtcGxhdGUpLmF0dHIoImlkIixqKS5hZGRDbGFzcygidWktdGFicy1wYW5lbCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYm90dG9tIikuaW5zZXJ0QWZ0ZXIoZC5wYW5lbHNbYi0xXXx8ZC5saXN0KSxrLmRhdGEoImRlc3Ryb3kudGFicyIsITApKSxkLnBhbmVscz1kLnBhbmVscy5hZGQoayl9ZWxzZSBlLmRpc2FibGVkLnB1c2goYil9KSxjPyh0aGlzLmVsZW1lbnQuYWRkQ2xhc3MoInVpLXRhYnMgdWktd2lkZ2V0IHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1hbGwiKSx0aGlzLmxpc3QuYWRkQ2xhc3MoInVpLXRhYnMtbmF2IHVpLWhlbHBlci1yZXNldCB1aS1oZWxwZXItY2xlYXJmaXggdWktd2lkZ2V0LWhlYWRlciB1aS1jb3JuZXItYWxsIiksdGhpcy5saXMuYWRkQ2xhc3MoInVpLXN0YXRlLWRlZmF1bHQgdWktY29ybmVyLXRvcCIpLHRoaXMucGFuZWxzLmFkZENsYXNzKCJ1aS10YWJzLXBhbmVsIHVpLXdpZGdldC1jb250ZW50IHVpLWNvcm5lci1ib3R0b20iKSxlLnNlbGVjdGVkPT09Yj8obG9jYXRpb24uaGFzaCYmdGhpcy5hbmNob3JzLmVhY2goZnVuY3Rpb24oYSxiKXtpZihiLmhhc2g9PWxvY2F0aW9uLmhhc2gpcmV0dXJuIGUuc2VsZWN0ZWQ9YSwhMX0pLHR5cGVvZiBlLnNlbGVjdGVkIT0ibnVtYmVyIiYmZS5jb29raWUmJihlLnNlbGVjdGVkPXBhcnNlSW50KGQuX2Nvb2tpZSgpLDEwKSksdHlwZW9mIGUuc2VsZWN0ZWQhPSJudW1iZXIiJiZ0aGlzLmxpcy5maWx0ZXIoIi51aS10YWJzLXNlbGVjdGVkIikubGVuZ3RoJiYoZS5zZWxlY3RlZD10aGlzLmxpcy5pbmRleCh0aGlzLmxpcy5maWx0ZXIoIi51aS10YWJzLXNlbGVjdGVkIikpKSxlLnNlbGVjdGVkPWUuc2VsZWN0ZWR8fCh0aGlzLmxpcy5sZW5ndGg/MDotMSkpOmUuc2VsZWN0ZWQ9PT1udWxsJiYoZS5zZWxlY3RlZD0tMSksZS5zZWxlY3RlZD1lLnNlbGVjdGVkPj0wJiZ0aGlzLmFuY2hvcnNbZS5zZWxlY3RlZF18fGUuc2VsZWN0ZWQ8MD9lLnNlbGVjdGVkOjAsZS5kaXNhYmxlZD1hLnVuaXF1ZShlLmRpc2FibGVkLmNvbmNhdChhLm1hcCh0aGlzLmxpcy5maWx0ZXIoIi51aS1zdGF0ZS1kaXNhYmxlZCIpLGZ1bmN0aW9uKGEsYil7cmV0dXJuIGQubGlzLmluZGV4KGEpfSkpKS5zb3J0KCksYS5pbkFycmF5KGUuc2VsZWN0ZWQsZS5kaXNhYmxlZCkhPS0xJiZlLmRpc2FibGVkLnNwbGljZShhLmluQXJyYXkoZS5zZWxlY3RlZCxlLmRpc2FibGVkKSwxKSx0aGlzLnBhbmVscy5hZGRDbGFzcygidWktdGFicy1oaWRlIiksdGhpcy5saXMucmVtb3ZlQ2xhc3MoInVpLXRhYnMtc2VsZWN0ZWQgdWktc3RhdGUtYWN0aXZlIiksZS5zZWxlY3RlZD49MCYmdGhpcy5hbmNob3JzLmxlbmd0aCYmKGQuZWxlbWVudC5maW5kKGQuX3Nhbml0aXplU2VsZWN0b3IoZC5hbmNob3JzW2Uuc2VsZWN0ZWRdLmhhc2gpKS5yZW1vdmVDbGFzcygidWktdGFicy1oaWRlIiksdGhpcy5saXMuZXEoZS5zZWxlY3RlZCkuYWRkQ2xhc3MoInVpLXRhYnMtc2VsZWN0ZWQgdWktc3RhdGUtYWN0aXZlIiksZC5lbGVtZW50LnF1ZXVlKCJ0YWJzIixmdW5jdGlvbigpe2QuX3RyaWdnZXIoInNob3ciLG51bGwsZC5fdWkoZC5hbmNob3JzW2Uuc2VsZWN0ZWRdLGQuZWxlbWVudC5maW5kKGQuX3Nhbml0aXplU2VsZWN0b3IoZC5hbmNob3JzW2Uuc2VsZWN0ZWRdLmhhc2gpKVswXSkpfSksdGhpcy5sb2FkKGUuc2VsZWN0ZWQpKSxhKHdpbmRvdykuYmluZCgidW5sb2FkIixmdW5jdGlvbigpe2QubGlzLmFkZChkLmFuY2hvcnMpLnVuYmluZCgiLnRhYnMiKSxkLmxpcz1kLmFuY2hvcnM9ZC5wYW5lbHM9bnVsbH0pKTplLnNlbGVjdGVkPXRoaXMubGlzLmluZGV4KHRoaXMubGlzLmZpbHRlcigiLnVpLXRhYnMtc2VsZWN0ZWQiKSksdGhpcy5lbGVtZW50W2UuY29sbGFwc2libGU/ImFkZENsYXNzIjoicmVtb3ZlQ2xhc3MiXSgidWktdGFicy1jb2xsYXBzaWJsZSIpLGUuY29va2llJiZ0aGlzLl9jb29raWUoZS5zZWxlY3RlZCxlLmNvb2tpZSk7Zm9yKHZhciBnPTAsaDtoPXRoaXMubGlzW2ddO2crKylhKGgpW2EuaW5BcnJheShnLGUuZGlzYWJsZWQpIT0tMSYmIWEoaCkuaGFzQ2xhc3MoInVpLXRhYnMtc2VsZWN0ZWQiKT8iYWRkQ2xhc3MiOiJyZW1vdmVDbGFzcyJdKCJ1aS1zdGF0ZS1kaXNhYmxlZCIpO2UuY2FjaGU9PT0hMSYmdGhpcy5hbmNob3JzLnJlbW92ZURhdGEoImNhY2hlLnRhYnMiKSx0aGlzLmxpcy5hZGQodGhpcy5hbmNob3JzKS51bmJpbmQoIi50YWJzIik7aWYoZS5ldmVudCE9PSJtb3VzZW92ZXIiKXt2YXIgaT1mdW5jdGlvbihhLGIpe2IuaXMoIjpub3QoLnVpLXN0YXRlLWRpc2FibGVkKSIpJiZiLmFkZENsYXNzKCJ1aS1zdGF0ZS0iK2EpfSxqPWZ1bmN0aW9uKGEsYil7Yi5yZW1vdmVDbGFzcygidWktc3RhdGUtIithKX07dGhpcy5saXMuYmluZCgibW91c2VvdmVyLnRhYnMiLGZ1bmN0aW9uKCl7aSgiaG92ZXIiLGEodGhpcykpfSksdGhpcy5saXMuYmluZCgibW91c2VvdXQudGFicyIsZnVuY3Rpb24oKXtqKCJob3ZlciIsYSh0aGlzKSl9KSx0aGlzLmFuY2hvcnMuYmluZCgiZm9jdXMudGFicyIsZnVuY3Rpb24oKXtpKCJmb2N1cyIsYSh0aGlzKS5jbG9zZXN0KCJsaSIpKX0pLHRoaXMuYW5jaG9ycy5iaW5kKCJibHVyLnRhYnMiLGZ1bmN0aW9uKCl7aigiZm9jdXMiLGEodGhpcykuY2xvc2VzdCgibGkiKSl9KX12YXIgayxsO2UuZngmJihhLmlzQXJyYXkoZS5meCk/KGs9ZS5meFswXSxsPWUuZnhbMV0pOms9bD1lLmZ4KTt2YXIgbj1sP2Z1bmN0aW9uKGIsYyl7YShiKS5jbG9zZXN0KCJsaSIpLmFkZENsYXNzKCJ1aS10YWJzLXNlbGVjdGVkIHVpLXN0YXRlLWFjdGl2ZSIpLGMuaGlkZSgpLnJlbW92ZUNsYXNzKCJ1aS10YWJzLWhpZGUiKS5hbmltYXRlKGwsbC5kdXJhdGlvbnx8Im5vcm1hbCIsZnVuY3Rpb24oKXttKGMsbCksZC5fdHJpZ2dlcigic2hvdyIsbnVsbCxkLl91aShiLGNbMF0pKX0pfTpmdW5jdGlvbihiLGMpe2EoYikuY2xvc2VzdCgibGkiKS5hZGRDbGFzcygidWktdGFicy1zZWxlY3RlZCB1aS1zdGF0ZS1hY3RpdmUiKSxjLnJlbW92ZUNsYXNzKCJ1aS10YWJzLWhpZGUiKSxkLl90cmlnZ2VyKCJzaG93IixudWxsLGQuX3VpKGIsY1swXSkpfSxvPWs/ZnVuY3Rpb24oYSxiKXtiLmFuaW1hdGUoayxrLmR1cmF0aW9ufHwibm9ybWFsIixmdW5jdGlvbigpe2QubGlzLnJlbW92ZUNsYXNzKCJ1aS10YWJzLXNlbGVjdGVkIHVpLXN0YXRlLWFjdGl2ZSIpLGIuYWRkQ2xhc3MoInVpLXRhYnMtaGlkZSIpLG0oYixrKSxkLmVsZW1lbnQuZGVxdWV1ZSgidGFicyIpfSl9OmZ1bmN0aW9uKGEsYixjKXtkLmxpcy5yZW1vdmVDbGFzcygidWktdGFicy1zZWxlY3RlZCB1aS1zdGF0ZS1hY3RpdmUiKSxiLmFkZENsYXNzKCJ1aS10YWJzLWhpZGUiKSxkLmVsZW1lbnQuZGVxdWV1ZSgidGFicyIpfTt0aGlzLmFuY2hvcnMuYmluZChlLmV2ZW50KyIudGFicyIsZnVuY3Rpb24oKXt2YXIgYj10aGlzLGM9YShiKS5jbG9zZXN0KCJsaSIpLGY9ZC5wYW5lbHMuZmlsdGVyKCI6bm90KC51aS10YWJzLWhpZGUpIiksZz1kLmVsZW1lbnQuZmluZChkLl9zYW5pdGl6ZVNlbGVjdG9yKGIuaGFzaCkpO2lmKGMuaGFzQ2xhc3MoInVpLXRhYnMtc2VsZWN0ZWQiKSYmIWUuY29sbGFwc2libGV8fGMuaGFzQ2xhc3MoInVpLXN0YXRlLWRpc2FibGVkIil8fGMuaGFzQ2xhc3MoInVpLXN0YXRlLXByb2Nlc3NpbmciKXx8ZC5wYW5lbHMuZmlsdGVyKCI6YW5pbWF0ZWQiKS5sZW5ndGh8fGQuX3RyaWdnZXIoInNlbGVjdCIsbnVsbCxkLl91aSh0aGlzLGdbMF0pKT09PSExKXJldHVybiB0aGlzLmJsdXIoKSwhMTtlLnNlbGVjdGVkPWQuYW5jaG9ycy5pbmRleCh0aGlzKSxkLmFib3J0KCk7aWYoZS5jb2xsYXBzaWJsZSl7aWYoYy5oYXNDbGFzcygidWktdGFicy1zZWxlY3RlZCIpKXJldHVybiBlLnNlbGVjdGVkPS0xLGUuY29va2llJiZkLl9jb29raWUoZS5zZWxlY3RlZCxlLmNvb2tpZSksZC5lbGVtZW50LnF1ZXVlKCJ0YWJzIixmdW5jdGlvbigpe28oYixmKX0pLmRlcXVldWUoInRhYnMiKSx0aGlzLmJsdXIoKSwhMTtpZighZi5sZW5ndGgpcmV0dXJuIGUuY29va2llJiZkLl9jb29raWUoZS5zZWxlY3RlZCxlLmNvb2tpZSksZC5lbGVtZW50LnF1ZXVlKCJ0YWJzIixmdW5jdGlvbigpe24oYixnKX0pLGQubG9hZChkLmFuY2hvcnMuaW5kZXgodGhpcykpLHRoaXMuYmx1cigpLCExfWUuY29va2llJiZkLl9jb29raWUoZS5zZWxlY3RlZCxlLmNvb2tpZSk7aWYoZy5sZW5ndGgpZi5sZW5ndGgmJmQuZWxlbWVudC5xdWV1ZSgidGFicyIsZnVuY3Rpb24oKXtvKGIsZil9KSxkLmVsZW1lbnQucXVldWUoInRhYnMiLGZ1bmN0aW9uKCl7bihiLGcpfSksZC5sb2FkKGQuYW5jaG9ycy5pbmRleCh0aGlzKSk7ZWxzZSB0aHJvdyJqUXVlcnkgVUkgVGFiczogTWlzbWF0Y2hpbmcgZnJhZ21lbnQgaWRlbnRpZmllci4iO2EuYnJvd3Nlci5tc2llJiZ0aGlzLmJsdXIoKX0pLHRoaXMuYW5jaG9ycy5iaW5kKCJjbGljay50YWJzIixmdW5jdGlvbigpe3JldHVybiExfSl9LF9nZXRJbmRleDpmdW5jdGlvbihhKXtyZXR1cm4gdHlwZW9mIGE9PSJzdHJpbmciJiYoYT10aGlzLmFuY2hvcnMuaW5kZXgodGhpcy5hbmNob3JzLmZpbHRlcigiW2hyZWYkPSciK2ErIiddIikpKSxhfSxkZXN0cm95OmZ1bmN0aW9uKCl7dmFyIGI9dGhpcy5vcHRpb25zO3JldHVybiB0aGlzLmFib3J0KCksdGhpcy5lbGVtZW50LnVuYmluZCgiLnRhYnMiKS5yZW1vdmVDbGFzcygidWktdGFicyB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCB1aS10YWJzLWNvbGxhcHNpYmxlIikucmVtb3ZlRGF0YSgidGFicyIpLHRoaXMubGlzdC5yZW1vdmVDbGFzcygidWktdGFicy1uYXYgdWktaGVscGVyLXJlc2V0IHVpLWhlbHBlci1jbGVhcmZpeCB1aS13aWRnZXQtaGVhZGVyIHVpLWNvcm5lci1hbGwiKSx0aGlzLmFuY2hvcnMuZWFjaChmdW5jdGlvbigpe3ZhciBiPWEuZGF0YSh0aGlzLCJocmVmLnRhYnMiKTtiJiYodGhpcy5ocmVmPWIpO3ZhciBjPWEodGhpcykudW5iaW5kKCIudGFicyIpO2EuZWFjaChbImhyZWYiLCJsb2FkIiwiY2FjaGUiXSxmdW5jdGlvbihhLGIpe2MucmVtb3ZlRGF0YShiKyIudGFicyIpfSl9KSx0aGlzLmxpcy51bmJpbmQoIi50YWJzIikuYWRkKHRoaXMucGFuZWxzKS5lYWNoKGZ1bmN0aW9uKCl7YS5kYXRhKHRoaXMsImRlc3Ryb3kudGFicyIpP2EodGhpcykucmVtb3ZlKCk6YSh0aGlzKS5yZW1vdmVDbGFzcyhbInVpLXN0YXRlLWRlZmF1bHQiLCJ1aS1jb3JuZXItdG9wIiwidWktdGFicy1zZWxlY3RlZCIsInVpLXN0YXRlLWFjdGl2ZSIsInVpLXN0YXRlLWhvdmVyIiwidWktc3RhdGUtZm9jdXMiLCJ1aS1zdGF0ZS1kaXNhYmxlZCIsInVpLXRhYnMtcGFuZWwiLCJ1aS13aWRnZXQtY29udGVudCIsInVpLWNvcm5lci1ib3R0b20iLCJ1aS10YWJzLWhpZGUiXS5qb2luKCIgIikpfSksYi5jb29raWUmJnRoaXMuX2Nvb2tpZShudWxsLGIuY29va2llKSx0aGlzfSxhZGQ6ZnVuY3Rpb24oYyxkLGUpe2U9PT1iJiYoZT10aGlzLmFuY2hvcnMubGVuZ3RoKTt2YXIgZj10aGlzLGc9dGhpcy5vcHRpb25zLGg9YShnLnRhYlRlbXBsYXRlLnJlcGxhY2UoLyNce2hyZWZcfS9nLGMpLnJlcGxhY2UoLyNce2xhYmVsXH0vZyxkKSksaT1jLmluZGV4T2YoIiMiKT90aGlzLl90YWJJZChhKCJhIixoKVswXSk6Yy5yZXBsYWNlKCIjIiwiIik7aC5hZGRDbGFzcygidWktc3RhdGUtZGVmYXVsdCB1aS1jb3JuZXItdG9wIikuZGF0YSgiZGVzdHJveS50YWJzIiwhMCk7dmFyIGo9Zi5lbGVtZW50LmZpbmQoIiMiK2kpO3JldHVybiBqLmxlbmd0aHx8KGo9YShnLnBhbmVsVGVtcGxhdGUpLmF0dHIoImlkIixpKS5kYXRhKCJkZXN0cm95LnRhYnMiLCEwKSksai5hZGRDbGFzcygidWktdGFicy1wYW5lbCB1aS13aWRnZXQtY29udGVudCB1aS1jb3JuZXItYm90dG9tIHVpLXRhYnMtaGlkZSIpLGU+PXRoaXMubGlzLmxlbmd0aD8oaC5hcHBlbmRUbyh0aGlzLmxpc3QpLGouYXBwZW5kVG8odGhpcy5saXN0WzBdLnBhcmVudE5vZGUpKTooaC5pbnNlcnRCZWZvcmUodGhpcy5saXNbZV0pLGouaW5zZXJ0QmVmb3JlKHRoaXMucGFuZWxzW2VdKSksZy5kaXNhYmxlZD1hLm1hcChnLmRpc2FibGVkLGZ1bmN0aW9uKGEsYil7cmV0dXJuIGE+PWU/KythOmF9KSx0aGlzLl90YWJpZnkoKSx0aGlzLmFuY2hvcnMubGVuZ3RoPT0xJiYoZy5zZWxlY3RlZD0wLGguYWRkQ2xhc3MoInVpLXRhYnMtc2VsZWN0ZWQgdWktc3RhdGUtYWN0aXZlIiksai5yZW1vdmVDbGFzcygidWktdGFicy1oaWRlIiksdGhpcy5lbGVtZW50LnF1ZXVlKCJ0YWJzIixmdW5jdGlvbigpe2YuX3RyaWdnZXIoInNob3ciLG51bGwsZi5fdWkoZi5hbmNob3JzWzBdLGYucGFuZWxzWzBdKSl9KSx0aGlzLmxvYWQoMCkpLHRoaXMuX3RyaWdnZXIoImFkZCIsbnVsbCx0aGlzLl91aSh0aGlzLmFuY2hvcnNbZV0sdGhpcy5wYW5lbHNbZV0pKSx0aGlzfSxyZW1vdmU6ZnVuY3Rpb24oYil7Yj10aGlzLl9nZXRJbmRleChiKTt2YXIgYz10aGlzLm9wdGlvbnMsZD10aGlzLmxpcy5lcShiKS5yZW1vdmUoKSxlPXRoaXMucGFuZWxzLmVxKGIpLnJlbW92ZSgpO3JldHVybiBkLmhhc0NsYXNzKCJ1aS10YWJzLXNlbGVjdGVkIikmJnRoaXMuYW5jaG9ycy5sZW5ndGg+MSYmdGhpcy5zZWxlY3QoYisoYisxPHRoaXMuYW5jaG9ycy5sZW5ndGg/MTotMSkpLGMuZGlzYWJsZWQ9YS5tYXAoYS5ncmVwKGMuZGlzYWJsZWQsZnVuY3Rpb24oYSxjKXtyZXR1cm4gYSE9Yn0pLGZ1bmN0aW9uKGEsYyl7cmV0dXJuIGE+PWI/LS1hOmF9KSx0aGlzLl90YWJpZnkoKSx0aGlzLl90cmlnZ2VyKCJyZW1vdmUiLG51bGwsdGhpcy5fdWkoZC5maW5kKCJhIilbMF0sZVswXSkpLHRoaXN9LGVuYWJsZTpmdW5jdGlvbihiKXtiPXRoaXMuX2dldEluZGV4KGIpO3ZhciBjPXRoaXMub3B0aW9ucztpZihhLmluQXJyYXkoYixjLmRpc2FibGVkKT09LTEpcmV0dXJuO3JldHVybiB0aGlzLmxpcy5lcShiKS5yZW1vdmVDbGFzcygidWktc3RhdGUtZGlzYWJsZWQiKSxjLmRpc2FibGVkPWEuZ3JlcChjLmRpc2FibGVkLGZ1bmN0aW9uKGEsYyl7cmV0dXJuIGEhPWJ9KSx0aGlzLl90cmlnZ2VyKCJlbmFibGUiLG51bGwsdGhpcy5fdWkodGhpcy5hbmNob3JzW2JdLHRoaXMucGFuZWxzW2JdKSksdGhpc30sZGlzYWJsZTpmdW5jdGlvbihhKXthPXRoaXMuX2dldEluZGV4KGEpO3ZhciBiPXRoaXMsYz10aGlzLm9wdGlvbnM7cmV0dXJuIGEhPWMuc2VsZWN0ZWQmJih0aGlzLmxpcy5lcShhKS5hZGRDbGFzcygidWktc3RhdGUtZGlzYWJsZWQiKSxjLmRpc2FibGVkLnB1c2goYSksYy5kaXNhYmxlZC5zb3J0KCksdGhpcy5fdHJpZ2dlcigiZGlzYWJsZSIsbnVsbCx0aGlzLl91aSh0aGlzLmFuY2hvcnNbYV0sdGhpcy5wYW5lbHNbYV0pKSksdGhpc30sc2VsZWN0OmZ1bmN0aW9uKGEpe2E9dGhpcy5fZ2V0SW5kZXgoYSk7aWYoYT09LTEpaWYodGhpcy5vcHRpb25zLmNvbGxhcHNpYmxlJiZ0aGlzLm9wdGlvbnMuc2VsZWN0ZWQhPS0xKWE9dGhpcy5vcHRpb25zLnNlbGVjdGVkO2Vsc2UgcmV0dXJuIHRoaXM7cmV0dXJuIHRoaXMuYW5jaG9ycy5lcShhKS50cmlnZ2VyKHRoaXMub3B0aW9ucy5ldmVudCsiLnRhYnMiKSx0aGlzfSxsb2FkOmZ1bmN0aW9uKGIpe2I9dGhpcy5fZ2V0SW5kZXgoYik7dmFyIGM9dGhpcyxkPXRoaXMub3B0aW9ucyxlPXRoaXMuYW5jaG9ycy5lcShiKVswXSxmPWEuZGF0YShlLCJsb2FkLnRhYnMiKTt0aGlzLmFib3J0KCk7aWYoIWZ8fHRoaXMuZWxlbWVudC5xdWV1ZSgidGFicyIpLmxlbmd0aCE9PTAmJmEuZGF0YShlLCJjYWNoZS50YWJzIikpe3RoaXMuZWxlbWVudC5kZXF1ZXVlKCJ0YWJzIik7cmV0dXJufXRoaXMubGlzLmVxKGIpLmFkZENsYXNzKCJ1aS1zdGF0ZS1wcm9jZXNzaW5nIik7aWYoZC5zcGlubmVyKXt2YXIgZz1hKCJzcGFuIixlKTtnLmRhdGEoImxhYmVsLnRhYnMiLGcuaHRtbCgpKS5odG1sKGQuc3Bpbm5lcil9cmV0dXJuIHRoaXMueGhyPWEuYWpheChhLmV4dGVuZCh7fSxkLmFqYXhPcHRpb25zLHt1cmw6ZixzdWNjZXNzOmZ1bmN0aW9uKGYsZyl7Yy5lbGVtZW50LmZpbmQoYy5fc2FuaXRpemVTZWxlY3RvcihlLmhhc2gpKS5odG1sKGYpLGMuX2NsZWFudXAoKSxkLmNhY2hlJiZhLmRhdGEoZSwiY2FjaGUudGFicyIsITApLGMuX3RyaWdnZXIoImxvYWQiLG51bGwsYy5fdWkoYy5hbmNob3JzW2JdLGMucGFuZWxzW2JdKSk7dHJ5e2QuYWpheE9wdGlvbnMuc3VjY2VzcyhmLGcpfWNhdGNoKGgpe319LGVycm9yOmZ1bmN0aW9uKGEsZixnKXtjLl9jbGVhbnVwKCksYy5fdHJpZ2dlcigibG9hZCIsbnVsbCxjLl91aShjLmFuY2hvcnNbYl0sYy5wYW5lbHNbYl0pKTt0cnl7ZC5hamF4T3B0aW9ucy5lcnJvcihhLGYsYixlKX1jYXRjaChnKXt9fX0pKSxjLmVsZW1lbnQuZGVxdWV1ZSgidGFicyIpLHRoaXN9LGFib3J0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWxlbWVudC5xdWV1ZShbXSksdGhpcy5wYW5lbHMuc3RvcCghMSwhMCksdGhpcy5lbGVtZW50LnF1ZXVlKCJ0YWJzIix0aGlzLmVsZW1lbnQucXVldWUoInRhYnMiKS5zcGxpY2UoLTIsMikpLHRoaXMueGhyJiYodGhpcy54aHIuYWJvcnQoKSxkZWxldGUgdGhpcy54aHIpLHRoaXMuX2NsZWFudXAoKSx0aGlzfSx1cmw6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5hbmNob3JzLmVxKGEpLnJlbW92ZURhdGEoImNhY2hlLnRhYnMiKS5kYXRhKCJsb2FkLnRhYnMiLGIpLHRoaXN9LGxlbmd0aDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmFuY2hvcnMubGVuZ3RofX0pLGEuZXh0ZW5kKGEudWkudGFicyx7dmVyc2lvbjoiMS44LjIwIn0pLGEuZXh0ZW5kKGEudWkudGFicy5wcm90b3R5cGUse3JvdGF0aW9uOm51bGwscm90YXRlOmZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcyxkPXRoaXMub3B0aW9ucyxlPWMuX3JvdGF0ZXx8KGMuX3JvdGF0ZT1mdW5jdGlvbihiKXtjbGVhclRpbWVvdXQoYy5yb3RhdGlvbiksYy5yb3RhdGlvbj1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dmFyIGE9ZC5zZWxlY3RlZDtjLnNlbGVjdCgrK2E8Yy5hbmNob3JzLmxlbmd0aD9hOjApfSxhKSxiJiZiLnN0b3BQcm9wYWdhdGlvbigpfSksZj1jLl91bnJvdGF0ZXx8KGMuX3Vucm90YXRlPWI/ZnVuY3Rpb24oYSl7ZSgpfTpmdW5jdGlvbihhKXthLmNsaWVudFgmJmMucm90YXRlKG51bGwpfSk7cmV0dXJuIGE/KHRoaXMuZWxlbWVudC5iaW5kKCJ0YWJzc2hvdyIsZSksdGhpcy5hbmNob3JzLmJpbmQoZC5ldmVudCsiLnRhYnMiLGYpLGUoKSk6KGNsZWFyVGltZW91dChjLnJvdGF0aW9uKSx0aGlzLmVsZW1lbnQudW5iaW5kKCJ0YWJzc2hvdyIsZSksdGhpcy5hbmNob3JzLnVuYmluZChkLmV2ZW50KyIudGFicyIsZiksZGVsZXRlIHRoaXMuX3JvdGF0ZSxkZWxldGUgdGhpcy5fdW5yb3RhdGUpLHRoaXN9fSl9KShqUXVlcnkpOzsvKiEgalF1ZXJ5IFVJIC0gdjEuOC4yMCAtIDIwMTItMDQtMzAKKiBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS11aQoqIEluY2x1ZGVzOiBqcXVlcnkudWkuZGF0ZXBpY2tlci5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKCQsdW5kZWZpbmVkKXtmdW5jdGlvbiBEYXRlcGlja2VyKCl7dGhpcy5kZWJ1Zz0hMSx0aGlzLl9jdXJJbnN0PW51bGwsdGhpcy5fa2V5RXZlbnQ9ITEsdGhpcy5fZGlzYWJsZWRJbnB1dHM9W10sdGhpcy5fZGF0ZXBpY2tlclNob3dpbmc9ITEsdGhpcy5faW5EaWFsb2c9ITEsdGhpcy5fbWFpbkRpdklkPSJ1aS1kYXRlcGlja2VyLWRpdiIsdGhpcy5faW5saW5lQ2xhc3M9InVpLWRhdGVwaWNrZXItaW5saW5lIix0aGlzLl9hcHBlbmRDbGFzcz0idWktZGF0ZXBpY2tlci1hcHBlbmQiLHRoaXMuX3RyaWdnZXJDbGFzcz0idWktZGF0ZXBpY2tlci10cmlnZ2VyIix0aGlzLl9kaWFsb2dDbGFzcz0idWktZGF0ZXBpY2tlci1kaWFsb2ciLHRoaXMuX2Rpc2FibGVDbGFzcz0idWktZGF0ZXBpY2tlci1kaXNhYmxlZCIsdGhpcy5fdW5zZWxlY3RhYmxlQ2xhc3M9InVpLWRhdGVwaWNrZXItdW5zZWxlY3RhYmxlIix0aGlzLl9jdXJyZW50Q2xhc3M9InVpLWRhdGVwaWNrZXItY3VycmVudC1kYXkiLHRoaXMuX2RheU92ZXJDbGFzcz0idWktZGF0ZXBpY2tlci1kYXlzLWNlbGwtb3ZlciIsdGhpcy5yZWdpb25hbD1bXSx0aGlzLnJlZ2lvbmFsWyIiXT17Y2xvc2VUZXh0OiJEb25lIixwcmV2VGV4dDoiUHJldiIsbmV4dFRleHQ6Ik5leHQiLGN1cnJlbnRUZXh0OiJUb2RheSIsbW9udGhOYW1lczpbIkphbnVhcnkiLCJGZWJydWFyeSIsIk1hcmNoIiwiQXByaWwiLCJNYXkiLCJKdW5lIiwiSnVseSIsIkF1Z3VzdCIsIlNlcHRlbWJlciIsIk9jdG9iZXIiLCJOb3ZlbWJlciIsIkRlY2VtYmVyIl0sbW9udGhOYW1lc1Nob3J0OlsiSmFuIiwiRmViIiwiTWFyIiwiQXByIiwiTWF5IiwiSnVuIiwiSnVsIiwiQXVnIiwiU2VwIiwiT2N0IiwiTm92IiwiRGVjIl0sZGF5TmFtZXM6WyJTdW5kYXkiLCJNb25kYXkiLCJUdWVzZGF5IiwiV2VkbmVzZGF5IiwiVGh1cnNkYXkiLCJGcmlkYXkiLCJTYXR1cmRheSJdLGRheU5hbWVzU2hvcnQ6WyJTdW4iLCJNb24iLCJUdWUiLCJXZWQiLCJUaHUiLCJGcmkiLCJTYXQiXSxkYXlOYW1lc01pbjpbIlN1IiwiTW8iLCJUdSIsIldlIiwiVGgiLCJGciIsIlNhIl0sd2Vla0hlYWRlcjoiV2siLGRhdGVGb3JtYXQ6Im1tL2RkL3l5IixmaXJzdERheTowLGlzUlRMOiExLHNob3dNb250aEFmdGVyWWVhcjohMSx5ZWFyU3VmZml4OiIifSx0aGlzLl9kZWZhdWx0cz17c2hvd09uOiJmb2N1cyIsc2hvd0FuaW06ImZhZGVJbiIsc2hvd09wdGlvbnM6e30sZGVmYXVsdERhdGU6bnVsbCxhcHBlbmRUZXh0OiIiLGJ1dHRvblRleHQ6Ii4uLiIsYnV0dG9uSW1hZ2U6IiIsYnV0dG9uSW1hZ2VPbmx5OiExLGhpZGVJZk5vUHJldk5leHQ6ITEsbmF2aWdhdGlvbkFzRGF0ZUZvcm1hdDohMSxnb3RvQ3VycmVudDohMSxjaGFuZ2VNb250aDohMSxjaGFuZ2VZZWFyOiExLHllYXJSYW5nZToiYy0xMDpjKzEwIixzaG93T3RoZXJNb250aHM6ITEsc2VsZWN0T3RoZXJNb250aHM6ITEsc2hvd1dlZWs6ITEsY2FsY3VsYXRlV2Vlazp0aGlzLmlzbzg2MDFXZWVrLHNob3J0WWVhckN1dG9mZjoiKzEwIixtaW5EYXRlOm51bGwsbWF4RGF0ZTpudWxsLGR1cmF0aW9uOiJmYXN0IixiZWZvcmVTaG93RGF5Om51bGwsYmVmb3JlU2hvdzpudWxsLG9uU2VsZWN0Om51bGwsb25DaGFuZ2VNb250aFllYXI6bnVsbCxvbkNsb3NlOm51bGwsbnVtYmVyT2ZNb250aHM6MSxzaG93Q3VycmVudEF0UG9zOjAsc3RlcE1vbnRoczoxLHN0ZXBCaWdNb250aHM6MTIsYWx0RmllbGQ6IiIsYWx0Rm9ybWF0OiIiLGNvbnN0cmFpbklucHV0OiEwLHNob3dCdXR0b25QYW5lbDohMSxhdXRvU2l6ZTohMSxkaXNhYmxlZDohMX0sJC5leHRlbmQodGhpcy5fZGVmYXVsdHMsdGhpcy5yZWdpb25hbFsiIl0pLHRoaXMuZHBEaXY9YmluZEhvdmVyKCQoJzxkaXYgaWQ9IicrdGhpcy5fbWFpbkRpdklkKyciIGNsYXNzPSJ1aS1kYXRlcGlja2VyIHVpLXdpZGdldCB1aS13aWRnZXQtY29udGVudCB1aS1oZWxwZXItY2xlYXJmaXggdWktY29ybmVyLWFsbCI+PC9kaXY+JykpfWZ1bmN0aW9uIGJpbmRIb3ZlcihhKXt2YXIgYj0iYnV0dG9uLCAudWktZGF0ZXBpY2tlci1wcmV2LCAudWktZGF0ZXBpY2tlci1uZXh0LCAudWktZGF0ZXBpY2tlci1jYWxlbmRhciB0ZCBhIjtyZXR1cm4gYS5iaW5kKCJtb3VzZW91dCIsZnVuY3Rpb24oYSl7dmFyIGM9JChhLnRhcmdldCkuY2xvc2VzdChiKTtpZighYy5sZW5ndGgpcmV0dXJuO2MucmVtb3ZlQ2xhc3MoInVpLXN0YXRlLWhvdmVyIHVpLWRhdGVwaWNrZXItcHJldi1ob3ZlciB1aS1kYXRlcGlja2VyLW5leHQtaG92ZXIiKX0pLmJpbmQoIm1vdXNlb3ZlciIsZnVuY3Rpb24oYyl7dmFyIGQ9JChjLnRhcmdldCkuY2xvc2VzdChiKTtpZigkLmRhdGVwaWNrZXIuX2lzRGlzYWJsZWREYXRlcGlja2VyKGluc3RBY3RpdmUuaW5saW5lP2EucGFyZW50KClbMF06aW5zdEFjdGl2ZS5pbnB1dFswXSl8fCFkLmxlbmd0aClyZXR1cm47ZC5wYXJlbnRzKCIudWktZGF0ZXBpY2tlci1jYWxlbmRhciIpLmZpbmQoImEiKS5yZW1vdmVDbGFzcygidWktc3RhdGUtaG92ZXIiKSxkLmFkZENsYXNzKCJ1aS1zdGF0ZS1ob3ZlciIpLGQuaGFzQ2xhc3MoInVpLWRhdGVwaWNrZXItcHJldiIpJiZkLmFkZENsYXNzKCJ1aS1kYXRlcGlja2VyLXByZXYtaG92ZXIiKSxkLmhhc0NsYXNzKCJ1aS1kYXRlcGlja2VyLW5leHQiKSYmZC5hZGRDbGFzcygidWktZGF0ZXBpY2tlci1uZXh0LWhvdmVyIil9KX1mdW5jdGlvbiBleHRlbmRSZW1vdmUoYSxiKXskLmV4dGVuZChhLGIpO2Zvcih2YXIgYyBpbiBiKWlmKGJbY109PW51bGx8fGJbY109PXVuZGVmaW5lZClhW2NdPWJbY107cmV0dXJuIGF9ZnVuY3Rpb24gaXNBcnJheShhKXtyZXR1cm4gYSYmKCQuYnJvd3Nlci5zYWZhcmkmJnR5cGVvZiBhPT0ib2JqZWN0IiYmYS5sZW5ndGh8fGEuY29uc3RydWN0b3ImJmEuY29uc3RydWN0b3IudG9TdHJpbmcoKS5tYXRjaCgvXEFycmF5XChcKS8pKX0kLmV4dGVuZCgkLnVpLHtkYXRlcGlja2VyOnt2ZXJzaW9uOiIxLjguMjAifX0pO3ZhciBQUk9QX05BTUU9ImRhdGVwaWNrZXIiLGRwdXVpZD0obmV3IERhdGUpLmdldFRpbWUoKSxpbnN0QWN0aXZlOyQuZXh0ZW5kKERhdGVwaWNrZXIucHJvdG90eXBlLHttYXJrZXJDbGFzc05hbWU6Imhhc0RhdGVwaWNrZXIiLG1heFJvd3M6NCxsb2c6ZnVuY3Rpb24oKXt0aGlzLmRlYnVnJiZjb25zb2xlLmxvZy5hcHBseSgiIixhcmd1bWVudHMpfSxfd2lkZ2V0RGF0ZXBpY2tlcjpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRwRGl2fSxzZXREZWZhdWx0czpmdW5jdGlvbihhKXtyZXR1cm4gZXh0ZW5kUmVtb3ZlKHRoaXMuX2RlZmF1bHRzLGF8fHt9KSx0aGlzfSxfYXR0YWNoRGF0ZXBpY2tlcjpmdW5jdGlvbih0YXJnZXQsc2V0dGluZ3Mpe3ZhciBpbmxpbmVTZXR0aW5ncz1udWxsO2Zvcih2YXIgYXR0ck5hbWUgaW4gdGhpcy5fZGVmYXVsdHMpe3ZhciBhdHRyVmFsdWU9dGFyZ2V0LmdldEF0dHJpYnV0ZSgiZGF0ZToiK2F0dHJOYW1lKTtpZihhdHRyVmFsdWUpe2lubGluZVNldHRpbmdzPWlubGluZVNldHRpbmdzfHx7fTt0cnl7aW5saW5lU2V0dGluZ3NbYXR0ck5hbWVdPWV2YWwoYXR0clZhbHVlKX1jYXRjaChlcnIpe2lubGluZVNldHRpbmdzW2F0dHJOYW1lXT1hdHRyVmFsdWV9fX12YXIgbm9kZU5hbWU9dGFyZ2V0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCksaW5saW5lPW5vZGVOYW1lPT0iZGl2Inx8bm9kZU5hbWU9PSJzcGFuIjt0YXJnZXQuaWR8fCh0aGlzLnV1aWQrPTEsdGFyZ2V0LmlkPSJkcCIrdGhpcy51dWlkKTt2YXIgaW5zdD10aGlzLl9uZXdJbnN0KCQodGFyZ2V0KSxpbmxpbmUpO2luc3Quc2V0dGluZ3M9JC5leHRlbmQoe30sc2V0dGluZ3N8fHt9LGlubGluZVNldHRpbmdzfHx7fSksbm9kZU5hbWU9PSJpbnB1dCI/dGhpcy5fY29ubmVjdERhdGVwaWNrZXIodGFyZ2V0LGluc3QpOmlubGluZSYmdGhpcy5faW5saW5lRGF0ZXBpY2tlcih0YXJnZXQsaW5zdCl9LF9uZXdJbnN0OmZ1bmN0aW9uKGEsYil7dmFyIGM9YVswXS5pZC5yZXBsYWNlKC8oW15BLVphLXowLTlfLV0pL2csIlxcXFwkMSIpO3JldHVybntpZDpjLGlucHV0OmEsc2VsZWN0ZWREYXk6MCxzZWxlY3RlZE1vbnRoOjAsc2VsZWN0ZWRZZWFyOjAsZHJhd01vbnRoOjAsZHJhd1llYXI6MCxpbmxpbmU6YixkcERpdjpiP2JpbmRIb3ZlcigkKCc8ZGl2IGNsYXNzPSInK3RoaXMuX2lubGluZUNsYXNzKycgdWktZGF0ZXBpY2tlciB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktaGVscGVyLWNsZWFyZml4IHVpLWNvcm5lci1hbGwiPjwvZGl2PicpKTp0aGlzLmRwRGl2fX0sX2Nvbm5lY3REYXRlcGlja2VyOmZ1bmN0aW9uKGEsYil7dmFyIGM9JChhKTtiLmFwcGVuZD0kKFtdKSxiLnRyaWdnZXI9JChbXSk7aWYoYy5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkpcmV0dXJuO3RoaXMuX2F0dGFjaG1lbnRzKGMsYiksYy5hZGRDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkua2V5ZG93bih0aGlzLl9kb0tleURvd24pLmtleXByZXNzKHRoaXMuX2RvS2V5UHJlc3MpLmtleXVwKHRoaXMuX2RvS2V5VXApLmJpbmQoInNldERhdGEuZGF0ZXBpY2tlciIsZnVuY3Rpb24oYSxjLGQpe2Iuc2V0dGluZ3NbY109ZH0pLmJpbmQoImdldERhdGEuZGF0ZXBpY2tlciIsZnVuY3Rpb24oYSxjKXtyZXR1cm4gdGhpcy5fZ2V0KGIsYyl9KSx0aGlzLl9hdXRvU2l6ZShiKSwkLmRhdGEoYSxQUk9QX05BTUUsYiksYi5zZXR0aW5ncy5kaXNhYmxlZCYmdGhpcy5fZGlzYWJsZURhdGVwaWNrZXIoYSl9LF9hdHRhY2htZW50czpmdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuX2dldChiLCJhcHBlbmRUZXh0IiksZD10aGlzLl9nZXQoYiwiaXNSVEwiKTtiLmFwcGVuZCYmYi5hcHBlbmQucmVtb3ZlKCksYyYmKGIuYXBwZW5kPSQoJzxzcGFuIGNsYXNzPSInK3RoaXMuX2FwcGVuZENsYXNzKyciPicrYysiPC9zcGFuPiIpLGFbZD8iYmVmb3JlIjoiYWZ0ZXIiXShiLmFwcGVuZCkpLGEudW5iaW5kKCJmb2N1cyIsdGhpcy5fc2hvd0RhdGVwaWNrZXIpLGIudHJpZ2dlciYmYi50cmlnZ2VyLnJlbW92ZSgpO3ZhciBlPXRoaXMuX2dldChiLCJzaG93T24iKTsoZT09ImZvY3VzInx8ZT09ImJvdGgiKSYmYS5mb2N1cyh0aGlzLl9zaG93RGF0ZXBpY2tlcik7aWYoZT09ImJ1dHRvbiJ8fGU9PSJib3RoIil7dmFyIGY9dGhpcy5fZ2V0KGIsImJ1dHRvblRleHQiKSxnPXRoaXMuX2dldChiLCJidXR0b25JbWFnZSIpO2IudHJpZ2dlcj0kKHRoaXMuX2dldChiLCJidXR0b25JbWFnZU9ubHkiKT8kKCI8aW1nLz4iKS5hZGRDbGFzcyh0aGlzLl90cmlnZ2VyQ2xhc3MpLmF0dHIoe3NyYzpnLGFsdDpmLHRpdGxlOmZ9KTokKCc8YnV0dG9uIHR5cGU9ImJ1dHRvbiI+PC9idXR0b24+JykuYWRkQ2xhc3ModGhpcy5fdHJpZ2dlckNsYXNzKS5odG1sKGc9PSIiP2Y6JCgiPGltZy8+IikuYXR0cih7c3JjOmcsYWx0OmYsdGl0bGU6Zn0pKSksYVtkPyJiZWZvcmUiOiJhZnRlciJdKGIudHJpZ2dlciksYi50cmlnZ2VyLmNsaWNrKGZ1bmN0aW9uKCl7cmV0dXJuICQuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcmJiQuZGF0ZXBpY2tlci5fbGFzdElucHV0PT1hWzBdPyQuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKTokLmRhdGVwaWNrZXIuX2RhdGVwaWNrZXJTaG93aW5nJiYkLmRhdGVwaWNrZXIuX2xhc3RJbnB1dCE9YVswXT8oJC5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpLCQuZGF0ZXBpY2tlci5fc2hvd0RhdGVwaWNrZXIoYVswXSkpOiQuZGF0ZXBpY2tlci5fc2hvd0RhdGVwaWNrZXIoYVswXSksITF9KX19LF9hdXRvU2l6ZTpmdW5jdGlvbihhKXtpZih0aGlzLl9nZXQoYSwiYXV0b1NpemUiKSYmIWEuaW5saW5lKXt2YXIgYj1uZXcgRGF0ZSgyMDA5LDExLDIwKSxjPXRoaXMuX2dldChhLCJkYXRlRm9ybWF0Iik7aWYoYy5tYXRjaCgvW0RNXS8pKXt2YXIgZD1mdW5jdGlvbihhKXt2YXIgYj0wLGM9MDtmb3IodmFyIGQ9MDtkPGEubGVuZ3RoO2QrKylhW2RdLmxlbmd0aD5iJiYoYj1hW2RdLmxlbmd0aCxjPWQpO3JldHVybiBjfTtiLnNldE1vbnRoKGQodGhpcy5fZ2V0KGEsYy5tYXRjaCgvTU0vKT8ibW9udGhOYW1lcyI6Im1vbnRoTmFtZXNTaG9ydCIpKSksYi5zZXREYXRlKGQodGhpcy5fZ2V0KGEsYy5tYXRjaCgvREQvKT8iZGF5TmFtZXMiOiJkYXlOYW1lc1Nob3J0IikpKzIwLWIuZ2V0RGF5KCkpfWEuaW5wdXQuYXR0cigic2l6ZSIsdGhpcy5fZm9ybWF0RGF0ZShhLGIpLmxlbmd0aCl9fSxfaW5saW5lRGF0ZXBpY2tlcjpmdW5jdGlvbihhLGIpe3ZhciBjPSQoYSk7aWYoYy5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkpcmV0dXJuO2MuYWRkQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpLmFwcGVuZChiLmRwRGl2KS5iaW5kKCJzZXREYXRhLmRhdGVwaWNrZXIiLGZ1bmN0aW9uKGEsYyxkKXtiLnNldHRpbmdzW2NdPWR9KS5iaW5kKCJnZXREYXRhLmRhdGVwaWNrZXIiLGZ1bmN0aW9uKGEsYyl7cmV0dXJuIHRoaXMuX2dldChiLGMpfSksJC5kYXRhKGEsUFJPUF9OQU1FLGIpLHRoaXMuX3NldERhdGUoYix0aGlzLl9nZXREZWZhdWx0RGF0ZShiKSwhMCksdGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihiKSx0aGlzLl91cGRhdGVBbHRlcm5hdGUoYiksYi5zZXR0aW5ncy5kaXNhYmxlZCYmdGhpcy5fZGlzYWJsZURhdGVwaWNrZXIoYSksYi5kcERpdi5jc3MoImRpc3BsYXkiLCJibG9jayIpfSxfZGlhbG9nRGF0ZXBpY2tlcjpmdW5jdGlvbihhLGIsYyxkLGUpe3ZhciBmPXRoaXMuX2RpYWxvZ0luc3Q7aWYoIWYpe3RoaXMudXVpZCs9MTt2YXIgZz0iZHAiK3RoaXMudXVpZDt0aGlzLl9kaWFsb2dJbnB1dD0kKCc8aW5wdXQgdHlwZT0idGV4dCIgaWQ9IicrZysnIiBzdHlsZT0icG9zaXRpb246IGFic29sdXRlOyB0b3A6IC0xMDBweDsgd2lkdGg6IDBweDsgei1pbmRleDogLTEwOyIvPicpLHRoaXMuX2RpYWxvZ0lucHV0LmtleWRvd24odGhpcy5fZG9LZXlEb3duKSwkKCJib2R5IikuYXBwZW5kKHRoaXMuX2RpYWxvZ0lucHV0KSxmPXRoaXMuX2RpYWxvZ0luc3Q9dGhpcy5fbmV3SW5zdCh0aGlzLl9kaWFsb2dJbnB1dCwhMSksZi5zZXR0aW5ncz17fSwkLmRhdGEodGhpcy5fZGlhbG9nSW5wdXRbMF0sUFJPUF9OQU1FLGYpfWV4dGVuZFJlbW92ZShmLnNldHRpbmdzLGR8fHt9KSxiPWImJmIuY29uc3RydWN0b3I9PURhdGU/dGhpcy5fZm9ybWF0RGF0ZShmLGIpOmIsdGhpcy5fZGlhbG9nSW5wdXQudmFsKGIpLHRoaXMuX3Bvcz1lP2UubGVuZ3RoP2U6W2UucGFnZVgsZS5wYWdlWV06bnVsbDtpZighdGhpcy5fcG9zKXt2YXIgaD1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgsaT1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0LGo9ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnR8fGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCxrPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3B8fGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wO3RoaXMuX3Bvcz1baC8yLTEwMCtqLGkvMi0xNTAra119cmV0dXJuIHRoaXMuX2RpYWxvZ0lucHV0LmNzcygibGVmdCIsdGhpcy5fcG9zWzBdKzIwKyJweCIpLmNzcygidG9wIix0aGlzLl9wb3NbMV0rInB4IiksZi5zZXR0aW5ncy5vblNlbGVjdD1jLHRoaXMuX2luRGlhbG9nPSEwLHRoaXMuZHBEaXYuYWRkQ2xhc3ModGhpcy5fZGlhbG9nQ2xhc3MpLHRoaXMuX3Nob3dEYXRlcGlja2VyKHRoaXMuX2RpYWxvZ0lucHV0WzBdKSwkLmJsb2NrVUkmJiQuYmxvY2tVSSh0aGlzLmRwRGl2KSwkLmRhdGEodGhpcy5fZGlhbG9nSW5wdXRbMF0sUFJPUF9OQU1FLGYpLHRoaXN9LF9kZXN0cm95RGF0ZXBpY2tlcjpmdW5jdGlvbihhKXt2YXIgYj0kKGEpLGM9JC5kYXRhKGEsUFJPUF9OQU1FKTtpZighYi5oYXNDbGFzcyh0aGlzLm1hcmtlckNsYXNzTmFtZSkpcmV0dXJuO3ZhciBkPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTskLnJlbW92ZURhdGEoYSxQUk9QX05BTUUpLGQ9PSJpbnB1dCI/KGMuYXBwZW5kLnJlbW92ZSgpLGMudHJpZ2dlci5yZW1vdmUoKSxiLnJlbW92ZUNsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKS51bmJpbmQoImZvY3VzIix0aGlzLl9zaG93RGF0ZXBpY2tlcikudW5iaW5kKCJrZXlkb3duIix0aGlzLl9kb0tleURvd24pLnVuYmluZCgia2V5cHJlc3MiLHRoaXMuX2RvS2V5UHJlc3MpLnVuYmluZCgia2V5dXAiLHRoaXMuX2RvS2V5VXApKTooZD09ImRpdiJ8fGQ9PSJzcGFuIikmJmIucmVtb3ZlQ2xhc3ModGhpcy5tYXJrZXJDbGFzc05hbWUpLmVtcHR5KCl9LF9lbmFibGVEYXRlcGlja2VyOmZ1bmN0aW9uKGEpe3ZhciBiPSQoYSksYz0kLmRhdGEoYSxQUk9QX05BTUUpO2lmKCFiLmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSlyZXR1cm47dmFyIGQ9YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO2lmKGQ9PSJpbnB1dCIpYS5kaXNhYmxlZD0hMSxjLnRyaWdnZXIuZmlsdGVyKCJidXR0b24iKS5lYWNoKGZ1bmN0aW9uKCl7dGhpcy5kaXNhYmxlZD0hMX0pLmVuZCgpLmZpbHRlcigiaW1nIikuY3NzKHtvcGFjaXR5OiIxLjAiLGN1cnNvcjoiIn0pO2Vsc2UgaWYoZD09ImRpdiJ8fGQ9PSJzcGFuIil7dmFyIGU9Yi5jaGlsZHJlbigiLiIrdGhpcy5faW5saW5lQ2xhc3MpO2UuY2hpbGRyZW4oKS5yZW1vdmVDbGFzcygidWktc3RhdGUtZGlzYWJsZWQiKSxlLmZpbmQoInNlbGVjdC51aS1kYXRlcGlja2VyLW1vbnRoLCBzZWxlY3QudWktZGF0ZXBpY2tlci15ZWFyIikucmVtb3ZlQXR0cigiZGlzYWJsZWQiKX10aGlzLl9kaXNhYmxlZElucHV0cz0kLm1hcCh0aGlzLl9kaXNhYmxlZElucHV0cyxmdW5jdGlvbihiKXtyZXR1cm4gYj09YT9udWxsOmJ9KX0sX2Rpc2FibGVEYXRlcGlja2VyOmZ1bmN0aW9uKGEpe3ZhciBiPSQoYSksYz0kLmRhdGEoYSxQUk9QX05BTUUpO2lmKCFiLmhhc0NsYXNzKHRoaXMubWFya2VyQ2xhc3NOYW1lKSlyZXR1cm47dmFyIGQ9YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO2lmKGQ9PSJpbnB1dCIpYS5kaXNhYmxlZD0hMCxjLnRyaWdnZXIuZmlsdGVyKCJidXR0b24iKS5lYWNoKGZ1bmN0aW9uKCl7dGhpcy5kaXNhYmxlZD0hMH0pLmVuZCgpLmZpbHRlcigiaW1nIikuY3NzKHtvcGFjaXR5OiIwLjUiLGN1cnNvcjoiZGVmYXVsdCJ9KTtlbHNlIGlmKGQ9PSJkaXYifHxkPT0ic3BhbiIpe3ZhciBlPWIuY2hpbGRyZW4oIi4iK3RoaXMuX2lubGluZUNsYXNzKTtlLmNoaWxkcmVuKCkuYWRkQ2xhc3MoInVpLXN0YXRlLWRpc2FibGVkIiksZS5maW5kKCJzZWxlY3QudWktZGF0ZXBpY2tlci1tb250aCwgc2VsZWN0LnVpLWRhdGVwaWNrZXIteWVhciIpLmF0dHIoImRpc2FibGVkIiwiZGlzYWJsZWQiKX10aGlzLl9kaXNhYmxlZElucHV0cz0kLm1hcCh0aGlzLl9kaXNhYmxlZElucHV0cyxmdW5jdGlvbihiKXtyZXR1cm4gYj09YT9udWxsOmJ9KSx0aGlzLl9kaXNhYmxlZElucHV0c1t0aGlzLl9kaXNhYmxlZElucHV0cy5sZW5ndGhdPWF9LF9pc0Rpc2FibGVkRGF0ZXBpY2tlcjpmdW5jdGlvbihhKXtpZighYSlyZXR1cm4hMTtmb3IodmFyIGI9MDtiPHRoaXMuX2Rpc2FibGVkSW5wdXRzLmxlbmd0aDtiKyspaWYodGhpcy5fZGlzYWJsZWRJbnB1dHNbYl09PWEpcmV0dXJuITA7cmV0dXJuITF9LF9nZXRJbnN0OmZ1bmN0aW9uKGEpe3RyeXtyZXR1cm4gJC5kYXRhKGEsUFJPUF9OQU1FKX1jYXRjaChiKXt0aHJvdyJNaXNzaW5nIGluc3RhbmNlIGRhdGEgZm9yIHRoaXMgZGF0ZXBpY2tlciJ9fSxfb3B0aW9uRGF0ZXBpY2tlcjpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9dGhpcy5fZ2V0SW5zdChhKTtpZihhcmd1bWVudHMubGVuZ3RoPT0yJiZ0eXBlb2YgYj09InN0cmluZyIpcmV0dXJuIGI9PSJkZWZhdWx0cyI/JC5leHRlbmQoe30sJC5kYXRlcGlja2VyLl9kZWZhdWx0cyk6ZD9iPT0iYWxsIj8kLmV4dGVuZCh7fSxkLnNldHRpbmdzKTp0aGlzLl9nZXQoZCxiKTpudWxsO3ZhciBlPWJ8fHt9O3R5cGVvZiBiPT0ic3RyaW5nIiYmKGU9e30sZVtiXT1jKTtpZihkKXt0aGlzLl9jdXJJbnN0PT1kJiZ0aGlzLl9oaWRlRGF0ZXBpY2tlcigpO3ZhciBmPXRoaXMuX2dldERhdGVEYXRlcGlja2VyKGEsITApLGc9dGhpcy5fZ2V0TWluTWF4RGF0ZShkLCJtaW4iKSxoPXRoaXMuX2dldE1pbk1heERhdGUoZCwibWF4Iik7ZXh0ZW5kUmVtb3ZlKGQuc2V0dGluZ3MsZSksZyE9PW51bGwmJmUuZGF0ZUZvcm1hdCE9PXVuZGVmaW5lZCYmZS5taW5EYXRlPT09dW5kZWZpbmVkJiYoZC5zZXR0aW5ncy5taW5EYXRlPXRoaXMuX2Zvcm1hdERhdGUoZCxnKSksaCE9PW51bGwmJmUuZGF0ZUZvcm1hdCE9PXVuZGVmaW5lZCYmZS5tYXhEYXRlPT09dW5kZWZpbmVkJiYoZC5zZXR0aW5ncy5tYXhEYXRlPXRoaXMuX2Zvcm1hdERhdGUoZCxoKSksdGhpcy5fYXR0YWNobWVudHMoJChhKSxkKSx0aGlzLl9hdXRvU2l6ZShkKSx0aGlzLl9zZXREYXRlKGQsZiksdGhpcy5fdXBkYXRlQWx0ZXJuYXRlKGQpLHRoaXMuX3VwZGF0ZURhdGVwaWNrZXIoZCl9fSxfY2hhbmdlRGF0ZXBpY2tlcjpmdW5jdGlvbihhLGIsYyl7dGhpcy5fb3B0aW9uRGF0ZXBpY2tlcihhLGIsYyl9LF9yZWZyZXNoRGF0ZXBpY2tlcjpmdW5jdGlvbihhKXt2YXIgYj10aGlzLl9nZXRJbnN0KGEpO2ImJnRoaXMuX3VwZGF0ZURhdGVwaWNrZXIoYil9LF9zZXREYXRlRGF0ZXBpY2tlcjpmdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuX2dldEluc3QoYSk7YyYmKHRoaXMuX3NldERhdGUoYyxiKSx0aGlzLl91cGRhdGVEYXRlcGlja2VyKGMpLHRoaXMuX3VwZGF0ZUFsdGVybmF0ZShjKSl9LF9nZXREYXRlRGF0ZXBpY2tlcjpmdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuX2dldEluc3QoYSk7cmV0dXJuIGMmJiFjLmlubGluZSYmdGhpcy5fc2V0RGF0ZUZyb21GaWVsZChjLGIpLGM/dGhpcy5fZ2V0RGF0ZShjKTpudWxsfSxfZG9LZXlEb3duOmZ1bmN0aW9uKGEpe3ZhciBiPSQuZGF0ZXBpY2tlci5fZ2V0SW5zdChhLnRhcmdldCksYz0hMCxkPWIuZHBEaXYuaXMoIi51aS1kYXRlcGlja2VyLXJ0bCIpO2IuX2tleUV2ZW50PSEwO2lmKCQuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcpc3dpdGNoKGEua2V5Q29kZSl7Y2FzZSA5OiQuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKSxjPSExO2JyZWFrO2Nhc2UgMTM6dmFyIGU9JCgidGQuIiskLmRhdGVwaWNrZXIuX2RheU92ZXJDbGFzcysiOm5vdCguIiskLmRhdGVwaWNrZXIuX2N1cnJlbnRDbGFzcysiKSIsYi5kcERpdik7ZVswXSYmJC5kYXRlcGlja2VyLl9zZWxlY3REYXkoYS50YXJnZXQsYi5zZWxlY3RlZE1vbnRoLGIuc2VsZWN0ZWRZZWFyLGVbMF0pO3ZhciBmPSQuZGF0ZXBpY2tlci5fZ2V0KGIsIm9uU2VsZWN0Iik7aWYoZil7dmFyIGc9JC5kYXRlcGlja2VyLl9mb3JtYXREYXRlKGIpO2YuYXBwbHkoYi5pbnB1dD9iLmlucHV0WzBdOm51bGwsW2csYl0pfWVsc2UgJC5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpO3JldHVybiExO2Nhc2UgMjc6JC5kYXRlcGlja2VyLl9oaWRlRGF0ZXBpY2tlcigpO2JyZWFrO2Nhc2UgMzM6JC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGEudGFyZ2V0LGEuY3RybEtleT8tJC5kYXRlcGlja2VyLl9nZXQoYiwic3RlcEJpZ01vbnRocyIpOi0kLmRhdGVwaWNrZXIuX2dldChiLCJzdGVwTW9udGhzIiksIk0iKTticmVhaztjYXNlIDM0OiQuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShhLnRhcmdldCxhLmN0cmxLZXk/KyQuZGF0ZXBpY2tlci5fZ2V0KGIsInN0ZXBCaWdNb250aHMiKTorJC5kYXRlcGlja2VyLl9nZXQoYiwic3RlcE1vbnRocyIpLCJNIik7YnJlYWs7Y2FzZSAzNTooYS5jdHJsS2V5fHxhLm1ldGFLZXkpJiYkLmRhdGVwaWNrZXIuX2NsZWFyRGF0ZShhLnRhcmdldCksYz1hLmN0cmxLZXl8fGEubWV0YUtleTticmVhaztjYXNlIDM2OihhLmN0cmxLZXl8fGEubWV0YUtleSkmJiQuZGF0ZXBpY2tlci5fZ290b1RvZGF5KGEudGFyZ2V0KSxjPWEuY3RybEtleXx8YS5tZXRhS2V5O2JyZWFrO2Nhc2UgMzc6KGEuY3RybEtleXx8YS5tZXRhS2V5KSYmJC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGEudGFyZ2V0LGQ/MTotMSwiRCIpLGM9YS5jdHJsS2V5fHxhLm1ldGFLZXksYS5vcmlnaW5hbEV2ZW50LmFsdEtleSYmJC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGEudGFyZ2V0LGEuY3RybEtleT8tJC5kYXRlcGlja2VyLl9nZXQoYiwic3RlcEJpZ01vbnRocyIpOi0kLmRhdGVwaWNrZXIuX2dldChiLCJzdGVwTW9udGhzIiksIk0iKTticmVhaztjYXNlIDM4OihhLmN0cmxLZXl8fGEubWV0YUtleSkmJiQuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZShhLnRhcmdldCwtNywiRCIpLGM9YS5jdHJsS2V5fHxhLm1ldGFLZXk7YnJlYWs7Y2FzZSAzOTooYS5jdHJsS2V5fHxhLm1ldGFLZXkpJiYkLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoYS50YXJnZXQsZD8tMToxLCJEIiksYz1hLmN0cmxLZXl8fGEubWV0YUtleSxhLm9yaWdpbmFsRXZlbnQuYWx0S2V5JiYkLmRhdGVwaWNrZXIuX2FkanVzdERhdGUoYS50YXJnZXQsYS5jdHJsS2V5PyskLmRhdGVwaWNrZXIuX2dldChiLCJzdGVwQmlnTW9udGhzIik6KyQuZGF0ZXBpY2tlci5fZ2V0KGIsInN0ZXBNb250aHMiKSwiTSIpO2JyZWFrO2Nhc2UgNDA6KGEuY3RybEtleXx8YS5tZXRhS2V5KSYmJC5kYXRlcGlja2VyLl9hZGp1c3REYXRlKGEudGFyZ2V0LDcsIkQiKSxjPWEuY3RybEtleXx8YS5tZXRhS2V5O2JyZWFrO2RlZmF1bHQ6Yz0hMX1lbHNlIGEua2V5Q29kZT09MzYmJmEuY3RybEtleT8kLmRhdGVwaWNrZXIuX3Nob3dEYXRlcGlja2VyKHRoaXMpOmM9ITE7YyYmKGEucHJldmVudERlZmF1bHQoKSxhLnN0b3BQcm9wYWdhdGlvbigpKX0sX2RvS2V5UHJlc3M6ZnVuY3Rpb24oYSl7dmFyIGI9JC5kYXRlcGlja2VyLl9nZXRJbnN0KGEudGFyZ2V0KTtpZigkLmRhdGVwaWNrZXIuX2dldChiLCJjb25zdHJhaW5JbnB1dCIpKXt2YXIgYz0kLmRhdGVwaWNrZXIuX3Bvc3NpYmxlQ2hhcnMoJC5kYXRlcGlja2VyLl9nZXQoYiwiZGF0ZUZvcm1hdCIpKSxkPVN0cmluZy5mcm9tQ2hhckNvZGUoYS5jaGFyQ29kZT09dW5kZWZpbmVkP2Eua2V5Q29kZTphLmNoYXJDb2RlKTtyZXR1cm4gYS5jdHJsS2V5fHxhLm1ldGFLZXl8fGQ8IiAifHwhY3x8Yy5pbmRleE9mKGQpPi0xfX0sX2RvS2V5VXA6ZnVuY3Rpb24oYSl7dmFyIGI9JC5kYXRlcGlja2VyLl9nZXRJbnN0KGEudGFyZ2V0KTtpZihiLmlucHV0LnZhbCgpIT1iLmxhc3RWYWwpdHJ5e3ZhciBjPSQuZGF0ZXBpY2tlci5wYXJzZURhdGUoJC5kYXRlcGlja2VyLl9nZXQoYiwiZGF0ZUZvcm1hdCIpLGIuaW5wdXQ/Yi5pbnB1dC52YWwoKTpudWxsLCQuZGF0ZXBpY2tlci5fZ2V0Rm9ybWF0Q29uZmlnKGIpKTtjJiYoJC5kYXRlcGlja2VyLl9zZXREYXRlRnJvbUZpZWxkKGIpLCQuZGF0ZXBpY2tlci5fdXBkYXRlQWx0ZXJuYXRlKGIpLCQuZGF0ZXBpY2tlci5fdXBkYXRlRGF0ZXBpY2tlcihiKSl9Y2F0Y2goZCl7JC5kYXRlcGlja2VyLmxvZyhkKX1yZXR1cm4hMH0sX3Nob3dEYXRlcGlja2VyOmZ1bmN0aW9uKGEpe2E9YS50YXJnZXR8fGEsYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpIT0iaW5wdXQiJiYoYT0kKCJpbnB1dCIsYS5wYXJlbnROb2RlKVswXSk7aWYoJC5kYXRlcGlja2VyLl9pc0Rpc2FibGVkRGF0ZXBpY2tlcihhKXx8JC5kYXRlcGlja2VyLl9sYXN0SW5wdXQ9PWEpcmV0dXJuO3ZhciBiPSQuZGF0ZXBpY2tlci5fZ2V0SW5zdChhKTskLmRhdGVwaWNrZXIuX2N1ckluc3QmJiQuZGF0ZXBpY2tlci5fY3VySW5zdCE9YiYmKCQuZGF0ZXBpY2tlci5fY3VySW5zdC5kcERpdi5zdG9wKCEwLCEwKSxiJiYkLmRhdGVwaWNrZXIuX2RhdGVwaWNrZXJTaG93aW5nJiYkLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCQuZGF0ZXBpY2tlci5fY3VySW5zdC5pbnB1dFswXSkpO3ZhciBjPSQuZGF0ZXBpY2tlci5fZ2V0KGIsImJlZm9yZVNob3ciKSxkPWM/Yy5hcHBseShhLFthLGJdKTp7fTtpZihkPT09ITEpcmV0dXJuO2V4dGVuZFJlbW92ZShiLnNldHRpbmdzLGQpLGIubGFzdFZhbD1udWxsLCQuZGF0ZXBpY2tlci5fbGFzdElucHV0PWEsJC5kYXRlcGlja2VyLl9zZXREYXRlRnJvbUZpZWxkKGIpLCQuZGF0ZXBpY2tlci5faW5EaWFsb2cmJihhLnZhbHVlPSIiKSwkLmRhdGVwaWNrZXIuX3Bvc3x8KCQuZGF0ZXBpY2tlci5fcG9zPSQuZGF0ZXBpY2tlci5fZmluZFBvcyhhKSwkLmRhdGVwaWNrZXIuX3Bvc1sxXSs9YS5vZmZzZXRIZWlnaHQpO3ZhciBlPSExOyQoYSkucGFyZW50cygpLmVhY2goZnVuY3Rpb24oKXtyZXR1cm4gZXw9JCh0aGlzKS5jc3MoInBvc2l0aW9uIik9PSJmaXhlZCIsIWV9KSxlJiYkLmJyb3dzZXIub3BlcmEmJigkLmRhdGVwaWNrZXIuX3Bvc1swXS09ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQsJC5kYXRlcGlja2VyLl9wb3NbMV0tPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3ApO3ZhciBmPXtsZWZ0OiQuZGF0ZXBpY2tlci5fcG9zWzBdLHRvcDokLmRhdGVwaWNrZXIuX3Bvc1sxXX07JC5kYXRlcGlja2VyLl9wb3M9bnVsbCxiLmRwRGl2LmVtcHR5KCksYi5kcERpdi5jc3Moe3Bvc2l0aW9uOiJhYnNvbHV0ZSIsZGlzcGxheToiYmxvY2siLHRvcDoiLTEwMDBweCJ9KSwkLmRhdGVwaWNrZXIuX3VwZGF0ZURhdGVwaWNrZXIoYiksZj0kLmRhdGVwaWNrZXIuX2NoZWNrT2Zmc2V0KGIsZixlKSxiLmRwRGl2LmNzcyh7cG9zaXRpb246JC5kYXRlcGlja2VyLl9pbkRpYWxvZyYmJC5ibG9ja1VJPyJzdGF0aWMiOmU/ImZpeGVkIjoiYWJzb2x1dGUiLGRpc3BsYXk6Im5vbmUiLGxlZnQ6Zi5sZWZ0KyJweCIsdG9wOmYudG9wKyJweCJ9KTtpZighYi5pbmxpbmUpe3ZhciBnPSQuZGF0ZXBpY2tlci5fZ2V0KGIsInNob3dBbmltIiksaD0kLmRhdGVwaWNrZXIuX2dldChiLCJkdXJhdGlvbiIpLGk9ZnVuY3Rpb24oKXt2YXIgYT1iLmRwRGl2LmZpbmQoImlmcmFtZS51aS1kYXRlcGlja2VyLWNvdmVyIik7aWYoISFhLmxlbmd0aCl7dmFyIGM9JC5kYXRlcGlja2VyLl9nZXRCb3JkZXJzKGIuZHBEaXYpO2EuY3NzKHtsZWZ0Oi1jWzBdLHRvcDotY1sxXSx3aWR0aDpiLmRwRGl2Lm91dGVyV2lkdGgoKSxoZWlnaHQ6Yi5kcERpdi5vdXRlckhlaWdodCgpfSl9fTtiLmRwRGl2LnpJbmRleCgkKGEpLnpJbmRleCgpKzEpLCQuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmc9ITAsJC5lZmZlY3RzJiYkLmVmZmVjdHNbZ10/Yi5kcERpdi5zaG93KGcsJC5kYXRlcGlja2VyLl9nZXQoYiwic2hvd09wdGlvbnMiKSxoLGkpOmIuZHBEaXZbZ3x8InNob3ciXShnP2g6bnVsbCxpKSwoIWd8fCFoKSYmaSgpLGIuaW5wdXQuaXMoIjp2aXNpYmxlIikmJiFiLmlucHV0LmlzKCI6ZGlzYWJsZWQiKSYmYi5pbnB1dC5mb2N1cygpLCQuZGF0ZXBpY2tlci5fY3VySW5zdD1ifX0sX3VwZGF0ZURhdGVwaWNrZXI6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztiLm1heFJvd3M9NDt2YXIgYz0kLmRhdGVwaWNrZXIuX2dldEJvcmRlcnMoYS5kcERpdik7aW5zdEFjdGl2ZT1hLGEuZHBEaXYuZW1wdHkoKS5hcHBlbmQodGhpcy5fZ2VuZXJhdGVIVE1MKGEpKTt2YXIgZD1hLmRwRGl2LmZpbmQoImlmcmFtZS51aS1kYXRlcGlja2VyLWNvdmVyIik7IWQubGVuZ3RofHxkLmNzcyh7bGVmdDotY1swXSx0b3A6LWNbMV0sd2lkdGg6YS5kcERpdi5vdXRlcldpZHRoKCksaGVpZ2h0OmEuZHBEaXYub3V0ZXJIZWlnaHQoKX0pLGEuZHBEaXYuZmluZCgiLiIrdGhpcy5fZGF5T3ZlckNsYXNzKyIgYSIpLm1vdXNlb3ZlcigpO3ZhciBlPXRoaXMuX2dldE51bWJlck9mTW9udGhzKGEpLGY9ZVsxXSxnPTE3O2EuZHBEaXYucmVtb3ZlQ2xhc3MoInVpLWRhdGVwaWNrZXItbXVsdGktMiB1aS1kYXRlcGlja2VyLW11bHRpLTMgdWktZGF0ZXBpY2tlci1tdWx0aS00Iikud2lkdGgoIiIpLGY+MSYmYS5kcERpdi5hZGRDbGFzcygidWktZGF0ZXBpY2tlci1tdWx0aS0iK2YpLmNzcygid2lkdGgiLGcqZisiZW0iKSxhLmRwRGl2WyhlWzBdIT0xfHxlWzFdIT0xPyJhZGQiOiJyZW1vdmUiKSsiQ2xhc3MiXSgidWktZGF0ZXBpY2tlci1tdWx0aSIpLGEuZHBEaXZbKHRoaXMuX2dldChhLCJpc1JUTCIpPyJhZGQiOiJyZW1vdmUiKSsiQ2xhc3MiXSgidWktZGF0ZXBpY2tlci1ydGwiKSxhPT0kLmRhdGVwaWNrZXIuX2N1ckluc3QmJiQuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcmJmEuaW5wdXQmJmEuaW5wdXQuaXMoIjp2aXNpYmxlIikmJiFhLmlucHV0LmlzKCI6ZGlzYWJsZWQiKSYmYS5pbnB1dFswXSE9ZG9jdW1lbnQuYWN0aXZlRWxlbWVudCYmYS5pbnB1dC5mb2N1cygpO2lmKGEueWVhcnNodG1sKXt2YXIgaD1hLnllYXJzaHRtbDtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7aD09PWEueWVhcnNodG1sJiZhLnllYXJzaHRtbCYmYS5kcERpdi5maW5kKCJzZWxlY3QudWktZGF0ZXBpY2tlci15ZWFyOmZpcnN0IikucmVwbGFjZVdpdGgoYS55ZWFyc2h0bWwpLGg9YS55ZWFyc2h0bWw9bnVsbH0sMCl9fSxfZ2V0Qm9yZGVyczpmdW5jdGlvbihhKXt2YXIgYj1mdW5jdGlvbihhKXtyZXR1cm57dGhpbjoxLG1lZGl1bToyLHRoaWNrOjN9W2FdfHxhfTtyZXR1cm5bcGFyc2VGbG9hdChiKGEuY3NzKCJib3JkZXItbGVmdC13aWR0aCIpKSkscGFyc2VGbG9hdChiKGEuY3NzKCJib3JkZXItdG9wLXdpZHRoIikpKV19LF9jaGVja09mZnNldDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9YS5kcERpdi5vdXRlcldpZHRoKCksZT1hLmRwRGl2Lm91dGVySGVpZ2h0KCksZj1hLmlucHV0P2EuaW5wdXQub3V0ZXJXaWR0aCgpOjAsZz1hLmlucHV0P2EuaW5wdXQub3V0ZXJIZWlnaHQoKTowLGg9ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoKyQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSxpPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQrJChkb2N1bWVudCkuc2Nyb2xsVG9wKCk7cmV0dXJuIGIubGVmdC09dGhpcy5fZ2V0KGEsImlzUlRMIik/ZC1mOjAsYi5sZWZ0LT1jJiZiLmxlZnQ9PWEuaW5wdXQub2Zmc2V0KCkubGVmdD8kKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCk6MCxiLnRvcC09YyYmYi50b3A9PWEuaW5wdXQub2Zmc2V0KCkudG9wK2c/JChkb2N1bWVudCkuc2Nyb2xsVG9wKCk6MCxiLmxlZnQtPU1hdGgubWluKGIubGVmdCxiLmxlZnQrZD5oJiZoPmQ/TWF0aC5hYnMoYi5sZWZ0K2QtaCk6MCksYi50b3AtPU1hdGgubWluKGIudG9wLGIudG9wK2U+aSYmaT5lP01hdGguYWJzKGUrZyk6MCksYn0sX2ZpbmRQb3M6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5fZ2V0SW5zdChhKSxjPXRoaXMuX2dldChiLCJpc1JUTCIpO3doaWxlKGEmJihhLnR5cGU9PSJoaWRkZW4ifHxhLm5vZGVUeXBlIT0xfHwkLmV4cHIuZmlsdGVycy5oaWRkZW4oYSkpKWE9YVtjPyJwcmV2aW91c1NpYmxpbmciOiJuZXh0U2libGluZyJdO3ZhciBkPSQoYSkub2Zmc2V0KCk7cmV0dXJuW2QubGVmdCxkLnRvcF19LF9oaWRlRGF0ZXBpY2tlcjpmdW5jdGlvbihhKXt2YXIgYj10aGlzLl9jdXJJbnN0O2lmKCFifHxhJiZiIT0kLmRhdGEoYSxQUk9QX05BTUUpKXJldHVybjtpZih0aGlzLl9kYXRlcGlja2VyU2hvd2luZyl7dmFyIGM9dGhpcy5fZ2V0KGIsInNob3dBbmltIiksZD10aGlzLl9nZXQoYiwiZHVyYXRpb24iKSxlPWZ1bmN0aW9uKCl7JC5kYXRlcGlja2VyLl90aWR5RGlhbG9nKGIpfTskLmVmZmVjdHMmJiQuZWZmZWN0c1tjXT9iLmRwRGl2LmhpZGUoYywkLmRhdGVwaWNrZXIuX2dldChiLCJzaG93T3B0aW9ucyIpLGQsZSk6Yi5kcERpdltjPT0ic2xpZGVEb3duIj8ic2xpZGVVcCI6Yz09ImZhZGVJbiI/ImZhZGVPdXQiOiJoaWRlIl0oYz9kOm51bGwsZSksY3x8ZSgpLHRoaXMuX2RhdGVwaWNrZXJTaG93aW5nPSExO3ZhciBmPXRoaXMuX2dldChiLCJvbkNsb3NlIik7ZiYmZi5hcHBseShiLmlucHV0P2IuaW5wdXRbMF06bnVsbCxbYi5pbnB1dD9iLmlucHV0LnZhbCgpOiIiLGJdKSx0aGlzLl9sYXN0SW5wdXQ9bnVsbCx0aGlzLl9pbkRpYWxvZyYmKHRoaXMuX2RpYWxvZ0lucHV0LmNzcyh7cG9zaXRpb246ImFic29sdXRlIixsZWZ0OiIwIix0b3A6Ii0xMDBweCJ9KSwkLmJsb2NrVUkmJigkLnVuYmxvY2tVSSgpLCQoImJvZHkiKS5hcHBlbmQodGhpcy5kcERpdikpKSx0aGlzLl9pbkRpYWxvZz0hMX19LF90aWR5RGlhbG9nOmZ1bmN0aW9uKGEpe2EuZHBEaXYucmVtb3ZlQ2xhc3ModGhpcy5fZGlhbG9nQ2xhc3MpLnVuYmluZCgiLnVpLWRhdGVwaWNrZXItY2FsZW5kYXIiKX0sX2NoZWNrRXh0ZXJuYWxDbGljazpmdW5jdGlvbihhKXtpZighJC5kYXRlcGlja2VyLl9jdXJJbnN0KXJldHVybjt2YXIgYj0kKGEudGFyZ2V0KSxjPSQuZGF0ZXBpY2tlci5fZ2V0SW5zdChiWzBdKTsoYlswXS5pZCE9JC5kYXRlcGlja2VyLl9tYWluRGl2SWQmJmIucGFyZW50cygiIyIrJC5kYXRlcGlja2VyLl9tYWluRGl2SWQpLmxlbmd0aD09MCYmIWIuaGFzQ2xhc3MoJC5kYXRlcGlja2VyLm1hcmtlckNsYXNzTmFtZSkmJiFiLmNsb3Nlc3QoIi4iKyQuZGF0ZXBpY2tlci5fdHJpZ2dlckNsYXNzKS5sZW5ndGgmJiQuZGF0ZXBpY2tlci5fZGF0ZXBpY2tlclNob3dpbmcmJighJC5kYXRlcGlja2VyLl9pbkRpYWxvZ3x8ISQuYmxvY2tVSSl8fGIuaGFzQ2xhc3MoJC5kYXRlcGlja2VyLm1hcmtlckNsYXNzTmFtZSkmJiQuZGF0ZXBpY2tlci5fY3VySW5zdCE9YykmJiQuZGF0ZXBpY2tlci5faGlkZURhdGVwaWNrZXIoKX0sX2FkanVzdERhdGU6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPSQoYSksZT10aGlzLl9nZXRJbnN0KGRbMF0pO2lmKHRoaXMuX2lzRGlzYWJsZWREYXRlcGlja2VyKGRbMF0pKXJldHVybjt0aGlzLl9hZGp1c3RJbnN0RGF0ZShlLGIrKGM9PSJNIj90aGlzLl9nZXQoZSwic2hvd0N1cnJlbnRBdFBvcyIpOjApLGMpLHRoaXMuX3VwZGF0ZURhdGVwaWNrZXIoZSl9LF9nb3RvVG9kYXk6ZnVuY3Rpb24oYSl7dmFyIGI9JChhKSxjPXRoaXMuX2dldEluc3QoYlswXSk7aWYodGhpcy5fZ2V0KGMsImdvdG9DdXJyZW50IikmJmMuY3VycmVudERheSljLnNlbGVjdGVkRGF5PWMuY3VycmVudERheSxjLmRyYXdNb250aD1jLnNlbGVjdGVkTW9udGg9Yy5jdXJyZW50TW9udGgsYy5kcmF3WWVhcj1jLnNlbGVjdGVkWWVhcj1jLmN1cnJlbnRZZWFyO2Vsc2V7dmFyIGQ9bmV3IERhdGU7Yy5zZWxlY3RlZERheT1kLmdldERhdGUoKSxjLmRyYXdNb250aD1jLnNlbGVjdGVkTW9udGg9ZC5nZXRNb250aCgpLGMuZHJhd1llYXI9Yy5zZWxlY3RlZFllYXI9ZC5nZXRGdWxsWWVhcigpfXRoaXMuX25vdGlmeUNoYW5nZShjKSx0aGlzLl9hZGp1c3REYXRlKGIpfSxfc2VsZWN0TW9udGhZZWFyOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD0kKGEpLGU9dGhpcy5fZ2V0SW5zdChkWzBdKTtlWyJzZWxlY3RlZCIrKGM9PSJNIj8iTW9udGgiOiJZZWFyIildPWVbImRyYXciKyhjPT0iTSI/Ik1vbnRoIjoiWWVhciIpXT1wYXJzZUludChiLm9wdGlvbnNbYi5zZWxlY3RlZEluZGV4XS52YWx1ZSwxMCksdGhpcy5fbm90aWZ5Q2hhbmdlKGUpLHRoaXMuX2FkanVzdERhdGUoZCl9LF9zZWxlY3REYXk6ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9JChhKTtpZigkKGQpLmhhc0NsYXNzKHRoaXMuX3Vuc2VsZWN0YWJsZUNsYXNzKXx8dGhpcy5faXNEaXNhYmxlZERhdGVwaWNrZXIoZVswXSkpcmV0dXJuO3ZhciBmPXRoaXMuX2dldEluc3QoZVswXSk7Zi5zZWxlY3RlZERheT1mLmN1cnJlbnREYXk9JCgiYSIsZCkuaHRtbCgpLGYuc2VsZWN0ZWRNb250aD1mLmN1cnJlbnRNb250aD1iLGYuc2VsZWN0ZWRZZWFyPWYuY3VycmVudFllYXI9Yyx0aGlzLl9zZWxlY3REYXRlKGEsdGhpcy5fZm9ybWF0RGF0ZShmLGYuY3VycmVudERheSxmLmN1cnJlbnRNb250aCxmLmN1cnJlbnRZZWFyKSl9LF9jbGVhckRhdGU6ZnVuY3Rpb24oYSl7dmFyIGI9JChhKSxjPXRoaXMuX2dldEluc3QoYlswXSk7dGhpcy5fc2VsZWN0RGF0ZShiLCIiKX0sX3NlbGVjdERhdGU6ZnVuY3Rpb24oYSxiKXt2YXIgYz0kKGEpLGQ9dGhpcy5fZ2V0SW5zdChjWzBdKTtiPWIhPW51bGw/Yjp0aGlzLl9mb3JtYXREYXRlKGQpLGQuaW5wdXQmJmQuaW5wdXQudmFsKGIpLHRoaXMuX3VwZGF0ZUFsdGVybmF0ZShkKTt2YXIgZT10aGlzLl9nZXQoZCwib25TZWxlY3QiKTtlP2UuYXBwbHkoZC5pbnB1dD9kLmlucHV0WzBdOm51bGwsW2IsZF0pOmQuaW5wdXQmJmQuaW5wdXQudHJpZ2dlcigiY2hhbmdlIiksZC5pbmxpbmU/dGhpcy5fdXBkYXRlRGF0ZXBpY2tlcihkKToodGhpcy5faGlkZURhdGVwaWNrZXIoKSx0aGlzLl9sYXN0SW5wdXQ9ZC5pbnB1dFswXSx0eXBlb2YgZC5pbnB1dFswXSE9Im9iamVjdCImJmQuaW5wdXQuZm9jdXMoKSx0aGlzLl9sYXN0SW5wdXQ9bnVsbCl9LF91cGRhdGVBbHRlcm5hdGU6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5fZ2V0KGEsImFsdEZpZWxkIik7aWYoYil7dmFyIGM9dGhpcy5fZ2V0KGEsImFsdEZvcm1hdCIpfHx0aGlzLl9nZXQoYSwiZGF0ZUZvcm1hdCIpLGQ9dGhpcy5fZ2V0RGF0ZShhKSxlPXRoaXMuZm9ybWF0RGF0ZShjLGQsdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGEpKTskKGIpLmVhY2goZnVuY3Rpb24oKXskKHRoaXMpLnZhbChlKX0pfX0sbm9XZWVrZW5kczpmdW5jdGlvbihhKXt2YXIgYj1hLmdldERheSgpO3JldHVybltiPjAmJmI8NiwiIl19LGlzbzg2MDFXZWVrOmZ1bmN0aW9uKGEpe3ZhciBiPW5ldyBEYXRlKGEuZ2V0VGltZSgpKTtiLnNldERhdGUoYi5nZXREYXRlKCkrNC0oYi5nZXREYXkoKXx8NykpO3ZhciBjPWIuZ2V0VGltZSgpO3JldHVybiBiLnNldE1vbnRoKDApLGIuc2V0RGF0ZSgxKSxNYXRoLmZsb29yKE1hdGgucm91bmQoKGMtYikvODY0ZTUpLzcpKzF9LHBhcnNlRGF0ZTpmdW5jdGlvbihhLGIsYyl7aWYoYT09bnVsbHx8Yj09bnVsbCl0aHJvdyJJbnZhbGlkIGFyZ3VtZW50cyI7Yj10eXBlb2YgYj09Im9iamVjdCI/Yi50b1N0cmluZygpOmIrIiI7aWYoYj09IiIpcmV0dXJuIG51bGw7dmFyIGQ9KGM/Yy5zaG9ydFllYXJDdXRvZmY6bnVsbCl8fHRoaXMuX2RlZmF1bHRzLnNob3J0WWVhckN1dG9mZjtkPXR5cGVvZiBkIT0ic3RyaW5nIj9kOihuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKSUxMDArcGFyc2VJbnQoZCwxMCk7dmFyIGU9KGM/Yy5kYXlOYW1lc1Nob3J0Om51bGwpfHx0aGlzLl9kZWZhdWx0cy5kYXlOYW1lc1Nob3J0LGY9KGM/Yy5kYXlOYW1lczpudWxsKXx8dGhpcy5fZGVmYXVsdHMuZGF5TmFtZXMsZz0oYz9jLm1vbnRoTmFtZXNTaG9ydDpudWxsKXx8dGhpcy5fZGVmYXVsdHMubW9udGhOYW1lc1Nob3J0LGg9KGM/Yy5tb250aE5hbWVzOm51bGwpfHx0aGlzLl9kZWZhdWx0cy5tb250aE5hbWVzLGk9LTEsaj0tMSxrPS0xLGw9LTEsbT0hMSxuPWZ1bmN0aW9uKGIpe3ZhciBjPXMrMTxhLmxlbmd0aCYmYS5jaGFyQXQocysxKT09YjtyZXR1cm4gYyYmcysrLGN9LG89ZnVuY3Rpb24oYSl7dmFyIGM9bihhKSxkPWE9PSJAIj8xNDphPT0iISI/MjA6YT09InkiJiZjPzQ6YT09Im8iPzM6MixlPW5ldyBSZWdFeHAoIl5cXGR7MSwiK2QrIn0iKSxmPWIuc3Vic3RyaW5nKHIpLm1hdGNoKGUpO2lmKCFmKXRocm93Ik1pc3NpbmcgbnVtYmVyIGF0IHBvc2l0aW9uICIrcjtyZXR1cm4gcis9ZlswXS5sZW5ndGgscGFyc2VJbnQoZlswXSwxMCl9LHA9ZnVuY3Rpb24oYSxjLGQpe3ZhciBlPSQubWFwKG4oYSk/ZDpjLGZ1bmN0aW9uKGEsYil7cmV0dXJuW1tiLGFdXX0pLnNvcnQoZnVuY3Rpb24oYSxiKXtyZXR1cm4tKGFbMV0ubGVuZ3RoLWJbMV0ubGVuZ3RoKX0pLGY9LTE7JC5lYWNoKGUsZnVuY3Rpb24oYSxjKXt2YXIgZD1jWzFdO2lmKGIuc3Vic3RyKHIsZC5sZW5ndGgpLnRvTG93ZXJDYXNlKCk9PWQudG9Mb3dlckNhc2UoKSlyZXR1cm4gZj1jWzBdLHIrPWQubGVuZ3RoLCExfSk7aWYoZiE9LTEpcmV0dXJuIGYrMTt0aHJvdyJVbmtub3duIG5hbWUgYXQgcG9zaXRpb24gIityfSxxPWZ1bmN0aW9uKCl7aWYoYi5jaGFyQXQocikhPWEuY2hhckF0KHMpKXRocm93IlVuZXhwZWN0ZWQgbGl0ZXJhbCBhdCBwb3NpdGlvbiAiK3I7cisrfSxyPTA7Zm9yKHZhciBzPTA7czxhLmxlbmd0aDtzKyspaWYobSlhLmNoYXJBdChzKT09IiciJiYhbigiJyIpP209ITE6cSgpO2Vsc2Ugc3dpdGNoKGEuY2hhckF0KHMpKXtjYXNlImQiOms9bygiZCIpO2JyZWFrO2Nhc2UiRCI6cCgiRCIsZSxmKTticmVhaztjYXNlIm8iOmw9bygibyIpO2JyZWFrO2Nhc2UibSI6aj1vKCJtIik7YnJlYWs7Y2FzZSJNIjpqPXAoIk0iLGcsaCk7YnJlYWs7Y2FzZSJ5IjppPW8oInkiKTticmVhaztjYXNlIkAiOnZhciB0PW5ldyBEYXRlKG8oIkAiKSk7aT10LmdldEZ1bGxZZWFyKCksaj10LmdldE1vbnRoKCkrMSxrPXQuZ2V0RGF0ZSgpO2JyZWFrO2Nhc2UiISI6dmFyIHQ9bmV3IERhdGUoKG8oIiEiKS10aGlzLl90aWNrc1RvMTk3MCkvMWU0KTtpPXQuZ2V0RnVsbFllYXIoKSxqPXQuZ2V0TW9udGgoKSsxLGs9dC5nZXREYXRlKCk7YnJlYWs7Y2FzZSInIjpuKCInIik/cSgpOm09ITA7YnJlYWs7ZGVmYXVsdDpxKCl9aWYocjxiLmxlbmd0aCl0aHJvdyJFeHRyYS91bnBhcnNlZCBjaGFyYWN0ZXJzIGZvdW5kIGluIGRhdGU6ICIrYi5zdWJzdHJpbmcocik7aT09LTE/aT0obmV3IERhdGUpLmdldEZ1bGxZZWFyKCk6aTwxMDAmJihpKz0obmV3IERhdGUpLmdldEZ1bGxZZWFyKCktKG5ldyBEYXRlKS5nZXRGdWxsWWVhcigpJTEwMCsoaTw9ZD8wOi0xMDApKTtpZihsPi0xKXtqPTEsaz1sO2Rve3ZhciB1PXRoaXMuX2dldERheXNJbk1vbnRoKGksai0xKTtpZihrPD11KWJyZWFrO2orKyxrLT11fXdoaWxlKCEwKX12YXIgdD10aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShpLGotMSxrKSk7aWYodC5nZXRGdWxsWWVhcigpIT1pfHx0LmdldE1vbnRoKCkrMSE9anx8dC5nZXREYXRlKCkhPWspdGhyb3ciSW52YWxpZCBkYXRlIjtyZXR1cm4gdH0sQVRPTToieXktbW0tZGQiLENPT0tJRToiRCwgZGQgTSB5eSIsSVNPXzg2MDE6Inl5LW1tLWRkIixSRkNfODIyOiJELCBkIE0geSIsUkZDXzg1MDoiREQsIGRkLU0teSIsUkZDXzEwMzY6IkQsIGQgTSB5IixSRkNfMTEyMzoiRCwgZCBNIHl5IixSRkNfMjgyMjoiRCwgZCBNIHl5IixSU1M6IkQsIGQgTSB5IixUSUNLUzoiISIsVElNRVNUQU1QOiJAIixXM0M6Inl5LW1tLWRkIixfdGlja3NUbzE5NzA6KDcxODY4NStNYXRoLmZsb29yKDQ5Mi41KS1NYXRoLmZsb29yKDE5LjcpK01hdGguZmxvb3IoNC45MjUpKSoyNCo2MCo2MCoxZTcsZm9ybWF0RGF0ZTpmdW5jdGlvbihhLGIsYyl7aWYoIWIpcmV0dXJuIiI7dmFyIGQ9KGM/Yy5kYXlOYW1lc1Nob3J0Om51bGwpfHx0aGlzLl9kZWZhdWx0cy5kYXlOYW1lc1Nob3J0LGU9KGM/Yy5kYXlOYW1lczpudWxsKXx8dGhpcy5fZGVmYXVsdHMuZGF5TmFtZXMsZj0oYz9jLm1vbnRoTmFtZXNTaG9ydDpudWxsKXx8dGhpcy5fZGVmYXVsdHMubW9udGhOYW1lc1Nob3J0LGc9KGM/Yy5tb250aE5hbWVzOm51bGwpfHx0aGlzLl9kZWZhdWx0cy5tb250aE5hbWVzLGg9ZnVuY3Rpb24oYil7dmFyIGM9bSsxPGEubGVuZ3RoJiZhLmNoYXJBdChtKzEpPT1iO3JldHVybiBjJiZtKyssY30saT1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9IiIrYjtpZihoKGEpKXdoaWxlKGQubGVuZ3RoPGMpZD0iMCIrZDtyZXR1cm4gZH0saj1mdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gaChhKT9kW2JdOmNbYl19LGs9IiIsbD0hMTtpZihiKWZvcih2YXIgbT0wO208YS5sZW5ndGg7bSsrKWlmKGwpYS5jaGFyQXQobSk9PSInIiYmIWgoIiciKT9sPSExOmsrPWEuY2hhckF0KG0pO2Vsc2Ugc3dpdGNoKGEuY2hhckF0KG0pKXtjYXNlImQiOmsrPWkoImQiLGIuZ2V0RGF0ZSgpLDIpO2JyZWFrO2Nhc2UiRCI6ays9aigiRCIsYi5nZXREYXkoKSxkLGUpO2JyZWFrO2Nhc2UibyI6ays9aSgibyIsTWF0aC5yb3VuZCgoKG5ldyBEYXRlKGIuZ2V0RnVsbFllYXIoKSxiLmdldE1vbnRoKCksYi5nZXREYXRlKCkpKS5nZXRUaW1lKCktKG5ldyBEYXRlKGIuZ2V0RnVsbFllYXIoKSwwLDApKS5nZXRUaW1lKCkpLzg2NGU1KSwzKTticmVhaztjYXNlIm0iOmsrPWkoIm0iLGIuZ2V0TW9udGgoKSsxLDIpO2JyZWFrO2Nhc2UiTSI6ays9aigiTSIsYi5nZXRNb250aCgpLGYsZyk7YnJlYWs7Y2FzZSJ5IjprKz1oKCJ5Iik/Yi5nZXRGdWxsWWVhcigpOihiLmdldFllYXIoKSUxMDA8MTA/IjAiOiIiKStiLmdldFllYXIoKSUxMDA7YnJlYWs7Y2FzZSJAIjprKz1iLmdldFRpbWUoKTticmVhaztjYXNlIiEiOmsrPWIuZ2V0VGltZSgpKjFlNCt0aGlzLl90aWNrc1RvMTk3MDticmVhaztjYXNlIiciOmgoIiciKT9rKz0iJyI6bD0hMDticmVhaztkZWZhdWx0OmsrPWEuY2hhckF0KG0pfXJldHVybiBrfSxfcG9zc2libGVDaGFyczpmdW5jdGlvbihhKXt2YXIgYj0iIixjPSExLGQ9ZnVuY3Rpb24oYil7dmFyIGM9ZSsxPGEubGVuZ3RoJiZhLmNoYXJBdChlKzEpPT1iO3JldHVybiBjJiZlKyssY307Zm9yKHZhciBlPTA7ZTxhLmxlbmd0aDtlKyspaWYoYylhLmNoYXJBdChlKT09IiciJiYhZCgiJyIpP2M9ITE6Yis9YS5jaGFyQXQoZSk7ZWxzZSBzd2l0Y2goYS5jaGFyQXQoZSkpe2Nhc2UiZCI6Y2FzZSJtIjpjYXNlInkiOmNhc2UiQCI6Yis9IjAxMjM0NTY3ODkiO2JyZWFrO2Nhc2UiRCI6Y2FzZSJNIjpyZXR1cm4gbnVsbDtjYXNlIiciOmQoIiciKT9iKz0iJyI6Yz0hMDticmVhaztkZWZhdWx0OmIrPWEuY2hhckF0KGUpfXJldHVybiBifSxfZ2V0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIGEuc2V0dGluZ3NbYl0hPT11bmRlZmluZWQ/YS5zZXR0aW5nc1tiXTp0aGlzLl9kZWZhdWx0c1tiXX0sX3NldERhdGVGcm9tRmllbGQ6ZnVuY3Rpb24oYSxiKXtpZihhLmlucHV0LnZhbCgpPT1hLmxhc3RWYWwpcmV0dXJuO3ZhciBjPXRoaXMuX2dldChhLCJkYXRlRm9ybWF0IiksZD1hLmxhc3RWYWw9YS5pbnB1dD9hLmlucHV0LnZhbCgpOm51bGwsZSxmO2U9Zj10aGlzLl9nZXREZWZhdWx0RGF0ZShhKTt2YXIgZz10aGlzLl9nZXRGb3JtYXRDb25maWcoYSk7dHJ5e2U9dGhpcy5wYXJzZURhdGUoYyxkLGcpfHxmfWNhdGNoKGgpe3RoaXMubG9nKGgpLGQ9Yj8iIjpkfWEuc2VsZWN0ZWREYXk9ZS5nZXREYXRlKCksYS5kcmF3TW9udGg9YS5zZWxlY3RlZE1vbnRoPWUuZ2V0TW9udGgoKSxhLmRyYXdZZWFyPWEuc2VsZWN0ZWRZZWFyPWUuZ2V0RnVsbFllYXIoKSxhLmN1cnJlbnREYXk9ZD9lLmdldERhdGUoKTowLGEuY3VycmVudE1vbnRoPWQ/ZS5nZXRNb250aCgpOjAsYS5jdXJyZW50WWVhcj1kP2UuZ2V0RnVsbFllYXIoKTowLHRoaXMuX2FkanVzdEluc3REYXRlKGEpfSxfZ2V0RGVmYXVsdERhdGU6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuX3Jlc3RyaWN0TWluTWF4KGEsdGhpcy5fZGV0ZXJtaW5lRGF0ZShhLHRoaXMuX2dldChhLCJkZWZhdWx0RGF0ZSIpLG5ldyBEYXRlKSl9LF9kZXRlcm1pbmVEYXRlOmZ1bmN0aW9uKGEsYixjKXt2YXIgZD1mdW5jdGlvbihhKXt2YXIgYj1uZXcgRGF0ZTtyZXR1cm4gYi5zZXREYXRlKGIuZ2V0RGF0ZSgpK2EpLGJ9LGU9ZnVuY3Rpb24oYil7dHJ5e3JldHVybiAkLmRhdGVwaWNrZXIucGFyc2VEYXRlKCQuZGF0ZXBpY2tlci5fZ2V0KGEsImRhdGVGb3JtYXQiKSxiLCQuZGF0ZXBpY2tlci5fZ2V0Rm9ybWF0Q29uZmlnKGEpKX1jYXRjaChjKXt9dmFyIGQ9KGIudG9Mb3dlckNhc2UoKS5tYXRjaCgvXmMvKT8kLmRhdGVwaWNrZXIuX2dldERhdGUoYSk6bnVsbCl8fG5ldyBEYXRlLGU9ZC5nZXRGdWxsWWVhcigpLGY9ZC5nZXRNb250aCgpLGc9ZC5nZXREYXRlKCksaD0vKFsrLV0/WzAtOV0rKVxzKihkfER8d3xXfG18TXx5fFkpPy9nLGk9aC5leGVjKGIpO3doaWxlKGkpe3N3aXRjaChpWzJdfHwiZCIpe2Nhc2UiZCI6Y2FzZSJEIjpnKz1wYXJzZUludChpWzFdLDEwKTticmVhaztjYXNlInciOmNhc2UiVyI6Zys9cGFyc2VJbnQoaVsxXSwxMCkqNzticmVhaztjYXNlIm0iOmNhc2UiTSI6Zis9cGFyc2VJbnQoaVsxXSwxMCksZz1NYXRoLm1pbihnLCQuZGF0ZXBpY2tlci5fZ2V0RGF5c0luTW9udGgoZSxmKSk7YnJlYWs7Y2FzZSJ5IjpjYXNlIlkiOmUrPXBhcnNlSW50KGlbMV0sMTApLGc9TWF0aC5taW4oZywkLmRhdGVwaWNrZXIuX2dldERheXNJbk1vbnRoKGUsZikpfWk9aC5leGVjKGIpfXJldHVybiBuZXcgRGF0ZShlLGYsZyl9LGY9Yj09bnVsbHx8Yj09PSIiP2M6dHlwZW9mIGI9PSJzdHJpbmciP2UoYik6dHlwZW9mIGI9PSJudW1iZXIiP2lzTmFOKGIpP2M6ZChiKTpuZXcgRGF0ZShiLmdldFRpbWUoKSk7cmV0dXJuIGY9ZiYmZi50b1N0cmluZygpPT0iSW52YWxpZCBEYXRlIj9jOmYsZiYmKGYuc2V0SG91cnMoMCksZi5zZXRNaW51dGVzKDApLGYuc2V0U2Vjb25kcygwKSxmLnNldE1pbGxpc2Vjb25kcygwKSksdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QoZil9LF9kYXlsaWdodFNhdmluZ0FkanVzdDpmdW5jdGlvbihhKXtyZXR1cm4gYT8oYS5zZXRIb3VycyhhLmdldEhvdXJzKCk+MTI/YS5nZXRIb3VycygpKzI6MCksYSk6bnVsbH0sX3NldERhdGU6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPSFiLGU9YS5zZWxlY3RlZE1vbnRoLGY9YS5zZWxlY3RlZFllYXIsZz10aGlzLl9yZXN0cmljdE1pbk1heChhLHRoaXMuX2RldGVybWluZURhdGUoYSxiLG5ldyBEYXRlKSk7YS5zZWxlY3RlZERheT1hLmN1cnJlbnREYXk9Zy5nZXREYXRlKCksYS5kcmF3TW9udGg9YS5zZWxlY3RlZE1vbnRoPWEuY3VycmVudE1vbnRoPWcuZ2V0TW9udGgoKSxhLmRyYXdZZWFyPWEuc2VsZWN0ZWRZZWFyPWEuY3VycmVudFllYXI9Zy5nZXRGdWxsWWVhcigpLChlIT1hLnNlbGVjdGVkTW9udGh8fGYhPWEuc2VsZWN0ZWRZZWFyKSYmIWMmJnRoaXMuX25vdGlmeUNoYW5nZShhKSx0aGlzLl9hZGp1c3RJbnN0RGF0ZShhKSxhLmlucHV0JiZhLmlucHV0LnZhbChkPyIiOnRoaXMuX2Zvcm1hdERhdGUoYSkpfSxfZ2V0RGF0ZTpmdW5jdGlvbihhKXt2YXIgYj0hYS5jdXJyZW50WWVhcnx8YS5pbnB1dCYmYS5pbnB1dC52YWwoKT09IiI/bnVsbDp0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShhLmN1cnJlbnRZZWFyLGEuY3VycmVudE1vbnRoLGEuY3VycmVudERheSkpO3JldHVybiBifSxfZ2VuZXJhdGVIVE1MOmZ1bmN0aW9uKGEpe3ZhciBiPW5ldyBEYXRlO2I9dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoYi5nZXRGdWxsWWVhcigpLGIuZ2V0TW9udGgoKSxiLmdldERhdGUoKSkpO3ZhciBjPXRoaXMuX2dldChhLCJpc1JUTCIpLGQ9dGhpcy5fZ2V0KGEsInNob3dCdXR0b25QYW5lbCIpLGU9dGhpcy5fZ2V0KGEsImhpZGVJZk5vUHJldk5leHQiKSxmPXRoaXMuX2dldChhLCJuYXZpZ2F0aW9uQXNEYXRlRm9ybWF0IiksZz10aGlzLl9nZXROdW1iZXJPZk1vbnRocyhhKSxoPXRoaXMuX2dldChhLCJzaG93Q3VycmVudEF0UG9zIiksaT10aGlzLl9nZXQoYSwic3RlcE1vbnRocyIpLGo9Z1swXSE9MXx8Z1sxXSE9MSxrPXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KGEuY3VycmVudERheT9uZXcgRGF0ZShhLmN1cnJlbnRZZWFyLGEuY3VycmVudE1vbnRoLGEuY3VycmVudERheSk6bmV3IERhdGUoOTk5OSw5LDkpKSxsPXRoaXMuX2dldE1pbk1heERhdGUoYSwibWluIiksbT10aGlzLl9nZXRNaW5NYXhEYXRlKGEsIm1heCIpLG49YS5kcmF3TW9udGgtaCxvPWEuZHJhd1llYXI7bjwwJiYobis9MTIsby0tKTtpZihtKXt2YXIgcD10aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShtLmdldEZ1bGxZZWFyKCksbS5nZXRNb250aCgpLWdbMF0qZ1sxXSsxLG0uZ2V0RGF0ZSgpKSk7cD1sJiZwPGw/bDpwO3doaWxlKHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKG8sbiwxKSk+cCluLS0sbjwwJiYobj0xMSxvLS0pfWEuZHJhd01vbnRoPW4sYS5kcmF3WWVhcj1vO3ZhciBxPXRoaXMuX2dldChhLCJwcmV2VGV4dCIpO3E9Zj90aGlzLmZvcm1hdERhdGUocSx0aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShvLG4taSwxKSksdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGEpKTpxO3ZhciByPXRoaXMuX2NhbkFkanVzdE1vbnRoKGEsLTEsbyxuKT8nPGEgY2xhc3M9InVpLWRhdGVwaWNrZXItcHJldiB1aS1jb3JuZXItYWxsIiBvbmNsaWNrPSJEUF9qUXVlcnlfJytkcHV1aWQrIi5kYXRlcGlja2VyLl9hZGp1c3REYXRlKCcjIithLmlkKyInLCAtIitpKyIsICdNJyk7XCIiKycgdGl0bGU9IicrcSsnIj48c3BhbiBjbGFzcz0idWktaWNvbiB1aS1pY29uLWNpcmNsZS10cmlhbmdsZS0nKyhjPyJlIjoidyIpKyciPicrcSsiPC9zcGFuPjwvYT4iOmU/IiI6JzxhIGNsYXNzPSJ1aS1kYXRlcGlja2VyLXByZXYgdWktY29ybmVyLWFsbCB1aS1zdGF0ZS1kaXNhYmxlZCIgdGl0bGU9IicrcSsnIj48c3BhbiBjbGFzcz0idWktaWNvbiB1aS1pY29uLWNpcmNsZS10cmlhbmdsZS0nKyhjPyJlIjoidyIpKyciPicrcSsiPC9zcGFuPjwvYT4iLHM9dGhpcy5fZ2V0KGEsIm5leHRUZXh0Iik7cz1mP3RoaXMuZm9ybWF0RGF0ZShzLHRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKG8sbitpLDEpKSx0aGlzLl9nZXRGb3JtYXRDb25maWcoYSkpOnM7dmFyIHQ9dGhpcy5fY2FuQWRqdXN0TW9udGgoYSwxLG8sbik/JzxhIGNsYXNzPSJ1aS1kYXRlcGlja2VyLW5leHQgdWktY29ybmVyLWFsbCIgb25jbGljaz0iRFBfalF1ZXJ5XycrZHB1dWlkKyIuZGF0ZXBpY2tlci5fYWRqdXN0RGF0ZSgnIyIrYS5pZCsiJywgKyIraSsiLCAnTScpO1wiIisnIHRpdGxlPSInK3MrJyI+PHNwYW4gY2xhc3M9InVpLWljb24gdWktaWNvbi1jaXJjbGUtdHJpYW5nbGUtJysoYz8idyI6ImUiKSsnIj4nK3MrIjwvc3Bhbj48L2E+IjplPyIiOic8YSBjbGFzcz0idWktZGF0ZXBpY2tlci1uZXh0IHVpLWNvcm5lci1hbGwgdWktc3RhdGUtZGlzYWJsZWQiIHRpdGxlPSInK3MrJyI+PHNwYW4gY2xhc3M9InVpLWljb24gdWktaWNvbi1jaXJjbGUtdHJpYW5nbGUtJysoYz8idyI6ImUiKSsnIj4nK3MrIjwvc3Bhbj48L2E+Iix1PXRoaXMuX2dldChhLCJjdXJyZW50VGV4dCIpLHY9dGhpcy5fZ2V0KGEsImdvdG9DdXJyZW50IikmJmEuY3VycmVudERheT9rOmI7dT1mP3RoaXMuZm9ybWF0RGF0ZSh1LHYsdGhpcy5fZ2V0Rm9ybWF0Q29uZmlnKGEpKTp1O3ZhciB3PWEuaW5saW5lPyIiOic8YnV0dG9uIHR5cGU9ImJ1dHRvbiIgY2xhc3M9InVpLWRhdGVwaWNrZXItY2xvc2UgdWktc3RhdGUtZGVmYXVsdCB1aS1wcmlvcml0eS1wcmltYXJ5IHVpLWNvcm5lci1hbGwiIG9uY2xpY2s9IkRQX2pRdWVyeV8nK2RwdXVpZCsnLmRhdGVwaWNrZXIuX2hpZGVEYXRlcGlja2VyKCk7Ij4nK3RoaXMuX2dldChhLCJjbG9zZVRleHQiKSsiPC9idXR0b24+Iix4PWQ/JzxkaXYgY2xhc3M9InVpLWRhdGVwaWNrZXItYnV0dG9ucGFuZSB1aS13aWRnZXQtY29udGVudCI+JysoYz93OiIiKSsodGhpcy5faXNJblJhbmdlKGEsdik/JzxidXR0b24gdHlwZT0iYnV0dG9uIiBjbGFzcz0idWktZGF0ZXBpY2tlci1jdXJyZW50IHVpLXN0YXRlLWRlZmF1bHQgdWktcHJpb3JpdHktc2Vjb25kYXJ5IHVpLWNvcm5lci1hbGwiIG9uY2xpY2s9IkRQX2pRdWVyeV8nK2RwdXVpZCsiLmRhdGVwaWNrZXIuX2dvdG9Ub2RheSgnIyIrYS5pZCsiJyk7XCIiKyI+Iit1KyI8L2J1dHRvbj4iOiIiKSsoYz8iIjp3KSsiPC9kaXY+IjoiIix5PXBhcnNlSW50KHRoaXMuX2dldChhLCJmaXJzdERheSIpLDEwKTt5PWlzTmFOKHkpPzA6eTt2YXIgej10aGlzLl9nZXQoYSwic2hvd1dlZWsiKSxBPXRoaXMuX2dldChhLCJkYXlOYW1lcyIpLEI9dGhpcy5fZ2V0KGEsImRheU5hbWVzU2hvcnQiKSxDPXRoaXMuX2dldChhLCJkYXlOYW1lc01pbiIpLEQ9dGhpcy5fZ2V0KGEsIm1vbnRoTmFtZXMiKSxFPXRoaXMuX2dldChhLCJtb250aE5hbWVzU2hvcnQiKSxGPXRoaXMuX2dldChhLCJiZWZvcmVTaG93RGF5IiksRz10aGlzLl9nZXQoYSwic2hvd090aGVyTW9udGhzIiksSD10aGlzLl9nZXQoYSwic2VsZWN0T3RoZXJNb250aHMiKSxJPXRoaXMuX2dldChhLCJjYWxjdWxhdGVXZWVrIil8fHRoaXMuaXNvODYwMVdlZWssSj10aGlzLl9nZXREZWZhdWx0RGF0ZShhKSxLPSIiO2Zvcih2YXIgTD0wO0w8Z1swXTtMKyspe3ZhciBNPSIiO3RoaXMubWF4Um93cz00O2Zvcih2YXIgTj0wO048Z1sxXTtOKyspe3ZhciBPPXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKG8sbixhLnNlbGVjdGVkRGF5KSksUD0iIHVpLWNvcm5lci1hbGwiLFE9IiI7aWYoail7USs9JzxkaXYgY2xhc3M9InVpLWRhdGVwaWNrZXItZ3JvdXAnO2lmKGdbMV0+MSlzd2l0Y2goTil7Y2FzZSAwOlErPSIgdWktZGF0ZXBpY2tlci1ncm91cC1maXJzdCIsUD0iIHVpLWNvcm5lci0iKyhjPyJyaWdodCI6ImxlZnQiKTticmVhaztjYXNlIGdbMV0tMTpRKz0iIHVpLWRhdGVwaWNrZXItZ3JvdXAtbGFzdCIsUD0iIHVpLWNvcm5lci0iKyhjPyJsZWZ0IjoicmlnaHQiKTticmVhaztkZWZhdWx0OlErPSIgdWktZGF0ZXBpY2tlci1ncm91cC1taWRkbGUiLFA9IiJ9USs9JyI+J31RKz0nPGRpdiBjbGFzcz0idWktZGF0ZXBpY2tlci1oZWFkZXIgdWktd2lkZ2V0LWhlYWRlciB1aS1oZWxwZXItY2xlYXJmaXgnK1ArJyI+JysoL2FsbHxsZWZ0Ly50ZXN0KFApJiZMPT0wP2M/dDpyOiIiKSsoL2FsbHxyaWdodC8udGVzdChQKSYmTD09MD9jP3I6dDoiIikrdGhpcy5fZ2VuZXJhdGVNb250aFllYXJIZWFkZXIoYSxuLG8sbCxtLEw+MHx8Tj4wLEQsRSkrJzwvZGl2Pjx0YWJsZSBjbGFzcz0idWktZGF0ZXBpY2tlci1jYWxlbmRhciI+PHRoZWFkPicrIjx0cj4iO3ZhciBSPXo/Jzx0aCBjbGFzcz0idWktZGF0ZXBpY2tlci13ZWVrLWNvbCI+Jyt0aGlzLl9nZXQoYSwid2Vla0hlYWRlciIpKyI8L3RoPiI6IiI7Zm9yKHZhciBTPTA7Uzw3O1MrKyl7dmFyIFQ9KFMreSklNztSKz0iPHRoIisoKFMreSs2KSU3Pj01PycgY2xhc3M9InVpLWRhdGVwaWNrZXItd2Vlay1lbmQiJzoiIikrIj4iKyc8c3BhbiB0aXRsZT0iJytBW1RdKyciPicrQ1tUXSsiPC9zcGFuPjwvdGg+In1RKz1SKyI8L3RyPjwvdGhlYWQ+PHRib2R5PiI7dmFyIFU9dGhpcy5fZ2V0RGF5c0luTW9udGgobyxuKTtvPT1hLnNlbGVjdGVkWWVhciYmbj09YS5zZWxlY3RlZE1vbnRoJiYoYS5zZWxlY3RlZERheT1NYXRoLm1pbihhLnNlbGVjdGVkRGF5LFUpKTt2YXIgVj0odGhpcy5fZ2V0Rmlyc3REYXlPZk1vbnRoKG8sbikteSs3KSU3LFc9TWF0aC5jZWlsKChWK1UpLzcpLFg9aj90aGlzLm1heFJvd3M+Vz90aGlzLm1heFJvd3M6VzpXO3RoaXMubWF4Um93cz1YO3ZhciBZPXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKG8sbiwxLVYpKTtmb3IodmFyIFo9MDtaPFg7WisrKXtRKz0iPHRyPiI7dmFyIF89ej8nPHRkIGNsYXNzPSJ1aS1kYXRlcGlja2VyLXdlZWstY29sIj4nK3RoaXMuX2dldChhLCJjYWxjdWxhdGVXZWVrIikoWSkrIjwvdGQ+IjoiIjtmb3IodmFyIFM9MDtTPDc7UysrKXt2YXIgYmE9Rj9GLmFwcGx5KGEuaW5wdXQ/YS5pbnB1dFswXTpudWxsLFtZXSk6WyEwLCIiXSxiYj1ZLmdldE1vbnRoKCkhPW4sYmM9YmImJiFIfHwhYmFbMF18fGwmJlk8bHx8bSYmWT5tO18rPSc8dGQgY2xhc3M9IicrKChTK3krNiklNz49NT8iIHVpLWRhdGVwaWNrZXItd2Vlay1lbmQiOiIiKSsoYmI/IiB1aS1kYXRlcGlja2VyLW90aGVyLW1vbnRoIjoiIikrKFkuZ2V0VGltZSgpPT1PLmdldFRpbWUoKSYmbj09YS5zZWxlY3RlZE1vbnRoJiZhLl9rZXlFdmVudHx8Si5nZXRUaW1lKCk9PVkuZ2V0VGltZSgpJiZKLmdldFRpbWUoKT09Ty5nZXRUaW1lKCk/IiAiK3RoaXMuX2RheU92ZXJDbGFzczoiIikrKGJjPyIgIit0aGlzLl91bnNlbGVjdGFibGVDbGFzcysiIHVpLXN0YXRlLWRpc2FibGVkIjoiIikrKGJiJiYhRz8iIjoiICIrYmFbMV0rKFkuZ2V0VGltZSgpPT1rLmdldFRpbWUoKT8iICIrdGhpcy5fY3VycmVudENsYXNzOiIiKSsoWS5nZXRUaW1lKCk9PWIuZ2V0VGltZSgpPyIgdWktZGF0ZXBpY2tlci10b2RheSI6IiIpKSsnIicrKCghYmJ8fEcpJiZiYVsyXT8nIHRpdGxlPSInK2JhWzJdKyciJzoiIikrKGJjPyIiOicgb25jbGljaz0iRFBfalF1ZXJ5XycrZHB1dWlkKyIuZGF0ZXBpY2tlci5fc2VsZWN0RGF5KCcjIithLmlkKyInLCIrWS5nZXRNb250aCgpKyIsIitZLmdldEZ1bGxZZWFyKCkrJywgdGhpcyk7cmV0dXJuIGZhbHNlOyInKSsiPiIrKGJiJiYhRz8iJiN4YTA7IjpiYz8nPHNwYW4gY2xhc3M9InVpLXN0YXRlLWRlZmF1bHQiPicrWS5nZXREYXRlKCkrIjwvc3Bhbj4iOic8YSBjbGFzcz0idWktc3RhdGUtZGVmYXVsdCcrKFkuZ2V0VGltZSgpPT1iLmdldFRpbWUoKT8iIHVpLXN0YXRlLWhpZ2hsaWdodCI6IiIpKyhZLmdldFRpbWUoKT09ay5nZXRUaW1lKCk/IiB1aS1zdGF0ZS1hY3RpdmUiOiIiKSsoYmI/IiB1aS1wcmlvcml0eS1zZWNvbmRhcnkiOiIiKSsnIiBocmVmPSIjIj4nK1kuZ2V0RGF0ZSgpKyI8L2E+IikrIjwvdGQ+IixZLnNldERhdGUoWS5nZXREYXRlKCkrMSksWT10aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChZKX1RKz1fKyI8L3RyPiJ9bisrLG4+MTEmJihuPTAsbysrKSxRKz0iPC90Ym9keT48L3RhYmxlPiIrKGo/IjwvZGl2PiIrKGdbMF0+MCYmTj09Z1sxXS0xPyc8ZGl2IGNsYXNzPSJ1aS1kYXRlcGlja2VyLXJvdy1icmVhayI+PC9kaXY+JzoiIik6IiIpLE0rPVF9Sys9TX1yZXR1cm4gSys9eCsoJC5icm93c2VyLm1zaWUmJnBhcnNlSW50KCQuYnJvd3Nlci52ZXJzaW9uLDEwKTw3JiYhYS5pbmxpbmU/JzxpZnJhbWUgc3JjPSJqYXZhc2NyaXB0OmZhbHNlOyIgY2xhc3M9InVpLWRhdGVwaWNrZXItY292ZXIiIGZyYW1lYm9yZGVyPSIwIj48L2lmcmFtZT4nOiIiKSxhLl9rZXlFdmVudD0hMSxLfSxfZ2VuZXJhdGVNb250aFllYXJIZWFkZXI6ZnVuY3Rpb24oYSxiLGMsZCxlLGYsZyxoKXt2YXIgaT10aGlzLl9nZXQoYSwiY2hhbmdlTW9udGgiKSxqPXRoaXMuX2dldChhLCJjaGFuZ2VZZWFyIiksaz10aGlzLl9nZXQoYSwic2hvd01vbnRoQWZ0ZXJZZWFyIiksbD0nPGRpdiBjbGFzcz0idWktZGF0ZXBpY2tlci10aXRsZSI+JyxtPSIiO2lmKGZ8fCFpKW0rPSc8c3BhbiBjbGFzcz0idWktZGF0ZXBpY2tlci1tb250aCI+JytnW2JdKyI8L3NwYW4+IjtlbHNle3ZhciBuPWQmJmQuZ2V0RnVsbFllYXIoKT09YyxvPWUmJmUuZ2V0RnVsbFllYXIoKT09YzttKz0nPHNlbGVjdCBjbGFzcz0idWktZGF0ZXBpY2tlci1tb250aCIgb25jaGFuZ2U9IkRQX2pRdWVyeV8nK2RwdXVpZCsiLmRhdGVwaWNrZXIuX3NlbGVjdE1vbnRoWWVhcignIyIrYS5pZCsiJywgdGhpcywgJ00nKTtcIiAiKyI+Ijtmb3IodmFyIHA9MDtwPDEyO3ArKykoIW58fHA+PWQuZ2V0TW9udGgoKSkmJighb3x8cDw9ZS5nZXRNb250aCgpKSYmKG0rPSc8b3B0aW9uIHZhbHVlPSInK3ArJyInKyhwPT1iPycgc2VsZWN0ZWQ9InNlbGVjdGVkIic6IiIpKyI+IitoW3BdKyI8L29wdGlvbj4iKTttKz0iPC9zZWxlY3Q+In1rfHwobCs9bSsoZnx8IWl8fCFqPyImI3hhMDsiOiIiKSk7aWYoIWEueWVhcnNodG1sKXthLnllYXJzaHRtbD0iIjtpZihmfHwhailsKz0nPHNwYW4gY2xhc3M9InVpLWRhdGVwaWNrZXIteWVhciI+JytjKyI8L3NwYW4+IjtlbHNle3ZhciBxPXRoaXMuX2dldChhLCJ5ZWFyUmFuZ2UiKS5zcGxpdCgiOiIpLHI9KG5ldyBEYXRlKS5nZXRGdWxsWWVhcigpLHM9ZnVuY3Rpb24oYSl7dmFyIGI9YS5tYXRjaCgvY1srLV0uKi8pP2MrcGFyc2VJbnQoYS5zdWJzdHJpbmcoMSksMTApOmEubWF0Y2goL1srLV0uKi8pP3IrcGFyc2VJbnQoYSwxMCk6cGFyc2VJbnQoYSwxMCk7cmV0dXJuIGlzTmFOKGIpP3I6Yn0sdD1zKHFbMF0pLHU9TWF0aC5tYXgodCxzKHFbMV18fCIiKSk7dD1kP01hdGgubWF4KHQsZC5nZXRGdWxsWWVhcigpKTp0LHU9ZT9NYXRoLm1pbih1LGUuZ2V0RnVsbFllYXIoKSk6dSxhLnllYXJzaHRtbCs9JzxzZWxlY3QgY2xhc3M9InVpLWRhdGVwaWNrZXIteWVhciIgb25jaGFuZ2U9IkRQX2pRdWVyeV8nK2RwdXVpZCsiLmRhdGVwaWNrZXIuX3NlbGVjdE1vbnRoWWVhcignIyIrYS5pZCsiJywgdGhpcywgJ1knKTtcIiAiKyI+Ijtmb3IoO3Q8PXU7dCsrKWEueWVhcnNodG1sKz0nPG9wdGlvbiB2YWx1ZT0iJyt0KyciJysodD09Yz8nIHNlbGVjdGVkPSJzZWxlY3RlZCInOiIiKSsiPiIrdCsiPC9vcHRpb24+IjthLnllYXJzaHRtbCs9Ijwvc2VsZWN0PiIsbCs9YS55ZWFyc2h0bWwsYS55ZWFyc2h0bWw9bnVsbH19cmV0dXJuIGwrPXRoaXMuX2dldChhLCJ5ZWFyU3VmZml4IiksayYmKGwrPShmfHwhaXx8IWo/IiYjeGEwOyI6IiIpK20pLGwrPSI8L2Rpdj4iLGx9LF9hZGp1c3RJbnN0RGF0ZTpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9YS5kcmF3WWVhcisoYz09IlkiP2I6MCksZT1hLmRyYXdNb250aCsoYz09Ik0iP2I6MCksZj1NYXRoLm1pbihhLnNlbGVjdGVkRGF5LHRoaXMuX2dldERheXNJbk1vbnRoKGQsZSkpKyhjPT0iRCI/YjowKSxnPXRoaXMuX3Jlc3RyaWN0TWluTWF4KGEsdGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoZCxlLGYpKSk7YS5zZWxlY3RlZERheT1nLmdldERhdGUoKSxhLmRyYXdNb250aD1hLnNlbGVjdGVkTW9udGg9Zy5nZXRNb250aCgpLGEuZHJhd1llYXI9YS5zZWxlY3RlZFllYXI9Zy5nZXRGdWxsWWVhcigpLChjPT0iTSJ8fGM9PSJZIikmJnRoaXMuX25vdGlmeUNoYW5nZShhKX0sX3Jlc3RyaWN0TWluTWF4OmZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5fZ2V0TWluTWF4RGF0ZShhLCJtaW4iKSxkPXRoaXMuX2dldE1pbk1heERhdGUoYSwibWF4IiksZT1jJiZiPGM/YzpiO3JldHVybiBlPWQmJmU+ZD9kOmUsZX0sX25vdGlmeUNoYW5nZTpmdW5jdGlvbihhKXt2YXIgYj10aGlzLl9nZXQoYSwib25DaGFuZ2VNb250aFllYXIiKTtiJiZiLmFwcGx5KGEuaW5wdXQ/YS5pbnB1dFswXTpudWxsLFthLnNlbGVjdGVkWWVhcixhLnNlbGVjdGVkTW9udGgrMSxhXSl9LF9nZXROdW1iZXJPZk1vbnRoczpmdW5jdGlvbihhKXt2YXIgYj10aGlzLl9nZXQoYSwibnVtYmVyT2ZNb250aHMiKTtyZXR1cm4gYj09bnVsbD9bMSwxXTp0eXBlb2YgYj09Im51bWJlciI/WzEsYl06Yn0sX2dldE1pbk1heERhdGU6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gdGhpcy5fZGV0ZXJtaW5lRGF0ZShhLHRoaXMuX2dldChhLGIrIkRhdGUiKSxudWxsKX0sX2dldERheXNJbk1vbnRoOmZ1bmN0aW9uKGEsYil7cmV0dXJuIDMyLXRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGEsYiwzMikpLmdldERhdGUoKX0sX2dldEZpcnN0RGF5T2ZNb250aDpmdW5jdGlvbihhLGIpe3JldHVybihuZXcgRGF0ZShhLGIsMSkpLmdldERheSgpfSxfY2FuQWRqdXN0TW9udGg6ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGU9dGhpcy5fZ2V0TnVtYmVyT2ZNb250aHMoYSksZj10aGlzLl9kYXlsaWdodFNhdmluZ0FkanVzdChuZXcgRGF0ZShjLGQrKGI8MD9iOmVbMF0qZVsxXSksMSkpO3JldHVybiBiPDAmJmYuc2V0RGF0ZSh0aGlzLl9nZXREYXlzSW5Nb250aChmLmdldEZ1bGxZZWFyKCksZi5nZXRNb250aCgpKSksdGhpcy5faXNJblJhbmdlKGEsZil9LF9pc0luUmFuZ2U6ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLl9nZXRNaW5NYXhEYXRlKGEsIm1pbiIpLGQ9dGhpcy5fZ2V0TWluTWF4RGF0ZShhLCJtYXgiKTtyZXR1cm4oIWN8fGIuZ2V0VGltZSgpPj1jLmdldFRpbWUoKSkmJighZHx8Yi5nZXRUaW1lKCk8PWQuZ2V0VGltZSgpKX0sX2dldEZvcm1hdENvbmZpZzpmdW5jdGlvbihhKXt2YXIgYj10aGlzLl9nZXQoYSwic2hvcnRZZWFyQ3V0b2ZmIik7cmV0dXJuIGI9dHlwZW9mIGIhPSJzdHJpbmciP2I6KG5ldyBEYXRlKS5nZXRGdWxsWWVhcigpJTEwMCtwYXJzZUludChiLDEwKSx7c2hvcnRZZWFyQ3V0b2ZmOmIsZGF5TmFtZXNTaG9ydDp0aGlzLl9nZXQoYSwiZGF5TmFtZXNTaG9ydCIpLGRheU5hbWVzOnRoaXMuX2dldChhLCJkYXlOYW1lcyIpLG1vbnRoTmFtZXNTaG9ydDp0aGlzLl9nZXQoYSwibW9udGhOYW1lc1Nob3J0IiksbW9udGhOYW1lczp0aGlzLl9nZXQoYSwibW9udGhOYW1lcyIpfX0sX2Zvcm1hdERhdGU6ZnVuY3Rpb24oYSxiLGMsZCl7Ynx8KGEuY3VycmVudERheT1hLnNlbGVjdGVkRGF5LGEuY3VycmVudE1vbnRoPWEuc2VsZWN0ZWRNb250aCxhLmN1cnJlbnRZZWFyPWEuc2VsZWN0ZWRZZWFyKTt2YXIgZT1iP3R5cGVvZiBiPT0ib2JqZWN0Ij9iOnRoaXMuX2RheWxpZ2h0U2F2aW5nQWRqdXN0KG5ldyBEYXRlKGQsYyxiKSk6dGhpcy5fZGF5bGlnaHRTYXZpbmdBZGp1c3QobmV3IERhdGUoYS5jdXJyZW50WWVhcixhLmN1cnJlbnRNb250aCxhLmN1cnJlbnREYXkpKTtyZXR1cm4gdGhpcy5mb3JtYXREYXRlKHRoaXMuX2dldChhLCJkYXRlRm9ybWF0IiksZSx0aGlzLl9nZXRGb3JtYXRDb25maWcoYSkpfX0pLCQuZm4uZGF0ZXBpY2tlcj1mdW5jdGlvbihhKXtpZighdGhpcy5sZW5ndGgpcmV0dXJuIHRoaXM7JC5kYXRlcGlja2VyLmluaXRpYWxpemVkfHwoJChkb2N1bWVudCkubW91c2Vkb3duKCQuZGF0ZXBpY2tlci5fY2hlY2tFeHRlcm5hbENsaWNrKS5maW5kKCJib2R5IikuYXBwZW5kKCQuZGF0ZXBpY2tlci5kcERpdiksJC5kYXRlcGlja2VyLmluaXRpYWxpemVkPSEwKTt2YXIgYj1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7cmV0dXJuIHR5cGVvZiBhIT0ic3RyaW5nInx8YSE9ImlzRGlzYWJsZWQiJiZhIT0iZ2V0RGF0ZSImJmEhPSJ3aWRnZXQiP2E9PSJvcHRpb24iJiZhcmd1bWVudHMubGVuZ3RoPT0yJiZ0eXBlb2YgYXJndW1lbnRzWzFdPT0ic3RyaW5nIj8kLmRhdGVwaWNrZXJbIl8iK2ErIkRhdGVwaWNrZXIiXS5hcHBseSgkLmRhdGVwaWNrZXIsW3RoaXNbMF1dLmNvbmNhdChiKSk6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dHlwZW9mIGE9PSJzdHJpbmciPyQuZGF0ZXBpY2tlclsiXyIrYSsiRGF0ZXBpY2tlciJdLmFwcGx5KCQuZGF0ZXBpY2tlcixbdGhpc10uY29uY2F0KGIpKTokLmRhdGVwaWNrZXIuX2F0dGFjaERhdGVwaWNrZXIodGhpcyxhKX0pOiQuZGF0ZXBpY2tlclsiXyIrYSsiRGF0ZXBpY2tlciJdLmFwcGx5KCQuZGF0ZXBpY2tlcixbdGhpc1swXV0uY29uY2F0KGIpKX0sJC5kYXRlcGlja2VyPW5ldyBEYXRlcGlja2VyLCQuZGF0ZXBpY2tlci5pbml0aWFsaXplZD0hMSwkLmRhdGVwaWNrZXIudXVpZD0obmV3IERhdGUpLmdldFRpbWUoKSwkLmRhdGVwaWNrZXIudmVyc2lvbj0iMS44LjIwIix3aW5kb3dbIkRQX2pRdWVyeV8iK2RwdXVpZF09JH0pKGpRdWVyeSk7Oy8qISBqUXVlcnkgVUkgLSB2MS44LjIwIC0gMjAxMi0wNC0zMAoqIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5LXVpCiogSW5jbHVkZXM6IGpxdWVyeS51aS5wcm9ncmVzc2Jhci5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKGEsYil7YS53aWRnZXQoInVpLnByb2dyZXNzYmFyIix7b3B0aW9uczp7dmFsdWU6MCxtYXg6MTAwfSxtaW46MCxfY3JlYXRlOmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LmFkZENsYXNzKCJ1aS1wcm9ncmVzc2JhciB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCIpLmF0dHIoe3JvbGU6InByb2dyZXNzYmFyIiwiYXJpYS12YWx1ZW1pbiI6dGhpcy5taW4sImFyaWEtdmFsdWVtYXgiOnRoaXMub3B0aW9ucy5tYXgsImFyaWEtdmFsdWVub3ciOnRoaXMuX3ZhbHVlKCl9KSx0aGlzLnZhbHVlRGl2PWEoIjxkaXYgY2xhc3M9J3VpLXByb2dyZXNzYmFyLXZhbHVlIHVpLXdpZGdldC1oZWFkZXIgdWktY29ybmVyLWxlZnQnPjwvZGl2PiIpLmFwcGVuZFRvKHRoaXMuZWxlbWVudCksdGhpcy5vbGRWYWx1ZT10aGlzLl92YWx1ZSgpLHRoaXMuX3JlZnJlc2hWYWx1ZSgpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lbGVtZW50LnJlbW92ZUNsYXNzKCJ1aS1wcm9ncmVzc2JhciB1aS13aWRnZXQgdWktd2lkZ2V0LWNvbnRlbnQgdWktY29ybmVyLWFsbCIpLnJlbW92ZUF0dHIoInJvbGUiKS5yZW1vdmVBdHRyKCJhcmlhLXZhbHVlbWluIikucmVtb3ZlQXR0cigiYXJpYS12YWx1ZW1heCIpLnJlbW92ZUF0dHIoImFyaWEtdmFsdWVub3ciKSx0aGlzLnZhbHVlRGl2LnJlbW92ZSgpLGEuV2lkZ2V0LnByb3RvdHlwZS5kZXN0cm95LmFwcGx5KHRoaXMsYXJndW1lbnRzKX0sdmFsdWU6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT1iP3RoaXMuX3ZhbHVlKCk6KHRoaXMuX3NldE9wdGlvbigidmFsdWUiLGEpLHRoaXMpfSxfc2V0T3B0aW9uOmZ1bmN0aW9uKGIsYyl7Yj09PSJ2YWx1ZSImJih0aGlzLm9wdGlvbnMudmFsdWU9Yyx0aGlzLl9yZWZyZXNoVmFsdWUoKSx0aGlzLl92YWx1ZSgpPT09dGhpcy5vcHRpb25zLm1heCYmdGhpcy5fdHJpZ2dlcigiY29tcGxldGUiKSksYS5XaWRnZXQucHJvdG90eXBlLl9zZXRPcHRpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpfSxfdmFsdWU6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9wdGlvbnMudmFsdWU7cmV0dXJuIHR5cGVvZiBhIT0ibnVtYmVyIiYmKGE9MCksTWF0aC5taW4odGhpcy5vcHRpb25zLm1heCxNYXRoLm1heCh0aGlzLm1pbixhKSl9LF9wZXJjZW50YWdlOmZ1bmN0aW9uKCl7cmV0dXJuIDEwMCp0aGlzLl92YWx1ZSgpL3RoaXMub3B0aW9ucy5tYXh9LF9yZWZyZXNoVmFsdWU6ZnVuY3Rpb24oKXt2YXIgYT10aGlzLnZhbHVlKCksYj10aGlzLl9wZXJjZW50YWdlKCk7dGhpcy5vbGRWYWx1ZSE9PWEmJih0aGlzLm9sZFZhbHVlPWEsdGhpcy5fdHJpZ2dlcigiY2hhbmdlIikpLHRoaXMudmFsdWVEaXYudG9nZ2xlKGE+dGhpcy5taW4pLnRvZ2dsZUNsYXNzKCJ1aS1jb3JuZXItcmlnaHQiLGE9PT10aGlzLm9wdGlvbnMubWF4KS53aWR0aChiLnRvRml4ZWQoMCkrIiUiKSx0aGlzLmVsZW1lbnQuYXR0cigiYXJpYS12YWx1ZW5vdyIsYSl9fSksYS5leHRlbmQoYS51aS5wcm9ncmVzc2Jhcix7dmVyc2lvbjoiMS44LjIwIn0pfSkoalF1ZXJ5KTs7LyohIGpRdWVyeSBVSSAtIHYxLjguMjAgLSAyMDEyLTA0LTMwCiogaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkKKiBJbmNsdWRlczoganF1ZXJ5LmVmZmVjdHMuY29yZS5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KalF1ZXJ5LmVmZmVjdHN8fGZ1bmN0aW9uKGEsYil7ZnVuY3Rpb24gYyhiKXt2YXIgYztyZXR1cm4gYiYmYi5jb25zdHJ1Y3Rvcj09QXJyYXkmJmIubGVuZ3RoPT0zP2I6KGM9L3JnYlwoXHMqKFswLTldezEsM30pXHMqLFxzKihbMC05XXsxLDN9KVxzKixccyooWzAtOV17MSwzfSlccypcKS8uZXhlYyhiKSk/W3BhcnNlSW50KGNbMV0sMTApLHBhcnNlSW50KGNbMl0sMTApLHBhcnNlSW50KGNbM10sMTApXTooYz0vcmdiXChccyooWzAtOV0rKD86XC5bMC05XSspPylcJVxzKixccyooWzAtOV0rKD86XC5bMC05XSspPylcJVxzKixccyooWzAtOV0rKD86XC5bMC05XSspPylcJVxzKlwpLy5leGVjKGIpKT9bcGFyc2VGbG9hdChjWzFdKSoyLjU1LHBhcnNlRmxvYXQoY1syXSkqMi41NSxwYXJzZUZsb2F0KGNbM10pKjIuNTVdOihjPS8jKFthLWZBLUYwLTldezJ9KShbYS1mQS1GMC05XXsyfSkoW2EtZkEtRjAtOV17Mn0pLy5leGVjKGIpKT9bcGFyc2VJbnQoY1sxXSwxNikscGFyc2VJbnQoY1syXSwxNikscGFyc2VJbnQoY1szXSwxNildOihjPS8jKFthLWZBLUYwLTldKShbYS1mQS1GMC05XSkoW2EtZkEtRjAtOV0pLy5leGVjKGIpKT9bcGFyc2VJbnQoY1sxXStjWzFdLDE2KSxwYXJzZUludChjWzJdK2NbMl0sMTYpLHBhcnNlSW50KGNbM10rY1szXSwxNildOihjPS9yZ2JhXCgwLCAwLCAwLCAwXCkvLmV4ZWMoYikpP2UudHJhbnNwYXJlbnQ6ZVthLnRyaW0oYikudG9Mb3dlckNhc2UoKV19ZnVuY3Rpb24gZChiLGQpe3ZhciBlO2Rve2U9YS5jdXJDU1MoYixkKTtpZihlIT0iIiYmZSE9InRyYW5zcGFyZW50Inx8YS5ub2RlTmFtZShiLCJib2R5IikpYnJlYWs7ZD0iYmFja2dyb3VuZENvbG9yIn13aGlsZShiPWIucGFyZW50Tm9kZSk7cmV0dXJuIGMoZSl9ZnVuY3Rpb24gaCgpe3ZhciBhPWRvY3VtZW50LmRlZmF1bHRWaWV3P2RvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUodGhpcyxudWxsKTp0aGlzLmN1cnJlbnRTdHlsZSxiPXt9LGMsZDtpZihhJiZhLmxlbmd0aCYmYVswXSYmYVthWzBdXSl7dmFyIGU9YS5sZW5ndGg7d2hpbGUoZS0tKWM9YVtlXSx0eXBlb2YgYVtjXT09InN0cmluZyImJihkPWMucmVwbGFjZSgvXC0oXHcpL2csZnVuY3Rpb24oYSxiKXtyZXR1cm4gYi50b1VwcGVyQ2FzZSgpfSksYltkXT1hW2NdKX1lbHNlIGZvcihjIGluIGEpdHlwZW9mIGFbY109PSJzdHJpbmciJiYoYltjXT1hW2NdKTtyZXR1cm4gYn1mdW5jdGlvbiBpKGIpe3ZhciBjLGQ7Zm9yKGMgaW4gYilkPWJbY10sKGQ9PW51bGx8fGEuaXNGdW5jdGlvbihkKXx8YyBpbiBnfHwvc2Nyb2xsYmFyLy50ZXN0KGMpfHwhL2NvbG9yL2kudGVzdChjKSYmaXNOYU4ocGFyc2VGbG9hdChkKSkpJiZkZWxldGUgYltjXTtyZXR1cm4gYn1mdW5jdGlvbiBqKGEsYil7dmFyIGM9e186MH0sZDtmb3IoZCBpbiBiKWFbZF0hPWJbZF0mJihjW2RdPWJbZF0pO3JldHVybiBjfWZ1bmN0aW9uIGsoYixjLGQsZSl7dHlwZW9mIGI9PSJvYmplY3QiJiYoZT1jLGQ9bnVsbCxjPWIsYj1jLmVmZmVjdCksYS5pc0Z1bmN0aW9uKGMpJiYoZT1jLGQ9bnVsbCxjPXt9KTtpZih0eXBlb2YgYz09Im51bWJlciJ8fGEuZnguc3BlZWRzW2NdKWU9ZCxkPWMsYz17fTtyZXR1cm4gYS5pc0Z1bmN0aW9uKGQpJiYoZT1kLGQ9bnVsbCksYz1jfHx7fSxkPWR8fGMuZHVyYXRpb24sZD1hLmZ4Lm9mZj8wOnR5cGVvZiBkPT0ibnVtYmVyIj9kOmQgaW4gYS5meC5zcGVlZHM/YS5meC5zcGVlZHNbZF06YS5meC5zcGVlZHMuX2RlZmF1bHQsZT1lfHxjLmNvbXBsZXRlLFtiLGMsZCxlXX1mdW5jdGlvbiBsKGIpe3JldHVybiFifHx0eXBlb2YgYj09Im51bWJlciJ8fGEuZnguc3BlZWRzW2JdPyEwOnR5cGVvZiBiPT0ic3RyaW5nIiYmIWEuZWZmZWN0c1tiXT8hMDohMX1hLmVmZmVjdHM9e30sYS5lYWNoKFsiYmFja2dyb3VuZENvbG9yIiwiYm9yZGVyQm90dG9tQ29sb3IiLCJib3JkZXJMZWZ0Q29sb3IiLCJib3JkZXJSaWdodENvbG9yIiwiYm9yZGVyVG9wQ29sb3IiLCJib3JkZXJDb2xvciIsImNvbG9yIiwib3V0bGluZUNvbG9yIl0sZnVuY3Rpb24oYixlKXthLmZ4LnN0ZXBbZV09ZnVuY3Rpb24oYSl7YS5jb2xvckluaXR8fChhLnN0YXJ0PWQoYS5lbGVtLGUpLGEuZW5kPWMoYS5lbmQpLGEuY29sb3JJbml0PSEwKSxhLmVsZW0uc3R5bGVbZV09InJnYigiK01hdGgubWF4KE1hdGgubWluKHBhcnNlSW50KGEucG9zKihhLmVuZFswXS1hLnN0YXJ0WzBdKSthLnN0YXJ0WzBdLDEwKSwyNTUpLDApKyIsIitNYXRoLm1heChNYXRoLm1pbihwYXJzZUludChhLnBvcyooYS5lbmRbMV0tYS5zdGFydFsxXSkrYS5zdGFydFsxXSwxMCksMjU1KSwwKSsiLCIrTWF0aC5tYXgoTWF0aC5taW4ocGFyc2VJbnQoYS5wb3MqKGEuZW5kWzJdLWEuc3RhcnRbMl0pK2Euc3RhcnRbMl0sMTApLDI1NSksMCkrIikifX0pO3ZhciBlPXthcXVhOlswLDI1NSwyNTVdLGF6dXJlOlsyNDAsMjU1LDI1NV0sYmVpZ2U6WzI0NSwyNDUsMjIwXSxibGFjazpbMCwwLDBdLGJsdWU6WzAsMCwyNTVdLGJyb3duOlsxNjUsNDIsNDJdLGN5YW46WzAsMjU1LDI1NV0sZGFya2JsdWU6WzAsMCwxMzldLGRhcmtjeWFuOlswLDEzOSwxMzldLGRhcmtncmV5OlsxNjksMTY5LDE2OV0sZGFya2dyZWVuOlswLDEwMCwwXSxkYXJra2hha2k6WzE4OSwxODMsMTA3XSxkYXJrbWFnZW50YTpbMTM5LDAsMTM5XSxkYXJrb2xpdmVncmVlbjpbODUsMTA3LDQ3XSxkYXJrb3JhbmdlOlsyNTUsMTQwLDBdLGRhcmtvcmNoaWQ6WzE1Myw1MCwyMDRdLGRhcmtyZWQ6WzEzOSwwLDBdLGRhcmtzYWxtb246WzIzMywxNTAsMTIyXSxkYXJrdmlvbGV0OlsxNDgsMCwyMTFdLGZ1Y2hzaWE6WzI1NSwwLDI1NV0sZ29sZDpbMjU1LDIxNSwwXSxncmVlbjpbMCwxMjgsMF0saW5kaWdvOls3NSwwLDEzMF0sa2hha2k6WzI0MCwyMzAsMTQwXSxsaWdodGJsdWU6WzE3MywyMTYsMjMwXSxsaWdodGN5YW46WzIyNCwyNTUsMjU1XSxsaWdodGdyZWVuOlsxNDQsMjM4LDE0NF0sbGlnaHRncmV5OlsyMTEsMjExLDIxMV0sbGlnaHRwaW5rOlsyNTUsMTgyLDE5M10sbGlnaHR5ZWxsb3c6WzI1NSwyNTUsMjI0XSxsaW1lOlswLDI1NSwwXSxtYWdlbnRhOlsyNTUsMCwyNTVdLG1hcm9vbjpbMTI4LDAsMF0sbmF2eTpbMCwwLDEyOF0sb2xpdmU6WzEyOCwxMjgsMF0sb3JhbmdlOlsyNTUsMTY1LDBdLHBpbms6WzI1NSwxOTIsMjAzXSxwdXJwbGU6WzEyOCwwLDEyOF0sdmlvbGV0OlsxMjgsMCwxMjhdLHJlZDpbMjU1LDAsMF0sc2lsdmVyOlsxOTIsMTkyLDE5Ml0sd2hpdGU6WzI1NSwyNTUsMjU1XSx5ZWxsb3c6WzI1NSwyNTUsMF0sdHJhbnNwYXJlbnQ6WzI1NSwyNTUsMjU1XX0sZj1bImFkZCIsInJlbW92ZSIsInRvZ2dsZSJdLGc9e2JvcmRlcjoxLGJvcmRlckJvdHRvbToxLGJvcmRlckNvbG9yOjEsYm9yZGVyTGVmdDoxLGJvcmRlclJpZ2h0OjEsYm9yZGVyVG9wOjEsYm9yZGVyV2lkdGg6MSxtYXJnaW46MSxwYWRkaW5nOjF9O2EuZWZmZWN0cy5hbmltYXRlQ2xhc3M9ZnVuY3Rpb24oYixjLGQsZSl7cmV0dXJuIGEuaXNGdW5jdGlvbihkKSYmKGU9ZCxkPW51bGwpLHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgZz1hKHRoaXMpLGs9Zy5hdHRyKCJzdHlsZSIpfHwiICIsbD1pKGguY2FsbCh0aGlzKSksbSxuPWcuYXR0cigiY2xhc3MiKXx8IiI7YS5lYWNoKGYsZnVuY3Rpb24oYSxjKXtiW2NdJiZnW2MrIkNsYXNzIl0oYltjXSl9KSxtPWkoaC5jYWxsKHRoaXMpKSxnLmF0dHIoImNsYXNzIixuKSxnLmFuaW1hdGUoaihsLG0pLHtxdWV1ZTohMSxkdXJhdGlvbjpjLGVhc2luZzpkLGNvbXBsZXRlOmZ1bmN0aW9uKCl7YS5lYWNoKGYsZnVuY3Rpb24oYSxjKXtiW2NdJiZnW2MrIkNsYXNzIl0oYltjXSl9KSx0eXBlb2YgZy5hdHRyKCJzdHlsZSIpPT0ib2JqZWN0Ij8oZy5hdHRyKCJzdHlsZSIpLmNzc1RleHQ9IiIsZy5hdHRyKCJzdHlsZSIpLmNzc1RleHQ9ayk6Zy5hdHRyKCJzdHlsZSIsayksZSYmZS5hcHBseSh0aGlzLGFyZ3VtZW50cyksYS5kZXF1ZXVlKHRoaXMpfX0pfSl9LGEuZm4uZXh0ZW5kKHtfYWRkQ2xhc3M6YS5mbi5hZGRDbGFzcyxhZGRDbGFzczpmdW5jdGlvbihiLGMsZCxlKXtyZXR1cm4gYz9hLmVmZmVjdHMuYW5pbWF0ZUNsYXNzLmFwcGx5KHRoaXMsW3thZGQ6Yn0sYyxkLGVdKTp0aGlzLl9hZGRDbGFzcyhiKX0sX3JlbW92ZUNsYXNzOmEuZm4ucmVtb3ZlQ2xhc3MscmVtb3ZlQ2xhc3M6ZnVuY3Rpb24oYixjLGQsZSl7cmV0dXJuIGM/YS5lZmZlY3RzLmFuaW1hdGVDbGFzcy5hcHBseSh0aGlzLFt7cmVtb3ZlOmJ9LGMsZCxlXSk6dGhpcy5fcmVtb3ZlQ2xhc3MoYil9LF90b2dnbGVDbGFzczphLmZuLnRvZ2dsZUNsYXNzLHRvZ2dsZUNsYXNzOmZ1bmN0aW9uKGMsZCxlLGYsZyl7cmV0dXJuIHR5cGVvZiBkPT0iYm9vbGVhbiJ8fGQ9PT1iP2U/YS5lZmZlY3RzLmFuaW1hdGVDbGFzcy5hcHBseSh0aGlzLFtkP3thZGQ6Y306e3JlbW92ZTpjfSxlLGYsZ10pOnRoaXMuX3RvZ2dsZUNsYXNzKGMsZCk6YS5lZmZlY3RzLmFuaW1hdGVDbGFzcy5hcHBseSh0aGlzLFt7dG9nZ2xlOmN9LGQsZSxmXSl9LHN3aXRjaENsYXNzOmZ1bmN0aW9uKGIsYyxkLGUsZil7cmV0dXJuIGEuZWZmZWN0cy5hbmltYXRlQ2xhc3MuYXBwbHkodGhpcyxbe2FkZDpjLHJlbW92ZTpifSxkLGUsZl0pfX0pLGEuZXh0ZW5kKGEuZWZmZWN0cyx7dmVyc2lvbjoiMS44LjIwIixzYXZlOmZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjPTA7YzxiLmxlbmd0aDtjKyspYltjXSE9PW51bGwmJmEuZGF0YSgiZWMuc3RvcmFnZS4iK2JbY10sYVswXS5zdHlsZVtiW2NdXSl9LHJlc3RvcmU6ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGM9MDtjPGIubGVuZ3RoO2MrKyliW2NdIT09bnVsbCYmYS5jc3MoYltjXSxhLmRhdGEoImVjLnN0b3JhZ2UuIitiW2NdKSl9LHNldE1vZGU6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYj09InRvZ2dsZSImJihiPWEuaXMoIjpoaWRkZW4iKT8ic2hvdyI6ImhpZGUiKSxifSxnZXRCYXNlbGluZTpmdW5jdGlvbihhLGIpe3ZhciBjLGQ7c3dpdGNoKGFbMF0pe2Nhc2UidG9wIjpjPTA7YnJlYWs7Y2FzZSJtaWRkbGUiOmM9LjU7YnJlYWs7Y2FzZSJib3R0b20iOmM9MTticmVhaztkZWZhdWx0OmM9YVswXS9iLmhlaWdodH1zd2l0Y2goYVsxXSl7Y2FzZSJsZWZ0IjpkPTA7YnJlYWs7Y2FzZSJjZW50ZXIiOmQ9LjU7YnJlYWs7Y2FzZSJyaWdodCI6ZD0xO2JyZWFrO2RlZmF1bHQ6ZD1hWzFdL2Iud2lkdGh9cmV0dXJue3g6ZCx5OmN9fSxjcmVhdGVXcmFwcGVyOmZ1bmN0aW9uKGIpe2lmKGIucGFyZW50KCkuaXMoIi51aS1lZmZlY3RzLXdyYXBwZXIiKSlyZXR1cm4gYi5wYXJlbnQoKTt2YXIgYz17d2lkdGg6Yi5vdXRlcldpZHRoKCEwKSxoZWlnaHQ6Yi5vdXRlckhlaWdodCghMCksImZsb2F0IjpiLmNzcygiZmxvYXQiKX0sZD1hKCI8ZGl2PjwvZGl2PiIpLmFkZENsYXNzKCJ1aS1lZmZlY3RzLXdyYXBwZXIiKS5jc3Moe2ZvbnRTaXplOiIxMDAlIixiYWNrZ3JvdW5kOiJ0cmFuc3BhcmVudCIsYm9yZGVyOiJub25lIixtYXJnaW46MCxwYWRkaW5nOjB9KSxlPWRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7cmV0dXJuIGIud3JhcChkKSwoYlswXT09PWV8fGEuY29udGFpbnMoYlswXSxlKSkmJmEoZSkuZm9jdXMoKSxkPWIucGFyZW50KCksYi5jc3MoInBvc2l0aW9uIik9PSJzdGF0aWMiPyhkLmNzcyh7cG9zaXRpb246InJlbGF0aXZlIn0pLGIuY3NzKHtwb3NpdGlvbjoicmVsYXRpdmUifSkpOihhLmV4dGVuZChjLHtwb3NpdGlvbjpiLmNzcygicG9zaXRpb24iKSx6SW5kZXg6Yi5jc3MoInotaW5kZXgiKX0pLGEuZWFjaChbInRvcCIsImxlZnQiLCJib3R0b20iLCJyaWdodCJdLGZ1bmN0aW9uKGEsZCl7Y1tkXT1iLmNzcyhkKSxpc05hTihwYXJzZUludChjW2RdLDEwKSkmJihjW2RdPSJhdXRvIil9KSxiLmNzcyh7cG9zaXRpb246InJlbGF0aXZlIix0b3A6MCxsZWZ0OjAscmlnaHQ6ImF1dG8iLGJvdHRvbToiYXV0byJ9KSksZC5jc3MoYykuc2hvdygpfSxyZW1vdmVXcmFwcGVyOmZ1bmN0aW9uKGIpe3ZhciBjLGQ9ZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtyZXR1cm4gYi5wYXJlbnQoKS5pcygiLnVpLWVmZmVjdHMtd3JhcHBlciIpPyhjPWIucGFyZW50KCkucmVwbGFjZVdpdGgoYiksKGJbMF09PT1kfHxhLmNvbnRhaW5zKGJbMF0sZCkpJiZhKGQpLmZvY3VzKCksYyk6Yn0sc2V0VHJhbnNpdGlvbjpmdW5jdGlvbihiLGMsZCxlKXtyZXR1cm4gZT1lfHx7fSxhLmVhY2goYyxmdW5jdGlvbihhLGMpe3ZhciBmPWIuY3NzVW5pdChjKTtmWzBdPjAmJihlW2NdPWZbMF0qZCtmWzFdKX0pLGV9fSksYS5mbi5leHRlbmQoe2VmZmVjdDpmdW5jdGlvbihiLGMsZCxlKXt2YXIgZj1rLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxnPXtvcHRpb25zOmZbMV0sZHVyYXRpb246ZlsyXSxjYWxsYmFjazpmWzNdfSxoPWcub3B0aW9ucy5tb2RlLGk9YS5lZmZlY3RzW2JdO3JldHVybiBhLmZ4Lm9mZnx8IWk/aD90aGlzW2hdKGcuZHVyYXRpb24sZy5jYWxsYmFjayk6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7Zy5jYWxsYmFjayYmZy5jYWxsYmFjay5jYWxsKHRoaXMpfSk6aS5jYWxsKHRoaXMsZyl9LF9zaG93OmEuZm4uc2hvdyxzaG93OmZ1bmN0aW9uKGEpe2lmKGwoYSkpcmV0dXJuIHRoaXMuX3Nob3cuYXBwbHkodGhpcyxhcmd1bWVudHMpO3ZhciBiPWsuYXBwbHkodGhpcyxhcmd1bWVudHMpO3JldHVybiBiWzFdLm1vZGU9InNob3ciLHRoaXMuZWZmZWN0LmFwcGx5KHRoaXMsYil9LF9oaWRlOmEuZm4uaGlkZSxoaWRlOmZ1bmN0aW9uKGEpe2lmKGwoYSkpcmV0dXJuIHRoaXMuX2hpZGUuYXBwbHkodGhpcyxhcmd1bWVudHMpO3ZhciBiPWsuYXBwbHkodGhpcyxhcmd1bWVudHMpO3JldHVybiBiWzFdLm1vZGU9ImhpZGUiLHRoaXMuZWZmZWN0LmFwcGx5KHRoaXMsYil9LF9fdG9nZ2xlOmEuZm4udG9nZ2xlLHRvZ2dsZTpmdW5jdGlvbihiKXtpZihsKGIpfHx0eXBlb2YgYj09ImJvb2xlYW4ifHxhLmlzRnVuY3Rpb24oYikpcmV0dXJuIHRoaXMuX190b2dnbGUuYXBwbHkodGhpcyxhcmd1bWVudHMpO3ZhciBjPWsuYXBwbHkodGhpcyxhcmd1bWVudHMpO3JldHVybiBjWzFdLm1vZGU9InRvZ2dsZSIsdGhpcy5lZmZlY3QuYXBwbHkodGhpcyxjKX0sY3NzVW5pdDpmdW5jdGlvbihiKXt2YXIgYz10aGlzLmNzcyhiKSxkPVtdO3JldHVybiBhLmVhY2goWyJlbSIsInB4IiwiJSIsInB0Il0sZnVuY3Rpb24oYSxiKXtjLmluZGV4T2YoYik+MCYmKGQ9W3BhcnNlRmxvYXQoYyksYl0pfSksZH19KSxhLmVhc2luZy5qc3dpbmc9YS5lYXNpbmcuc3dpbmcsYS5leHRlbmQoYS5lYXNpbmcse2RlZjoiZWFzZU91dFF1YWQiLHN3aW5nOmZ1bmN0aW9uKGIsYyxkLGUsZil7cmV0dXJuIGEuZWFzaW5nW2EuZWFzaW5nLmRlZl0oYixjLGQsZSxmKX0sZWFzZUluUXVhZDpmdW5jdGlvbihhLGIsYyxkLGUpe3JldHVybiBkKihiLz1lKSpiK2N9LGVhc2VPdXRRdWFkOmZ1bmN0aW9uKGEsYixjLGQsZSl7cmV0dXJuLWQqKGIvPWUpKihiLTIpK2N9LGVhc2VJbk91dFF1YWQ6ZnVuY3Rpb24oYSxiLGMsZCxlKXtyZXR1cm4oYi89ZS8yKTwxP2QvMipiKmIrYzotZC8yKigtLWIqKGItMiktMSkrY30sZWFzZUluQ3ViaWM6ZnVuY3Rpb24oYSxiLGMsZCxlKXtyZXR1cm4gZCooYi89ZSkqYipiK2N9LGVhc2VPdXRDdWJpYzpmdW5jdGlvbihhLGIsYyxkLGUpe3JldHVybiBkKigoYj1iL2UtMSkqYipiKzEpK2N9LGVhc2VJbk91dEN1YmljOmZ1bmN0aW9uKGEsYixjLGQsZSl7cmV0dXJuKGIvPWUvMik8MT9kLzIqYipiKmIrYzpkLzIqKChiLT0yKSpiKmIrMikrY30sZWFzZUluUXVhcnQ6ZnVuY3Rpb24oYSxiLGMsZCxlKXtyZXR1cm4gZCooYi89ZSkqYipiKmIrY30sZWFzZU91dFF1YXJ0OmZ1bmN0aW9uKGEsYixjLGQsZSl7cmV0dXJuLWQqKChiPWIvZS0xKSpiKmIqYi0xKStjfSxlYXNlSW5PdXRRdWFydDpmdW5jdGlvbihhLGIsYyxkLGUpe3JldHVybihiLz1lLzIpPDE/ZC8yKmIqYipiKmIrYzotZC8yKigoYi09MikqYipiKmItMikrY30sZWFzZUluUXVpbnQ6ZnVuY3Rpb24oYSxiLGMsZCxlKXtyZXR1cm4gZCooYi89ZSkqYipiKmIqYitjfSxlYXNlT3V0UXVpbnQ6ZnVuY3Rpb24oYSxiLGMsZCxlKXtyZXR1cm4gZCooKGI9Yi9lLTEpKmIqYipiKmIrMSkrY30sZWFzZUluT3V0UXVpbnQ6ZnVuY3Rpb24oYSxiLGMsZCxlKXtyZXR1cm4oYi89ZS8yKTwxP2QvMipiKmIqYipiKmIrYzpkLzIqKChiLT0yKSpiKmIqYipiKzIpK2N9LGVhc2VJblNpbmU6ZnVuY3Rpb24oYSxiLGMsZCxlKXtyZXR1cm4tZCpNYXRoLmNvcyhiL2UqKE1hdGguUEkvMikpK2QrY30sZWFzZU91dFNpbmU6ZnVuY3Rpb24oYSxiLGMsZCxlKXtyZXR1cm4gZCpNYXRoLnNpbihiL2UqKE1hdGguUEkvMikpK2N9LGVhc2VJbk91dFNpbmU6ZnVuY3Rpb24oYSxiLGMsZCxlKXtyZXR1cm4tZC8yKihNYXRoLmNvcyhNYXRoLlBJKmIvZSktMSkrY30sZWFzZUluRXhwbzpmdW5jdGlvbihhLGIsYyxkLGUpe3JldHVybiBiPT0wP2M6ZCpNYXRoLnBvdygyLDEwKihiL2UtMSkpK2N9LGVhc2VPdXRFeHBvOmZ1bmN0aW9uKGEsYixjLGQsZSl7cmV0dXJuIGI9PWU/YytkOmQqKC1NYXRoLnBvdygyLC0xMCpiL2UpKzEpK2N9LGVhc2VJbk91dEV4cG86ZnVuY3Rpb24oYSxiLGMsZCxlKXtyZXR1cm4gYj09MD9jOmI9PWU/YytkOihiLz1lLzIpPDE/ZC8yKk1hdGgucG93KDIsMTAqKGItMSkpK2M6ZC8yKigtTWF0aC5wb3coMiwtMTAqLS1iKSsyKStjfSxlYXNlSW5DaXJjOmZ1bmN0aW9uKGEsYixjLGQsZSl7cmV0dXJuLWQqKE1hdGguc3FydCgxLShiLz1lKSpiKS0xKStjfSxlYXNlT3V0Q2lyYzpmdW5jdGlvbihhLGIsYyxkLGUpe3JldHVybiBkKk1hdGguc3FydCgxLShiPWIvZS0xKSpiKStjfSxlYXNlSW5PdXRDaXJjOmZ1bmN0aW9uKGEsYixjLGQsZSl7cmV0dXJuKGIvPWUvMik8MT8tZC8yKihNYXRoLnNxcnQoMS1iKmIpLTEpK2M6ZC8yKihNYXRoLnNxcnQoMS0oYi09MikqYikrMSkrY30sZWFzZUluRWxhc3RpYzpmdW5jdGlvbihhLGIsYyxkLGUpe3ZhciBmPTEuNzAxNTgsZz0wLGg9ZDtpZihiPT0wKXJldHVybiBjO2lmKChiLz1lKT09MSlyZXR1cm4gYytkO2d8fChnPWUqLjMpO2lmKGg8TWF0aC5hYnMoZCkpe2g9ZDt2YXIgZj1nLzR9ZWxzZSB2YXIgZj1nLygyKk1hdGguUEkpKk1hdGguYXNpbihkL2gpO3JldHVybi0oaCpNYXRoLnBvdygyLDEwKihiLT0xKSkqTWF0aC5zaW4oKGIqZS1mKSoyKk1hdGguUEkvZykpK2N9LGVhc2VPdXRFbGFzdGljOmZ1bmN0aW9uKGEsYixjLGQsZSl7dmFyIGY9MS43MDE1OCxnPTAsaD1kO2lmKGI9PTApcmV0dXJuIGM7aWYoKGIvPWUpPT0xKXJldHVybiBjK2Q7Z3x8KGc9ZSouMyk7aWYoaDxNYXRoLmFicyhkKSl7aD1kO3ZhciBmPWcvNH1lbHNlIHZhciBmPWcvKDIqTWF0aC5QSSkqTWF0aC5hc2luKGQvaCk7cmV0dXJuIGgqTWF0aC5wb3coMiwtMTAqYikqTWF0aC5zaW4oKGIqZS1mKSoyKk1hdGguUEkvZykrZCtjfSxlYXNlSW5PdXRFbGFzdGljOmZ1bmN0aW9uKGEsYixjLGQsZSl7dmFyIGY9MS43MDE1OCxnPTAsaD1kO2lmKGI9PTApcmV0dXJuIGM7aWYoKGIvPWUvMik9PTIpcmV0dXJuIGMrZDtnfHwoZz1lKi4zKjEuNSk7aWYoaDxNYXRoLmFicyhkKSl7aD1kO3ZhciBmPWcvNH1lbHNlIHZhciBmPWcvKDIqTWF0aC5QSSkqTWF0aC5hc2luKGQvaCk7cmV0dXJuIGI8MT8tMC41KmgqTWF0aC5wb3coMiwxMCooYi09MSkpKk1hdGguc2luKChiKmUtZikqMipNYXRoLlBJL2cpK2M6aCpNYXRoLnBvdygyLC0xMCooYi09MSkpKk1hdGguc2luKChiKmUtZikqMipNYXRoLlBJL2cpKi41K2QrY30sZWFzZUluQmFjazpmdW5jdGlvbihhLGMsZCxlLGYsZyl7cmV0dXJuIGc9PWImJihnPTEuNzAxNTgpLGUqKGMvPWYpKmMqKChnKzEpKmMtZykrZH0sZWFzZU91dEJhY2s6ZnVuY3Rpb24oYSxjLGQsZSxmLGcpe3JldHVybiBnPT1iJiYoZz0xLjcwMTU4KSxlKigoYz1jL2YtMSkqYyooKGcrMSkqYytnKSsxKStkfSxlYXNlSW5PdXRCYWNrOmZ1bmN0aW9uKGEsYyxkLGUsZixnKXtyZXR1cm4gZz09YiYmKGc9MS43MDE1OCksKGMvPWYvMik8MT9lLzIqYypjKigoKGcqPTEuNTI1KSsxKSpjLWcpK2Q6ZS8yKigoYy09MikqYyooKChnKj0xLjUyNSkrMSkqYytnKSsyKStkfSxlYXNlSW5Cb3VuY2U6ZnVuY3Rpb24oYixjLGQsZSxmKXtyZXR1cm4gZS1hLmVhc2luZy5lYXNlT3V0Qm91bmNlKGIsZi1jLDAsZSxmKStkfSxlYXNlT3V0Qm91bmNlOmZ1bmN0aW9uKGEsYixjLGQsZSl7cmV0dXJuKGIvPWUpPDEvMi43NT9kKjcuNTYyNSpiKmIrYzpiPDIvMi43NT9kKig3LjU2MjUqKGItPTEuNS8yLjc1KSpiKy43NSkrYzpiPDIuNS8yLjc1P2QqKDcuNTYyNSooYi09Mi4yNS8yLjc1KSpiKy45Mzc1KStjOmQqKDcuNTYyNSooYi09Mi42MjUvMi43NSkqYisuOTg0Mzc1KStjfSxlYXNlSW5PdXRCb3VuY2U6ZnVuY3Rpb24oYixjLGQsZSxmKXtyZXR1cm4gYzxmLzI/YS5lYXNpbmcuZWFzZUluQm91bmNlKGIsYyoyLDAsZSxmKSouNStkOmEuZWFzaW5nLmVhc2VPdXRCb3VuY2UoYixjKjItZiwwLGUsZikqLjUrZSouNStkfX0pfShqUXVlcnkpOzsvKiEgalF1ZXJ5IFVJIC0gdjEuOC4yMCAtIDIwMTItMDQtMzAKKiBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS11aQoqIEluY2x1ZGVzOiBqcXVlcnkuZWZmZWN0cy5ibGluZC5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKGEsYil7YS5lZmZlY3RzLmJsaW5kPWZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxkPVsicG9zaXRpb24iLCJ0b3AiLCJib3R0b20iLCJsZWZ0IiwicmlnaHQiXSxlPWEuZWZmZWN0cy5zZXRNb2RlKGMsYi5vcHRpb25zLm1vZGV8fCJoaWRlIiksZj1iLm9wdGlvbnMuZGlyZWN0aW9ufHwidmVydGljYWwiO2EuZWZmZWN0cy5zYXZlKGMsZCksYy5zaG93KCk7dmFyIGc9YS5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoYykuY3NzKHtvdmVyZmxvdzoiaGlkZGVuIn0pLGg9Zj09InZlcnRpY2FsIj8iaGVpZ2h0Ijoid2lkdGgiLGk9Zj09InZlcnRpY2FsIj9nLmhlaWdodCgpOmcud2lkdGgoKTtlPT0ic2hvdyImJmcuY3NzKGgsMCk7dmFyIGo9e307altoXT1lPT0ic2hvdyI/aTowLGcuYW5pbWF0ZShqLGIuZHVyYXRpb24sYi5vcHRpb25zLmVhc2luZyxmdW5jdGlvbigpe2U9PSJoaWRlIiYmYy5oaWRlKCksYS5lZmZlY3RzLnJlc3RvcmUoYyxkKSxhLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihjKSxiLmNhbGxiYWNrJiZiLmNhbGxiYWNrLmFwcGx5KGNbMF0sYXJndW1lbnRzKSxjLmRlcXVldWUoKX0pfSl9fSkoalF1ZXJ5KTs7LyohIGpRdWVyeSBVSSAtIHYxLjguMjAgLSAyMDEyLTA0LTMwCiogaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkKKiBJbmNsdWRlczoganF1ZXJ5LmVmZmVjdHMuYm91bmNlLmpzCiogQ29weXJpZ2h0IChjKSAyMDEyIEFVVEhPUlMudHh0OyBMaWNlbnNlZCBNSVQsIEdQTCAqLwooZnVuY3Rpb24oYSxiKXthLmVmZmVjdHMuYm91bmNlPWZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxkPVsicG9zaXRpb24iLCJ0b3AiLCJib3R0b20iLCJsZWZ0IiwicmlnaHQiXSxlPWEuZWZmZWN0cy5zZXRNb2RlKGMsYi5vcHRpb25zLm1vZGV8fCJlZmZlY3QiKSxmPWIub3B0aW9ucy5kaXJlY3Rpb258fCJ1cCIsZz1iLm9wdGlvbnMuZGlzdGFuY2V8fDIwLGg9Yi5vcHRpb25zLnRpbWVzfHw1LGk9Yi5kdXJhdGlvbnx8MjUwOy9zaG93fGhpZGUvLnRlc3QoZSkmJmQucHVzaCgib3BhY2l0eSIpLGEuZWZmZWN0cy5zYXZlKGMsZCksYy5zaG93KCksYS5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoYyk7dmFyIGo9Zj09InVwInx8Zj09ImRvd24iPyJ0b3AiOiJsZWZ0IixrPWY9PSJ1cCJ8fGY9PSJsZWZ0Ij8icG9zIjoibmVnIixnPWIub3B0aW9ucy5kaXN0YW5jZXx8KGo9PSJ0b3AiP2Mub3V0ZXJIZWlnaHQoe21hcmdpbjohMH0pLzM6Yy5vdXRlcldpZHRoKHttYXJnaW46ITB9KS8zKTtlPT0ic2hvdyImJmMuY3NzKCJvcGFjaXR5IiwwKS5jc3MoaixrPT0icG9zIj8tZzpnKSxlPT0iaGlkZSImJihnPWcvKGgqMikpLGUhPSJoaWRlIiYmaC0tO2lmKGU9PSJzaG93Iil7dmFyIGw9e29wYWNpdHk6MX07bFtqXT0oaz09InBvcyI/Iis9IjoiLT0iKStnLGMuYW5pbWF0ZShsLGkvMixiLm9wdGlvbnMuZWFzaW5nKSxnPWcvMixoLS19Zm9yKHZhciBtPTA7bTxoO20rKyl7dmFyIG49e30scD17fTtuW2pdPShrPT0icG9zIj8iLT0iOiIrPSIpK2cscFtqXT0oaz09InBvcyI/Iis9IjoiLT0iKStnLGMuYW5pbWF0ZShuLGkvMixiLm9wdGlvbnMuZWFzaW5nKS5hbmltYXRlKHAsaS8yLGIub3B0aW9ucy5lYXNpbmcpLGc9ZT09ImhpZGUiP2cqMjpnLzJ9aWYoZT09ImhpZGUiKXt2YXIgbD17b3BhY2l0eTowfTtsW2pdPShrPT0icG9zIj8iLT0iOiIrPSIpK2csYy5hbmltYXRlKGwsaS8yLGIub3B0aW9ucy5lYXNpbmcsZnVuY3Rpb24oKXtjLmhpZGUoKSxhLmVmZmVjdHMucmVzdG9yZShjLGQpLGEuZWZmZWN0cy5yZW1vdmVXcmFwcGVyKGMpLGIuY2FsbGJhY2smJmIuY2FsbGJhY2suYXBwbHkodGhpcyxhcmd1bWVudHMpfSl9ZWxzZXt2YXIgbj17fSxwPXt9O25bal09KGs9PSJwb3MiPyItPSI6Iis9IikrZyxwW2pdPShrPT0icG9zIj8iKz0iOiItPSIpK2csYy5hbmltYXRlKG4saS8yLGIub3B0aW9ucy5lYXNpbmcpLmFuaW1hdGUocCxpLzIsYi5vcHRpb25zLmVhc2luZyxmdW5jdGlvbigpe2EuZWZmZWN0cy5yZXN0b3JlKGMsZCksYS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYyksYi5jYWxsYmFjayYmYi5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KX1jLnF1ZXVlKCJmeCIsZnVuY3Rpb24oKXtjLmRlcXVldWUoKX0pLGMuZGVxdWV1ZSgpfSl9fSkoalF1ZXJ5KTs7LyohIGpRdWVyeSBVSSAtIHYxLjguMjAgLSAyMDEyLTA0LTMwCiogaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkKKiBJbmNsdWRlczoganF1ZXJ5LmVmZmVjdHMuY2xpcC5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKGEsYil7YS5lZmZlY3RzLmNsaXA9ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hKHRoaXMpLGQ9WyJwb3NpdGlvbiIsInRvcCIsImJvdHRvbSIsImxlZnQiLCJyaWdodCIsImhlaWdodCIsIndpZHRoIl0sZT1hLmVmZmVjdHMuc2V0TW9kZShjLGIub3B0aW9ucy5tb2RlfHwiaGlkZSIpLGY9Yi5vcHRpb25zLmRpcmVjdGlvbnx8InZlcnRpY2FsIjthLmVmZmVjdHMuc2F2ZShjLGQpLGMuc2hvdygpO3ZhciBnPWEuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGMpLmNzcyh7b3ZlcmZsb3c6ImhpZGRlbiJ9KSxoPWNbMF0udGFnTmFtZT09IklNRyI/ZzpjLGk9e3NpemU6Zj09InZlcnRpY2FsIj8iaGVpZ2h0Ijoid2lkdGgiLHBvc2l0aW9uOmY9PSJ2ZXJ0aWNhbCI/InRvcCI6ImxlZnQifSxqPWY9PSJ2ZXJ0aWNhbCI/aC5oZWlnaHQoKTpoLndpZHRoKCk7ZT09InNob3ciJiYoaC5jc3MoaS5zaXplLDApLGguY3NzKGkucG9zaXRpb24sai8yKSk7dmFyIGs9e307a1tpLnNpemVdPWU9PSJzaG93Ij9qOjAsa1tpLnBvc2l0aW9uXT1lPT0ic2hvdyI/MDpqLzIsaC5hbmltYXRlKGsse3F1ZXVlOiExLGR1cmF0aW9uOmIuZHVyYXRpb24sZWFzaW5nOmIub3B0aW9ucy5lYXNpbmcsY29tcGxldGU6ZnVuY3Rpb24oKXtlPT0iaGlkZSImJmMuaGlkZSgpLGEuZWZmZWN0cy5yZXN0b3JlKGMsZCksYS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYyksYi5jYWxsYmFjayYmYi5jYWxsYmFjay5hcHBseShjWzBdLGFyZ3VtZW50cyksYy5kZXF1ZXVlKCl9fSl9KX19KShqUXVlcnkpOzsvKiEgalF1ZXJ5IFVJIC0gdjEuOC4yMCAtIDIwMTItMDQtMzAKKiBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS11aQoqIEluY2x1ZGVzOiBqcXVlcnkuZWZmZWN0cy5kcm9wLmpzCiogQ29weXJpZ2h0IChjKSAyMDEyIEFVVEhPUlMudHh0OyBMaWNlbnNlZCBNSVQsIEdQTCAqLwooZnVuY3Rpb24oYSxiKXthLmVmZmVjdHMuZHJvcD1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBjPWEodGhpcyksZD1bInBvc2l0aW9uIiwidG9wIiwiYm90dG9tIiwibGVmdCIsInJpZ2h0Iiwib3BhY2l0eSJdLGU9YS5lZmZlY3RzLnNldE1vZGUoYyxiLm9wdGlvbnMubW9kZXx8ImhpZGUiKSxmPWIub3B0aW9ucy5kaXJlY3Rpb258fCJsZWZ0IjthLmVmZmVjdHMuc2F2ZShjLGQpLGMuc2hvdygpLGEuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGMpO3ZhciBnPWY9PSJ1cCJ8fGY9PSJkb3duIj8idG9wIjoibGVmdCIsaD1mPT0idXAifHxmPT0ibGVmdCI/InBvcyI6Im5lZyIsaT1iLm9wdGlvbnMuZGlzdGFuY2V8fChnPT0idG9wIj9jLm91dGVySGVpZ2h0KHttYXJnaW46ITB9KS8yOmMub3V0ZXJXaWR0aCh7bWFyZ2luOiEwfSkvMik7ZT09InNob3ciJiZjLmNzcygib3BhY2l0eSIsMCkuY3NzKGcsaD09InBvcyI/LWk6aSk7dmFyIGo9e29wYWNpdHk6ZT09InNob3ciPzE6MH07altnXT0oZT09InNob3ciP2g9PSJwb3MiPyIrPSI6Ii09IjpoPT0icG9zIj8iLT0iOiIrPSIpK2ksYy5hbmltYXRlKGose3F1ZXVlOiExLGR1cmF0aW9uOmIuZHVyYXRpb24sZWFzaW5nOmIub3B0aW9ucy5lYXNpbmcsY29tcGxldGU6ZnVuY3Rpb24oKXtlPT0iaGlkZSImJmMuaGlkZSgpLGEuZWZmZWN0cy5yZXN0b3JlKGMsZCksYS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYyksYi5jYWxsYmFjayYmYi5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyksYy5kZXF1ZXVlKCl9fSl9KX19KShqUXVlcnkpOzsvKiEgalF1ZXJ5IFVJIC0gdjEuOC4yMCAtIDIwMTItMDQtMzAKKiBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS11aQoqIEluY2x1ZGVzOiBqcXVlcnkuZWZmZWN0cy5leHBsb2RlLmpzCiogQ29weXJpZ2h0IChjKSAyMDEyIEFVVEhPUlMudHh0OyBMaWNlbnNlZCBNSVQsIEdQTCAqLwooZnVuY3Rpb24oYSxiKXthLmVmZmVjdHMuZXhwbG9kZT1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBjPWIub3B0aW9ucy5waWVjZXM/TWF0aC5yb3VuZChNYXRoLnNxcnQoYi5vcHRpb25zLnBpZWNlcykpOjMsZD1iLm9wdGlvbnMucGllY2VzP01hdGgucm91bmQoTWF0aC5zcXJ0KGIub3B0aW9ucy5waWVjZXMpKTozO2Iub3B0aW9ucy5tb2RlPWIub3B0aW9ucy5tb2RlPT0idG9nZ2xlIj9hKHRoaXMpLmlzKCI6dmlzaWJsZSIpPyJoaWRlIjoic2hvdyI6Yi5vcHRpb25zLm1vZGU7dmFyIGU9YSh0aGlzKS5zaG93KCkuY3NzKCJ2aXNpYmlsaXR5IiwiaGlkZGVuIiksZj1lLm9mZnNldCgpO2YudG9wLT1wYXJzZUludChlLmNzcygibWFyZ2luVG9wIiksMTApfHwwLGYubGVmdC09cGFyc2VJbnQoZS5jc3MoIm1hcmdpbkxlZnQiKSwxMCl8fDA7dmFyIGc9ZS5vdXRlcldpZHRoKCEwKSxoPWUub3V0ZXJIZWlnaHQoITApO2Zvcih2YXIgaT0wO2k8YztpKyspZm9yKHZhciBqPTA7ajxkO2orKyllLmNsb25lKCkuYXBwZW5kVG8oImJvZHkiKS53cmFwKCI8ZGl2PjwvZGl2PiIpLmNzcyh7cG9zaXRpb246ImFic29sdXRlIix2aXNpYmlsaXR5OiJ2aXNpYmxlIixsZWZ0Oi1qKihnL2QpLHRvcDotaSooaC9jKX0pLnBhcmVudCgpLmFkZENsYXNzKCJ1aS1lZmZlY3RzLWV4cGxvZGUiKS5jc3Moe3Bvc2l0aW9uOiJhYnNvbHV0ZSIsb3ZlcmZsb3c6ImhpZGRlbiIsd2lkdGg6Zy9kLGhlaWdodDpoL2MsbGVmdDpmLmxlZnQraiooZy9kKSsoYi5vcHRpb25zLm1vZGU9PSJzaG93Ij8oai1NYXRoLmZsb29yKGQvMikpKihnL2QpOjApLHRvcDpmLnRvcCtpKihoL2MpKyhiLm9wdGlvbnMubW9kZT09InNob3ciPyhpLU1hdGguZmxvb3IoYy8yKSkqKGgvYyk6MCksb3BhY2l0eTpiLm9wdGlvbnMubW9kZT09InNob3ciPzA6MX0pLmFuaW1hdGUoe2xlZnQ6Zi5sZWZ0K2oqKGcvZCkrKGIub3B0aW9ucy5tb2RlPT0ic2hvdyI/MDooai1NYXRoLmZsb29yKGQvMikpKihnL2QpKSx0b3A6Zi50b3AraSooaC9jKSsoYi5vcHRpb25zLm1vZGU9PSJzaG93Ij8wOihpLU1hdGguZmxvb3IoYy8yKSkqKGgvYykpLG9wYWNpdHk6Yi5vcHRpb25zLm1vZGU9PSJzaG93Ij8xOjB9LGIuZHVyYXRpb258fDUwMCk7c2V0VGltZW91dChmdW5jdGlvbigpe2Iub3B0aW9ucy5tb2RlPT0ic2hvdyI/ZS5jc3Moe3Zpc2liaWxpdHk6InZpc2libGUifSk6ZS5jc3Moe3Zpc2liaWxpdHk6InZpc2libGUifSkuaGlkZSgpLGIuY2FsbGJhY2smJmIuY2FsbGJhY2suYXBwbHkoZVswXSksZS5kZXF1ZXVlKCksYSgiZGl2LnVpLWVmZmVjdHMtZXhwbG9kZSIpLnJlbW92ZSgpfSxiLmR1cmF0aW9ufHw1MDApfSl9fSkoalF1ZXJ5KTs7LyohIGpRdWVyeSBVSSAtIHYxLjguMjAgLSAyMDEyLTA0LTMwCiogaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkKKiBJbmNsdWRlczoganF1ZXJ5LmVmZmVjdHMuZmFkZS5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKGEsYil7YS5lZmZlY3RzLmZhZGU9ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hKHRoaXMpLGQ9YS5lZmZlY3RzLnNldE1vZGUoYyxiLm9wdGlvbnMubW9kZXx8ImhpZGUiKTtjLmFuaW1hdGUoe29wYWNpdHk6ZH0se3F1ZXVlOiExLGR1cmF0aW9uOmIuZHVyYXRpb24sZWFzaW5nOmIub3B0aW9ucy5lYXNpbmcsY29tcGxldGU6ZnVuY3Rpb24oKXtiLmNhbGxiYWNrJiZiLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxjLmRlcXVldWUoKX19KX0pfX0pKGpRdWVyeSk7Oy8qISBqUXVlcnkgVUkgLSB2MS44LjIwIC0gMjAxMi0wNC0zMAoqIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5LXVpCiogSW5jbHVkZXM6IGpxdWVyeS5lZmZlY3RzLmZvbGQuanMKKiBDb3B5cmlnaHQgKGMpIDIwMTIgQVVUSE9SUy50eHQ7IExpY2Vuc2VkIE1JVCwgR1BMICovCihmdW5jdGlvbihhLGIpe2EuZWZmZWN0cy5mb2xkPWZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxkPVsicG9zaXRpb24iLCJ0b3AiLCJib3R0b20iLCJsZWZ0IiwicmlnaHQiXSxlPWEuZWZmZWN0cy5zZXRNb2RlKGMsYi5vcHRpb25zLm1vZGV8fCJoaWRlIiksZj1iLm9wdGlvbnMuc2l6ZXx8MTUsZz0hIWIub3B0aW9ucy5ob3JpekZpcnN0LGg9Yi5kdXJhdGlvbj9iLmR1cmF0aW9uLzI6YS5meC5zcGVlZHMuX2RlZmF1bHQvMjthLmVmZmVjdHMuc2F2ZShjLGQpLGMuc2hvdygpO3ZhciBpPWEuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGMpLmNzcyh7b3ZlcmZsb3c6ImhpZGRlbiJ9KSxqPWU9PSJzaG93IiE9ZyxrPWo/WyJ3aWR0aCIsImhlaWdodCJdOlsiaGVpZ2h0Iiwid2lkdGgiXSxsPWo/W2kud2lkdGgoKSxpLmhlaWdodCgpXTpbaS5oZWlnaHQoKSxpLndpZHRoKCldLG09LyhbMC05XSspJS8uZXhlYyhmKTttJiYoZj1wYXJzZUludChtWzFdLDEwKS8xMDAqbFtlPT0iaGlkZSI/MDoxXSksZT09InNob3ciJiZpLmNzcyhnP3toZWlnaHQ6MCx3aWR0aDpmfTp7aGVpZ2h0OmYsd2lkdGg6MH0pO3ZhciBuPXt9LHA9e307bltrWzBdXT1lPT0ic2hvdyI/bFswXTpmLHBba1sxXV09ZT09InNob3ciP2xbMV06MCxpLmFuaW1hdGUobixoLGIub3B0aW9ucy5lYXNpbmcpLmFuaW1hdGUocCxoLGIub3B0aW9ucy5lYXNpbmcsZnVuY3Rpb24oKXtlPT0iaGlkZSImJmMuaGlkZSgpLGEuZWZmZWN0cy5yZXN0b3JlKGMsZCksYS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYyksYi5jYWxsYmFjayYmYi5jYWxsYmFjay5hcHBseShjWzBdLGFyZ3VtZW50cyksYy5kZXF1ZXVlKCl9KX0pfX0pKGpRdWVyeSk7Oy8qISBqUXVlcnkgVUkgLSB2MS44LjIwIC0gMjAxMi0wNC0zMAoqIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5LXVpCiogSW5jbHVkZXM6IGpxdWVyeS5lZmZlY3RzLmhpZ2hsaWdodC5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKGEsYil7YS5lZmZlY3RzLmhpZ2hsaWdodD1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBjPWEodGhpcyksZD1bImJhY2tncm91bmRJbWFnZSIsImJhY2tncm91bmRDb2xvciIsIm9wYWNpdHkiXSxlPWEuZWZmZWN0cy5zZXRNb2RlKGMsYi5vcHRpb25zLm1vZGV8fCJzaG93IiksZj17YmFja2dyb3VuZENvbG9yOmMuY3NzKCJiYWNrZ3JvdW5kQ29sb3IiKX07ZT09ImhpZGUiJiYoZi5vcGFjaXR5PTApLGEuZWZmZWN0cy5zYXZlKGMsZCksYy5zaG93KCkuY3NzKHtiYWNrZ3JvdW5kSW1hZ2U6Im5vbmUiLGJhY2tncm91bmRDb2xvcjpiLm9wdGlvbnMuY29sb3J8fCIjZmZmZjk5In0pLmFuaW1hdGUoZix7cXVldWU6ITEsZHVyYXRpb246Yi5kdXJhdGlvbixlYXNpbmc6Yi5vcHRpb25zLmVhc2luZyxjb21wbGV0ZTpmdW5jdGlvbigpe2U9PSJoaWRlIiYmYy5oaWRlKCksYS5lZmZlY3RzLnJlc3RvcmUoYyxkKSxlPT0ic2hvdyImJiFhLnN1cHBvcnQub3BhY2l0eSYmdGhpcy5zdHlsZS5yZW1vdmVBdHRyaWJ1dGUoImZpbHRlciIpLGIuY2FsbGJhY2smJmIuY2FsbGJhY2suYXBwbHkodGhpcyxhcmd1bWVudHMpLGMuZGVxdWV1ZSgpfX0pfSl9fSkoalF1ZXJ5KTs7LyohIGpRdWVyeSBVSSAtIHYxLjguMjAgLSAyMDEyLTA0LTMwCiogaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnktdWkKKiBJbmNsdWRlczoganF1ZXJ5LmVmZmVjdHMucHVsc2F0ZS5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKGEsYil7YS5lZmZlY3RzLnB1bHNhdGU9ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hKHRoaXMpLGQ9YS5lZmZlY3RzLnNldE1vZGUoYyxiLm9wdGlvbnMubW9kZXx8InNob3ciKSxlPShiLm9wdGlvbnMudGltZXN8fDUpKjItMSxmPWIuZHVyYXRpb24/Yi5kdXJhdGlvbi8yOmEuZnguc3BlZWRzLl9kZWZhdWx0LzIsZz1jLmlzKCI6dmlzaWJsZSIpLGg9MDtnfHwoYy5jc3MoIm9wYWNpdHkiLDApLnNob3coKSxoPTEpLChkPT0iaGlkZSImJmd8fGQ9PSJzaG93IiYmIWcpJiZlLS07Zm9yKHZhciBpPTA7aTxlO2krKyljLmFuaW1hdGUoe29wYWNpdHk6aH0sZixiLm9wdGlvbnMuZWFzaW5nKSxoPShoKzEpJTI7Yy5hbmltYXRlKHtvcGFjaXR5Omh9LGYsYi5vcHRpb25zLmVhc2luZyxmdW5jdGlvbigpe2g9PTAmJmMuaGlkZSgpLGIuY2FsbGJhY2smJmIuY2FsbGJhY2suYXBwbHkodGhpcyxhcmd1bWVudHMpfSksYy5xdWV1ZSgiZngiLGZ1bmN0aW9uKCl7Yy5kZXF1ZXVlKCl9KS5kZXF1ZXVlKCl9KX19KShqUXVlcnkpOzsvKiEgalF1ZXJ5IFVJIC0gdjEuOC4yMCAtIDIwMTItMDQtMzAKKiBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS11aQoqIEluY2x1ZGVzOiBqcXVlcnkuZWZmZWN0cy5zY2FsZS5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKGEsYil7YS5lZmZlY3RzLnB1ZmY9ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hKHRoaXMpLGQ9YS5lZmZlY3RzLnNldE1vZGUoYyxiLm9wdGlvbnMubW9kZXx8ImhpZGUiKSxlPXBhcnNlSW50KGIub3B0aW9ucy5wZXJjZW50LDEwKXx8MTUwLGY9ZS8xMDAsZz17aGVpZ2h0OmMuaGVpZ2h0KCksd2lkdGg6Yy53aWR0aCgpfTthLmV4dGVuZChiLm9wdGlvbnMse2ZhZGU6ITAsbW9kZTpkLHBlcmNlbnQ6ZD09ImhpZGUiP2U6MTAwLGZyb206ZD09ImhpZGUiP2c6e2hlaWdodDpnLmhlaWdodCpmLHdpZHRoOmcud2lkdGgqZn19KSxjLmVmZmVjdCgic2NhbGUiLGIub3B0aW9ucyxiLmR1cmF0aW9uLGIuY2FsbGJhY2spLGMuZGVxdWV1ZSgpfSl9LGEuZWZmZWN0cy5zY2FsZT1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBjPWEodGhpcyksZD1hLmV4dGVuZCghMCx7fSxiLm9wdGlvbnMpLGU9YS5lZmZlY3RzLnNldE1vZGUoYyxiLm9wdGlvbnMubW9kZXx8ImVmZmVjdCIpLGY9cGFyc2VJbnQoYi5vcHRpb25zLnBlcmNlbnQsMTApfHwocGFyc2VJbnQoYi5vcHRpb25zLnBlcmNlbnQsMTApPT0wPzA6ZT09ImhpZGUiPzA6MTAwKSxnPWIub3B0aW9ucy5kaXJlY3Rpb258fCJib3RoIixoPWIub3B0aW9ucy5vcmlnaW47ZSE9ImVmZmVjdCImJihkLm9yaWdpbj1ofHxbIm1pZGRsZSIsImNlbnRlciJdLGQucmVzdG9yZT0hMCk7dmFyIGk9e2hlaWdodDpjLmhlaWdodCgpLHdpZHRoOmMud2lkdGgoKX07Yy5mcm9tPWIub3B0aW9ucy5mcm9tfHwoZT09InNob3ciP3toZWlnaHQ6MCx3aWR0aDowfTppKTt2YXIgaj17eTpnIT0iaG9yaXpvbnRhbCI/Zi8xMDA6MSx4OmchPSJ2ZXJ0aWNhbCI/Zi8xMDA6MX07Yy50bz17aGVpZ2h0OmkuaGVpZ2h0KmoueSx3aWR0aDppLndpZHRoKmoueH0sYi5vcHRpb25zLmZhZGUmJihlPT0ic2hvdyImJihjLmZyb20ub3BhY2l0eT0wLGMudG8ub3BhY2l0eT0xKSxlPT0iaGlkZSImJihjLmZyb20ub3BhY2l0eT0xLGMudG8ub3BhY2l0eT0wKSksZC5mcm9tPWMuZnJvbSxkLnRvPWMudG8sZC5tb2RlPWUsYy5lZmZlY3QoInNpemUiLGQsYi5kdXJhdGlvbixiLmNhbGxiYWNrKSxjLmRlcXVldWUoKX0pfSxhLmVmZmVjdHMuc2l6ZT1mdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5xdWV1ZShmdW5jdGlvbigpe3ZhciBjPWEodGhpcyksZD1bInBvc2l0aW9uIiwidG9wIiwiYm90dG9tIiwibGVmdCIsInJpZ2h0Iiwid2lkdGgiLCJoZWlnaHQiLCJvdmVyZmxvdyIsIm9wYWNpdHkiXSxlPVsicG9zaXRpb24iLCJ0b3AiLCJib3R0b20iLCJsZWZ0IiwicmlnaHQiLCJvdmVyZmxvdyIsIm9wYWNpdHkiXSxmPVsid2lkdGgiLCJoZWlnaHQiLCJvdmVyZmxvdyJdLGc9WyJmb250U2l6ZSJdLGg9WyJib3JkZXJUb3BXaWR0aCIsImJvcmRlckJvdHRvbVdpZHRoIiwicGFkZGluZ1RvcCIsInBhZGRpbmdCb3R0b20iXSxpPVsiYm9yZGVyTGVmdFdpZHRoIiwiYm9yZGVyUmlnaHRXaWR0aCIsInBhZGRpbmdMZWZ0IiwicGFkZGluZ1JpZ2h0Il0saj1hLmVmZmVjdHMuc2V0TW9kZShjLGIub3B0aW9ucy5tb2RlfHwiZWZmZWN0Iiksaz1iLm9wdGlvbnMucmVzdG9yZXx8ITEsbD1iLm9wdGlvbnMuc2NhbGV8fCJib3RoIixtPWIub3B0aW9ucy5vcmlnaW4sbj17aGVpZ2h0OmMuaGVpZ2h0KCksd2lkdGg6Yy53aWR0aCgpfTtjLmZyb209Yi5vcHRpb25zLmZyb218fG4sYy50bz1iLm9wdGlvbnMudG98fG47aWYobSl7dmFyIHA9YS5lZmZlY3RzLmdldEJhc2VsaW5lKG0sbik7Yy5mcm9tLnRvcD0obi5oZWlnaHQtYy5mcm9tLmhlaWdodCkqcC55LGMuZnJvbS5sZWZ0PShuLndpZHRoLWMuZnJvbS53aWR0aCkqcC54LGMudG8udG9wPShuLmhlaWdodC1jLnRvLmhlaWdodCkqcC55LGMudG8ubGVmdD0obi53aWR0aC1jLnRvLndpZHRoKSpwLnh9dmFyIHE9e2Zyb206e3k6Yy5mcm9tLmhlaWdodC9uLmhlaWdodCx4OmMuZnJvbS53aWR0aC9uLndpZHRofSx0bzp7eTpjLnRvLmhlaWdodC9uLmhlaWdodCx4OmMudG8ud2lkdGgvbi53aWR0aH19O2lmKGw9PSJib3gifHxsPT0iYm90aCIpcS5mcm9tLnkhPXEudG8ueSYmKGQ9ZC5jb25jYXQoaCksYy5mcm9tPWEuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGMsaCxxLmZyb20ueSxjLmZyb20pLGMudG89YS5lZmZlY3RzLnNldFRyYW5zaXRpb24oYyxoLHEudG8ueSxjLnRvKSkscS5mcm9tLnghPXEudG8ueCYmKGQ9ZC5jb25jYXQoaSksYy5mcm9tPWEuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGMsaSxxLmZyb20ueCxjLmZyb20pLGMudG89YS5lZmZlY3RzLnNldFRyYW5zaXRpb24oYyxpLHEudG8ueCxjLnRvKSk7KGw9PSJjb250ZW50Inx8bD09ImJvdGgiKSYmcS5mcm9tLnkhPXEudG8ueSYmKGQ9ZC5jb25jYXQoZyksYy5mcm9tPWEuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGMsZyxxLmZyb20ueSxjLmZyb20pLGMudG89YS5lZmZlY3RzLnNldFRyYW5zaXRpb24oYyxnLHEudG8ueSxjLnRvKSksYS5lZmZlY3RzLnNhdmUoYyxrP2Q6ZSksYy5zaG93KCksYS5lZmZlY3RzLmNyZWF0ZVdyYXBwZXIoYyksYy5jc3MoIm92ZXJmbG93IiwiaGlkZGVuIikuY3NzKGMuZnJvbSk7aWYobD09ImNvbnRlbnQifHxsPT0iYm90aCIpaD1oLmNvbmNhdChbIm1hcmdpblRvcCIsIm1hcmdpbkJvdHRvbSJdKS5jb25jYXQoZyksaT1pLmNvbmNhdChbIm1hcmdpbkxlZnQiLCJtYXJnaW5SaWdodCJdKSxmPWQuY29uY2F0KGgpLmNvbmNhdChpKSxjLmZpbmQoIipbd2lkdGhdIikuZWFjaChmdW5jdGlvbigpe3ZhciBjPWEodGhpcyk7ayYmYS5lZmZlY3RzLnNhdmUoYyxmKTt2YXIgZD17aGVpZ2h0OmMuaGVpZ2h0KCksd2lkdGg6Yy53aWR0aCgpfTtjLmZyb209e2hlaWdodDpkLmhlaWdodCpxLmZyb20ueSx3aWR0aDpkLndpZHRoKnEuZnJvbS54fSxjLnRvPXtoZWlnaHQ6ZC5oZWlnaHQqcS50by55LHdpZHRoOmQud2lkdGgqcS50by54fSxxLmZyb20ueSE9cS50by55JiYoYy5mcm9tPWEuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGMsaCxxLmZyb20ueSxjLmZyb20pLGMudG89YS5lZmZlY3RzLnNldFRyYW5zaXRpb24oYyxoLHEudG8ueSxjLnRvKSkscS5mcm9tLnghPXEudG8ueCYmKGMuZnJvbT1hLmVmZmVjdHMuc2V0VHJhbnNpdGlvbihjLGkscS5mcm9tLngsYy5mcm9tKSxjLnRvPWEuZWZmZWN0cy5zZXRUcmFuc2l0aW9uKGMsaSxxLnRvLngsYy50bykpLGMuY3NzKGMuZnJvbSksYy5hbmltYXRlKGMudG8sYi5kdXJhdGlvbixiLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7ayYmYS5lZmZlY3RzLnJlc3RvcmUoYyxmKX0pfSk7Yy5hbmltYXRlKGMudG8se3F1ZXVlOiExLGR1cmF0aW9uOmIuZHVyYXRpb24sZWFzaW5nOmIub3B0aW9ucy5lYXNpbmcsY29tcGxldGU6ZnVuY3Rpb24oKXtjLnRvLm9wYWNpdHk9PT0wJiZjLmNzcygib3BhY2l0eSIsYy5mcm9tLm9wYWNpdHkpLGo9PSJoaWRlIiYmYy5oaWRlKCksYS5lZmZlY3RzLnJlc3RvcmUoYyxrP2Q6ZSksYS5lZmZlY3RzLnJlbW92ZVdyYXBwZXIoYyksYi5jYWxsYmFjayYmYi5jYWxsYmFjay5hcHBseSh0aGlzLGFyZ3VtZW50cyksYy5kZXF1ZXVlKCl9fSl9KX19KShqUXVlcnkpOzsvKiEgalF1ZXJ5IFVJIC0gdjEuOC4yMCAtIDIwMTItMDQtMzAKKiBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS11aQoqIEluY2x1ZGVzOiBqcXVlcnkuZWZmZWN0cy5zaGFrZS5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKGEsYil7YS5lZmZlY3RzLnNoYWtlPWZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxkPVsicG9zaXRpb24iLCJ0b3AiLCJib3R0b20iLCJsZWZ0IiwicmlnaHQiXSxlPWEuZWZmZWN0cy5zZXRNb2RlKGMsYi5vcHRpb25zLm1vZGV8fCJlZmZlY3QiKSxmPWIub3B0aW9ucy5kaXJlY3Rpb258fCJsZWZ0IixnPWIub3B0aW9ucy5kaXN0YW5jZXx8MjAsaD1iLm9wdGlvbnMudGltZXN8fDMsaT1iLmR1cmF0aW9ufHxiLm9wdGlvbnMuZHVyYXRpb258fDE0MDthLmVmZmVjdHMuc2F2ZShjLGQpLGMuc2hvdygpLGEuZWZmZWN0cy5jcmVhdGVXcmFwcGVyKGMpO3ZhciBqPWY9PSJ1cCJ8fGY9PSJkb3duIj8idG9wIjoibGVmdCIsaz1mPT0idXAifHxmPT0ibGVmdCI/InBvcyI6Im5lZyIsbD17fSxtPXt9LG49e307bFtqXT0oaz09InBvcyI/Ii09IjoiKz0iKStnLG1bal09KGs9PSJwb3MiPyIrPSI6Ii09IikrZyoyLG5bal09KGs9PSJwb3MiPyItPSI6Iis9IikrZyoyLGMuYW5pbWF0ZShsLGksYi5vcHRpb25zLmVhc2luZyk7Zm9yKHZhciBwPTE7cDxoO3ArKyljLmFuaW1hdGUobSxpLGIub3B0aW9ucy5lYXNpbmcpLmFuaW1hdGUobixpLGIub3B0aW9ucy5lYXNpbmcpO2MuYW5pbWF0ZShtLGksYi5vcHRpb25zLmVhc2luZykuYW5pbWF0ZShsLGkvMixiLm9wdGlvbnMuZWFzaW5nLGZ1bmN0aW9uKCl7YS5lZmZlY3RzLnJlc3RvcmUoYyxkKSxhLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihjKSxiLmNhbGxiYWNrJiZiLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pLGMucXVldWUoImZ4IixmdW5jdGlvbigpe2MuZGVxdWV1ZSgpfSksYy5kZXF1ZXVlKCl9KX19KShqUXVlcnkpOzsvKiEgalF1ZXJ5IFVJIC0gdjEuOC4yMCAtIDIwMTItMDQtMzAKKiBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L2pxdWVyeS11aQoqIEluY2x1ZGVzOiBqcXVlcnkuZWZmZWN0cy5zbGlkZS5qcwoqIENvcHlyaWdodCAoYykgMjAxMiBBVVRIT1JTLnR4dDsgTGljZW5zZWQgTUlULCBHUEwgKi8KKGZ1bmN0aW9uKGEsYil7YS5lZmZlY3RzLnNsaWRlPWZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLnF1ZXVlKGZ1bmN0aW9uKCl7dmFyIGM9YSh0aGlzKSxkPVsicG9zaXRpb24iLCJ0b3AiLCJib3R0b20iLCJsZWZ0IiwicmlnaHQiXSxlPWEuZWZmZWN0cy5zZXRNb2RlKGMsYi5vcHRpb25zLm1vZGV8fCJzaG93IiksZj1iLm9wdGlvbnMuZGlyZWN0aW9ufHwibGVmdCI7YS5lZmZlY3RzLnNhdmUoYyxkKSxjLnNob3coKSxhLmVmZmVjdHMuY3JlYXRlV3JhcHBlcihjKS5jc3Moe292ZXJmbG93OiJoaWRkZW4ifSk7dmFyIGc9Zj09InVwInx8Zj09ImRvd24iPyJ0b3AiOiJsZWZ0IixoPWY9PSJ1cCJ8fGY9PSJsZWZ0Ij8icG9zIjoibmVnIixpPWIub3B0aW9ucy5kaXN0YW5jZXx8KGc9PSJ0b3AiP2Mub3V0ZXJIZWlnaHQoe21hcmdpbjohMH0pOmMub3V0ZXJXaWR0aCh7bWFyZ2luOiEwfSkpO2U9PSJzaG93IiYmYy5jc3MoZyxoPT0icG9zIj9pc05hTihpKT8iLSIraTotaTppKTt2YXIgaj17fTtqW2ddPShlPT0ic2hvdyI/aD09InBvcyI/Iis9IjoiLT0iOmg9PSJwb3MiPyItPSI6Iis9IikraSxjLmFuaW1hdGUoaix7cXVldWU6ITEsZHVyYXRpb246Yi5kdXJhdGlvbixlYXNpbmc6Yi5vcHRpb25zLmVhc2luZyxjb21wbGV0ZTpmdW5jdGlvbigpe2U9PSJoaWRlIiYmYy5oaWRlKCksYS5lZmZlY3RzLnJlc3RvcmUoYyxkKSxhLmVmZmVjdHMucmVtb3ZlV3JhcHBlcihjKSxiLmNhbGxiYWNrJiZiLmNhbGxiYWNrLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxjLmRlcXVldWUoKX19KX0pfX0pKGpRdWVyeSk7Oy8qISBqUXVlcnkgVUkgLSB2MS44LjIwIC0gMjAxMi0wNC0zMAoqIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5LXVpCiogSW5jbHVkZXM6IGpxdWVyeS5lZmZlY3RzLnRyYW5zZmVyLmpzCiogQ29weXJpZ2h0IChjKSAyMDEyIEFVVEhPUlMudHh0OyBMaWNlbnNlZCBNSVQsIEdQTCAqLwooZnVuY3Rpb24oYSxiKXthLmVmZmVjdHMudHJhbnNmZXI9ZnVuY3Rpb24oYil7cmV0dXJuIHRoaXMucXVldWUoZnVuY3Rpb24oKXt2YXIgYz1hKHRoaXMpLGQ9YShiLm9wdGlvbnMudG8pLGU9ZC5vZmZzZXQoKSxmPXt0b3A6ZS50b3AsbGVmdDplLmxlZnQsaGVpZ2h0OmQuaW5uZXJIZWlnaHQoKSx3aWR0aDpkLmlubmVyV2lkdGgoKX0sZz1jLm9mZnNldCgpLGg9YSgnPGRpdiBjbGFzcz0idWktZWZmZWN0cy10cmFuc2ZlciI+PC9kaXY+JykuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSkuYWRkQ2xhc3MoYi5vcHRpb25zLmNsYXNzTmFtZSkuY3NzKHt0b3A6Zy50b3AsbGVmdDpnLmxlZnQsaGVpZ2h0OmMuaW5uZXJIZWlnaHQoKSx3aWR0aDpjLmlubmVyV2lkdGgoKSxwb3NpdGlvbjoiYWJzb2x1dGUifSkuYW5pbWF0ZShmLGIuZHVyYXRpb24sYi5vcHRpb25zLmVhc2luZyxmdW5jdGlvbigpe2gucmVtb3ZlKCksYi5jYWxsYmFjayYmYi5jYWxsYmFjay5hcHBseShjWzBdLGFyZ3VtZW50cyksYy5kZXF1ZXVlKCl9KX0pfX0pKGpRdWVyeSk7OwovKiEKICogTkVURVlFIEFjdGl2aXR5IEluZGljYXRvciBqUXVlcnkgUGx1Z2luCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMCBORVRFWUUgR21iSAogKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UKICovCmV2YWwoZnVuY3Rpb24ocCxhLGMsayxlLGQpe2U9ZnVuY3Rpb24oYyl7cmV0dXJuIGN9O2lmKCEnJy5yZXBsYWNlKC9eLyxTdHJpbmcpKXt3aGlsZShjLS0pe2RbY109a1tjXXx8Y31rPVtmdW5jdGlvbihlKXtyZXR1cm4gZFtlXX1dO2U9ZnVuY3Rpb24oKXtyZXR1cm4nXFx3Kyd9O2M9MX07d2hpbGUoYy0tKXtpZihrW2NdKXtwPXAucmVwbGFjZShuZXcgUmVnRXhwKCdcXGInK2UoYykrJ1xcYicsJ2cnKSxrW2NdKX19cmV0dXJuIHB9KCcoMTMoJCl7JC4yOS4yMD0xMyg4KXsxNC41OCgxMygpezUgJDE0PSQoMTQpOzUgNj0kMTQuNDIoXCcyMFwnKTszMCg2KXsxMDQoNi40MihcJzU5XCcpKTs2Ljc4KCk7JDE0LjEwMShcJzIwXCcpfTMwKDghPT0xMDApezg9JC45Nyh7NDA6JDE0LjI1KFwnNDBcJyl9LCQuMjkuMjAuODAsOCk7Nj00NCgkMTQsOCkuMjUoXCc5OVwnLFwnMTAzXCcpLjExMCg4Ljc1P1wnODhcJzokMTQpOzUgNTI9JDE0LjEzMSgpLTYuMzQoKTs1IDU3PSQxNC4xMDkoKS02LjE1KCk7NSA0MT17MTk6OC41MT09XCcxOVwnPzguMzg6OC41MT09XCcxMDhcJz81Mi04LjM4OjI3Ljc3KDUyLzIpLDIxOjguNTU9PVwnMjFcJz84LjM4OjguNTU9PVwnMTA2XCc/NTctOC4zODoyNy43Nyg1Ny8yKX07NSAyNj0kMTQuMjYoKTszMCg4Ljc1KXs2LjI1KHsxOToyNi4xOStcJzM3XCcsMjE6MjYuMjErXCczN1wnfSl9OTN7NDEuMTktPTYuMjYoKS4xOS0yNi4xOTs0MS4yMS09Ni4yNigpLjIxLTI2LjIxfTYuMjUoezExMjo0MS4xOStcJzM3XCcsMTA1OjQxLjIxK1wnMzdcJ30pOzQ2KDYsOC4yOCwyNy42MigxMC84Ljg0KS8xMCk7JDE0LjQyKFwnMjBcJyw2KX19KTszMiAxNH07JC4yOS4yMC44MD17Mjg6MTIsNTY6MywzNTo3LDE1OjQsODQ6MS4yLDU1OlwnODNcJyw1MTpcJzgzXCcsMzg6NH07JC4yOS4yMC42ND0xMyg4LDE3KXs1IDE2PTguMTZ8fDguMjgtMTs1IDgyPTguNDUhPT0xMzA/OC40NToxLzE2OzMyIDEtMjcuMTI4KDE3LDE2KSooMS04MikvMTZ9OzUgNDQ9MTMoKXszMiAkKFwnPDY4PlwnKS4xMzIoXCcxMzVcJyl9OzUgNDY9MTMoKXt9OzEzIDIyKDc0LDUwKXs1IDY9NDcuNTMoIjY2Oi8vNjUuODYuNzEvNzMvMjIiLDc0fHxcJzIyXCcpOzMwKDUwKXskLjU4KDUwLDEzKDg1LDcwKXs2LjgxKDk2LDg1LDcwKX0pfTMyICQoNil9MzAoNDcuNTMmJjQ3LjUzKCI2NjovLzY1Ljg2LjcxLzczLzIyIiwiMjIiKS4xMjUpezQ0PTEzKDkxLDkpezUgMjQ9OS4xNSoyKzkuNTY7NSAyMz0oMjQrOS4zNSsyNy40OSg5LjE1LzIpKzEpOzUgNj0yMigpLjE1KDIzKjIpLjM0KDIzKjIpOzUgMTg9MjIoXCcxOFwnLHtcJzM2LTE1XCc6OS4xNSxcJzM2LTEyNFwnOlwnNjJcJywzNjo5LjQwfSkuNzIoMjIoXCcxOFwnLHs1NDpcJzEyMyhcJysyMytcJyxcJysyMytcJylcJ30pLjcyKDYpKTs2OSg1IDE3PTA7MTc8OS4yODsxNysrKXsxOC4zMygyMihcJzEyMlwnLHsxMjA6MCwxMzQ6MjQsMTM2OjAsMTE1OjI0KzkuMzUsNTQ6XCc5NShcJysoNDgvOS4yOCoxNykrXCcsIDAsIDApXCcsNDU6JC4yOS4yMC42NCg5LDE3KX0pKX0zMiAkKFwnPDY4PlwnKS4zMyg2KS4xNSgyKjIzKS4zNCgyKjIzKX07NDY9MTMoNiwxNiw0Myl7NSAzMT0wOzUgMTg9Ni4xMTYoXCcxOCAxOFwnKS42MCgwKTs2LjQyKFwnNTlcJyw3OSgxMygpezE4LjgxKDk2LFwnNTRcJyxcJzk1KFwnKygrKzMxJTE2Kig0OC8gMTYpKSArIFwnKVwnKX0sICA0MyAqIDc2IC8xNikpfX05M3s1IDExPSQoXCc8NjM+XCcpLjI1KFwnODlcJyxcJzk0KCM5MCM5MilcJyk7JChcJzg4XCcpLjMzKDExKTszMCgxMS42MCgwKS4xMjEpezUgODc9NDcuMTE4KCk7JC41OChbXCc2MVwnLFwnNjNcJyxcJzM2XCddLDEzKCl7ODcuMTI2KDE0LCI4OTo5NCgjOTAjOTIpOyIpfSk7NDQ9MTMoOTEsOSl7NSAyND05LjE1KjIrOS41Njs1IDIzPSgyNCs5LjM1KzI3LjQ5KDkuMTUvMikrMSk7NSAxMT0yMyoyOzUgMzk9LTI3LjQ5KDExLzIpOzUgNj0kKFwnPDYxPlwnLHs2NzoxMStcJyBcJysxMSwxMDc6MzkrXCcgXCcrMzl9KS4yNSh7MTk6MzksMjE6MzksMTU6MTEsMzQ6MTF9KTs2OSg1IDE3PTA7MTc8OS4yODsxNysrKXs2LjMzKCQoXCc8NjM+XCcsezExMTpcJzExNCBcJysyNCtcJywwICA5OCBcJysoMjQrOS4zNSkrXCcsMFwnfSkuMjUoezE1OjExLDM0OjExLDMxOig0OC85LjI4KjE3KStcJzEwMlwnfSkuMzMoJChcJzwzNj5cJyx7NDA6OS40MCwxMjc6OS4xNStcJzM3XCcsMTE3OlwnNjJcJyw0NTokLjI5LjIwLjY0KDksMTcpfSkpKX0zMiAkKFwnPDYxPlwnLHs2NzoxMStcJyBcJysxMX0pLjI1KHsxNToxMSwzNDoxMSwxMzM6XCcxMjlcJ30pLjMzKDYpfTs0Nj0xMyg2LDE2LDQzKXs1IDMxPTA7NSAxOD02LjYwKDApOzYuNDIoXCc1OVwnLDc5KDEzKCl7MTguMTEzLjMxPSsrMzElMTYqKDQ4LyAxNil9LCAgNDMgKiA3NiAvMTYpKX19JCgxMSkuNzgoKX19KSgxMTkpOycsMTAsMTM3LCd8fHx8fHZhcnxlbHx8b3B0c3xkfHxzfHxmdW5jdGlvbnx0aGlzfHdpZHRofHN0ZXBzfGl8Z3x0b3B8YWN0aXZpdHl8bGVmdHxzdmd8cnxpbm5lclJhZGl1c3xjc3N8b2Zmc2V0fE1hdGh8c2VnbWVudHN8Zm58aWZ8cm90YXRpb258cmV0dXJufGFwcGVuZHxoZWlnaHR8bGVuZ3RofHN0cm9rZXxweHxwYWRkaW5nfG98Y29sb3J8bWFyZ2lufGRhdGF8ZHVyYXRpb258cmVuZGVyfG9wYWNpdHl8YW5pbWF0ZXxkb2N1bWVudHwzNjB8Y2VpbHxhdHRyfHZhbGlnbnxofGNyZWF0ZUVsZW1lbnROU3x0cmFuc2Zvcm18YWxpZ258c3BhY2V8d3xlYWNofGludGVydmFsfGdldHxncm91cHxyb3VuZHxzaGFwZXxnZXRPcGFjaXR5fHd3d3xodHRwfGNvb3Jkc2l6ZXxkaXZ8Zm9yfHZ8b3JnfGFwcGVuZFRvfDIwMDB8dGFnfG91dHNpZGV8MTAwMHxmbG9vcnxyZW1vdmV8c2V0SW50ZXJ2YWx8ZGVmYXVsdHN8c2V0QXR0cmlidXRlTlN8ZW5kfGNlbnRlcnxzcGVlZHxrfHczfHNoZWV0fGJvZHl8YmVoYXZpb3J8ZGVmYXVsdHx0YXJnZXR8Vk1MfGVsc2V8dXJsfHJvdGF0ZXxudWxsfGV4dGVuZHxsfHBvc2l0aW9ufGZhbHNlfHJlbW92ZURhdGF8ZGVnfGFic29sdXRlfGNsZWFySW50ZXJ2YWx8bWFyZ2luTGVmdHxyaWdodHxjb29yZG9yaWdpbnxib3R0b218b3V0ZXJXaWR0aHxwcmVwZW5kVG98cGF0aHxtYXJnaW5Ub3B8c3R5bGV8bXx5MnxmaW5kfGVuZGNhcHxjcmVhdGVTdHlsZVNoZWV0fGpRdWVyeXx4MXxhZGp8bGluZXx0cmFuc2xhdGV8bGluZWNhcHxjcmVhdGVTVkdSZWN0fGFkZFJ1bGV8d2VpZ2h0fG1pbnxoaWRkZW58dW5kZWZpbmVkfG91dGVySGVpZ2h0fGFkZENsYXNzfG92ZXJmbG93fHkxfGJ1c3l8eDInLnNwbGl0KCd8JyksMCx7fSkpCgovKgoqKiBaYWJiaXgKKiogQ29weXJpZ2h0IChDKSAyMDAwLTIwMTIgWmFiYml4IFNJQQoqKgoqKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQoqKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQoqKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAyIG9mIHRoZSBMaWNlbnNlLCBvcgoqKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoqKgoqKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKKiogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKiogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQoqKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoqKgoqKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQoqKiBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQoqKiBGb3VuZGF0aW9uLCBJbmMuLCA1MSBGcmFua2xpbiBTdHJlZXQsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BICAwMjExMC0xMzAxLCBVU0EuCioqLwoKCi8vIGpRdWVyeSBubyBjb25mbGljdAppZiAodHlwZW9mKGpRdWVyeSkgIT0gJ3VuZGVmaW5lZCcpIHsKCWpRdWVyeS5ub0NvbmZsaWN0KCk7Cn0KCmZ1bmN0aW9uIGlzc2V0KGtleSwgb2JqKSB7CglyZXR1cm4gKGlzX251bGwoa2V5KSB8fCBpc19udWxsKG9iaikpID8gZmFsc2UgOiAodHlwZW9mKG9ialtrZXldKSAhPSAndW5kZWZpbmVkJyk7Cn0KCmZ1bmN0aW9uIGVtcHR5KG9iaikgewoJaWYgKGlzX251bGwob2JqKSkgewoJCXJldHVybiB0cnVlOwoJfQoJaWYgKG9iaiA9PT0gZmFsc2UpIHsKCQlyZXR1cm4gdHJ1ZTsKCX0KCWlmIChpc19zdHJpbmcob2JqKSAmJiBvYmogPT09ICcnKSB7CgkJcmV0dXJuIHRydWU7Cgl9CglpZiAodHlwZW9mKG9iaikgPT0gJ3VuZGVmaW5lZCcpIHsKCQlyZXR1cm4gdHJ1ZTsKCX0KCglyZXR1cm4gaXNfYXJyYXkob2JqKSAmJiBvYmoubGVuZ3RoID09IDA7Cn0KCmZ1bmN0aW9uIGlzX251bGwob2JqKSB7CglyZXR1cm4gKG9iaiA9PSBudWxsKTsKfQoKZnVuY3Rpb24gaXNfbnVtYmVyKG9iaikgewoJcmV0dXJuIGlzTmFOKG9iaikgPyBmYWxzZSA6ICh0eXBlb2Yob2JqKSA9PT0gJ251bWJlcicpOwp9CgpmdW5jdGlvbiBpc19vYmplY3Qob2JqLCBpbnN0YW5jZSkgewoJaWYgKHR5cGVvZihpbnN0YW5jZSkgPT09ICdvYmplY3QnIHx8IHR5cGVvZihpbnN0YW5jZSkgPT09ICdmdW5jdGlvbicpIHsKCQlpZiAodHlwZW9mKG9iaikgPT09ICdvYmplY3QnICYmIG9iaiBpbnN0YW5jZW9mIGluc3RhbmNlKSB7CgkJCXJldHVybiB0cnVlOwoJCX0KCX0KCWVsc2UgewoJCWlmICh0eXBlb2Yob2JqKSA9PT0gJ29iamVjdCcpIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoJfQoKCXJldHVybiBmYWxzZTsKfQoKZnVuY3Rpb24gaXNfc3RyaW5nKG9iaikgewoJcmV0dXJuICh0eXBlb2Yob2JqKSA9PT0gJ3N0cmluZycpOwp9CgpmdW5jdGlvbiBpc19hcnJheShvYmopIHsKCXJldHVybiAob2JqICE9IG51bGwpICYmICh0eXBlb2Ygb2JqID09ICdvYmplY3QnKSAmJiAoJ3NwbGljZScgaW4gb2JqKSAmJiAoJ2pvaW4nIGluIG9iaik7Cn0KCmZ1bmN0aW9uIFNESShtc2cpIHsKCWlmIChHSyB8fCBXSykgewoJCWNvbnNvbGUubG9nKG1zZyk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJdmFyIGRpdl9oZWxwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Rpdl9oZWxwJyk7CgoJaWYgKHR5cGVvZihkaXZfaGVscCkgPT0gJ3VuZGVmaW5lZCcgfHwgZW1wdHkoZGl2X2hlbHApKSB7CgkJdmFyIGRpdl9oZWxwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJdmFyIGRvY19ib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXTsKCgkJaWYgKGVtcHR5KGRvY19ib2R5KSkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQlkb2NfYm9keS5hcHBlbmRDaGlsZChkaXZfaGVscCk7CgkJZGl2X2hlbHAuc2V0QXR0cmlidXRlKCdpZCcsICdkaXZfaGVscCcpOwoJCWRpdl9oZWxwLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAncG9zaXRpb246IGFic29sdXRlOyBsZWZ0OiAxMHB4OyB0b3A6IDEwMHB4OyBib3JkZXI6IDFweCByZWQgc29saWQ7IHdpZHRoOiA0MDBweDsgaGVpZ2h0OiA0MDBweDsgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7IGZvbnQtc2l6ZTogMTJweDsgb3ZlcmZsb3c6IGF1dG87IHotaW5kZXg6IDIwOycpOwoJfQoKCXZhciBwcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwcmUnKTsKCXByZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShtc2cpKTsKCWRpdl9oZWxwLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdERUJVRyBJTkZPOiAnKSk7CglkaXZfaGVscC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdicicpKTsKCWRpdl9oZWxwLmFwcGVuZENoaWxkKHByZSk7CglkaXZfaGVscC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdicicpKTsKCWRpdl9oZWxwLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2JyJykpOwoJZGl2X2hlbHAuc2Nyb2xsVG9wID0gZGl2X2hlbHAuc2Nyb2xsSGVpZ2h0OwoKCXJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiBTREoob2JqLCBuYW1lKSB7CglpZiAoR0sgfHwgV0spIHsKCQljb25zb2xlLmRpcihvYmopOwoJCXJldHVybiB0cnVlOwoJfQoKCXZhciBkZWJ1ZyA9ICcnOwoJbmFtZSA9IG5hbWUgfHwgJ25vbmUnOwoKCWZvciAodmFyIGtleSBpbiBvYmopIHsKCQlpZiAodHlwZW9mKG9ialtrZXldKSA9PSBuYW1lKSB7CgkJCWNvbnRpbnVlOwoJCX0KCQlkZWJ1ZyArPSBrZXkgKyAnOiAnICsgb2JqW2tleV0gKyAnICgnICsgdHlwZW9mKG9ialtrZXldKSArICcpJyArICdcbic7Cgl9CgoJU0RJKGRlYnVnKTsKfQoKZnVuY3Rpb24gYWRkTGlzdGVuZXIoZWxlbWVudCwgZXZlbnRuYW1lLCBleHByZXNzaW9uLCBidWJibGluZykgewoJYnViYmxpbmcgPSBidWJibGluZyB8fCBmYWxzZTsKCWVsZW1lbnQgPSAkKGVsZW1lbnQpOwoKCWlmIChlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIpIHsKCQllbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnRuYW1lLCBleHByZXNzaW9uLCBidWJibGluZyk7CgkJcmV0dXJuIHRydWU7Cgl9CgllbHNlIGlmIChlbGVtZW50LmF0dGFjaEV2ZW50KSB7CgkJZWxlbWVudC5hdHRhY2hFdmVudCgnb24nICsgZXZlbnRuYW1lLCBleHByZXNzaW9uKTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCWVsc2UgewoJCXJldHVybiBmYWxzZTsKCX0KfQoKZnVuY3Rpb24gcmVtb3ZlTGlzdGVuZXIoZWxlbWVudCwgZXZlbnRuYW1lLCBleHByZXNzaW9uLCBidWJibGluZykgewoJYnViYmxpbmcgPSBidWJibGluZyB8fCBmYWxzZTsKCWVsZW1lbnQgPSAkKGVsZW1lbnQpOwoKCWlmIChlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIpIHsKCQllbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnRuYW1lLCBleHByZXNzaW9uLCBidWJibGluZyk7CgkJcmV0dXJuIHRydWU7Cgl9CgllbHNlIGlmIChlbGVtZW50LmRldGFjaEV2ZW50KSB7CgkJZWxlbWVudC5kZXRhY2hFdmVudCgnb24nICsgZXZlbnRuYW1lLCBleHByZXNzaW9uKTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCWVsc2UgewoJCXJldHVybiBmYWxzZTsKCX0KfQoKZnVuY3Rpb24gY2FuY2VsRXZlbnQoZSkgewoJaWYgKCFlKSB7CgkJZSA9IHdpbmRvdy5ldmVudDsKCX0KCglpZiAoIWVtcHR5KGUpKSB7CgkJaWYgKElFKSB7CgkJCWUuY2FuY2VsQnViYmxlID0gdHJ1ZTsKCQkJZS5yZXR1cm5WYWx1ZSA9IGZhbHNlOwoKCQkJaWYgKElFOSAmJiBlLnByZXZlbnREZWZhdWx0KSB7CgkJCQllLnByZXZlbnREZWZhdWx0KCk7CgkJCX0KCQl9CgkJZWxzZSB7CgkJCWUuc3RvcFByb3BhZ2F0aW9uKCk7CgkJCWUucHJldmVudERlZmF1bHQoKTsKCQl9Cgl9CgoJcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBhZGRfdmFyaWFibGUob19lbCwgc19uYW1lLCB4X3ZhbHVlLCBzX2Zvcm1uYW1lLCBvX2RvY3VtZW50KSB7Cgl2YXIgZm9ybTsKCglpZiAoIW9fZG9jdW1lbnQpIHsKCQlvX2RvY3VtZW50ID0gZG9jdW1lbnQ7Cgl9CgoJaWYgKHNfZm9ybW5hbWUpIHsKCQlpZiAoIShmb3JtID0gb19kb2N1bWVudC5mb3Jtc1tzX2Zvcm1uYW1lXSkpIHsKCQkJdGhyb3cgIk1pc3NpbmcgZm9ybSB3aXRoIG5hbWUgJyIgKyBzX2Zvcm1uYW1lICsgIicuIjsKCQl9Cgl9CgllbHNlIGlmIChvX2VsKSB7CgkJaWYgKCEoZm9ybSA9IG9fZWwuZm9ybSkpIHsKCQkJdGhyb3cgIk1pc3NpbmcgZm9ybSBpbiAnb19lbCcgb2JqZWN0IjsKCQl9Cgl9CgllbHNlIHsKCQlpZiAoIShmb3JtID0gdGhpcy5mb3JtKSkgewoJCQl0aHJvdyAiTWlzc2luZyBmb3JtIGluICd0aGlzJyBvYmplY3QiOwoJCX0KCX0KCgl2YXIgb192YXJpYWJsZSA9IG9fZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKCWlmICghb192YXJpYWJsZSkgewoJCXRocm93ICJDYW4ndCBjcmVhdGUgZWxlbWVudCI7Cgl9CglvX3ZhcmlhYmxlLnR5cGUgPSAnaGlkZGVuJzsKCW9fdmFyaWFibGUubmFtZSA9IHNfbmFtZTsKCW9fdmFyaWFibGUuaWQgPSBzX25hbWU7CglvX3ZhcmlhYmxlLnZhbHVlID0geF92YWx1ZTsKCWZvcm0uYXBwZW5kQ2hpbGQob192YXJpYWJsZSk7CgoJcmV0dXJuIHRydWU7Cn0KCmZ1bmN0aW9uIGNoZWNrQWxsKGZvcm1fbmFtZSwgY2hrTWFpbiwgc2hrTmFtZSkgewoJdmFyIGZybUZvcm0gPSBkb2N1bWVudC5mb3Jtc1tmb3JtX25hbWVdOwoJdmFyIHZhbHVlID0gZnJtRm9ybS5lbGVtZW50c1tjaGtNYWluXS5jaGVja2VkOwoKCWNoa2J4UmFuZ2UuY2hlY2tBbGwoc2hrTmFtZSwgdmFsdWUpOwoKCXJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiBjaGVja0xvY2FsQWxsKGZvcm1fbmFtZSwgY2hrTWFpbiwgY2hrTmFtZSkgewoJdmFyIGZybUZvcm0gPSBkb2N1bWVudC5mb3Jtc1tmb3JtX25hbWVdOwoJdmFyIGNoZWNrYm94ZXMgPSAkJCgnaW5wdXRbbmFtZT0nICsgY2hrTmFtZSArICddJyk7CgoJZm9yICh2YXIgaSA9IDA7IGkgPCBjaGVja2JveGVzLmxlbmd0aDsgaSsrKSB7CgkJaWYgKGlzc2V0KCd0eXBlJywgY2hlY2tib3hlc1tpXSkgJiYgY2hlY2tib3hlc1tpXS50eXBlID09ICdjaGVja2JveCcpIHsKCQkJY2hlY2tib3hlc1tpXS5jaGVja2VkID0gZnJtRm9ybS5lbGVtZW50c1tjaGtNYWluXS5jaGVja2VkOwoJCX0KCX0KCglyZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gY2xlYXJBbGxGb3JtKGZvcm0pIHsKCWZvcm0gPSAkKGZvcm0pOwoKCXZhciBpbnB1dHMgPSBmb3JtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdpbnB1dCcpOwoJZm9yICh2YXIgaSA9IDA7IGkgPCBpbnB1dHMubGVuZ3RoOyBpKyspIHsKCQl2YXIgdHlwZSA9IGlucHV0c1tpXS5nZXRBdHRyaWJ1dGUoJ3R5cGUnKTsKCQlzd2l0Y2ggKHR5cGUpIHsKCQkJY2FzZSAnYnV0dG9uJzoKCQkJY2FzZSAnaGlkZGVuJzoKCQkJY2FzZSAnc3VibWl0JzoKCQkJCWJyZWFrOwoJCQljYXNlICdjaGVja2JveCc6CgkJCQlpbnB1dHNbaV0uY2hlY2tlZCA9IGZhbHNlOwoJCQkJYnJlYWs7CgkJCWNhc2UgJ3RleHQnOgoJCQljYXNlICdwYXNzd29yZCc6CgkJCWRlZmF1bHQ6CgkJCQlpbnB1dHNbaV0udmFsdWUgPSAnJzsKCQl9Cgl9CgoJdmFyIHNlbGVjdHMgPSBmb3JtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzZWxlY3QnKTsKCWZvciAodmFyIGkgPSAwOyBpIDwgc2VsZWN0cy5sZW5ndGg7IGkrKykgewoJCXNlbGVjdHNbaV0uc2VsZWN0ZWRJbmRleCA9IDA7Cgl9CgoJdmFyIGFyZWFzID0gZm9ybS5nZXRFbGVtZW50c0J5VGFnTmFtZSgndGV4dGFyZWEnKTsKCWZvciAodmFyIGkgPSAwOyBpIDwgYXJlYXMubGVuZ3RoOyBpKyspIHsKCQlhcmVhc1tpXS5pbm5lckhUTUwgPSAnJzsKCX0KCglyZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gY2xvc2Vfd2luZG93KCkgewoJd2luZG93LnNldFRpbWVvdXQoJ3dpbmRvdy5jbG9zZSgpOycsIDUwMCk7IC8vIHNvbHZlIGJ1ZyBmb3IgSW50ZXJuZXQgRXhwbG9yZXIKCXJldHVybiBmYWxzZTsKfQoKZnVuY3Rpb24gQ29uZmlybShtc2cpIHsKCXJldHVybiBjb25maXJtKG1zZywgJ3RpdGxlJyk7Cn0KCmZ1bmN0aW9uIGNyZWF0ZV92YXIoZm9ybV9uYW1lLCB2YXJfbmFtZSwgdmFyX3ZhbHVlLCBkb1N1Ym1pdCkgewoJdmFyIG9iakZvcm0gPSBpc19zdHJpbmcoZm9ybV9uYW1lKSA/IGRvY3VtZW50LmZvcm1zW2Zvcm1fbmFtZV0gOiBmb3JtX25hbWU7CglpZiAoIW9iakZvcm0pIHsKCQlyZXR1cm4gZmFsc2U7Cgl9CgoJdmFyIG9ialZhciA9ICh0eXBlb2Yob2JqRm9ybVt2YXJfbmFtZV0pICE9ICd1bmRlZmluZWQnKSA/IG9iakZvcm1bdmFyX25hbWVdIDogbnVsbDsKCWlmIChpc19udWxsKG9ialZhcikpIHsKCQlvYmpWYXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwoJCW9ialZhci5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAnaGlkZGVuJyk7CgkJaWYgKCFvYmpWYXIpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCQlvYmpWYXIuc2V0QXR0cmlidXRlKCduYW1lJywgdmFyX25hbWUpOwoJCW9ialZhci5zZXRBdHRyaWJ1dGUoJ2lkJywgdmFyX25hbWUucmVwbGFjZSgnXScsICcnKS5yZXBsYWNlKCdbJywgJ18nKSk7CgkJb2JqRm9ybS5hcHBlbmRDaGlsZChvYmpWYXIpOwoJfQoKCWlmIChpc19udWxsKHZhcl92YWx1ZSkpIHsKCQlvYmpWYXIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvYmpWYXIpOwoJfQoJZWxzZSB7CgkJb2JqVmFyLnZhbHVlID0gdmFyX3ZhbHVlOwoJfQoKCWlmIChkb1N1Ym1pdCkgewoJCW9iakZvcm0uc3VibWl0KCk7Cgl9CgoJcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBkZXNlbGVjdEFsbCgpIHsKCWlmIChJRSkgewoJCWRvY3VtZW50LnNlbGVjdGlvbi5lbXB0eSgpOwoJfQoJZWxzZSB7CgkJdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTsKCQlzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7Cgl9Cn0KCmZ1bmN0aW9uIGdldERpbWVuc2lvbnMob2JqLCB0cnVlU2lkZSkgewoJb2JqID0gJChvYmopOwoKCWlmICh0eXBlb2YodHJ1ZVNpZGUpID09ICd1bmRlZmluZWQnKSB7CgkJdHJ1ZVNpZGUgPSBmYWxzZTsKCX0KCgl2YXIgZGltID0gewoJCWxlZnQ6CTAsCgkJdG9wOgkwLAoJCXJpZ2h0OgkwLAoJCWJvdHRvbToJMCwKCQl3aWR0aDoJMCwKCQloZWlnaHQ6CTAKCX07CgoJaWYgKCFpc19udWxsKG9iaikgJiYgdHlwZW9mKG9iai5vZmZzZXRQYXJlbnQpICE9ICd1bmRlZmluZWQnKSB7CgkJdmFyIGRpbSA9IHsKCQkJbGVmdDoJcGFyc2VJbnQob2JqLnN0eWxlLmxlZnQsIDEwKSwKCQkJdG9wOglwYXJzZUludChvYmouc3R5bGUudG9wLCAxMCksCgkJCXJpZ2h0OglwYXJzZUludChvYmouc3R5bGUucmlnaHQsIDEwKSwKCQkJYm90dG9tOglwYXJzZUludChvYmouc3R5bGUuYm90dG9tLCAxMCksCgkJCXdpZHRoOglwYXJzZUludChvYmouc3R5bGUud2lkdGgsIDEwKSwKCQkJaGVpZ2h0OglwYXJzZUludChvYmouc3R5bGUuaGVpZ2h0LCAxMCkKCQl9OwoKCQlpZiAoIWlzX251bWJlcihkaW0udG9wKSkgewoJCQlkaW0udG9wID0gcGFyc2VJbnQob2JqLm9mZnNldFRvcCwgMTApOwoJCX0KCQlpZiAoIWlzX251bWJlcihkaW0ubGVmdCkpIHsKCQkJZGltLmxlZnQgPSBwYXJzZUludChvYmoub2Zmc2V0TGVmdCwgMTApOwoJCX0KCQlpZiAoIWlzX251bWJlcihkaW0ud2lkdGgpKSB7CgkJCWRpbS53aWR0aCA9IHBhcnNlSW50KG9iai5vZmZzZXRXaWR0aCwgMTApOwoJCX0KCQlpZiAoIWlzX251bWJlcihkaW0uaGVpZ2h0KSkgewoJCQlkaW0uaGVpZ2h0ID0gcGFyc2VJbnQob2JqLm9mZnNldEhlaWdodCwgMTApOwoJCX0KCgkJaWYgKCF0cnVlU2lkZSkgewoJCQlkaW0ucmlnaHQgPSBkaW0ubGVmdCArIGRpbS53aWR0aDsKCQkJZGltLmJvdHRvbSA9IGRpbS50b3AgKyBkaW0uaGVpZ2h0OwoJCX0KCX0KCglyZXR1cm4gZGltOwp9CgpmdW5jdGlvbiBnZXRQYXJlbnQob2JqLCBuYW1lKSB7CglpZiAob2JqLnBhcmVudE5vZGUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PSBuYW1lLnRvTG93ZXJDYXNlKCkpIHsKCQlyZXR1cm4gb2JqLnBhcmVudE5vZGU7Cgl9CgllbHNlIGlmIChvYmoucGFyZW50Tm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09ICdib2R5JykgewoJCXJldHVybiBudWxsOwoJfQoJZWxzZSB7CgkJcmV0dXJuIGdldFBhcmVudChvYmoucGFyZW50Tm9kZSwgbmFtZSk7Cgl9Cn0KCmZ1bmN0aW9uIGdldFBvc2l0aW9uKG9iaikgewoJb2JqID0gJChvYmopOwoJdmFyIHBvcyA9IHt0b3A6IDAsIGxlZnQ6IDB9OwoKCWlmICghaXNfbnVsbChvYmopICYmIHR5cGVvZihvYmoub2Zmc2V0UGFyZW50KSAhPSAndW5kZWZpbmVkJykgewoJCXBvcy5sZWZ0ID0gb2JqLm9mZnNldExlZnQ7CgkJcG9zLnRvcCA9IG9iai5vZmZzZXRUb3A7CgoJCXRyeSB7CgkJCXdoaWxlICghaXNfbnVsbChvYmoub2Zmc2V0UGFyZW50KSkgewoJCQkJb2JqID0gb2JqLm9mZnNldFBhcmVudDsKCQkJCXBvcy5sZWZ0ICs9IG9iai5vZmZzZXRMZWZ0OwoJCQkJcG9zLnRvcCArPSBvYmoub2Zmc2V0VG9wOwoKCQkJCWlmIChJRSAmJiBvYmoub2Zmc2V0UGFyZW50LnRvU3RyaW5nKCkgPT0gJ3Vua25vd24nKSB7CgkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KCQl9IGNhdGNoKGUpIHsKCQl9Cgl9CgoJcmV0dXJuIHBvczsKfQoKZnVuY3Rpb24gZ2V0U2VsZWN0ZWRUZXh0KG9iaikgewoJaWYgKElFKSB7CgkJb2JqLmZvY3VzKCk7CgkJcmV0dXJuIGRvY3VtZW50LnNlbGVjdGlvbi5jcmVhdGVSYW5nZSgpLnRleHQ7Cgl9CgllbHNlIGlmIChvYmouc2VsZWN0aW9uU3RhcnQpIHsKCQlpZiAob2JqLnNlbGVjdGlvblN0YXJ0ICE9IG9iai5zZWxlY3Rpb25FbmQpIHsKCQkJcmV0dXJuIG9iai52YWx1ZS5zdWJzdHJpbmcob2JqLnNlbGVjdGlvblN0YXJ0LCBvYmouc2VsZWN0aW9uRW5kKTsKCQl9Cgl9CgoJcmV0dXJuIG9iai52YWx1ZTsKfQoKZnVuY3Rpb24gZ2V0X2JvZHl3aWR0aCgpIHsKCXZhciB3ID0gcGFyc2VJbnQoZG9jdW1lbnQuYm9keS5zY3JvbGxXaWR0aCk7Cgl2YXIgdzIgPSBwYXJzZUludChkb2N1bWVudC5ib2R5Lm9mZnNldFdpZHRoKTsKCglyZXR1cm4gKHcyIDwgdykgPyB3MiA6IHc7Cn0KCmZ1bmN0aW9uIGdldF9jdXJzb3JfcG9zaXRpb24oZSkgewoJZSA9IGUgfHwgd2luZG93LmV2ZW50OwoJdmFyIGN1cnNvciA9IHt4OiAwLCB5OiAwfTsKCglpZiAoZS5wYWdlWCB8fCBlLnBhZ2VZKSB7CgkJY3Vyc29yLnggPSBlLnBhZ2VYOwoJCWN1cnNvci55ID0gZS5wYWdlWTsKCX0KCWVsc2UgewoJCXZhciBkZSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDsKCQl2YXIgYiA9IGRvY3VtZW50LmJvZHk7CgkJY3Vyc29yLnggPSBlLmNsaWVudFggKyAoZGUuc2Nyb2xsTGVmdCB8fCBiLnNjcm9sbExlZnQpIC0gKGRlLmNsaWVudExlZnQgfHwgMCk7CgkJY3Vyc29yLnkgPSBlLmNsaWVudFkgKyAoZGUuc2Nyb2xsVG9wIHx8IGIuc2Nyb2xsVG9wKSAtIChkZS5jbGllbnRUb3AgfHwgMCk7Cgl9CgoJcmV0dXJuIGN1cnNvcjsKfQoKZnVuY3Rpb24gZ2V0X3Njcm9sbF9wb3MoKSB7Cgl2YXIgc2NyT2ZYID0gMCwgc2NyT2ZZID0gMDsKCgkvLyBuZXRzY2FwZSBjb21wbGlhbnQKCWlmICh0eXBlb2Yod2luZG93LnBhZ2VZT2Zmc2V0KSA9PSAnbnVtYmVyJykgewoJCXNjck9mWSA9IHdpbmRvdy5wYWdlWU9mZnNldDsKCQlzY3JPZlggPSB3aW5kb3cucGFnZVhPZmZzZXQ7Cgl9CgkvLyBET00gY29tcGxpYW50CgllbHNlIGlmIChkb2N1bWVudC5ib2R5ICYmIChkb2N1bWVudC5ib2R5LnNjcm9sbExlZnQgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3ApKSB7CgkJc2NyT2ZZID0gZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A7CgkJc2NyT2ZYID0gZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0OwoJfQoJLy8gSUU2IHN0YW5kYXJkcyBjb21wbGlhbnQgbW9kZQoJZWxzZSBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wKSkgewoJCXNjck9mWSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3A7CgkJc2NyT2ZYID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQ7Cgl9CgoJcmV0dXJuIFtzY3JPZlgsIHNjck9mWV07Cn0KCmZ1bmN0aW9uIGluc2VydEluRWxlbWVudChlbGVtZW50X25hbWUsIHRleHQsIHRhZ05hbWUpIHsKCXZhciBlbGVtcyA9IChJRSkKCQk/ICQkKHRhZ05hbWUgKyAnW25hbWU9JyArIGVsZW1lbnRfbmFtZSArICddJykKCQk6IGRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKGVsZW1lbnRfbmFtZSk7CgoJZm9yICh2YXIga2V5ID0gMDsga2V5IDwgZWxlbXMubGVuZ3RoOyBrZXkrKykgewoJCWlmICh0eXBlb2YoZWxlbXNba2V5XSkgIT0gJ3VuZGVmaW5lZCcgJiYgIWlzX251bGwoZWxlbXNba2V5XSkpIHsKCQkJJChlbGVtc1trZXldKS51cGRhdGUodGV4dCk7CgkJfQoJfQp9CgpmdW5jdGlvbiBvcGVuV2luQ2VudGVyZWQobG9jLCB3aW5uYW1lLCBpd2lkdGgsIGloZWlnaHQsIHBhcmFtcykgewoJdmFyIHRwID0gTWF0aC5jZWlsKChzY3JlZW4uaGVpZ2h0IC0gaWhlaWdodCkgLyAyKTsKCXZhciBsZiA9IE1hdGguY2VpbCgoc2NyZWVuLndpZHRoIC0gaXdpZHRoKSAvIDIpOwoKCWlmIChwYXJhbXMubGVuZ3RoID4gMCkgewoJCXBhcmFtcyA9ICcsICcgKyBwYXJhbXM7Cgl9CgoJbG9jID0gbmV3IEN1cmwobG9jKS5nZXRVcmwoKTsKCgl2YXIgV2luT2JqUmVmZXJlciA9IHdpbmRvdy5vcGVuKGxvYywgd2lubmFtZSwgJ3dpZHRoPScgKyBpd2lkdGggKyAnLCBoZWlnaHQ9JyArIGloZWlnaHQgKyAnLCB0b3A9JyArIHRwICsgJywgbGVmdD0nICsgbGYgKyBwYXJhbXMpOwoJV2luT2JqUmVmZXJlci5mb2N1cygpOwp9CgpmdW5jdGlvbiBQb3BVcCh1cmwsIHdpZHRoLCBoZWlnaHQsIGZvcm1fbmFtZSkgewoJaWYgKCF3aWR0aCkgewoJCXdpZHRoID0gNzIwOwoJfQoJaWYgKCFoZWlnaHQpIHsKCQloZWlnaHQgPSA0ODA7Cgl9CglpZiAoIWZvcm1fbmFtZSkgewoJCWZvcm1fbmFtZSA9ICd6YnhfcG9wdXAnOwoJfQoKCXZhciBsZWZ0ID0gKHNjcmVlbi53aWR0aCAtICh3aWR0aCArIDE1MCkpIC8gMjsKCXZhciB0b3AgPSAoc2NyZWVuLmhlaWdodCAtIChoZWlnaHQgKyAxNTApKSAvIDI7CgoJdmFyIHBvcHVwID0gd2luZG93Lm9wZW4odXJsLCBmb3JtX25hbWUsICd3aWR0aD0nICsgd2lkdGggKyAnLCBoZWlnaHQ9JyArIGhlaWdodCArICcsIHRvcD0nICsgdG9wICsgJywgbGVmdD0nICsgbGVmdCArICcsIHJlc2l6YWJsZT15ZXMsIHNjcm9sbGJhcnM9eWVzLCBsb2NhdGlvbj1ubywgbWVudWJhcj1ubycpOwoJcG9wdXAuZm9jdXMoKTsKCglyZXR1cm4gZmFsc2U7Cn0KCmZ1bmN0aW9uIHJlZGlyZWN0KHVyaSwgbWV0aG9kLCBuZWVkbGUpIHsKCW1ldGhvZCA9IG1ldGhvZCB8fCAnZ2V0JzsKCXZhciB1cmwgPSBuZXcgQ3VybCh1cmkpOwoKCWlmIChtZXRob2QudG9Mb3dlckNhc2UoKSA9PSAnZ2V0JykgewoJCXdpbmRvdy5sb2NhdGlvbiA9IHVybC5nZXRVcmwoKTsKCX0KCWVsc2UgewoJCS8vIHVzZWxlc3MgcGFyYW0ganVzdCBmb3IgZWFzaWVyIGxvb3AKCQl2YXIgYWN0aW9uID0gJyc7CgkJdmFyIGRvbUJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdOwoJCXZhciBwb3N0Rm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKTsKCQlkb21Cb2R5LmFwcGVuZENoaWxkKHBvc3RGb3JtKTsKCQlwb3N0Rm9ybS5zZXRBdHRyaWJ1dGUoJ21ldGhvZCcsICdwb3N0Jyk7CgoJCXZhciBhcmdzID0gdXJsLmdldEFyZ3VtZW50cygpOwoJCWZvciAodmFyIGtleSBpbiBhcmdzKSB7CgkJCWlmIChlbXB0eShhcmdzW2tleV0pKSB7CgkJCQljb250aW51ZTsKCQkJfQoJCQlpZiAodHlwZW9mKG5lZWRsZSkgIT0gJ3VuZGVmaW5lZCcgJiYga2V5LmluZGV4T2YobmVlZGxlKSA+IC0xKSB7CgkJCQlhY3Rpb24gKz0gJyYnICsga2V5ICsgJz0nICsgYXJnc1trZXldOwoJCQkJY29udGludWU7CgkJCX0KCgkJCXZhciBoSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwoJCQloSW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ2hpZGRlbicpOwoJCQlwb3N0Rm9ybS5hcHBlbmRDaGlsZChoSW5wdXQpOwoJCQloSW5wdXQuc2V0QXR0cmlidXRlKCduYW1lJywga2V5KTsKCQkJaElucHV0LnNldEF0dHJpYnV0ZSgndmFsdWUnLCBhcmdzW2tleV0pOwoJCX0KCgkJcG9zdEZvcm0uc2V0QXR0cmlidXRlKCdhY3Rpb24nLCB1cmwuZ2V0UGF0aCgpICsgJz8nICsgYWN0aW9uLnN1YnN0cigxKSk7CgkJcG9zdEZvcm0uc3VibWl0KCk7Cgl9CgoJcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBzaG93SGlkZShvYmosIHN0eWxlKSB7CglpZiAodHlwZW9mKHN0eWxlKSA9PSAndW5kZWZpbmVkJykgewoJCXN0eWxlID0gJ2lubGluZSc7Cgl9CglpZiAoaXNfc3RyaW5nKG9iaikpIHsKCQlvYmogPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvYmopOwoJfQoJaWYgKCFvYmopIHsKCQl0aHJvdyAnc2hvd0hpZGUoKTogT2JqZWN0IG5vdCBmb3VuZC4nOwoJfQoKCWlmIChvYmouc3R5bGUuZGlzcGxheSAhPSAnbm9uZScpIHsKCQlvYmouc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCQlyZXR1cm4gMDsKCX0KCWVsc2UgewoJCW9iai5zdHlsZS5kaXNwbGF5ID0gc3R5bGU7CgkJcmV0dXJuIDE7Cgl9Cn0KCmZ1bmN0aW9uIHNob3dIaWRlVmlzaWJsZShvYmopIHsKCWlmIChpc19zdHJpbmcob2JqKSkgewoJCW9iaiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG9iaik7Cgl9CglpZiAoIW9iaikgewoJCXRocm93ICdzaG93SGlkZVZpc2libGUoKTogT2JqZWN0IG5vdCBmb3VuZC4nOwoJfQoKCWlmIChvYmouc3R5bGUudmlzaWJpbGl0eSAhPSAnaGlkZGVuJykgewoJCW9iai5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7Cgl9CgllbHNlIHsKCQlvYmouc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsKCX0KfQoKZnVuY3Rpb24gc2hvd0hpZGVCeU5hbWUobmFtZSwgc3R5bGUpIHsKCWlmICh0eXBlb2Yoc3R5bGUpID09ICd1bmRlZmluZWQnKSB7CgkJc3R5bGUgPSAnbm9uZSc7Cgl9CgoJdmFyIG9ianMgPSAkJCgnW25hbWU9JyArIG5hbWUgKyAnXScpOwoKCWlmIChlbXB0eShvYmpzKSkgewoJCXRocm93ICdzaG93SGlkZUJ5TmFtZSgpOiBPYmplY3Qgbm90IGZvdW5kLic7Cgl9CgoJZm9yICh2YXIgaSA9IDA7IGkgPCBvYmpzLmxlbmd0aDsgaSsrKSB7CgkJdmFyIG9iaiA9IG9ianNbaV07CgkJb2JqLnN0eWxlLmRpc3BsYXkgPSBzdHlsZTsKCX0KfQoKZnVuY3Rpb24gc3dpdGNoRWxlbWVudHNDbGFzcyhvYmosIGNsYXNzMSwgY2xhc3MyKSB7CglvYmogPSAkKG9iaik7CglpZiAoIW9iaikgewoJCXJldHVybiBmYWxzZTsKCX0KCgl2YXIgcmVzdWx0ID0gZmFsc2U7CgoJaWYgKG9iai5oYXNDbGFzc05hbWUoY2xhc3MxKSkgewoJCW9iai5yZW1vdmVDbGFzc05hbWUoY2xhc3MxKTsKCQlvYmouY2xhc3NOYW1lID0gY2xhc3MyICsgJyAnICsgb2JqLmNsYXNzTmFtZTsKCQlyZXN1bHQgPSBjbGFzczI7Cgl9CgllbHNlIGlmIChvYmouaGFzQ2xhc3NOYW1lKGNsYXNzMikpIHsKCQlvYmoucmVtb3ZlQ2xhc3NOYW1lKGNsYXNzMik7CgkJb2JqLmNsYXNzTmFtZSA9ICBjbGFzczEgKyAnICcgKyBvYmouY2xhc3NOYW1lOwoJCXJlc3VsdCA9IGNsYXNzMTsKCX0KCWVsc2UgewoJCW9iai5jbGFzc05hbWUgPSBjbGFzczEgKyAnICcgKyBvYmouY2xhc3NOYW1lOwoJCXJlc3VsdCA9IGNsYXNzMTsKCX0KCglyZXR1cm4gcmVzdWx0Owp9CgpmdW5jdGlvbiB6YnhfdGhyb3cobXNnKSB7Cgl0aHJvdyhtc2cpOwp9CgovKgoqKiBaYWJiaXgKKiogQ29weXJpZ2h0IChDKSAyMDAwLTIwMTIgWmFiYml4IFNJQQoqKgoqKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQoqKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQoqKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAyIG9mIHRoZSBMaWNlbnNlLCBvcgoqKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoqKgoqKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKKiogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKiogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQoqKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoqKgoqKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQoqKiBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQoqKiBGb3VuZGF0aW9uLCBJbmMuLCA1MSBGcmFua2xpbiBTdHJlZXQsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BICAwMjExMC0xMzAxLCBVU0EuCioqLwoKCnZhciBDRGVidWcgPSBDbGFzcy5jcmVhdGUoewoKCWNsYXNzTmFtZToJCW51bGwsCS8vIGRlYnVnaW5nIGNsYXNzIG5hbWUKCWRlYnVnX3N0YXR1czoJMCwJCS8vIGRlYnVnIHN0YXR1czogMCAtIG9mZiwgMSAtIG9uLCAyIC0gU0RJOwoJZGVidWdfaW5mbzoJCScnLAkJLy8gZGVidWcgc3RyaW5nCgoJaW5pdGlhbGl6ZTogZnVuY3Rpb24oY2xhc3NOYW1lKSB7CgkJdGhpcy5jbGFzc05hbWUgPSBjbGFzc05hbWU7Cgl9LAoKCWRlYnVnOiBmdW5jdGlvbihzdHIsIGlkKSB7CgkJaWYgKHRoaXMuZGVidWdfc3RhdHVzKSB7CgkJCXN0ciA9IHRoaXMuY2xhc3NOYW1lICsgJy4gJyArIHN0cjsKCgkJCWlmICh0eXBlb2YoaWQpICE9ICd1bmRlZmluZWQnKSB7CgkJCQlzdHIgKz0gJyA6JyArIGlkOwoJCQl9CgoJCQl0aGlzLmRlYnVnX2luZm8gKz0gc3RyICsgJ1xuJzsKCQkJaWYgKHRoaXMuZGVidWdfc3RhdHVzID09IDIpIHsKCQkJCVNESShzdHIpOwoJCQl9CgoJCQl0aGlzLmRlYnVnX3ByZXYgPSBzdHI7CgkJfQoJfSwKCglub3RpZnk6IGZ1bmN0aW9uKCkgewoJfSwKCglpbmZvOiBmdW5jdGlvbihtc2cpIHsKCQlhbGVydChtc2cgfHwgJ0luZm8uJyk7Cgl9LAoKCWVycm9yOiBmdW5jdGlvbihtc2cpIHsKCQl0aHJvdyhtc2cgfHwgJ0Vycm9yLicpOwoJfQp9KTsKCi8qKgogKiBKcyBkZWJ1ZwogKi8KdmFyIGpzRHVtcDsKCihmdW5jdGlvbigpIHsKCXZhciByZU5hbWUgPSAvXmZ1bmN0aW9uIChcdyspLzsKCglmdW5jdGlvbiBxdW90ZShzdHIpIHsKCQlyZXR1cm4gJyInICsgc3RyLnRvU3RyaW5nKCkucmVwbGFjZSgvIi9nLCAnXFwiJykgKyAnIic7Cgl9OwoKCWZ1bmN0aW9uIGxpdGVyYWwobykgewoJCXJldHVybiBvICsgJyc7Cgl9OwoKCWZ1bmN0aW9uIGpvaW4ocHJlLCBhcnIsIHBvc3QpIHsKCQl2YXIgcyA9IGpzRHVtcC5zZXBhcmF0b3IoKSwKCQkJYmFzZSA9IGpzRHVtcC5pbmRlbnQoKTsKCQkJaW5uZXIgPSBqc0R1bXAuaW5kZW50KDEpOwoKCQlpZiAoYXJyLmpvaW4pIHsKCQkJYXJyID0gYXJyLmpvaW4oJywnICsgcyArIGlubmVyKTsKCQl9CgkJaWYgKCFhcnIpIHsKCQkJcmV0dXJuIHByZSArIHBvc3Q7CgkJfQoKCQlyZXR1cm4gW3ByZSwgaW5uZXIgKyBhcnIsIGJhc2UgKyBwb3N0XS5qb2luKHMpOwoJfTsKCglmdW5jdGlvbiBhcnJheShhcnIpIHsKCQl2YXIgaSA9IGFyci5sZW5ndGgsIHJldCA9IEFycmF5KGkpOwoKCQl0aGlzLnVwKCk7CgkJd2hpbGUgKGktLSkgewoJCQlyZXRbaV0gPSB0aGlzLnBhcnNlKGFycltpXSk7CgkJfQoJCXRoaXMuZG93bigpOwoKCQlyZXR1cm4gam9pbignWycsIHJldCwgJ10nKTsKCX07CgoJanNEdW1wID0gewoJCXF1b3RlOiBxdW90ZSwKCQlsaXRlcmFsOiBsaXRlcmFsLAoJCWpvaW46IGpvaW4sCgkJX2RlcHRoXzogMSwKCQlIVE1MOiBmYWxzZSwgLy8gaWYgdHJ1ZSwgZW50aXRpZXMgYXJlIGVzY2FwZWQgKCA8LCA+LCBcdCwgc3BhY2UgYW5kIFxuICkKCQlpbmRlbnRDaGFyOiAnICAgJywgLy8gaW5kZW50YXRpb24gdW5pdAoJCW11bHRpbGluZTogdHJ1ZSwgLy8gaWYgdHJ1ZSwgaXRlbXMgaW4gYSBjb2xsZWN0aW9uLCBhcmUgc2VwYXJhdGVkIGJ5IGEgXG4sIGVsc2UganVzdCBhIHNwYWNlLgoKCQlwYXJzZTogZnVuY3Rpb24ob2JqLCB0eXBlKSB7IC8vIHR5cGUgaXMgdXNlZCBtb3N0bHkgaW50ZXJuYWxseSwgeW91IGNhbiBmaXggYSAoY3VzdG9tKSB0eXBlIGluIGFkdmFuY2UKCQkJdmFyIHBhcnNlciA9IHRoaXMucGFyc2Vyc1t0eXBlIHx8IHRoaXMudHlwZU9mKG9iaildOwoJCQl0eXBlID0gdHlwZW9mIHBhcnNlcjsKCgkJCXJldHVybiB0eXBlID09ICdmdW5jdGlvbicgPyBwYXJzZXIuY2FsbCh0aGlzLCBvYmopIDogdHlwZSA9PSAnc3RyaW5nJyA/IHBhcnNlciA6IHRoaXMucGFyc2Vycy5lcnJvcjsKCQl9LAoKCQl0eXBlT2Y6IGZ1bmN0aW9uKG9iaikgewoJCQl2YXIgdHlwZSA9IHR5cGVvZiBvYmosCgkJCQlmID0gJ2Z1bmN0aW9uJzsgLy8gd2UnbGwgdXNlIGl0IDMgdGltZXMsIHNhdmUgaXQKCgkJCXJldHVybiB0eXBlICE9ICdvYmplY3QnICYmIHR5cGUgIT0gZiA/IHR5cGUgOgoJCQkJIW9iaiA/ICdudWxsJyA6CgkJCQlvYmouZXhlYyA/ICdyZWdleHAnIDogLy8gc29tZSBicm93c2VycyAoRkYpIGNvbnNpZGVyIHJlZ2V4cHMgZnVuY3Rpb25zCgkJCQlvYmouZ2V0SG91cnMgPyAnZGF0ZScgOgoJCQkJb2JqLnNjcm9sbEJ5ID8gICd3aW5kb3cnIDoKCQkJCW9iai5ub2RlTmFtZSA9PSAnI2RvY3VtZW50JyA/ICdkb2N1bWVudCcgOgoJCQkJb2JqLm5vZGVOYW1lID8gJ25vZGUnIDoKCQkJCW9iai5pdGVtID8gJ25vZGVsaXN0JyA6IC8vIFNhZmFyaSByZXBvcnRzIG5vZGVsaXN0cyBhcyBmdW5jdGlvbnMKCQkJCW9iai5jYWxsZWUgPyAnYXJndW1lbnRzJyA6CgkJCQlvYmouY2FsbCB8fCBvYmouY29uc3RydWN0b3IgIT0gQXJyYXkgJiYgLy8gYW4gYXJyYXkgd291bGQgYWxzbyBmYWxsIG9uIHRoaXMgaGFjawoJCQkJCShvYmogKyAnJykuaW5kZXhPZihmKSAhPSAtMSA/IGYgOiAvLyBJRSByZXBvcnRzIGZ1bmN0aW9ucyBsaWtlIGFsZXJ0LCBhcyBvYmplY3RzCgkJCQknbGVuZ3RoJyBpbiBvYmogPyAnYXJyYXknIDoKCQkJCXR5cGU7CgkJfSwKCgkJc2VwYXJhdG9yOiBmdW5jdGlvbigpIHsKCQkJcmV0dXJuIHRoaXMubXVsdGlsaW5lID8gdGhpcy5IVE1MID8gJzxiciAvPicgOiAnXG4nIDogdGhpcy5IVE1MID8gJyZuYnNwOycgOiAnICc7CgkJfSwKCgkJaW5kZW50OiBmdW5jdGlvbiAoZXh0cmEpIHsgLy8gZXh0cmEgY2FuIGJlIGEgbnVtYmVyLCBzaG9ydGN1dCBmb3IgaW5jcmVhc2luZy1jYWxsaW5nLWRlY3JlYXNpbmcKCQkJaWYgKCF0aGlzLm11bHRpbGluZSkgewoJCQkJcmV0dXJuICcnOwoJCQl9CgoJCQl2YXIgY2hyID0gdGhpcy5pbmRlbnRDaGFyOwoKCQkJaWYgKHRoaXMuSFRNTCkgewoJCQkJY2hyID0gY2hyLnJlcGxhY2UoL1x0L2csICcgICAnKS5yZXBsYWNlKC8gL2csICcmbmJzcDsnKTsKCQkJfQoKCQkJcmV0dXJuIEFycmF5KHRoaXMuX2RlcHRoXyArIChleHRyYXx8MCkpLmpvaW4oY2hyKTsKCQl9LAoKCQl1cDogZnVuY3Rpb24oYSkgewoJCQl0aGlzLl9kZXB0aF8gKz0gYSB8fCAxOwoJCX0sCgoJCWRvd246IGZ1bmN0aW9uKGEpIHsKCQkJdGhpcy5fZGVwdGhfIC09IGEgfHwgMTsKCQl9LAoKCQlzZXRQYXJzZXI6IGZ1bmN0aW9uKG5hbWUsIHBhcnNlcikgewoJCQl0aGlzLnBhcnNlcnNbbmFtZV0gPSBwYXJzZXI7CgkJfSwKCgkJLy8gdGhpcyBpcyB0aGUgbGlzdCBvZiBwYXJzZXJzLCB0byBtb2RpZnkgdGhlbSwgdXNlIGpzZHVtcC5zZXRwYXJzZXIKCQlwYXJzZXJzOiB7CgkJCXdpbmRvdzogJ1tXaW5kb3ddJywKCQkJZG9jdW1lbnQ6ICdbRG9jdW1lbnRdJywKCQkJZXJyb3I6ICdbRVJST1JdJywgLy8gd2hlbiBubyBwYXJzZXIgaXMgZm91bmQsIHNob3VsZG4ndCBoYXBwZW4KCQkJdW5rbm93bjogJ1tVbmtub3duXScsCgkJCSdudWxsJzogJ251bGwnLAoJCQl1bmRlZmluZWQ6ICd1bmRlZmluZWQnLAoJCQknZnVuY3Rpb24nOiBmdW5jdGlvbihmbikgewoJCQkJdmFyIHJldCA9ICdmdW5jdGlvbicsCgkJCQkJbmFtZSA9ICduYW1lJyBpbiBmbiA/IGZuLm5hbWUgOiAocmVOYW1lLmV4ZWMoZm4pIHx8IFtdKVsxXTsgLy8gZnVuY3Rpb25zIG5ldmVyIGhhdmUgbmFtZSBpbiBJRQoJCQkJaWYgKG5hbWUpIHsKCQkJCQlyZXQgKz0gJyAnICsgbmFtZTsKCQkJCX0KCQkJCXJldCArPSAnKCc7CgkJCQlyZXQgPSBbcmV0LCB0aGlzLnBhcnNlKGZuLCAnZnVuY3Rpb25BcmdzJyksICcpeyddLmpvaW4oJycpOwoKCQkJCXJldHVybiBqb2luKHJldCwgdGhpcy5wYXJzZShmbiwgJ2Z1bmN0aW9uQ29kZScpLCAnfScpOwoJCQl9LAoKCQkJYXJyYXk6IGFycmF5LAoJCQlub2RlbGlzdDogYXJyYXksCgkJCWFyZ3VtZW50czogYXJyYXksCgkJCWtleTogcXVvdGUsIC8vIG9iamVjdCBjYWxscyBpdCBpbnRlcm5hbGx5LCB0aGUga2V5IHBhcnQgb2YgYW4gaXRlbSBpbiBhIG1hcAoJCQlmdW5jdGlvbkNvZGU6ICdbY29kZV0nLCAvLyBmdW5jdGlvbiBjYWxscyBpdCBpbnRlcm5hbGx5LCBpdCdzIHRoZSBjb250ZW50IG9mIHRoZSBmdW5jdGlvbgoJCQlhdHRyaWJ1dGU6IHF1b3RlLCAvLyBvbm9kZSBjYWxscyBpdCBpbnRlcm5hbGx5LCBpdCdzIGFuIGh0bWwgYXR0cmlidXRlIHZhbHVlCgkJCXN0cmluZzogcXVvdGUsCgkJCWRhdGU6IHF1b3RlLAoJCQlyZWdleHA6IGxpdGVyYWwsIC8vIHJlZ2V4CgkJCW51bWJlcjogbGl0ZXJhbCwKCQkJJ2Jvb2xlYW4nOiBsaXRlcmFsLAoKCQkJb2JqZWN0OiBmdW5jdGlvbihtYXApIHsKCQkJCXZhciByZXQgPSBbXTsKCQkJCXRoaXMudXAoKTsKCQkJCWZvciAodmFyIGtleSBpbiBtYXApIHsKCQkJCQlyZXQucHVzaCh0aGlzLnBhcnNlKGtleSwgJ2tleScpICsgJzogJyArIHRoaXMucGFyc2UobWFwW2tleV0pKTsKCQkJCX0KCQkJCXRoaXMuZG93bigpOwoKCQkJCXJldHVybiBqb2luKCd7JywgcmV0LCAnfScpOwoJCQl9LAoKCQkJbm9kZTogZnVuY3Rpb24obm9kZSkgewoJCQkJdmFyIG9wZW4gPSB0aGlzLkhUTUwgPyAnJmx0OycgOiAnPCcsCgkJCQkJY2xvc2UgPSB0aGlzLkhUTUwgPyAnJmd0OycgOiAnPicsCgkJCQkJdGFnID0gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpLAoJCQkJCXJldCA9IG9wZW4gKyB0YWc7CgoJCQkJZm9yICh2YXIgYSBpbiB0aGlzLkRPTUF0dHJzKSB7CgkJCQkJdmFyIHZhbCA9IG5vZGVbdGhpcy5ET01BdHRyc1thXV07CgkJCQkJaWYgKHZhbCkgewoJCQkJCQlyZXQgKz0gJyAnICsgYSArICc9JyArIHRoaXMucGFyc2UodmFsLCAnYXR0cmlidXRlJyk7CgkJCQkJfQoJCQkJfQoKCQkJCXJldHVybiByZXQgKyBjbG9zZSArIG9wZW4gKyAnLycgKyB0YWcgKyBjbG9zZTsKCQkJfSwKCgkJCWZ1bmN0aW9uQXJnczogZnVuY3Rpb24oZm4pIHsgLy8gZnVuY3Rpb24gY2FsbHMgaXQgaW50ZXJuYWxseSwgaXQncyB0aGUgYXJndW1lbnRzIHBhcnQgb2YgdGhlIGZ1bmN0aW9uCgkJCQl2YXIgbCA9IGZuLmxlbmd0aDsKCgkJCQlpZiAoIWwpIHsKCQkJCQlyZXR1cm4gJyc7CgkJCQl9CgoJCQkJdmFyIGFyZ3MgPSBBcnJheShsKTsKCQkJCXdoaWxlIChsLS0pIHsKCQkJCQlhcmdzW2xdID0gU3RyaW5nLmZyb21DaGFyQ29kZSg5NyArIGwpOyAvLyA5NyBpcyAnYScKCQkJCX0KCgkJCQlyZXR1cm4gJyAnICsgYXJncy5qb2luKCcsICcpICsgJyAnOwoJCQl9CgkJfSwKCgkJRE9NQXR0cnM6IHsgLy8gYXR0cmlidXRlcyB0byBkdW1wIGZyb20gbm9kZXMsIG5hbWUgPT4gcmVhbE5hbWUKCQkJaWQ6ICdpZCcsCgkJCW5hbWU6ICduYW1lJywKCQkJJ2NsYXNzJzogJ2NsYXNzTmFtZScKCQl9Cgl9Owp9KSgpOwoKZnVuY3Rpb24gY2R1bXAoJG9iaikgewoJY29uc29sZS5sb2coanNEdW1wLnBhcnNlKCRvYmopKTsKfQoKZnVuY3Rpb24gY2R1bXB0cyh0aW1lc3RhbXApIHsKCXJldHVybiBuZXcgQ0RhdGUodGltZXN0YW1wKS5nZXRaQlhEYXRlKCk7Cn0KCi8qCioqIFphYmJpeAoqKiBDb3B5cmlnaHQgKEMpIDIwMDAtMjAxMSBaYWJiaXggU0lBCioqCioqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CioqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CioqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlciB2ZXJzaW9uIDIgb2YgdGhlIExpY2Vuc2UsIG9yCioqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCioqCioqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAoqKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgoqKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCioqIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuCioqCioqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCioqIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtOyBpZiBub3QsIHdyaXRlIHRvIHRoZSBGcmVlIFNvZnR3YXJlCioqIEZvdW5kYXRpb24sIEluYy4sIDUxIEZyYW5rbGluIFN0cmVldCwgRmlmdGggRmxvb3IsIEJvc3RvbiwgTUEgIDAyMTEwLTEzMDEsIFVTQS4KKiovCgp2YXIgQ0RhdGUgPSBDbGFzcy5jcmVhdGUoKTsKCkNEYXRlLnByb3RvdHlwZSA9IHsKCXNlcnZlcjoJCTAsCQkJLy8gZ2V0VGltZSB1c2VzIGNsaWVudHMgOjAsIG9yIHNlcnZlcnMgdGltZSA6MQoJdHpEaWZmOgkJMCwJCQkvLyBzZXJ2ZXIgYW5kIGNsaWVudCBUWiBkaWZmCgljbGllbnREYXRlOgludWxsLAkvLyBjbGllbnRzKEpTLCBCcm93c2VyKSBkYXRlIG9iamVjdAoJc2VydmVyRGF0ZToJbnVsbCwJLy8gc2VydmVycyhQSFAsIFVuaXgpIGRhdGUgb2JqZWN0Cgl0bXBEYXRlOgludWxsLAkJLy8gaW5uZXIgdXNhZ2UKCglpbml0aWFsaXplOiBmdW5jdGlvbigpIHsKCQl0aGlzLnRtcERhdGUgPSBuZXcgRGF0ZSgpOwoKCQl0aGlzLmNsaWVudERhdGUgPSAoYXJndW1lbnRzLmxlbmd0aCA+IDApCgkJCT8gbmV3IERhdGUoYXJndW1lbnRzWzBdKQoJCQk6IG5ldyBEYXRlKCk7CgkJdGhpcy5jYWxjVFpkaWZmKHRoaXMuY2xpZW50RGF0ZS5nZXRUaW1lKCkpOwoJCXRoaXMuc2VydmVyRGF0ZSA9IG5ldyBEYXRlKHRoaXMuY2xpZW50RGF0ZS5nZXRUaW1lKCkgLSB0aGlzLnR6RGlmZiAqIDEwMDApOwoJfSwKCgljYWxjVFpkaWZmOiBmdW5jdGlvbih0aW1lKSB7CgkJdmFyIGRkVFpPZmZzZXQ7CgoJCWlmICh0eXBlb2YodGltZSkgIT0gJ3VuZGVmaW5lZCcpIHsKCQkJdGhpcy50bXBEYXRlLnNldFRpbWUodGltZSk7CgkJCWRkVFpPZmZzZXQgPSB0aGlzLnRtcERhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIC02MDsKCQl9CgkJZWxzZSB7CgkJCWRkVFpPZmZzZXQgPSB0aGlzLnNlcnZlckRhdGUuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIC02MDsKCQl9CgoJCXRoaXMudHpEaWZmID0gZGRUWk9mZnNldCAtIFBIUF9UWl9PRkZTRVQ7Cgl9LAoKCWdldFpCWERhdGU6IGZ1bmN0aW9uKCkgewoJCXZhciB0aGVkYXRlID0gW107CgkJdGhlZGF0ZVswXSA9IHRoaXMuc2VydmVyRGF0ZS5nZXREYXRlKCk7CgkJdGhlZGF0ZVsxXSA9IHRoaXMuc2VydmVyRGF0ZS5nZXRNb250aCgpICsgMTsKCQl0aGVkYXRlWzJdID0gdGhpcy5zZXJ2ZXJEYXRlLmdldEZ1bGxZZWFyKCk7CgkJdGhlZGF0ZVszXSA9IHRoaXMuc2VydmVyRGF0ZS5nZXRIb3VycygpOwoJCXRoZWRhdGVbNF0gPSB0aGlzLnNlcnZlckRhdGUuZ2V0TWludXRlcygpOwoJCXRoZWRhdGVbNV0gPSB0aGlzLnNlcnZlckRhdGUuZ2V0U2Vjb25kcygpOwoKCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoZWRhdGUubGVuZ3RoOyBpKyspIHsKCQkJaWYgKCh0aGVkYXRlW2ldICsgJycpLmxlbmd0aCA8IDIpIHsKCQkJCXRoZWRhdGVbaV0gPSAnMCcgKyB0aGVkYXRlW2ldOwoJCQl9CgkJfQoKCQlyZXR1cm4gJycgKyB0aGVkYXRlWzJdICsgdGhlZGF0ZVsxXSArIHRoZWRhdGVbMF0gKyB0aGVkYXRlWzNdICsgdGhlZGF0ZVs0XSArIHRoZWRhdGVbNV07Cgl9LAoKCXNldFpCWERhdGU6IGZ1bmN0aW9uKHN0cmRhdGUpIHsKCQl0aGlzLnNlcnZlciA9IDE7CgoJCXZhciB0aGVEYXRlID0gewoJCQlZOiBzdHJkYXRlLnRvU3RyaW5nKCkuc3Vic3RyKDAsIDQpLAoJCQltOiBzdHJkYXRlLnRvU3RyaW5nKCkuc3Vic3RyKDQsIDIpLAoJCQlkOiBzdHJkYXRlLnRvU3RyaW5nKCkuc3Vic3RyKDYsIDIpLAoJCQlIOiBzdHJkYXRlLnRvU3RyaW5nKCkuc3Vic3RyKDgsIDIpLAoJCQlpOiBzdHJkYXRlLnRvU3RyaW5nKCkuc3Vic3RyKDEwLCAyKSwKCQkJczogc3RyZGF0ZS50b1N0cmluZygpLnN1YnN0cigxMiwgMikKCQl9OwoKCQl0aGlzLnNlcnZlckRhdGUuc2V0RnVsbFllYXIodGhlRGF0ZS5ZKTsKCQl0aGlzLnNlcnZlckRhdGUuc2V0TW9udGgodGhlRGF0ZS5tIC0gMSk7CgkJdGhpcy5zZXJ2ZXJEYXRlLnNldERhdGUodGhlRGF0ZS5kKTsKCQl0aGlzLnNlcnZlckRhdGUuc2V0SG91cnModGhlRGF0ZS5IKTsKCQl0aGlzLnNlcnZlckRhdGUuc2V0TWludXRlcyh0aGVEYXRlLmkpOwoJCXRoaXMuc2VydmVyRGF0ZS5zZXRTZWNvbmRzKHRoZURhdGUucyk7CgkJdGhpcy5zZXJ2ZXJEYXRlLnNldE1pbGxpc2Vjb25kcygwKTsKCQl0aGlzLmNhbGNUWmRpZmYoKTsKCgkJcmV0dXJuIHRoaXMuZ2V0VGltZSgpOwoJfSwKCglnZXRGb3JtYXR0ZWREYXRlOiBmdW5jdGlvbigpIHsKCQl2YXIgZkRhdGUgPSB0aGlzLmdldEZ1bGxZZWFyKCkgKyAnLScgKyAodGhpcy5nZXRNb250aCgpICsgMSkgKyAnLScgKyB0aGlzLmdldERhdGUoKTsKCQlmRGF0ZSArPSAnICcgKyB0aGlzLmdldEhvdXJzKCkgKyAnOicgKyB0aGlzLmdldE1pbnV0ZXMoKSArICc6JyArIHRoaXMuZ2V0U2Vjb25kcygpOwoJCWZEYXRlICs9ICcgJyArIHR6T2Zmc2V0SG91cnMgKyAnOicgKyB0aGlzLnR6T2Zmc2V0IC8gMzYwMDsKCgkJcmV0dXJuIGZEYXRlOwoJfSwKCgl0b1N0cmluZzogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuc2VydmVyRGF0ZS50b1N0cmluZygpOwoJfSwKCglwYXJzZTogZnVuY3Rpb24oYXJnKSB7CgkJdGhpcy5zZXJ2ZXIgPSAxOwoJCXRoaXMuc2VydmVyRGF0ZS5zZXRUaW1lKERhdGUucGFyc2UoYXJnKSk7CgkJdGhpcy5jYWxjVFpkaWZmKCk7CgoJCXJldHVybiB0aGlzLmdldFRpbWUoKTsKCX0sCgoJZ2V0VGltZXpvbmVPZmZzZXQ6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBwYXJzZUludCgtUEhQX1RaX09GRlNFVCAvIDYwKTsKCX0sCgoJZ2V0TWlsbGlzZWNvbmRzOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5zZXJ2ZXJEYXRlLmdldE1pbGxpc2Vjb25kcygpOwoJfSwKCglnZXRTZWNvbmRzOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5zZXJ2ZXJEYXRlLmdldFNlY29uZHMoKTsKCX0sCgoJZ2V0TWludXRlczogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuc2VydmVyRGF0ZS5nZXRNaW51dGVzKCk7Cgl9LAoKCWdldEhvdXJzOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5zZXJ2ZXJEYXRlLmdldEhvdXJzKCk7Cgl9LAoKCWdldERheTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuc2VydmVyRGF0ZS5nZXREYXkoKTsKCX0sCgoJZ2V0TW9udGg6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLnNlcnZlckRhdGUuZ2V0TW9udGgoKTsKCX0sCgoJZ2V0WWVhcjogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuc2VydmVyRGF0ZS5nZXRZZWFyKCk7Cgl9LAoKCWdldEZ1bGxZZWFyOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5zZXJ2ZXJEYXRlLmdldEZ1bGxZZWFyKCk7Cgl9LAoKCWdldERhdGU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLnNlcnZlckRhdGUuZ2V0RGF0ZSgpOwoJfSwKCglnZXRUaW1lOiBmdW5jdGlvbigpIHsKCQlpZiAodGhpcy5zZXJ2ZXIgPT0gMSkgewoJCQlyZXR1cm4gdGhpcy5zZXJ2ZXJEYXRlLmdldFRpbWUoKSArIHRoaXMudHpEaWZmICogMTAwMDsKCQl9CgkJZWxzZSB7CgkJCXJldHVybiB0aGlzLmNsaWVudERhdGUuZ2V0VGltZSgpOwoJCX0KCX0sCgoJc2V0TWlsbGlzZWNvbmRzOiBmdW5jdGlvbihhcmcpIHsKCQl0aGlzLnNlcnZlciA9IDE7CgkJdGhpcy5zZXJ2ZXJEYXRlLnNldE1pbGxpc2Vjb25kcyhhcmcpOwoJCXRoaXMuY2FsY1RaZGlmZigpOwoJfSwKCglzZXRTZWNvbmRzOiBmdW5jdGlvbihhcmcpIHsKCQl0aGlzLnNlcnZlciA9IDE7CgkJdGhpcy5zZXJ2ZXJEYXRlLnNldFNlY29uZHMoYXJnKTsKCQl0aGlzLmNhbGNUWmRpZmYoKTsKCX0sCgoJc2V0TWludXRlczogZnVuY3Rpb24oYXJnKSB7CgkJdGhpcy5zZXJ2ZXIgPSAxOwoJCXRoaXMuc2VydmVyRGF0ZS5zZXRNaW51dGVzKGFyZyk7CgkJdGhpcy5jYWxjVFpkaWZmKCk7Cgl9LAoKCXNldEhvdXJzOiBmdW5jdGlvbihhcmcpIHsKCQl0aGlzLnNlcnZlciA9IDE7CgkJdGhpcy5zZXJ2ZXJEYXRlLnNldEhvdXJzKGFyZyk7CgkJdGhpcy5jYWxjVFpkaWZmKCk7Cgl9LAoKCXNldERhdGU6IGZ1bmN0aW9uKGFyZykgewoJCXRoaXMuc2VydmVyID0gMTsKCQl0aGlzLnNlcnZlckRhdGUuc2V0RGF0ZShhcmcpOwoJCXRoaXMuY2FsY1RaZGlmZigpOwoJfSwKCglzZXRNb250aDogZnVuY3Rpb24oYXJnKSB7CgkJdGhpcy5zZXJ2ZXIgPSAxOwoJCXRoaXMuc2VydmVyRGF0ZS5zZXRNb250aChhcmcpOwoJCXRoaXMuY2FsY1RaZGlmZigpOwoJfSwKCglzZXRGdWxsWWVhcjogZnVuY3Rpb24oYXJnKSB7CgkJdGhpcy5zZXJ2ZXIgPSAxOwoJCXRoaXMuc2VydmVyRGF0ZS5zZXRGdWxsWWVhcihhcmcpOwoJCXRoaXMuY2FsY1RaZGlmZigpOwoJfSwKCglzZXRUaW1lOiBmdW5jdGlvbihhcmcpIHsKCQlhcmcgPSBwYXJzZUludChhcmcsIDEwKTsKCgkJdGhpcy5zZXJ2ZXIgPSAwOwoJCXRoaXMuY2FsY1RaZGlmZihhcmcpOwoJCXRoaXMuc2VydmVyRGF0ZS5zZXRUaW1lKGFyZyAtIHRoaXMudHpEaWZmICogMTAwMCk7CgkJdGhpcy5jbGllbnREYXRlLnNldFRpbWUoYXJnKTsKCX0sCgoJZGVidWc6IGZ1bmN0aW9uKGZuY19uYW1lLCBpZCkgewoJCWlmICh0aGlzLmRlYnVnX3N0YXR1cykgewoJCQl2YXIgc3RyID0gJ0NEYXRlLicgKyBmbmNfbmFtZTsKCQkJaWYgKHR5cGVvZihpZCkgIT0gJ3VuZGVmaW5lZCcpIHsKCQkJCXN0ciArPSAnIDonICsgaWQ7CgkJCX0KCQkJaWYgKHRoaXMuZGVidWdfcHJldiA9PSBzdHIpIHsKCQkJCXJldHVybiB0cnVlOwoJCQl9CgoJCQl0aGlzLmRlYnVnX2luZm8gKz0gc3RyOwoJCQlpZiAodGhpcy5kZWJ1Z19zdGF0dXMgPT0gMikgewoJCQkJU0RJKHN0cik7CgkJCX0KCQkJdGhpcy5kZWJ1Z19wcmV2ID0gc3RyOwoJCX0KCX0KfQoKLyoKKiogWmFiYml4CioqIENvcHlyaWdodCAoQykgMjAwMC0yMDExIFphYmJpeCBTSUEKKioKKiogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKKiogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKKiogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMiBvZiB0aGUgTGljZW5zZSwgb3IKKiogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KKioKKiogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCioqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCioqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKKiogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKioKKiogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKKiogYWxvbmcgd2l0aCB0aGlzIHByb2dyYW07IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKKiogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAgMDIxMTAtMTMwMSwgVVNBLgoqKi8KCnZhciBjb29raWUgPSB7Cgljb29raWVzOiBbXSwKCglpbml0OiBmdW5jdGlvbigpIHsKCQl2YXIgcGF0aCA9IG5ldyBDdXJsKCk7CgkJdmFyIHBhZ2UgPSBwYXRoLmdldFBhdGgoKTsKCQl2YXIgYWxsQ29va2llcyA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOyAnKTsKCQlmb3IgKHZhciBpID0gMDsgaSA8IGFsbENvb2tpZXMubGVuZ3RoOyBpKyspIHsKCQkJdmFyIGNvb2tpZVBhaXIgPSBhbGxDb29raWVzW2ldLnNwbGl0KCc9Jyk7CgkJCWlmIChjb29raWVQYWlyWzBdLmluZGV4T2YoJ2NiXycpID4gLTEgJiYgY29va2llUGFpclswXS5pbmRleE9mKCdjYl8nICsgcGFnZSkgPT0gLTEpIHsKCQkJCXRoaXMuZXJhc2UoY29va2llUGFpclswXSk7CgkJCX0KCQkJZWxzZSB7CgkJCQl0aGlzLmNvb2tpZXNbY29va2llUGFpclswXV0gPSBjb29raWVQYWlyWzFdOwoJCQl9CgkJfQoJfSwKCgljcmVhdGU6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlLCBkYXlzKSB7CgkJaWYgKHR5cGVvZihkYXlzKSAhPSAndW5kZWZpbmVkJykgewoJCQl2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CgkJCWRhdGUuc2V0VGltZShkYXRlLmdldFRpbWUoKSArIGRheXMgKiAyNCAqIDYwICogNjAgKiAxMDAwKTsKCQkJdmFyIGV4cGlyZXMgPSAnOyBleHBpcmVzPScgKyBkYXRlLnRvR01UU3RyaW5nKCk7CgkJfQoJCWVsc2UgewoJCQl2YXIgZXhwaXJlcyA9ICcnOwoJCX0KCQlkb2N1bWVudC5jb29raWUgPSBuYW1lICsgJz0nICsgdmFsdWUgKyBleHBpcmVzICsgJzsgcGF0aD0vJzsKCgkJLy8gYXBhY2hlIGhlYWRlciBzaXplIGxpbWl0CgkJaWYgKGRvY3VtZW50LmNvb2tpZS5sZW5ndGggPiA4MDAwKSB7CgkJCWRvY3VtZW50LmNvb2tpZSA9IG5hbWUgKyAnPTsgcGF0aD0vJzsKCQkJYWxlcnQobG9jYWxlWydTX01BWF9DT09LSUVfU0laRV9SRUFDSEVEJ10pOwoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCWVsc2UgewoJCQl0aGlzLmNvb2tpZXNbbmFtZV0gPSB2YWx1ZTsKCQl9CgkJcmV0dXJuIHRydWU7Cgl9LAoKCWNyZWF0ZUFycmF5OiBmdW5jdGlvbihuYW1lLCB2YWx1ZSwgZGF5cykgewoJCXZhciBsaXN0ID0gdmFsdWUuam9pbignLCcpOwoJCXZhciBsaXN0X3BhcnQgPSAnJzsKCQl2YXIgcGFydCA9IDE7CgkJdmFyIHBhcnRfY291bnQgPSBwYXJzZUludCh0aGlzLnJlYWQobmFtZSArICdfcGFydHMnKSwgMTApOwoKCQlpZiAoaXNfbnVsbChwYXJ0X2NvdW50KSkgewoJCQlwYXJ0X2NvdW50ID0gMTsKCQl9CgoJCXZhciB0bXBfaW5kZXggPSAwCgkJdmFyIHJlc3VsdCA9IHRydWU7CgkJd2hpbGUgKGxpc3QubGVuZ3RoID4gMCkgewoJCQlsaXN0X3BhcnQgPSBsaXN0LnN1YnN0cigwLCA0MDAwKTsKCQkJbGlzdCA9IGxpc3Quc3Vic3RyKDQwMDApOwoJCQlpZiAobGlzdC5sZW5ndGggPiAwKSB7CgkJCQl0bXBfaW5kZXggPSBsaXN0X3BhcnQubGFzdEluZGV4T2YoJywnKTsKCQkJCWlmICh0bXBfaW5kZXggPiAtMSkgewoJCQkJCWxpc3QgPSBsaXN0X3BhcnQuc3Vic3RyaW5nKHRtcF9pbmRleCsxKSArIGxpc3Q7CgkJCQkJbGlzdF9wYXJ0ID0gbGlzdF9wYXJ0LnN1YnN0cmluZygwLCB0bXBfaW5kZXggKyAxKTsKCQkJCX0KCQkJfQoJCQlyZXN1bHQgPSB0aGlzLmNyZWF0ZShuYW1lICsgJ18nICsgcGFydCwgbGlzdF9wYXJ0LCBkYXlzKTsKCQkJcGFydCsrOwoKCQkJaWYgKCFyZXN1bHQpIHsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJCXRoaXMuY3JlYXRlKG5hbWUgKyAnX3BhcnRzJywgcGFydCAtIDEpOwoKCQl3aGlsZSAocGFydCA8PSBwYXJ0X2NvdW50KSB7CgkJCXRoaXMuZXJhc2UobmFtZSArICdfJyArIHBhcnQpOwoJCQlwYXJ0Kys7CgkJfQoJfSwKCgljcmVhdGVKU09OOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSwgZGF5cykgewoJCXZhciB2YWx1ZV9hcnJheSA9IFtdOwoJCWZvciAodmFyIGtleSBpbiB2YWx1ZSkgewoJCQlpZiAoIWVtcHR5KHZhbHVlW2tleV0pKSB7CgkJCQl2YWx1ZV9hcnJheS5wdXNoKHZhbHVlW2tleV0pOwoJCQl9CgkJfQoJCXRoaXMuY3JlYXRlQXJyYXkobmFtZSwgdmFsdWVfYXJyYXksIGRheXMpOwoJfSwKCglyZWFkOiBmdW5jdGlvbihuYW1lKSB7CgkJaWYgKHR5cGVvZih0aGlzLmNvb2tpZXNbbmFtZV0pICE9ICd1bmRlZmluZWQnKSB7CgkJCXJldHVybiB0aGlzLmNvb2tpZXNbbmFtZV07CgkJfQoJCWVsc2UgaWYgKGRvY3VtZW50LmNvb2tpZS5pbmRleE9mKG5hbWUpICE9IC0xKSB7CgkJCXZhciBuYW1lRVEgPSBuYW1lICsgJz0nOwoJCQl2YXIgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBjYS5sZW5ndGg7IGkrKykgewoJCQkJdmFyIGMgPSBjYVtpXTsKCQkJCXdoaWxlIChjLmNoYXJBdCgwKSA9PSAnICcpIHsKCQkJCQljID0gYy5zdWJzdHJpbmcoMSwgYy5sZW5ndGgpOwoJCQkJfQoJCQkJaWYgKGMuaW5kZXhPZihuYW1lRVEpID09IDApIHsKCQkJCQlyZXR1cm4gdGhpcy5jb29raWVzW25hbWVdID0gYy5zdWJzdHJpbmcobmFtZUVRLmxlbmd0aCwgYy5sZW5ndGgpOwoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiBudWxsOwoJfSwKCglyZWFkQXJyYXk6IGZ1bmN0aW9uKG5hbWUpIHsKCQl2YXIgbGlzdCA9ICcnOwoJCXZhciBsaXN0X3BhcnQgPSAnJzsKCQl2YXIgcGFydCA9IDE7CgkJdmFyIHBhcnRfY291bnQgPSBwYXJzZUludCh0aGlzLnJlYWQobmFtZSArICdfcGFydHMnKSwgMTApOwoJCWlmIChpc19udWxsKHBhcnRfY291bnQpKSB7CgkJCXBhcnRfY291bnQgPSAxOwoJCX0KCgkJLy8gcmVhZGluZyBhbGwgcGFydHMgb2Ygc2VsZWN0ZWQgbGlzdAoJCXdoaWxlIChwYXJ0IDw9IChwYXJ0X2NvdW50ICsgMSkpIHsKCQkJaWYgKCFpc19udWxsKGxpc3RfcGFydCkpIHsKCQkJCWxpc3QgKz0gbGlzdF9wYXJ0OwoJCQl9CgkJCWxpc3RfcGFydCA9IHRoaXMucmVhZChuYW1lICsgJ18nICsgcGFydCk7CgkJCXBhcnQrKzsKCQl9CgkJdmFyIHJhbmdlID0gbGlzdC5zcGxpdCgnLCcpOwoJCXJldHVybiByYW5nZTsKCX0sCgoJcmVhZEpTT046IGZ1bmN0aW9uKG5hbWUpIHsKCQl2YXIgdmFsdWVfanNvbiA9IHt9OwoJCXZhciB2YWx1ZV9hcnJheSA9IHRoaXMucmVhZEFycmF5KG5hbWUpOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWVfYXJyYXkubGVuZ3RoOyBpKyspIHsKCQkJaWYgKGlzc2V0KGksIHZhbHVlX2FycmF5KSkgewoJCQkJdmFsdWVfanNvblt2YWx1ZV9hcnJheVtpXV0gPSB2YWx1ZV9hcnJheVtpXTsKCQkJfQoJCX0KCQlyZXR1cm4gdmFsdWVfanNvbjsKCX0sCgoJcHJpbnRhbGw6IGZ1bmN0aW9uKCkgewoJCXZhciBhbGxDb29raWVzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7ICcpOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgYWxsQ29va2llcy5sZW5ndGg7IGkrKykgewoJCQl2YXIgY29va2llUGFpciA9IGFsbENvb2tpZXNbaV0uc3BsaXQoJz0nKTsKCQkJU0RJKCdbJyArIGNvb2tpZVBhaXJbMF0gKyAnXSBpcyAnICsgY29va2llUGFpclsxXSk7IC8vIGFzc3VtZXMgcHJpbnQgaXMgYWxyZWFkeSBkZWZpbmVkCgkJfQoJfSwKCgllcmFzZTogZnVuY3Rpb24obmFtZSkgewoJCXRoaXMuY3JlYXRlKG5hbWUsICcnLCAtMSk7CgkJdGhpcy5jb29raWVzW25hbWVdID0gdW5kZWZpbmVkOwoJfSwKCgllcmFzZUFycmF5OiBmdW5jdGlvbihuYW1lKSB7CgkJdmFyIHBhcnRfY291bnQgPSBwYXJzZUludCh0aGlzLnJlYWQoJ2NiXycgKyBuYW1lICsgJ19wYXJ0cycpLCAxMCk7CgkJaWYgKCFpc19udWxsKHBhcnRfY291bnQpKSB7CgkJCWZvciAodmFyIGkgPSAxOyBpIDw9IHBhcnRfY291bnQ7IGkrKykgewoJCQkJdGhpcy5lcmFzZSgnY2JfJyArIG5hbWUgKyAnXycgKyBpKTsKCQkJfQoJCQl0aGlzLmVyYXNlKCdjYl8nICsgbmFtZSArICdfcGFydHMnKTsKCQl9Cgl9LAoKCWVyYXNlQXJyYXlCeVBhdHRlcm46IGZ1bmN0aW9uKHBhdHRlcm4pIHsKCQlmb3IgKHZhciBuYW1lIGluIHRoaXMuY29va2llcykgewoJCQlpZiAoIWlzc2V0KG5hbWUsIHRoaXMuY29va2llcykgfHwgZW1wdHkodGhpcy5jb29raWVzW25hbWVdKSkgewoJCQkJY29udGludWU7CgkJCX0KCQkJaWYgKG5hbWUuaW5kZXhPZignY2JfJyArIHBhdHRlcm4pID09IC0xKSB7CgkJCQl0aGlzLmVyYXNlKG5hbWUpOwoJCQl9CgkJfQoJfQp9OwoKLyoqCiAqIGpRdWVyeSBDb29raWUgcGx1Z2luCiAqCiAqIENvcHlyaWdodCAoYykgMjAxMCBLbGF1cyBIYXJ0bCAoc3RpbGJ1ZXJvLmRlKQogKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgYW5kIEdQTCBsaWNlbnNlczoKICogaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHAKICogaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC5odG1sCiAqCiAqLwoKLyoqCiAqIENyZWF0ZSBhIGNvb2tpZSB3aXRoIHRoZSBnaXZlbiBrZXkgYW5kIHZhbHVlIGFuZCBvdGhlciBvcHRpb25hbCBwYXJhbWV0ZXJzLgogKgogKiBAZXhhbXBsZSAkLmNvb2tpZSgndGhlX2Nvb2tpZScsICd0aGVfdmFsdWUnKTsKICogQGRlc2MgU2V0IHRoZSB2YWx1ZSBvZiBhIGNvb2tpZS4KICogQGV4YW1wbGUgJC5jb29raWUoJ3RoZV9jb29raWUnLCAndGhlX3ZhbHVlJywgeyBleHBpcmVzOiA3LCBwYXRoOiAnLycsIGRvbWFpbjogJ2pxdWVyeS5jb20nLCBzZWN1cmU6IHRydWUgfSk7CiAqIEBkZXNjIENyZWF0ZSBhIGNvb2tpZSB3aXRoIGFsbCBhdmFpbGFibGUgb3B0aW9ucy4KICogQGV4YW1wbGUgJC5jb29raWUoJ3RoZV9jb29raWUnLCAndGhlX3ZhbHVlJyk7CiAqIEBkZXNjIENyZWF0ZSBhIHNlc3Npb24gY29va2llLgogKiBAZXhhbXBsZSAkLmNvb2tpZSgndGhlX2Nvb2tpZScsIG51bGwpOwogKiBAZGVzYyBEZWxldGUgYSBjb29raWUgYnkgcGFzc2luZyBudWxsIGFzIHZhbHVlLiBLZWVwIGluIG1pbmQgdGhhdCB5b3UgaGF2ZSB0byB1c2UgdGhlIHNhbWUgcGF0aCBhbmQgZG9tYWluCiAqICAgICAgIHVzZWQgd2hlbiB0aGUgY29va2llIHdhcyBzZXQuCiAqCiAqIEBwYXJhbSBTdHJpbmcga2V5IFRoZSBrZXkgb2YgdGhlIGNvb2tpZS4KICogQHBhcmFtIFN0cmluZyB2YWx1ZSBUaGUgdmFsdWUgb2YgdGhlIGNvb2tpZS4KICogQHBhcmFtIE9iamVjdCBvcHRpb25zIEFuIG9iamVjdCBsaXRlcmFsIGNvbnRhaW5pbmcga2V5L3ZhbHVlIHBhaXJzIHRvIHByb3ZpZGUgb3B0aW9uYWwgY29va2llIGF0dHJpYnV0ZXMuCiAqIEBvcHRpb24gTnVtYmVyfERhdGUgZXhwaXJlcyBFaXRoZXIgYW4gaW50ZWdlciBzcGVjaWZ5aW5nIHRoZSBleHBpcmF0aW9uIGRhdGUgZnJvbSBub3cgb24gaW4gZGF5cyBvciBhIERhdGUgb2JqZWN0LgogKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgYSBuZWdhdGl2ZSB2YWx1ZSBpcyBzcGVjaWZpZWQgKGUuZy4gYSBkYXRlIGluIHRoZSBwYXN0KSwgdGhlIGNvb2tpZSB3aWxsIGJlIGRlbGV0ZWQuCiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJZiBzZXQgdG8gbnVsbCBvciBvbWl0dGVkLCB0aGUgY29va2llIHdpbGwgYmUgYSBzZXNzaW9uIGNvb2tpZSBhbmQgd2lsbCBub3QgYmUgcmV0YWluZWQKICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoZW4gdGhlIHRoZSBicm93c2VyIGV4aXRzLgogKiBAb3B0aW9uIFN0cmluZyBwYXRoIFRoZSB2YWx1ZSBvZiB0aGUgcGF0aCBhdHJpYnV0ZSBvZiB0aGUgY29va2llIChkZWZhdWx0OiBwYXRoIG9mIHBhZ2UgdGhhdCBjcmVhdGVkIHRoZSBjb29raWUpLgogKiBAb3B0aW9uIFN0cmluZyBkb21haW4gVGhlIHZhbHVlIG9mIHRoZSBkb21haW4gYXR0cmlidXRlIG9mIHRoZSBjb29raWUgKGRlZmF1bHQ6IGRvbWFpbiBvZiBwYWdlIHRoYXQgY3JlYXRlZCB0aGUgY29va2llKS4KICogQG9wdGlvbiBCb29sZWFuIHNlY3VyZSBJZiB0cnVlLCB0aGUgc2VjdXJlIGF0dHJpYnV0ZSBvZiB0aGUgY29va2llIHdpbGwgYmUgc2V0IGFuZCB0aGUgY29va2llIHRyYW5zbWlzc2lvbiB3aWxsCiAqICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWlyZSBhIHNlY3VyZSBwcm90b2NvbCAobGlrZSBIVFRQUykuCiAqIEB0eXBlIHVuZGVmaW5lZAogKgogKiBAbmFtZSAkLmNvb2tpZQogKiBAY2F0IFBsdWdpbnMvQ29va2llCiAqIEBhdXRob3IgS2xhdXMgSGFydGwva2xhdXMuaGFydGxAc3RpbGJ1ZXJvLmRlCiAqLwoKLyoqCiAqIEdldCB0aGUgdmFsdWUgb2YgYSBjb29raWUgd2l0aCB0aGUgZ2l2ZW4ga2V5LgogKgogKiBAZXhhbXBsZSAkLmNvb2tpZSgndGhlX2Nvb2tpZScpOwogKiBAZGVzYyBHZXQgdGhlIHZhbHVlIG9mIGEgY29va2llLgogKgogKiBAcGFyYW0gU3RyaW5nIGtleSBUaGUga2V5IG9mIHRoZSBjb29raWUuCiAqIEByZXR1cm4gVGhlIHZhbHVlIG9mIHRoZSBjb29raWUuCiAqIEB0eXBlIFN0cmluZwogKgogKiBAbmFtZSAkLmNvb2tpZQogKiBAY2F0IFBsdWdpbnMvQ29va2llCiAqIEBhdXRob3IgS2xhdXMgSGFydGwva2xhdXMuaGFydGxAc3RpbGJ1ZXJvLmRlCiAqLwpqUXVlcnkuY29va2llID0gZnVuY3Rpb24gKGtleSwgdmFsdWUsIG9wdGlvbnMpIHsKCS8vIGtleSBhbmQgdmFsdWUgZ2l2ZW4sIHNldCBjb29raWUuLi4KCWlmIChhcmd1bWVudHMubGVuZ3RoID4gMSAmJiAodmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlICE9PSAnb2JqZWN0JykpIHsKCQlvcHRpb25zID0galF1ZXJ5LmV4dGVuZCh7fSwgb3B0aW9ucyk7CgoJCWlmICh2YWx1ZSA9PT0gbnVsbCkgewoJCQlvcHRpb25zLmV4cGlyZXMgPSAtMTsKCQl9CgoJCWlmICh0eXBlb2Ygb3B0aW9ucy5leHBpcmVzID09PSAnbnVtYmVyJykgewoJCQl2YXIgZGF5cyA9IG9wdGlvbnMuZXhwaXJlcywgdCA9IG9wdGlvbnMuZXhwaXJlcyA9IG5ldyBEYXRlKCk7CgkJCXQuc2V0RGF0ZSh0LmdldERhdGUoKSArIGRheXMpOwoJCX0KCgkJcmV0dXJuIChkb2N1bWVudC5jb29raWUgPSBbCgkJCWVuY29kZVVSSUNvbXBvbmVudChrZXkpLCAnPScsCgkJCW9wdGlvbnMucmF3ID8gU3RyaW5nKHZhbHVlKSA6IGVuY29kZVVSSUNvbXBvbmVudChTdHJpbmcodmFsdWUpKSwKCQkJb3B0aW9ucy5leHBpcmVzID8gJzsgZXhwaXJlcz0nICsgb3B0aW9ucy5leHBpcmVzLnRvVVRDU3RyaW5nKCkgOiAnJywgLy8gdXNlIGV4cGlyZXMgYXR0cmlidXRlLCBtYXgtYWdlIGlzIG5vdCBzdXBwb3J0ZWQgYnkgSUUKCQkJb3B0aW9ucy5wYXRoID8gJzsgcGF0aD0nICsgb3B0aW9ucy5wYXRoIDogJycsCgkJCW9wdGlvbnMuZG9tYWluID8gJzsgZG9tYWluPScgKyBvcHRpb25zLmRvbWFpbiA6ICcnLAoJCQlvcHRpb25zLnNlY3VyZSA/ICc7IHNlY3VyZScgOiAnJwoJCV0uam9pbignJykpOwoJfQoKCS8vIGtleSBhbmQgcG9zc2libHkgb3B0aW9ucyBnaXZlbiwgZ2V0IGNvb2tpZS4uLgoJb3B0aW9ucyA9IHZhbHVlIHx8IHt9OwoJdmFyIHJlc3VsdCwgZGVjb2RlID0gb3B0aW9ucy5yYXcgPyBmdW5jdGlvbiAocykgeyByZXR1cm4gczsgfSA6IGRlY29kZVVSSUNvbXBvbmVudDsKCXJldHVybiAocmVzdWx0ID0gbmV3IFJlZ0V4cCgnKD86Xnw7ICknICsgZW5jb2RlVVJJQ29tcG9uZW50KGtleSkgKyAnPShbXjtdKiknKS5leGVjKGRvY3VtZW50LmNvb2tpZSkpID8gZGVjb2RlKHJlc3VsdFsxXSkgOiBudWxsOwp9OwoKLyoKKiogWmFiYml4CioqIENvcHlyaWdodCAoQykgMjAwMC0yMDExIFphYmJpeCBTSUEKKioKKiogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKKiogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKKiogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMiBvZiB0aGUgTGljZW5zZSwgb3IKKiogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KKioKKiogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCioqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCioqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKKiogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKioKKiogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKKiogYWxvbmcgd2l0aCB0aGlzIHByb2dyYW07IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKKiogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAgMDIxMTAtMTMwMSwgVVNBLgoqKi8KCgp2YXIgQ3VybCA9IENsYXNzLmNyZWF0ZSgpOwpDdXJsLnByb3RvdHlwZSA9IHsKCgl1cmw6CQknJywgLy8gYWN0dWFsbHksIGl0J3MgZGVwcmVjYXRlZC9wcml2YXRlIHZhcmlhYmxlCglwb3J0OgkJLTEsCglob3N0OgkJJycsCglwcm90b2NvbDoJJycsCgl1c2VybmFtZToJJycsCglwYXNzd29yZDoJJycsCglmaWxyOgkJJycsCglyZWZlcmVuY2U6CScnLAoJcGF0aDoJCScnLAoJcXVlcnk6CQknJywKCWFyZ3M6CQludWxsLAoKCWluaXRpYWxpemU6IGZ1bmN0aW9uKHVybCkgewoJCXVybCA9IHVybCB8fCBsb2NhdGlvbi5ocmVmOwoKCQl0aGlzLnVybCA9IHVybDsKCQl0aGlzLmFyZ3MgPSB7fTsKCgkJdGhpcy5xdWVyeSA9ICh0aGlzLnVybC5pbmRleE9mKCc/JykgPj0gMCkgPyB0aGlzLnVybC5zdWJzdHJpbmcodGhpcy51cmwuaW5kZXhPZignPycpICsgMSkgOiAnJzsKCQlpZiAodGhpcy5xdWVyeS5pbmRleE9mKCcjJykgPj0gMCkgewoJCQl0aGlzLnF1ZXJ5ID0gdGhpcy5xdWVyeS5zdWJzdHJpbmcoMCwgdGhpcy5xdWVyeS5pbmRleE9mKCcjJykpOwoJCX0KCgkJdmFyIHByb3RvY29sU2VwSW5kZXggPSB0aGlzLnVybC5pbmRleE9mKCc6Ly8nKTsKCQlpZiAocHJvdG9jb2xTZXBJbmRleCA+PSAwKSB7CgkJCXRoaXMucHJvdG9jb2wgPSB0aGlzLnVybC5zdWJzdHJpbmcoMCwgcHJvdG9jb2xTZXBJbmRleCkudG9Mb3dlckNhc2UoKTsKCQkJdGhpcy5ob3N0ID0gdGhpcy51cmwuc3Vic3RyaW5nKHByb3RvY29sU2VwSW5kZXggKyAzKTsKCgkJCWlmICh0aGlzLmhvc3QuaW5kZXhPZignLycpID49IDApIHsKCQkJCXRoaXMuaG9zdCA9IHRoaXMuaG9zdC5zdWJzdHJpbmcoMCwgdGhpcy5ob3N0LmluZGV4T2YoJy8nKSk7CgkJCX0KCgkJCXZhciBhdEluZGV4ID0gdGhpcy5ob3N0LmluZGV4T2YoJ0AnKTsKCQkJaWYgKGF0SW5kZXggPj0gMCkgewoJCQkJdmFyIGNyZWRlbnRpYWxzID0gdGhpcy5ob3N0LnN1YnN0cmluZygwLCBhdEluZGV4KTsKCQkJCXZhciBjb2xvbkluZGV4ID0gY3JlZGVudGlhbHMuaW5kZXhPZignOicpOwoKCQkJCWlmIChjb2xvbkluZGV4ID49IDApIHsKCQkJCQl0aGlzLnVzZXJuYW1lID0gY3JlZGVudGlhbHMuc3Vic3RyaW5nKDAsIGNvbG9uSW5kZXgpOwoJCQkJCXRoaXMucGFzc3dvcmQgPSBjcmVkZW50aWFscy5zdWJzdHJpbmcoY29sb25JbmRleCk7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQl0aGlzLnVzZXJuYW1lID0gY3JlZGVudGlhbHM7CgkJCQl9CgkJCQl0aGlzLmhvc3QgPSB0aGlzLmhvc3Quc3Vic3RyaW5nKGF0SW5kZXggKyAxKTsKCQkJfQoKCQkJdmFyIGhvc3RfaXB2NiA9IHRoaXMuaG9zdC5pbmRleE9mKCddJyk7CgkJCWlmIChob3N0X2lwdjYgPj0gMCkgewoJCQkJaWYgKGhvc3RfaXB2NiA8ICh0aGlzLmhvc3QubGVuZ3RoIC0gMSkpIHsKCQkJCQlob3N0X2lwdjYrKzsKCQkJCQl2YXIgaG9zdF9sZXNzID0gdGhpcy5ob3N0LnN1YnN0cmluZyhob3N0X2lwdjYpOwoKCQkJCQl2YXIgcG9ydENvbG9uSW5kZXggPSBob3N0X2xlc3MuaW5kZXhPZignOicpOwoJCQkJCWlmIChwb3J0Q29sb25JbmRleCA+PSAwKSB7CgkJCQkJCXRoaXMucG9ydCA9IGhvc3RfbGVzcy5zdWJzdHJpbmcocG9ydENvbG9uSW5kZXggKyAxKTsKCQkJCQkJdGhpcy5ob3N0ID0gdGhpcy5ob3N0LnN1YnN0cmluZygwLCBob3N0X2lwdjYpOwoJCQkJCX0KCQkJCX0KCQkJfQoJCQllbHNlIHsKCQkJCXZhciBwb3J0Q29sb25JbmRleCA9IHRoaXMuaG9zdC5pbmRleE9mKCc6Jyk7CgkJCQlpZiAocG9ydENvbG9uSW5kZXggPj0gMCkgewoJCQkJCXRoaXMucG9ydCA9IHRoaXMuaG9zdC5zdWJzdHJpbmcocG9ydENvbG9uSW5kZXggKyAxKTsKCQkJCQl0aGlzLmhvc3QgPSB0aGlzLmhvc3Quc3Vic3RyaW5nKDAsIHBvcnRDb2xvbkluZGV4KTsKCQkJCX0KCQkJfQoJCQl0aGlzLmZpbGUgPSB0aGlzLnVybC5zdWJzdHJpbmcocHJvdG9jb2xTZXBJbmRleCArIDMpOwoJCQl0aGlzLmZpbGUgPSB0aGlzLmZpbGUuc3Vic3RyaW5nKHRoaXMuZmlsZS5pbmRleE9mKCcvJykpOwoKCQkJaWYgKHRoaXMuZmlsZSA9PSB0aGlzLmhvc3QpIHsKCQkJCXRoaXMuZmlsZSA9ICcnOwoJCQl9CgkJfQoJCWVsc2UgewoJCQl0aGlzLmZpbGUgPSB0aGlzLnVybDsKCQl9CgoJCWlmICh0aGlzLmZpbGUuaW5kZXhPZignPycpID49IDApIHsKCQkJdGhpcy5maWxlID0gdGhpcy5maWxlLnN1YnN0cmluZygwLCB0aGlzLmZpbGUuaW5kZXhPZignPycpKTsKCQl9CgoJCXZhciByZWZTZXBJbmRleCA9IHRoaXMuZmlsZS5pbmRleE9mKCcjJyk7CgkJaWYgKHJlZlNlcEluZGV4ID49IDApIHsKCQkJdGhpcy5yZWZlcmVuY2UgPSB0aGlzLmZpbGUuc3Vic3RyaW5nKHJlZlNlcEluZGV4ICsgMSk7CgkJCXRoaXMuZmlsZSA9IHRoaXMuZmlsZS5zdWJzdHJpbmcoMCwgcmVmU2VwSW5kZXgpOwoJCX0KCgkJdGhpcy5wYXRoID0gdGhpcy5maWxlOwoJCWlmICh0aGlzLnF1ZXJ5Lmxlbmd0aCA+IDApIHsKCQkJdGhpcy5maWxlICs9ICc/JyArIHRoaXMucXVlcnk7CgkJfQoJCWlmICh0aGlzLnF1ZXJ5Lmxlbmd0aCA+IDApIHsKCQkJdGhpcy5mb3JtYXRBcmd1bWVudHMoKTsKCQl9CgoJCXRoaXMuYWRkU0lEKCk7Cgl9LAoKCWFkZFNJRDogZnVuY3Rpb24oKSB7CgkJdmFyIHNpZCA9ICcnOwoJCXZhciBwb3NzaXRpb24gPSBwYXJzZUludChsb2NhdGlvbi5ocmVmLmluZGV4T2YoJ3NpZD0nKSk7CgoJCWlmIChwb3NzaXRpb24gPiAtMSkgewoJCQlzaWQgPSBsb2NhdGlvbi5ocmVmLnN1YnN0cihwb3NzaXRpb24gKyA0LCAxNik7CgkJfQoJCWVsc2UgewoJCQlzaWQgPSBjb29raWUucmVhZCgnemJ4X3Nlc3Npb25pZCcpOwoJCQlpZiAoIWlzX251bGwoc2lkKSkgewoJCQkJc2lkID0gc2lkLnN1YnN0cigxNiwgMTYpOwoJCQl9CgkJfQoKCQlpZiAoKC9bXGRhLXpdezE2fS9pKS50ZXN0KHNpZCkpIHsKCQkJdGhpcy5zZXRBcmd1bWVudCgnc2lkJywgc2lkKTsKCQl9Cgl9LAoKCWZvcm1hdFF1ZXJ5OiBmdW5jdGlvbigpIHsKCQlpZiAodGhpcy5hcmdzLmxlbmdodCA8IDEpIHsKCQkJcmV0dXJuOwoJCX0KCgkJdmFyIHF1ZXJ5ID0gW107CgkJZm9yICh2YXIga2V5IGluIHRoaXMuYXJncykgewoJCQlpZiAodHlwZW9mKHRoaXMuYXJnc1trZXldKSAhPSAndW5kZWZpbmVkJyAmJiAhaXNfbnVsbCh0aGlzLmFyZ3Nba2V5XSkpIHsKCQkJCXF1ZXJ5LnB1c2goa2V5ICsgJz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuYXJnc1trZXldKSk7CgkJCX0KCQl9CgkJdGhpcy5xdWVyeSA9IHF1ZXJ5LmpvaW4oJyYnKTsKCX0sCgoJZm9ybWF0QXJndW1lbnRzOiBmdW5jdGlvbigpIHsKCQl0aGlzLmFyZ3MgPSB7fTsKCQl2YXIgYXJncyA9IHRoaXMucXVlcnkuc3BsaXQoJyYnKTsKCQl2YXIga2V5dmFsID0gJyc7CgoJCWlmIChhcmdzLmxlbmd0aCA8IDEpIHsKCQkJcmV0dXJuOwoJCX0KCgkJZm9yICh2YXIgaSA9IDA7IGkgPCBhcmdzLmxlbmd0aDsgaSsrKSB7CgkJCWtleXZhbCA9IGFyZ3NbaV0uc3BsaXQoJz0nKTsKCQkJaWYgKGtleXZhbC5sZW5ndGggPiAxKSB7CgkJCQl0cnkgewoJCQkJCXZhciB0bXAgPSBrZXl2YWxbMV0ucmVwbGFjZSgvXCsvZywgJyUyMCcpOwoJCQkJCXRoaXMuYXJnc1trZXl2YWxbMF1dID0gZGVjb2RlVVJJQ29tcG9uZW50KHRtcCk7CgkJCQl9CgkJCQljYXRjaChleGMpIHsKCQkJCQl0aGlzLmFyZ3Nba2V5dmFsWzBdXSA9IGtleXZhbFsxXTsKCQkJCX0KCQkJfQoJCQllbHNlIHsKCQkJCXRoaXMuYXJnc1trZXl2YWxbMF1dID0gJyc7CgkJCX0KCQl9Cgl9LAoKCXNldEFyZ3VtZW50OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7CgkJdGhpcy5hcmdzW2tleV0gPSB2YWx1ZTsKCQl0aGlzLmZvcm1hdFF1ZXJ5KCk7Cgl9LAoKCXVuc2V0QXJndW1lbnQ6IGZ1bmN0aW9uKGtleSkgewoJCWRlbGV0ZSh0aGlzLmFyZ3Nba2V5XSk7CgkJdGhpcy5mb3JtYXRRdWVyeSgpOwoJfSwKCglnZXRBcmd1bWVudDogZnVuY3Rpb24oa2V5KSB7CgkJaWYgKHR5cGVvZih0aGlzLmFyZ3Nba2V5XSkgIT0gJ3VuZGVmaW5lZCcpIHsKCQkJcmV0dXJuIHRoaXMuYXJnc1trZXldOwoJCX0KCQllbHNlIHsKCQkJcmV0dXJuIG51bGw7CgkJfQoJfSwKCglnZXRBcmd1bWVudHM6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLmFyZ3M7Cgl9LAoKCWdldFVybDogZnVuY3Rpb24oKSB7CgkJdGhpcy5mb3JtYXRRdWVyeSgpOwoKCQl2YXIgdXJsID0gdGhpcy5wcm90b2NvbC5sZW5ndGggPiAwID8gdGhpcy5wcm90b2NvbCArICc6Ly8nIDogJyc7CgkJdXJsICs9ICB0aGlzLnVzZXJuYW1lLmxlbmd0aCA+IDAgPyBlbmNvZGVVUkkodGhpcy51c2VybmFtZSkgOiAnJzsKCQl1cmwgKz0gIHRoaXMucGFzc3dvcmQubGVuZ3RoID4gMCA/IGVuY29kZVVSSSgnOicgKyB0aGlzLnBhc3N3b3JkKSA6ICcnOwoJCXVybCArPSAgdGhpcy5ob3N0Lmxlbmd0aCA+IDAgPyB0aGlzLmhvc3QgOiAnJzsKCQl1cmwgKz0gIHRoaXMucG9ydC5sZW5ndGggPiAwID8gJzonICsgdGhpcy5wb3J0IDogJyc7CgkJdXJsICs9ICB0aGlzLnBhdGgubGVuZ3RoID4gMCA/IGVuY29kZVVSSSh0aGlzLnBhdGgpIDogJyc7CgkJdXJsICs9ICB0aGlzLnF1ZXJ5Lmxlbmd0aCA+IDAgPyAnPycgKyB0aGlzLnF1ZXJ5IDogJyc7CgkJdXJsICs9ICB0aGlzLnJlZmVyZW5jZS5sZW5ndGggPiAwID8gZW5jb2RlVVJJKCcjJyArIHRoaXMucmVmZXJlbmNlKSA6ICcnOwoKCQlyZXR1cm4gdXJsOwoJfSwKCglzZXRQb3J0OiBmdW5jdGlvbihwb3J0KSB7CgkJdGhpcy5wb3J0ID0gcG9ydDsKCX0sCgoJZ2V0UG9ydDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMucG9ydDsKCX0sCgoJc2V0UXVlcnk6IGZ1bmN0aW9uKHF1ZXJ5KSB7CgkJdGhpcy5xdWVyeSA9IHF1ZXJ5OwoKCQlpZiAodGhpcy5xdWVyeS5pbmRleE9mKCc/JykgPj0gMCkgewoJCQl0aGlzLnF1ZXJ5ID0gdGhpcy5xdWVyeS5zdWJzdHJpbmcodGhpcy5xdWVyeS5pbmRleE9mKCc/JykgKyAxKTsKCQl9CgoJCXRoaXMuZm9ybWF0QXJndW1lbnRzKCk7CgkJdGhpcy5hZGRTSUQoKTsKCX0sCgoJZ2V0UXVlcnk6IGZ1bmN0aW9uKCkgewoJCXRoaXMuZm9ybWF0UXVlcnkoKTsKCQlyZXR1cm4gdGhpcy5xdWVyeTsKCX0sCgoJLy8gcmV0dXJucyB0aGUgcHJvdG9jb2wgb2YgdGhpcyB1cmwsIGkuZS4gJ2h0dHAnIGluIHRoZSB1cmwgJ2h0dHA6Ly9zZXJ2ZXIvJwoJZ2V0UHJvdG9jb2w6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLnByb3RvY29sOwoJfSwKCglzZXRQcm90b2NvbDogZnVuY3Rpb24ocHJvdG9jb2wpIHsKCQl0aGlzLnByb3RvY29sID0gcHJvdG9jb2w7Cgl9LAoKCS8vIHJldHVybnMgdGhlIGhvc3QgbmFtZSBvZiB0aGlzIHVybCwgaS5lLiAnc2VydmVyLmNvbScgaW4gdGhlIHVybCAnaHR0cDovL3NlcnZlci5jb20vJwoJZ2V0SG9zdDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuaG9zdDsKCX0sCgoJc2V0SG9zdDogZnVuY3Rpb24oaG9zdCkgewoJCXRoaXMuaG9zdCA9IGhvc3Q7Cgl9LAoKCS8vIHJldHVybnMgdGhlIHVzZXIgbmFtZSBwYXJ0IG9mIHRoaXMgdXJsLCBpLmUuICdqb2UnIGluIHRoZSB1cmwgJ2h0dHA6Ly9qb2VAc2VydmVyLmNvbS8nCglnZXRVc2VyTmFtZTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMudXNlcm5hbWU7Cgl9LAoKCXNldFVzZXJOYW1lOiBmdW5jdGlvbih1c2VybmFtZSkgewoJCXRoaXMudXNlcm5hbWUgPSB1c2VybmFtZTsKCX0sCgoJLy8gcmV0dXJucyB0aGUgcGFzc3dvcmQgcGFydCBvZiB0aGlzIHVybCwgaS5lLiAnc2VjcmV0JyBpbiB0aGUgdXJsICdodHRwOi8vam9lOnNlY3JldEBzZXJ2ZXIuY29tLycKCWdldFBhc3N3b3JkOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5wYXNzd29yZDsKCX0sCgoJc2V0UGFzc3dvcmQ6IGZ1bmN0aW9uKHBhc3N3b3JkKSB7CgkJdGhpcy5wYXNzd29yZCA9IHBhc3N3b3JkOwoJfSwKCgkvLyByZXR1cm5zIHRoZSBmaWxlIHBhcnQgb2YgdGhpcyB1cmwsIGkuZS4gZXZlcnl0aGluZyBhZnRlciB0aGUgaG9zdCBuYW1lLgoJZ2V0RmlsZTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZmlsZTsKCX0sCgoJLy8gcmV0dXJucyB0aGUgcmVmZXJlbmNlIG9mIHRoaXMgdXJsLCBpLmUuICdib29rbWFyaycgaW4gdGhlIHVybCAnaHR0cDovL3NlcnZlci9maWxlLmh0bWwjYm9va21hcmsnCglnZXRSZWZlcmVuY2U6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLnJlZmVyZW5jZTsKCX0sCgoJc2V0UmVmZXJlbmNlOiBmdW5jdGlvbihyZWZlcmVuY2UpIHsKCQl0aGlzLnJlZmVyZW5jZSA9IHJlZmVyZW5jZTsKCX0sCgoJLy8gcmV0dXJucyB0aGUgZmlsZSBwYXRoIG9mIHRoaXMgdXJsLCBpLmUuICcvZGlyL2ZpbGUuaHRtbCcgaW4gdGhlIHVybCAnaHR0cDovL3NlcnZlci9kaXIvZmlsZS5odG1sJwoJZ2V0UGF0aDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMucGF0aDsKCX0sCgoJc2V0UGF0aDogZnVuY3Rpb24ocGF0aCkgewoJCXRoaXMucGF0aCA9IHBhdGg7Cgl9Cn07CgovKgoqKiBaYWJiaXgKKiogQ29weXJpZ2h0IChDKSAyMDAwLTIwMTIgWmFiYml4IFNJQQoqKgoqKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQoqKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQoqKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAyIG9mIHRoZSBMaWNlbnNlLCBvcgoqKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoqKgoqKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKKiogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKiogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQoqKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoqKgoqKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQoqKiBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQoqKiBGb3VuZGF0aW9uLCBJbmMuLCA1MSBGcmFua2xpbiBTdHJlZXQsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BICAwMjExMC0xMzAxLCBVU0EuCioqLwoKdmFyIFJQQyA9IHsKCSdfcnBjdXJsJzogJ2pzcnBjLnBocD9vdXRwdXQ9anNvbi1ycGMnLCAvLyBycGMgdXJsCgknX2NhbGxpZCc6IDAsIC8vIHJwYyByZXF1ZXN0IGlkCgknX2F1dGgnOiBudWxsLCAvLyBhdXRoZW50aWNhdGlvbiBoYXNoCgoJYXV0aDogZnVuY3Rpb24oYXV0aF8pIHsKCQlpZiAoaXNfbnVsbCh0aGlzLl9hdXRoKSkgewoJCQl0aGlzLl9hdXRoID0gY29va2llLnJlYWQoJ3pieF9zZXNzaW9uaWQnKTsKCQl9CgoJCWlmICgndW5kZWZpbmVkJyA9PSB0eXBlb2YodXJsXykpIHsKCQkJcmV0dXJuIHRoaXMuX2F1dGg7CgkJfQoJCWVsc2UgewoJCQl0aGlzLl9hdXRoID0gYXV0aF87CgkJfQoJfSwKCgljYWxsaWQ6IGZ1bmN0aW9uKCkgewoJCXRoaXMuX2NhbGxpZCsrOwoJCXJldHVybiB0aGlzLl9jYWxsaWQ7Cgl9LAoKCXJwY3VybDogZnVuY3Rpb24ocnBjdXJsXykgewoJCWlmICgndW5kZWZpbmVkJyA9PSB0eXBlb2YocnBjdXJsXykpIHsKCQkJcmV0dXJuIHRoaXMuX3JwY3VybDsKCQl9CgkJZWxzZSB7CgkJCXRoaXMuX3JwY3VybCA9IHJwY3VybF87CgkJfQoJfQp9OwoKUlBDLkJhc2UgPSBDbGFzcy5jcmVhdGUoewoJJ3VzZXJQYXJhbXMnOgl7fSwJCS8vIHVzZXIgT1B0aW9ucwoJJ2F1dGgnOgkJCW51bGwsCS8vIGF1dGhlbnRpY2F0aW9uIGhhc2gKCSdjYWxsaWQnOgkJMCwJCS8vIHJwYyByZXF1ZXN0IGlkCgknZGVidWdfc3RhdHVzJzoJMCwJCS8vIGRlYnVnIHN0YXR1czogMCAtIG9mZiwgMSAtIG9uLCAyIC0gU0RJOwoJJ2RlYnVnX2luZm8nOgknJywJCS8vIGRlYnVnIHN0cmluZwoJJ2RlYnVnX3ByZXYnOgknJywJCS8vIGRvbid0IGxvZyByZXBlYXRlZCBmbmMKCglpbml0aWFsaXplOiBmdW5jdGlvbih1c2VyUGFyYW1zKSB7CgkJdGhpcy51c2VyUGFyYW1zID0gewoJCQknbWV0aG9kJzogbnVsbCwKCQkJJ3BhcmFtcyc6IHt9LAoJCQknbm90aWZpY2F0aW9uJzogMCwKCQkJJ3JlcXVlc3QnOiB7fSwKCQkJJ29uU3VjY2Vzcyc6IGZ1bmN0aW9uKCkge30sCgkJCSdvbkZhaWx1cmUnOiBmdW5jdGlvbigpIHt9CgkJfTsKCgkJT2JqZWN0LmV4dGVuZCh0aGlzLnVzZXJQYXJhbXMsIHVzZXJQYXJhbXMgfHwge30pOwoKCQl0aGlzLmNhbGxpZCA9IFJQQy5jYWxsaWQoKTsKCQl0aGlzLmF1dGggPSBSUEMuYXV0aCgpOwoJfSwKCglkZWJ1ZzogZnVuY3Rpb24oZm5jX25hbWUsIGlkKSB7CgkJaWYgKHRoaXMuZGVidWdfc3RhdHVzKSB7CgkJCXZhciBzdHIgPSAnUlBDLkNhbGxbJyArIFJQQy5pZCArICddLicgKyBmbmNfbmFtZTsKCQkJaWYgKHR5cGVvZihpZCkgIT0gJ3VuZGVmaW5lZCcpIHsKCQkJCXN0ciArPSAnIDonICsgaWQ7CgkJCX0KCgkJCXRoaXMuZGVidWdfaW5mbyArPSBzdHIgKyAnXG4nOwoKCQkJaWYgKHRoaXMuZGVidWdfc3RhdHVzID09IDIpIHsKCQkJCVNESShzdHIpOwoJCQl9CgoJCQl0aGlzLmRlYnVnX3ByZXYgPSBzdHI7CgkJfQoJfQp9KTsKClJQQy5DYWxsID0gQ2xhc3MuY3JlYXRlKFJQQy5CYXNlLCB7Cglpbml0aWFsaXplOiBmdW5jdGlvbigkc3VwZXIsIHVzZXJQYXJhbXMpIHsKCQkkc3VwZXIodXNlclBhcmFtcyk7CgkJdGhpcy5jYWxsKCk7Cgl9LAoKCWNhbGw6IGZ1bmN0aW9uKCkgewoJCXRoaXMuZGVidWcoJ2NhbGwnKTsKCgkJdmFyIGhlYWRlciA9IHsKCQkJJ0NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uLXJwYycKCQl9OwoKCQl2YXIgYm9keSA9IHsKCQkJJ2pzb25ycGMnOiAnMi4wJywKCQkJJ21ldGhvZCc6IHRoaXMudXNlclBhcmFtcy5tZXRob2QsCgkJCSdwYXJhbXMnOiB0aGlzLnVzZXJQYXJhbXMucGFyYW1zLAoJCQknYXV0aCc6IHRoaXMuYXV0aAoJCX07CgoJCXZhciByZXF1ZXN0ID0gewoJCQkncmVxdWVzdEhlYWRlcnMnOiBoZWFkZXIKCQl9OwoKCQlpZiAodGhpcy51c2VyUGFyYW1zLm5vdGlmaWNhdGlvbiA9PSAwKSB7CgkJCWJvZHkuaWQgPSB0aGlzLmNhbGxpZDsKCQkJcmVxdWVzdC5vblN1Y2Nlc3MgPSB0aGlzLnByb2Nlc3NSZXNwb25kLmJpbmQodGhpcyk7CgkJCXJlcXVlc3Qub25GYWlsdXJlID0gdGhpcy5wcm9jZXNzRXJyb3IuYmluZCh0aGlzKTsKCQl9CgoJCU9iamVjdC5leHRlbmQocmVxdWVzdCwgdGhpcy51c2VyUGFyYW1zLnJlcXVlc3QpOwoJCXJlcXVlc3QucG9zdEJvZHkgPSBPYmplY3QudG9KU09OKGJvZHkpLAoKCQluZXcgQWpheC5SZXF1ZXN0KFJQQy5ycGN1cmwoKSwgcmVxdWVzdCk7Cgl9LAoKCXByb2Nlc3NSZXNwb25kOiBmdW5jdGlvbihyZXNwKXsKCQl0aGlzLmRlYnVnKCdwcm9jZXNzUmVzcG9uZCcpOwoKCQl2YXIgaXNFcnJvciA9IHRoaXMucHJvY2Vzc0Vycm9yKHJlc3ApOwoJCWlmIChpc0Vycm9yKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCWlmIChpc3NldCgnb25TdWNjZXNzJywgdGhpcy51c2VyUGFyYW1zKSkgewoJCQl0aGlzLnVzZXJQYXJhbXMub25TdWNjZXNzKHJlc3AucmVzcG9uc2VKU09OLnJlc3VsdCk7CgkJfQoKCQlyZXR1cm4gdHJ1ZTsKCX0sCgoJcHJvY2Vzc0Vycm9yOiBmdW5jdGlvbihyZXNwKSB7CgkJdGhpcy5kZWJ1ZygnZXJyb3InKTsKCgkJLy8ganNvbiByZXF1ZXN0IGZhaWxlZCBvciBzZXJ2ZXIgcmVzcG9uZGVkIHdpdGggaW5jb3JyZWN0IGpzb24KCQlpZiAoaXNfbnVsbChyZXNwKSB8fCAhaXNzZXQoJ3Jlc3BvbnNlSlNPTicsIHJlc3ApKSB7CgkJCXRocm93KCdSUEMgY2FsbCBbJyArIHRoaXMudXNlclBhcmFtcy5tZXRob2QgKyAnXSByZXF1ZXN0IGZhaWxlZCcpOwoJCX0KCgkJLy8ganNvbiBoYXZlIHdyb25nIGhlYWRlciBvciBubyByZXNwb25kIGF0IGFsbAoJCWlmIChlbXB0eShyZXNwLnJlc3BvbnNlSlNPTikpIHsKCQkJdGhyb3coJ1JQQzogU2VydmVyIGNhbGwgWycgKyB0aGlzLnVzZXJQYXJhbXMubWV0aG9kICsgJ10gcmVzcG9uZGVkIHdpdGggaW5jb3JyZWN0IEpTT04uJyk7CgkJfQoKCQkvLyBycGMgcmVzcG9uZGVkIHdpdGggZXJyb3IgfHwgd2l0aCBpbmNvcnJlY3QganNvbgoJCWlmIChpc3NldCgnZXJyb3InLCByZXNwLnJlc3BvbnNlSlNPTikgJiYgaXNzZXQoJ29uRmFpbHVyZScsIHRoaXMudXNlclBhcmFtcykpIHsKCQkJdGhpcy51c2VyUGFyYW1zLm9uRmFpbHVyZShyZXNwLnJlc3BvbnNlSlNPTi5lcnJvcik7CgkJCXJldHVybiB0cnVlOwoJCX0KCQllbHNlIGlmICghaXNzZXQoJ3Jlc3VsdCcsIHJlc3AucmVzcG9uc2VKU09OKSkgewoJCQl0aHJvdygnUlBDOiBTZXJ2ZXIgY2FsbCBbJyArIHRoaXMudXNlclBhcmFtcy5tZXRob2QgKyAnXSByZXNwb25kZWQgd2l0aCBpbmNvcnJlY3QgSlNPTi4nKTsKCQl9CgoJCXJldHVybiBmYWxzZTsKCX0KfSk7CgovKgoqKiBaYWJiaXgKKiogQ29weXJpZ2h0IChDKSAyMDAwLTIwMTEgWmFiYml4IFNJQQoqKgoqKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQoqKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQoqKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAyIG9mIHRoZSBMaWNlbnNlLCBvcgoqKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoqKgoqKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKKiogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKiogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQoqKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoqKgoqKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQoqKiBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQoqKiBGb3VuZGF0aW9uLCBJbmMuLCA1MSBGcmFua2xpbiBTdHJlZXQsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BICAwMjExMC0xMzAxLCBVU0EuCioqLwoKCnZhciBCQkNvZGUgPSB7CglvcGVudGFnczogbnVsbCwgLy8gb3BlbiB0YWcgc3RhY2sKCWNybGYyYnI6IG51bGwsIC8vIGNvbnZlcnQgQ1JMRiB0byA8YnI+PwoJbm9wYXJzZTogbnVsbCwgLy8gaWdub3JlIEJCQ29kZSB0YWdzPwoJdXJsc3RhcnQ6IG51bGwsIC8vIGJlZ2lubmluZyBvZiB0aGUgVVJMIGlmIHplcm8gb3IgZ3JlYXRlciAoaWdub3JlZCBpZiAtMSkKCglSRTogewoJCSdiYmNvZGUnOiAvXlwvPyg/OmJ8aXx1fHByZXxjb2RlfGNvbG9yfHNpemV8bm9wYXJzZXx1cmwpJC8sIC8vIEJCY29kZSB0YWdzCgkJJ2NvbG9yJzogL14oOj8jKD86WzAtOWEtZl17M30pP1swLTlhLWZdezN9KSQvaSwgLy8gY29sb3IgbmFtZXMgb3IgaGV4IGNvbG9yCgkJJ3VyaSc6IC9eWy07XC9cPzpAJj1cK1wkLF9cLiF+XConXChcKSUwLTlhLXpdezEsNTEyfSQvaSwgLy8gcmVzZXJ2ZWQsIHVucmVzZXJ2ZWQsIGVzY2FwZWQgYW5kIGFscGhhLW51bWVyaWMgW1JGQzIzOTZdCgkJJ2Zvcm1hdCc6IC8oW1xyXG5dKXwoPzpcWyhbYS16XXsxLDE2fSkoPzo9KFteXHgwMC1ceDFGJydcKFwpPD5cW1xdXXsxLDI1Nn0pKT9cXSl8KD86XFtcLyhbYS16XXsxLDE2fSlcXSkvaWcgLy8gbWFpbiByZWd1bGFyIGV4cHJlc3Npb246IENSTEYsIFt0YWc9b3B0aW9uXSwgW3RhZ10gb3IgWy90YWddCgl9LAoKCS8vIHBvc3QgbXVzdCBiZSBIVE1MLWVuY29kZWQKCVBhcnNlOiBmdW5jdGlvbihwb3N0KSB7CgkJdGhpcy5jcmxmMmJyID0gZmFsc2U7CgkJdGhpcy5ub3BhcnNlID0gZmFsc2U7CgkJdGhpcy51cmxzdGFydCA9IC0xOwoJCXRoaXMub3BlbnRhZ3MgPSBbXTsKCgkJdmFyIHJlc3VsdCA9IHBvc3QucmVwbGFjZSh0aGlzLlJFLmZvcm1hdCwgdGhpcy50b0h0bWwuYmluZCh0aGlzKSk7CgoJCWlmICh0aGlzLm9wZW50YWdzLmxlbmd0aCkgewoJCQl2YXIgZW5kdGFncyA9ICcnOwoKCQkJaWYgKHRoaXMub3BlbnRhZ3NbdGhpcy5vcGVudGFncy5sZW5ndGgtMV0uYmJ0YWcgPT0gJ3VybCcpIHsKCQkJCXRoaXMub3BlbnRhZ3MucG9wKCk7CgkJCQllbmR0YWdzICs9ICdcJz4nICsgcG9zdC5zdWJzdHIodGhpcy51cmxzdGFydCwgcG9zdC5sZW5ndGgtdGhpcy51cmxzdGFydCkgKyAnPC9hPic7CgkJCX0KCgkJCXdoaWxlICh0aGlzLm9wZW50YWdzLmxlbmd0aCkgewoJCQkJZW5kdGFncyArPSB0aGlzLm9wZW50YWdzLnBvcCgpLmV0YWc7CgkJCX0KCQl9CgoJCXJldHVybiBlbmR0YWdzID8gcmVzdWx0ICsgZW5kdGFncyA6IHJlc3VsdDsKCX0sCgoJLy8gY2hlY2sgaWYgaXQncyBhIHZhbGlkIEJCQ29kZSB0YWcKCWlzVmFsaWRUYWc6IGZ1bmN0aW9uKHN0cikgewoJCWlmIChlbXB0eShzdHIpKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCXJldHVybiB0aGlzLlJFLmJiY29kZS50ZXN0KHN0cik7Cgl9LAoKCXRvSHRtbDogZnVuY3Rpb24obXN0ciwgY3JsZiwgdGFnLCBvcHRpb24sIHRhZ0VuZCwgb2Zmc2V0LCBzdHJpbmcpIHsKCQlpZiAoIWVtcHR5KGNybGYpKSB7CgkJCWlmICghdGhpcy5jcmxmMmJyKSB7CgkJCQlyZXR1cm4gbXN0cjsKCQkJfQoKCQkJaWYgKGNybGYgPT0gJ1xyJykgewoJCQkJcmV0dXJuICcnOwoJCQl9CgkJCWVsc2UgaWYgKGNybGYgPT0gJ1xuJykgewoJCQkJcmV0dXJuICc8YnIgLz4nOwoJCQl9CgkJfQoKCQkvLyBoYW5kbGUgc3RhcnQgdGFncwoJCWlmICh0aGlzLmlzVmFsaWRUYWcodGFnKSkgewoJCQlpZiAodGhpcy5ub3BhcnNlKSB7CgkJCQlyZXR1cm4gJ1snICsgdGFnICsgJ10nOwoJCQl9CgoJCQlpZiAoIWVtcHR5KHRoaXMub3BlbnRhZ3MpICYmIHRoaXMub3BlbnRhZ3NbdGhpcy5vcGVudGFncy5sZW5ndGggLSAxXS5iYnRhZyA9PSAndXJsJyAmJiB0aGlzLnVybHN0YXJ0ID49IDApIHsKCQkJCXJldHVybiAnWycgKyB0YWcgKyAnXSc7CgkJCX0KCgkJCXN3aXRjaCAodGFnKSB7CgkJCQljYXNlICdub3BhcnNlJzoKCQkJCQl0aGlzLm5vcGFyc2UgPSB0cnVlOwoJCQkJCXJldHVybiAnJzsKCQkJCWNhc2UgJ3VybCc6CgkJCQkJdGhpcy5vcGVudGFncy5wdXNoKHsnYmJ0YWcnIDogdGFnLCAnZXRhZycgOiAnPC9hPid9KTsKCgkJCQkJaWYgKG9wdGlvbiAmJiB0aGlzLlJFLnVyaS50ZXN0KG9wdGlvbikpIHsKCQkJCQkJdGhpcy51cmxzdGFydCA9IC0xOwoJCQkJCQlyZXR1cm4gJzxhIGhyZWY9IicgKyBvcHRpb24gKyAnIj4nOwoJCQkJCX0KCgkJCQkJdGhpcy51cmxzdGFydCA9IG1zdHIubGVuZ3RoICsgb2Zmc2V0OwoKCQkJCQlyZXR1cm4gJzxhIGhyZWY9Iic7CgkJCQljYXNlICdjb2RlJzoKCQkJCQl0aGlzLm9wZW50YWdzLnB1c2goeydiYnRhZycgOiB0YWcsICdldGFnJyA6ICc8L2NvZGU+PC9wcmU+J30pOwoJCQkJCXRoaXMubm9wYXJzZSA9IGZhbHNlOwoJCQkJCXJldHVybiAnPHByZT48Y29kZT4nOwoJCQkJY2FzZSAncHJlJzoKCQkJCQl0aGlzLm9wZW50YWdzLnB1c2goeydiYnRhZycgOiB0YWcsICdldGFnJyA6ICc8L3ByZT4nfSk7CgkJCQkJdGhpcy5ub3BhcnNlID0gZmFsc2U7CgkJCQkJcmV0dXJuICc8cHJlPic7CgkJCQljYXNlICdjb2xvcic6CgkJCQkJaWYgKCFvcHRpb24gfHwgIXRoaXMuUkUuY29sb3IudGVzdChvcHRpb24pKSB7CgkJCQkJCW9wdGlvbiA9ICdpbmhlcml0JzsKCQkJCQl9CgoJCQkJCXRoaXMub3BlbnRhZ3MucHVzaCh7J2JidGFnJyA6IHRhZywgJ2V0YWcnIDogJzwvc3Bhbj4nfSk7CgkJCQkJcmV0dXJuICc8c3BhbiBzdHlsZT0iY29sb3I6ICcgKyBvcHRpb24gKyAnIj4nOwoJCQkJY2FzZSAnc2l6ZSc6CgkJCQkJb3B0aW9uID0gb3B0aW9uIHx8ICc3JzsKCgkJCQkJdGhpcy5vcGVudGFncy5wdXNoKHsnYmJ0YWcnIDogdGFnLCAnZXRhZycgOiAnPC9zcGFuPid9KTsKCQkJCQlyZXR1cm4gJzxzcGFuIHN0eWxlPSJmb250LXNpemU6ICcgKyBwYXJzZUludChvcHRpb24sIDEwKSArICdwdCI+JzsKCQkJCWRlZmF1bHQ6CgkJCQkJdGhpcy5vcGVudGFncy5wdXNoKHsnYmJ0YWcnIDogdGFnLCAnZXRhZycgOiAnPC8nICsgdGFnICsgJz4nfSk7CgkJCQkJcmV0dXJuICc8JyArIHRhZyArICc+JzsKCQkJfQoJCX0KCgkJLy8gcHJvY2VzcyBlbmQgdGFncwoJCWlmICh0aGlzLmlzVmFsaWRUYWcodGFnRW5kKSkgewoJCQlpZiAodGhpcy5ub3BhcnNlKSB7CgkJCQlpZiAodGFnRW5kID09ICdub3BhcnNlJykgewoJCQkJCXRoaXMubm9wYXJzZSA9IGZhbHNlOwoJCQkJCXJldHVybiAnJzsKCQkJCX0KCgkJCQlyZXR1cm4gJ1svJyArIHRhZ0VuZCArICddJzsKCQkJfQoKCQkJaWYgKCF0aGlzLm9wZW50YWdzLmxlbmd0aCB8fCB0aGlzLm9wZW50YWdzW3RoaXMub3BlbnRhZ3MubGVuZ3RoIC0gMV0uYmJ0YWcgIT0gdGFnRW5kKSB7CgkJCQlyZXR1cm4gJzxzcGFuIHN0eWxlPSJjb2xvcjogcmVkIj5bLycgKyB0YWdFbmQgKyAnXTwvc3Bhbj4nOwoJCQl9CgoJCQlpZiAodGFnRW5kID09ICd1cmwnKSB7CgkJCQlpZiAodGhpcy51cmxzdGFydCA+IDApIHsKCQkJCQlyZXR1cm4gJyI+JyArIHN0cmluZy5zdWJzdHIodGhpcy51cmxzdGFydCwgb2Zmc2V0IC0gdGhpcy51cmxzdGFydCkgKyB0aGlzLm9wZW50YWdzLnBvcCgpLmV0YWc7CgkJCQl9CgkJCQlyZXR1cm4gdGhpcy5vcGVudGFncy5wb3AoKS5ldGFnOwoJCQl9CgkJCWVsc2UgaWYgKHRhZ0VuZCA9PSAnY29kZScgfHwgdGFnRW5kID09ICdwcmUnKSB7CgkJCQl0aGlzLmNybGYyYnIgPSB0cnVlOwoJCQl9CgoJCQlyZXR1cm4gdGhpcy5vcGVudGFncy5wb3AoKS5ldGFnOwoJCX0KCgkJcmV0dXJuIG1zdHI7Cgl9Cn07CgovKgoqKiBaYWJiaXgKKiogQ29weXJpZ2h0IChDKSAyMDAwLTIwMTEgWmFiYml4IFNJQQoqKgoqKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTsgeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQoqKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQoqKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAyIG9mIHRoZSBMaWNlbnNlLCBvcgoqKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLgoqKgoqKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKKiogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YKKiogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQoqKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgoqKgoqKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQoqKiBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQoqKiBGb3VuZGF0aW9uLCBJbmMuLCA1MSBGcmFua2xpbiBTdHJlZXQsIEZpZnRoIEZsb29yLCBCb3N0b24sIE1BICAwMjExMC0xMzAxLCBVU0EuCioqLwoKdmFyIExDTF9TVUdHRVNUUyA9IFtdOwoKZnVuY3Rpb24gY3JlYXRlU3VnZ2VzdChvaWQpewoJdmFyIHNpZCA9IExDTF9TVUdHRVNUUy5sZW5ndGg7CglMQ0xfU1VHR0VTVFNbc2lkXSA9IG5ldyBDU3VnZ2VzdChzaWQsIG9pZCk7CgpyZXR1cm4gc2lkOwp9Cgp2YXIgQ1N1Z2dlc3QgPSBDbGFzcy5jcmVhdGUoQ0RlYnVnLHsKLy8gUFVCTElDCid1c2VMb2NhbCc6CQkJdHJ1ZSwJLy8gdXNlIGNhY2hlIHRvIGZpbmQgc3VnZ2VzdHMKJ3VzZVNlcnZlcic6CQl0cnVlLAkvLyB1c2Ugc2VydmVyIHRvIGZpbmQgc3VnZ2VzdHMKCidzYXZlVG9DYWNoZSc6CQl0cnVlLAkvLyBzYXZlIHJlc3VsdHMgdG8gY2FjaGUKCidjYWNoZVRpbWVPdXQnOgkJNjAsCQkvLyBjYWNoZSB0aW1lb3V0IChzZWNvbmRzKQonc3VnZ2VzdExpbWl0JzoJCTE1LAkJLy8gc3VnZ2VzdGlvbiBzaG93IGxpbWl0Cgonc2VhcmNoRGVsYXknOgkJMjAwLAkvLyBtaWxsaXNlY29uZHMKCgovLyBQUklWQVRFCidpZCc6CQkJCW51bGwsCS8vIHN1Z2cgb2JqIGlkZW50aXR5CidycGNpZCc6CQkJMCwJCS8vIHJwYyByZXF1ZXN0IGlkCgonbmVlZGxlcyc6CQkJe30sCQkvLyBzZWFyY2hlZCBzdHJpbmdzCid1c2VyTmVlZGxlJzoJCScnLAkJLy8gdXNlck5lZWRsZQondGltZW91dE5lZWRsZSc6CW51bGwsCS8vIFRpbWVvdXQgcmVmZXJlbmNlCgonY2FjaGUnOnsKCSd0aW1lJzoJCQkwLAkJLy8gY2FjaGUgY3JlYXRpb24gdGltZQoJJ2xpc3QnOgkJCXt9LAkJLy8gY2FjaGUgYnkgd29yZAoJJ25lZWRsZSc6CQl7fQkJLy8gY2FjaGUgYnkgbmVlZGxlCn0sCgonZG9tJzp7CgknaW5wdXQnOgkJbnVsbCwJLy8gRE9NIG5vZGUgaW5wdXQKCSdzdWdnZXN0JzoJCW51bGwsCS8vIERPTSBub2RlIHN1Z2dlc3QgZGl2Cgknc3VndGFiJzoJCW51bGwJLy8gRE9NIG5vZGUgc3VnZ2VzdHMgdGFibGUKfSwKCidobEluZGV4JzoJCQkwLAkJLy8gaW5kaWNhdGVzIHdoYXQgcm93IHNob3VsZCBiZSBoaWdobGlnaHRlZAonc3VnZ2VzdENvdW50JzoJCTAsCQkvLyBzdWdnZXN0cyBzaG93bgoKJ21vdXNlT3ZlclN1Z2dlc3QnOglmYWxzZSwJLy8gaW5kaWNhdGVzIGlmIG1vdXNlIGlzIG92ZXIgc3VnZ2VzdHMKCmluaXRpYWxpemU6IGZ1bmN0aW9uKCRzdXBlciwgaWQsIG9iamlkKXsKCXRoaXMuaWQgPSBpZDsKCSRzdXBlcignQ1N1Z2dlc3RbJytpZCsnXScpOwovLy0tCgoJdGhpcy5jbGVhbkNhY2hlKCk7CgoJdGhpcy5kb20uaW5wdXQgPSAkKG9iamlkKTsKCglhZGRMaXN0ZW5lcih0aGlzLmRvbS5pbnB1dCwgJ2tleXVwJywgdGhpcy5rZXlQcmVzc2VkLmJpbmRBc0V2ZW50TGlzdGVuZXIodGhpcykpOwoJYWRkTGlzdGVuZXIodGhpcy5kb20uaW5wdXQsICdibHVyJywgdGhpcy5zdWdnZXN0Qmx1ci5iaW5kQXNFdmVudExpc3RlbmVyKHRoaXMpKTsKCWFkZExpc3RlbmVyKHdpbmRvdywgJ3Jlc2l6ZScsIHRoaXMucG9zaXRpb25TdWdnZXN0cy5iaW5kQXNFdmVudExpc3RlbmVyKHRoaXMpKTsKLy8JYWRkTGlzdGVuZXIod2luZG93LCAna2V5cHJlc3MnLCB0aGlzLnNlYXJjaEZvY3VzLmJpbmRBc0V2ZW50TGlzdGVuZXIodGhpcykpOwoKCXRoaXMudGltZW91dE5lZWRsZSA9IG51bGw7Cn0sCgpuZWVkbGVDaGFuZ2U6IGZ1bmN0aW9uKGUpewoJdGhpcy5kZWJ1ZygnbmVlZGxlQ2hhbmdlJyk7Ci8vLS0KCXRoaXMuaGxJbmRleCA9IDA7Cgl0aGlzLnN1Z2dlc3RDb3VudCA9IDA7CgoJY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dE5lZWRsZSk7CgoJdmFyIHRhcmdldCA9IEV2ZW50LmVsZW1lbnQoZSk7Cgl2YXIgbmVlZGxlID0gdGFyZ2V0LnZhbHVlLnRvTG93ZXJDYXNlKCk7CgoJaWYoZW1wdHkobmVlZGxlKSl7CgkJdGhpcy5oaWRlU3VnZ2VzdHMoKTsKCQlyZXR1cm4gdHJ1ZTsKCX0KCgl0aGlzLnVzZXJOZWVkbGUgPSBuZWVkbGU7Cgl0aGlzLm5lZWRsZXNbbmVlZGxlXSA9IHsnbmVlZGxlJzogbmVlZGxlLCAnbGlzdCc6IHt9fTsKCgl2YXIgZm91bmQgPSBmYWxzZTsKCglpZih0aGlzLnVzZUxvY2FsKSBmb3VuZCA9IHRoaXMuc2VhcmNoQ2xpZW50KG5lZWRsZSk7CgoJaWYoIWZvdW5kICYmIHRoaXMudXNlU2VydmVyKXsKCQl0aGlzLnRpbWVvdXROZWVkbGUgPSBzZXRUaW1lb3V0KHRoaXMuc2VhcmNoU2VydmVyLmJpbmQodGhpcywgbmVlZGxlKSwgdGhpcy5zZWFyY2hEZWxheSk7Cgl9Cn0sCgovLyBTRUFSQ0gKc2VhcmNoU2VydmVyOiBmdW5jdGlvbihuZWVkbGUpewoJdGhpcy5kZWJ1Zygnc2VhcmNoU2VydmVyJywgbmVlZGxlKTsKLy8tLS0KCWlmKG5lZWRsZSAhPSB0aGlzLnVzZXJOZWVkbGUpIHJldHVybiB0cnVlOwoKCXZhciBycGNSZXF1ZXN0ID0gewoJCSdtZXRob2QnOiAnaG9zdC5nZXQnLAoJCSdwYXJhbXMnOiB7CgkJCSdzdGFydFNlYXJjaCc6IDEsCgkJCSdzZWFyY2gnOiB7J25hbWUnOiBuZWVkbGV9LAoJCQknb3V0cHV0JzogWydob3N0aWQnLCAnbmFtZScsICdob3N0J10sCgkJCSdzb3J0ZmllbGQnOiAnbmFtZScsCgkJCSdsaW1pdCc6IHRoaXMuc3VnZ2VzdExpbWl0CgkJfSwKCQknb25TdWNjZXNzJzogdGhpcy5zZXJ2ZXJSZXNwb25kLmJpbmQodGhpcywgbmVlZGxlKSwKCQknb25GYWlsdXJlJzogZnVuY3Rpb24oKXt6YnhfdGhyb3coJ1N1Z2dlc3QgV2lkZ2V0OiBzZWFyY2ggcmVxdWVzdCBmYWlsZWQuJyk7fQoJfTsKCgluZXcgUlBDLkNhbGwocnBjUmVxdWVzdCk7CgpyZXR1cm4gdHJ1ZTsKfSwKCnNlcnZlclJlc3BvbmQ6IGZ1bmN0aW9uKG5lZWRsZSwgcmVzcG9uZCl7Cgl0aGlzLmRlYnVnKCdzZXJ2ZXJSZXNwb25kJywgbmVlZGxlKTsKLy8tLQoKCXZhciBwYXJhbXMgPSB7CgkJJ2xpc3QnOiB7fSwKCQknbmVlZGxlJzogbmVlZGxlCgl9OwoKCWZvcih2YXIgaT0wOyBpIDwgcmVzcG9uZC5sZW5ndGg7IGkrKyl7CgkJaWYoIWlzc2V0KGksIHJlc3BvbmQpIHx8IGVtcHR5KHJlc3BvbmRbaV0pKSBjb250aW51ZTsKCQlwYXJhbXMubGlzdFtpXSA9IHJlc3BvbmRbaV0ubmFtZS50b0xvd2VyQ2FzZSgpOwoJfQoJdGhpcy5uZWVkbGVzW3BhcmFtcy5uZWVkbGVdLmxpc3QgPSBwYXJhbXMubGlzdDsKCglpZihuZWVkbGUgPT0gdGhpcy51c2VyTmVlZGxlKXsKCQl0aGlzLnNob3dTdWdnZXN0cygpOwoJCXRoaXMubmV3U3VnVGFiKHBhcmFtcy5uZWVkbGUpOwoJfQoKCWlmKHRoaXMuc2F2ZVRvQ2FjaGUpIHRoaXMuc2F2ZUNhY2hlKHBhcmFtcy5uZWVkbGUsIHBhcmFtcy5saXN0KTsKfSwKCnNlYXJjaENsaWVudDogZnVuY3Rpb24obmVlZGxlKXsKCXRoaXMuZGVidWcoJ3NlYXJjaENsaWVudCcsIG5lZWRsZSk7Ci8vLS0tCgoJdmFyIGZvdW5kID0gZmFsc2U7CglpZih0aGlzLmluQ2FjaGUobmVlZGxlKSl7CgkJdGhpcy5uZWVkbGVzW25lZWRsZV0ubGlzdCA9IHRoaXMuY2FjaGUubmVlZGxlW25lZWRsZV07CgkJZm91bmQgPSB0cnVlOwoJfQoJZWxzZSBpZighdGhpcy51c2VTZXJ2ZXIpewoJCWZvdW5kID0gdGhpcy5zZWFyY2hDYWNoZShuZWVkbGUpOwoJfQoKCWlmKGZvdW5kKXsKCQl0aGlzLnNob3dTdWdnZXN0cygpOwoJCXRoaXMubmV3U3VnVGFiKG5lZWRsZSk7Cgl9CgpyZXR1cm4gZm91bmQ7Cn0sCi8vLS0tLS0KCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIENBQ0hFCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCnNlYXJjaENhY2hlOiBmdW5jdGlvbihuZWVkbGUpewoJdGhpcy5kZWJ1Zygnc2VhcmNoQ2FjaGUnLCBuZWVkbGUpOwovLy0tLQoJdmFyIGZrZXkgPSBuZWVkbGVbMF07CglpZighaXNzZXQoZmtleSwgdGhpcy5jYWNoZS5saXN0KSkgcmV0dXJuIGZhbHNlOwoKCXZhciBmb3VuZCA9IGZhbHNlOwoJdmFyIGxpc3QgPSB7fTsKCWZvcih2YXIga2V5IGluIHRoaXMuY2FjaGUubGlzdFtma2V5XSl7CgkJdmFyIHZhbHVlID0gdGhpcy5jYWNoZS5saXN0W2ZrZXldW2tleV07CgkJaWYoZW1wdHkodmFsdWUpKSBjb250aW51ZTsKCgkJaWYoa2V5LmluZGV4T2YobmVlZGxlKSA9PT0gMCl7CgkJCWxpc3RbdmFsdWVdID0gdmFsdWU7CgkJCWZvdW5kID0gdHJ1ZTsKCQl9Cgl9CgoJdGhpcy5uZWVkbGVzW25lZWRsZV0ubGlzdCA9IGxpc3Q7CglpZih0aGlzLnNhdmVUb0NhY2hlKSB0aGlzLnNhdmVDYWNoZShuZWVkbGUsIGxpc3QpOwoKcmV0dXJuIGZvdW5kOwp9LAoKaW5DYWNoZTogZnVuY3Rpb24obmVlZGxlKXsKCXRoaXMuZGVidWcoJ2luQ2FjaGUnKTsKLy8tLS0KCWlmKHRoaXMudXNlU2VydmVyKXsKCQl2YXIgZGQgPSBuZXcgRGF0ZSgpOwoJCWlmKCh0aGlzLmNhY2hlLnRpbWUgKyAodGhpcy5jYWNoZVRpbWVPdXQqMTAwMCkpIDwgZGQuZ2V0VGltZSgpKSB0aGlzLmNsZWFuQ2FjaGUoKTsKCX0KCnJldHVybiBpc3NldChuZWVkbGUsIHRoaXMuY2FjaGUubmVlZGxlKTsKfSwKCnNhdmVDYWNoZTogZnVuY3Rpb24obmVlZGxlLCBsaXN0KXsKCXRoaXMuZGVidWcoJ3NhdmVDYWNoZScpOwovLy0tLQoJaWYodGhpcy51c2VTZXJ2ZXIpewoJCXZhciBkZCA9IG5ldyBEYXRlKCk7CgkJaWYoKHRoaXMuY2FjaGUudGltZSArICh0aGlzLmNhY2hlVGltZU91dCoxMDAwKSkgPCBkZC5nZXRUaW1lKCkpIHRoaXMuY2xlYW5DYWNoZSgpOwoJfQoKLy8gTmVlZGxlcwoJaWYoIWlzX251bGwobmVlZGxlKSkgdGhpcy5jYWNoZS5uZWVkbGVbbmVlZGxlXSA9IGxpc3Q7CgovLyBMaXN0Cglmb3IodmFyIGtleSBpbiBsaXN0KXsKCQlpZihlbXB0eShsaXN0W2tleV0pKSBjb250aW51ZTsKCgkJdmFyIHdvcmQgPSBsaXN0W2tleV07CgkJdmFyIGxXb3JkID0gd29yZC50b0xvd2VyQ2FzZSgpOwoKCQl2YXIgZmtleSA9IGxXb3JkWzBdOwoKLy8gaW5kZXhpbmcgYnkgZmlyc3QgbGV0dGVyCgkJaWYoIWlzc2V0KGZrZXksIHRoaXMuY2FjaGUubGlzdCkpIHRoaXMuY2FjaGUubGlzdFtma2V5XSA9IHt9OwoJCXRoaXMuY2FjaGUubGlzdFtma2V5XVtsV29yZF0gPSB3b3JkOwoJfQp9LAoKY2xlYW5DYWNoZTogZnVuY3Rpb24oKXsKCXRoaXMuZGVidWcoJ2NsZWFuQ2FjaGUnKTsKLy8tLS0KCgl2YXIgdGltZSA9IG5ldyBEYXRlKCk7Cgl0aGlzLmNhY2hlID0gewoJCSd0aW1lJzoJCXRpbWUuZ2V0VGltZSgpLAoJCSdsaXN0JzoJCXt9LAoJCSduZWVkbGUnOgl7fQoJfQp9LAoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gRXZlbnRzCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgpvblNlbGVjdDogZnVuY3Rpb24oc2VsZWN0aW9uKXsKCXJldHVybiB0cnVlOwp9LAoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gS2V5Ym9hcmQKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0Kc2VhcmNoRm9jdXM6IGZ1bmN0aW9uKGUpewoJdGhpcy5kZWJ1Zygna2V5UHJlc3NlZCcpOwovLy0tLQoJaWYoIWUpIGUgPSB3aW5kb3cuZXZlbnQ7CgoJdmFyIGVsZW0gPSBlLmVsZW1lbnQoKTsKCWlmKGVsZW0ubWF0Y2goJ2lucHV0W3R5cGU9dGV4dF0nKSB8fCBlbGVtLm1hdGNoKCd0ZXh0YXJlYScpIHx8IGVsZW0ubWF0Y2goJ3NlbGVjdCcpKSByZXR1cm4gdHJ1ZTsKCgl2YXIga2V5ID0gZS5rZXlDb2RlOwoJaWYoa2V5ID09IDQ3KXsKCQllLnN0b3AoKTsKCQkkKHRoaXMuZG9tLmlucHV0KS5mb2N1cygpOwoJCXJldHVybiB2b2lkKDApOwoJfQp9LAoKa2V5UHJlc3NlZDogZnVuY3Rpb24oZSl7Cgl0aGlzLmRlYnVnKCdrZXlQcmVzc2VkJyk7Ci8vLS0tCgoJaWYoIWUpIGUgPSB3aW5kb3cuZXZlbnQ7Cgl2YXIga2V5ID0gZS5rZXlDb2RlOwoKCXN3aXRjaCh0cnVlKXsKCQljYXNlKGtleSA9PSAyNyk6CgkJCXRoaXMuaGxJbmRleCA9IDA7CgkJCXRoaXMuc3VnZ2VzdENvdW50ID0gMDsKCQkJdGhpcy5yZW1vdmVIaWdoTGlnaHQoZSk7CgkJCXRoaXMuc2V0TmVlZGxlQnlIaWdoTGlnaHQoZSk7CgkJCXRoaXMuaGlkZVN1Z2dlc3RzKGUpOwoJCQlicmVhazsKCQljYXNlKGtleT09MTMpOgoJCQlFdmVudC5zdG9wKGUpOwoJCQl0aGlzLnNlbGVjdFN1Z2dlc3QoZSk7CgkJCWJyZWFrOwoJCWNhc2Uoa2V5ID09IDM3IHx8IGtleSA9PSAzOSB8fCBrZXkgPT0gOSk6IC8vIGxlZnQsIHJpZ2h0LCB0YWIKCQkJYnJlYWs7CgkJY2FzZShrZXk9PTM4KTogLy8gdXAKCQkJdGhpcy5rZXlVcChlKTsKCQkJYnJlYWs7CgkJY2FzZShrZXk9PTQwKTogLy8gZG93bgoJCQl0aGlzLmtleURvd24oZSk7CgkJCWJyZWFrOwoJCWRlZmF1bHQ6CgkJCXRoaXMubmVlZGxlQ2hhbmdlKGUpOwoJfQoKCUV2ZW50LnN0b3AoZSk7Cn0sCgprZXlVcDogZnVuY3Rpb24oZSl7Cgl0aGlzLmRlYnVnKCdrZXlVcCcpOwovLy0tLQoKCWlmKHRoaXMuaGxJbmRleCA9PSAwKSB0aGlzLmhsSW5kZXggPSB0aGlzLnN1Z2dlc3RDb3VudDsKCWVsc2UgdGhpcy5obEluZGV4LS07CgoJdGhpcy5yZW1vdmVIaWdoTGlnaHQoZSk7Cgl0aGlzLmhpZ2hMaWdodFN1Z2dlc3QoZSk7Cgl0aGlzLnNldE5lZWRsZUJ5SGlnaExpZ2h0KGUpOwp9LAoKa2V5RG93bjogZnVuY3Rpb24oZSl7Cgl0aGlzLmRlYnVnKCdrZXlEb3duJyk7Ci8vLS0tCglpZihpc19udWxsKHRoaXMuZG9tLnN1Z2dlc3QpIHx8ICh0aGlzLmRvbS5zdWdnZXN0LnN0eWxlLmRpc3BsYXkgPT0gJ25vbmUnKSl7CgkJdGhpcy5uZWVkbGVDaGFuZ2UoZSk7CgkJcmV0dXJuIHRydWU7Cgl9CgoJaWYodGhpcy5obEluZGV4ID09IHRoaXMuc3VnZ2VzdENvdW50KSB0aGlzLmhsSW5kZXggPSAwOwoJZWxzZSB0aGlzLmhsSW5kZXgrKzsKCgl0aGlzLnJlbW92ZUhpZ2hMaWdodChlKTsKCXRoaXMuaGlnaExpZ2h0U3VnZ2VzdChlKTsKCXRoaXMuc2V0TmVlZGxlQnlIaWdoTGlnaHQoZSk7Cn0sCgptb3VzZU92ZXI6IGZ1bmN0aW9uKGUpewoJdGhpcy5kZWJ1ZygnbW91c2VPdmVyJyk7Ci8vLS0tCgl0aGlzLm1vdXNlT3ZlclN1Z2dlc3QgPSB0cnVlOwoKCXZhciByb3cgPSBFdmVudC5lbGVtZW50KGUpLnBhcmVudE5vZGU7CglpZihpc19udWxsKHJvdykgfHwgKHJvdy50YWdOYW1lLnRvTG93ZXJDYXNlKCkgIT0gJ3RyJykgfHwgIWlzc2V0KCdpZCcscm93KSkgcmV0dXJuIHRydWU7CgoJdmFyIHRtcCA9IHJvdy5pZC5zcGxpdCgnXycpOwoJaWYodG1wLmxlbmd0aCAhPSAyKSByZXR1cm4gdHJ1ZTsKCgl0aGlzLmhsSW5kZXggPSBwYXJzZUludCh0bXBbMV0sIDEwKTsKCgl0aGlzLnJlbW92ZUhpZ2hMaWdodChlKTsKCXRoaXMuaGlnaExpZ2h0U3VnZ2VzdChlKTsKfSwKCm1vdXNlT3V0OiBmdW5jdGlvbihlKXsKCXRoaXMuZGVidWcoJ21vdXNlT3V0Jyk7Ci8vLS0tCgoJdGhpcy5tb3VzZU92ZXJTdWdnZXN0ID0gZmFsc2U7Cn0sCgpzdWdnZXN0Qmx1cjogZnVuY3Rpb24oZSl7Cgl0aGlzLmRlYnVnKCdzdWdnZXN0Qmx1cicpOwovLy0tLQoKCWlmKHRoaXMubW91c2VPdmVyU3VnZ2VzdCkgRXZlbnQuc3RvcChlKTsKCWVsc2UgdGhpcy5oaWRlU3VnZ2VzdHMoZSk7Cn0sCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBIaWdoTGlnaHQKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCnJlbW92ZUhpZ2hMaWdodDogZnVuY3Rpb24oKXsKCXRoaXMuZGVidWcoJ3JtdkhpZ2hMaWdodCcpOwovLy0tLQoKCSQkKCd0ci5oaWdobGlnaHQnKS5lYWNoKCBmdW5jdGlvbihobFJvdyl7aGxSb3cuY2xhc3NOYW1lID0gJyc7fSk7Cn0sCgoKaGlnaExpZ2h0U3VnZ2VzdDogZnVuY3Rpb24oKXsKCXRoaXMuZGVidWcoJ2hpZ2hMaWdodFN1Z2dlc3QnKTsKLy8tLS0KCgl2YXIgcm93ID0gJCgnbGluZV8nK3RoaXMuaGxJbmRleCk7CglpZighaXNfbnVsbChyb3cpKSByb3cuY2xhc3NOYW1lID0gJ2hpZ2hsaWdodCc7Cn0sCgpzZXROZWVkbGVCeUhpZ2hMaWdodDogZnVuY3Rpb24oKXsKCXRoaXMuZGVidWcoJ3NldE5lZWRsZUJ5SGlnaExpZ2h0Jyk7Ci8vLS0tCglpZih0aGlzLmhsSW5kZXggPT0gMCkKCQl0aGlzLmRvbS5pbnB1dC52YWx1ZSA9IHRoaXMudXNlck5lZWRsZTsKCWVsc2UKCQl0aGlzLmRvbS5pbnB1dC52YWx1ZSA9ICQoJ2xpbmVfJyt0aGlzLmhsSW5kZXgpLnJlYWRBdHRyaWJ1dGUoJ25lZWRsZScpOwp9LAoKc2VsZWN0U3VnZ2VzdDogZnVuY3Rpb24oZSl7Cgl0aGlzLmRlYnVnKCdzZWxlY3RTdWdnZXN0Jyk7Ci8vLS0tCgoJdGhpcy5zZXROZWVkbGVCeUhpZ2hMaWdodChlKTsKCXRoaXMuaGlkZVN1Z2dlc3RzKCk7CgovL1NESih0aGlzLmRvbS5pbnB1dCk7CgoJaWYodGhpcy5vblNlbGVjdCh0aGlzLmRvbS5pbnB1dC52YWx1ZSkgJiYgIUdLKSB0aGlzLmRvbS5pbnB1dC5mb3JtLnN1Ym1pdCgpOwp9LAoKCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIERPTSBjcmVhdGlvbgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKc2hvd1N1Z2dlc3RzOiBmdW5jdGlvbigpewoJdGhpcy5kZWJ1Zygnc2hvd1N1Z2dlc3RzJyk7Ci8vLS0tCgoJaWYoaXNfbnVsbCh0aGlzLmRvbS5zdWdnZXN0KSl7CgkJdGhpcy5kb20uc3VnZ2VzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCXRoaXMuZG9tLnN1Z2dlc3QgPSAkKHRoaXMuZG9tLnN1Z2dlc3QpOwoKCQl2YXIgZG9jX2JvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdOwoJCWlmKGVtcHR5KGRvY19ib2R5KSkgcmV0dXJuIGZhbHNlOwoKCQlkb2NfYm9keS5hcHBlbmRDaGlsZCh0aGlzLmRvbS5zdWdnZXN0KTsKCQl0aGlzLmRvbS5zdWdnZXN0LmNsYXNzTmFtZSA9ICdzdWdnZXN0JzsKCgkJdGhpcy5wb3NpdGlvblN1Z2dlc3RzKCk7Cgl9CgoJdGhpcy5kb20uc3VnZ2VzdC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKfSwKCmhpZGVTdWdnZXN0czogZnVuY3Rpb24oKXsKCXRoaXMuZGVidWcoJ2hpZGVTdWdnZXN0Jyk7Ci8vLS0KCglpZighaXNfbnVsbCh0aGlzLmRvbS5zdWdnZXN0KSl7CgkJdGhpcy5kb20uc3VnZ2VzdC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoJfQp9LAoKcG9zaXRpb25TdWdnZXN0czogZnVuY3Rpb24oKXsKCXRoaXMuZGVidWcoJ3Bvc2l0aW9uU3VnZ2VzdHMnKTsKLy8tLS0KCglpZihpc19udWxsKHRoaXMuZG9tLnN1Z2dlc3QpKSByZXR1cm4gdHJ1ZTsKCgl2YXIgcG9zID0gZ2V0UG9zaXRpb24odGhpcy5kb20uaW5wdXQpOwoJdmFyIGRpbXMgPSBnZXREaW1lbnNpb25zKHRoaXMuZG9tLmlucHV0KTsKCgl0aGlzLmRvbS5zdWdnZXN0LnN0eWxlLnRvcCA9IChwb3MudG9wK2RpbXMuaGVpZ2h0KSsncHgnOwoJdGhpcy5kb20uc3VnZ2VzdC5zdHlsZS5sZWZ0ID0gcG9zLmxlZnQrJ3B4JzsKfSwKCm5ld1N1Z1RhYjogZnVuY3Rpb24obmVlZGxlKXsKCXRoaXMuZGVidWcoJ25ld1N1Z1RhYicsIG5lZWRsZSk7Ci8vLS0tCgl2YXIgbGlzdCA9IHRoaXMubmVlZGxlc1tuZWVkbGVdLmxpc3Q7CgoJdmFyIHN1Z1RhYiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RhYmxlJyk7CglzdWdUYWIuY2xhc3NOYW1lID0gJ3N1Z2dlc3QnOwoKCXZhciBzdWdCb2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGJvZHknKTsKCXN1Z1RhYi5hcHBlbmRDaGlsZChzdWdCb2R5KTsKCgl2YXIgY291bnQgPSAwOwoJZm9yKHZhciBrZXkgaW4gbGlzdCl7CgkJaWYoZW1wdHkobGlzdFtrZXldKSkgY29udGludWU7CgkJY291bnQrKzsKCgkJdmFyIHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKCQlzdWdCb2R5LmFwcGVuZENoaWxkKHRyKTsKCgkJdHIuc2V0QXR0cmlidXRlKCdpZCcsICdsaW5lXycrY291bnQpOwoJCXRyLnNldEF0dHJpYnV0ZSgnbmVlZGxlJywgbGlzdFtrZXldKTsKCgkJdmFyIHRkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKCQl0ci5hcHBlbmRDaGlsZCh0ZCk7CgoJCXRkLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKG5lZWRsZSkpOwoJCWFkZExpc3RlbmVyKHRkLCAnbW91c2VvdmVyJywgdGhpcy5tb3VzZU92ZXIuYmluZEFzRXZlbnRMaXN0ZW5lcih0aGlzKSwgdHJ1ZSk7CgkJYWRkTGlzdGVuZXIodGQsICdtb3VzZXVwJywgdGhpcy5zZWxlY3RTdWdnZXN0LmJpbmRBc0V2ZW50TGlzdGVuZXIodGhpcyksIHRydWUpOwoJCWFkZExpc3RlbmVyKHRkLCAnbW91c2VvdXQnLCB0aGlzLm1vdXNlT3V0LmJpbmRBc0V2ZW50TGlzdGVuZXIodGhpcyksIHRydWUpOwoKLy8gdGV4dAoJCXZhciBib2xkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYicpOwoJCXRkLmFwcGVuZENoaWxkKGJvbGQpOwoKCQlib2xkLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxpc3Rba2V5XS5zdWJzdHIobmVlZGxlLmxlbmd0aCkpKTsKCgkJaWYoY291bnQgPj0gdGhpcy5zdWdnZXN0TGltaXQpIGJyZWFrOwoJfQoKCWlmKCFpc19udWxsKHRoaXMuZG9tLnN1Z3RhYikpIHRoaXMuZG9tLnN1Z3RhYi5yZW1vdmUoKTsKCgl0aGlzLmRvbS5zdWd0YWIgPSAkKHN1Z1RhYik7Cgl0aGlzLmRvbS5zdWdnZXN0LmFwcGVuZENoaWxkKHRoaXMuZG9tLnN1Z3RhYik7CgoJaWYoY291bnQgPT0gMCkgdGhpcy5oaWRlU3VnZ2VzdHMoKTsKCgl0aGlzLnN1Z2dlc3RDb3VudCA9IGNvdW50Owp9Cn0pOwoKLyoKKiogWmFiYml4CioqIENvcHlyaWdodCAoQykgMjAwMC0yMDExIFphYmJpeCBTSUEKKioKKiogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKKiogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKKiogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMiBvZiB0aGUgTGljZW5zZSwgb3IKKiogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KKioKKiogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCioqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCioqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKKiogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKioKKiogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKKiogYWxvbmcgd2l0aCB0aGlzIHByb2dyYW07IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKKiogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAgMDIxMTAtMTMwMSwgVVNBLgoqKi8KCi8vIEFycmF5IGluZGV4T2YgbWV0aG9kIGZvciBqYXZhc2NyaXB0PDEuNiBjb21wYXRpYmlsaXR5CmlmICghQXJyYXkucHJvdG90eXBlLmluZGV4T2YpIHsKCUFycmF5LnByb3RvdHlwZS5pbmRleE9mID0gZnVuY3Rpb24gKHNlYXJjaEVsZW1lbnQpIHsKCQkndXNlIHN0cmljdCc7CgoJCWlmICh0aGlzID09PSB2b2lkIDAgfHwgdGhpcyA9PT0gbnVsbCkgewoJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCk7CgkJfQoJCXZhciB0ID0gT2JqZWN0KHRoaXMpOwoJCXZhciBsZW4gPSB0Lmxlbmd0aCA+Pj4gMDsKCQlpZiAobGVuID09PSAwKSB7CgkJCXJldHVybiAtMTsKCQl9CgkJdmFyIG4gPSAwOwoJCWlmIChhcmd1bWVudHMubGVuZ3RoID4gMCkgewoJCQluID0gTnVtYmVyKGFyZ3VtZW50c1sxXSk7CgkJCWlmIChuICE9PSBuKSB7IC8vIHNob3J0Y3V0IGZvciB2ZXJpZnlpbmcgaWYgaXQncyBOYU4KCQkJCW4gPSAwOwoJCQl9CgkJCWVsc2UgaWYgKG4gIT09IDAgJiYgbiAhPT0gKDEgLyAwKSAmJiBuICE9PSAtKDEgLyAwKSkgewoJCQkJbiA9IChuID4gMCB8fCAtMSkgKiBNYXRoLmZsb29yKE1hdGguYWJzKG4pKTsKCQkJfQoJCX0KCQlpZiAobiA+PSBsZW4pIHsKCQkJcmV0dXJuIC0xOwoJCX0KCQl2YXIgayA9IG4gPj0gMCA/IG4gOiBNYXRoLm1heChsZW4gLSBNYXRoLmFicyhuKSwgMCk7CgkJZm9yICg7IGsgPCBsZW47IGsrKykgewoJCQlpZiAoayBpbiB0ICYmIHRba10gPT09IHNlYXJjaEVsZW1lbnQpIHsKCQkJCXJldHVybiBrOwoJCQl9CgkJfQoJCXJldHVybiAtMTsKCX0KfQoKLyoKICogUGFnZSByZWZyZXNoCiAqLwp2YXIgUGFnZVJlZnJlc2ggPSB7CglkZWxheToJCW51bGwsIC8vIHJlZnJlc2ggdGltZW91dAoJZGVsYXlMZWZ0OgludWxsLCAvLyBsZWZ0IHRpbGwgcmVmcmVzaAoJdGltZW91dDoJbnVsbCwgLy8gbGluayB0byB0aW1lb3V0CgoJaW5pdDogZnVuY3Rpb24odGltZSkgewoJCXRoaXMuZGVsYXkgPSB0aW1lOwoJCXRoaXMuZGVsYXlMZWZ0ID0gdGhpcy5kZWxheTsKCQl0aGlzLnN0YXJ0KCk7Cgl9LAoKCWNoZWNrOiBmdW5jdGlvbigpIHsKCQlpZiAoaXNfbnVsbCh0aGlzLmRlbGF5KSkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQl0aGlzLmRlbGF5TGVmdCAtPSAxMDAwOwoJCWlmICh0aGlzLmRlbGF5TGVmdCA8IDApIHsKCQkJbG9jYXRpb24ucmVwbGFjZShsb2NhdGlvbi5ocmVmKTsKCQl9CgkJZWxzZSB7CgkJCXRoaXMudGltZW91dCA9IHNldFRpbWVvdXQoJ1BhZ2VSZWZyZXNoLmNoZWNrKCknLCAxMDAwKTsKCQl9Cgl9LAoKCXN0YXJ0OiBmdW5jdGlvbigpIHsKCQlpZiAoaXNfbnVsbCh0aGlzLmRlbGF5KSkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCXRoaXMudGltZW91dCA9IHNldFRpbWVvdXQoJ1BhZ2VSZWZyZXNoLmNoZWNrKCknLCAxMDAwKTsKCX0sCgoJc3RvcDogZnVuY3Rpb24oKSB7CgkJY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7Cgl9LAoKCXJlc3RhcnQ6IGZ1bmN0aW9uKCkgewoJCXRoaXMuc3RvcCgpOwoJCXRoaXMuZGVsYXlMZWZ0ID0gdGhpcy5kZWxheTsKCQl0aGlzLnN0YXJ0KCk7Cgl9Cn07CgovKgogKiBNYWluIG1lbnUKICovCnZhciBNTWVudSA9IHsKCW1lbnVzOgkJCXsnZW1wdHknOiAwLCAndmlldyc6IDAsICdjbSc6IDAsICdyZXBvcnRzJzogMCwgJ2NvbmZpZyc6IDAsICdhZG1pbic6IDB9LAoJZGVmX2xhYmVsOgkJbnVsbCwKCXN1Yl9hY3RpdmU6IAlmYWxzZSwKCXRpbWVvdXRfcmVzZXQ6CW51bGwsCgl0aW1lb3V0X2NoYW5nZToJbnVsbCwKCgltb3VzZU92ZXI6IGZ1bmN0aW9uKHNob3dfbGFiZWwpIHsKCQljbGVhclRpbWVvdXQodGhpcy50aW1lb3V0X3Jlc2V0KTsKCQl0aGlzLnRpbWVvdXRfY2hhbmdlID0gc2V0VGltZW91dCgnTU1lbnUuc2hvd1N1Yk1lbnUoIicgKyBzaG93X2xhYmVsICsgJyIpJywgMjAwKTsKCQlQYWdlUmVmcmVzaC5yZXN0YXJ0KCk7Cgl9LAoKCXN1Ym1lbnVfbW91c2VPdmVyOiBmdW5jdGlvbigpIHsKCQljbGVhclRpbWVvdXQodGhpcy50aW1lb3V0X3Jlc2V0KTsKCQljbGVhclRpbWVvdXQodGhpcy50aW1lb3V0X2NoYW5nZSk7CgkJUGFnZVJlZnJlc2gucmVzdGFydCgpOwoJfSwKCgltb3VzZU91dDogZnVuY3Rpb24oKSB7CgkJY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dF9jaGFuZ2UpOwoJCXRoaXMudGltZW91dF9yZXNldCA9IHNldFRpbWVvdXQoJ01NZW51LnNob3dTdWJNZW51KCInICsgdGhpcy5kZWZfbGFiZWwgKyAnIiknLCAyNTAwKTsKCX0sCgoJc2hvd1N1Yk1lbnU6IGZ1bmN0aW9uKHNob3dfbGFiZWwpIHsKCQl2YXIgbWVudV9kaXYgPSAkKCdzdWJfJyArIHNob3dfbGFiZWwpOwoJCWlmICghaXNfbnVsbChtZW51X2RpdikpIHsKCQkJJChzaG93X2xhYmVsKS5jbGFzc05hbWUgPSAnYWN0aXZlJzsKCQkJbWVudV9kaXYuc2hvdygpOwoJCQlmb3IgKHZhciBrZXkgaW4gdGhpcy5tZW51cykgewoJCQkJaWYgKGtleSA9PSBzaG93X2xhYmVsKSB7CgkJCQkJY29udGludWU7CgkJCQl9CgoJCQkJdmFyIG1lbnVfY2VsbCA9ICQoa2V5KTsKCQkJCWlmICghaXNfbnVsbChtZW51X2NlbGwpKSB7CgkJCQkJaWYgKG1lbnVfY2VsbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgIT0gJ3NlbGVjdCcpIHsKCQkJCQkJbWVudV9jZWxsLmNsYXNzTmFtZSA9ICcnOwoJCQkJCX0KCQkJCX0KCQkJCXZhciBzdWJfbWVudV9jZWxsID0gJCgnc3ViXycgKyBrZXkpOwoJCQkJaWYgKCFpc19udWxsKHN1Yl9tZW51X2NlbGwpKSB7CgkJCQkJc3ViX21lbnVfY2VsbC5oaWRlKCk7CgkJCQl9CgkJCX0KCQl9Cgl9Cn07CgovKgogKiBBdXRvbWF0aWMgY2hlY2tib3ggcmFuZ2Ugc2VsZWN0aW9uCiAqLwp2YXIgY2hrYnhSYW5nZSA9IHsKCXN0YXJ0Ym94OgkJbnVsbCwJLy8gc3RhcnQgY2hlY2tib3ggb2JqCglzdGFydGJveF9uYW1lOgludWxsLAkvLyBzdGFydCBjaGVja2JveCBuYW1lCgljaGtib3hlczoJCXt9LAkJLy8gY2tieCBsaXN0CglwYWdlR29OYW1lOgkJbnVsbCwJLy8gd2hpY2ggY2hlY2tib3hlcyBzaG91bGQgYmUgY291bnRlZCBieSBHbyBidXR0b24KCXBhZ2VHb0NvdW50OgkwLAkJLy8gc2VsZWN0ZWQgY2hlY2tib3hlcwoJc2VsZWN0ZWRfaWRzOgl7fSwJCS8vIGlkcyBvZiBzZWxlY3RlZCBjaGVja2JveGVzCglnb0J1dHRvbjoJCW51bGwsCglwYWdlOgkJCW51bGwsCS8vIGxvYWRlZCBwYWdlIG5hbWUKCglpbml0OiBmdW5jdGlvbigpIHsKCQl2YXIgcGF0aCA9IG5ldyBDdXJsKCk7CgkJdGhpcy5wYWdlID0gcGF0aC5nZXRQYXRoKCk7CgkJdGhpcy5zZWxlY3RlZF9pZHMgPSBjb29raWUucmVhZEpTT04oJ2NiXycgKyB0aGlzLnBhZ2UpOwoJCXZhciBjaGtfYnggPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW5wdXQnKTsKCQlmb3IgKHZhciBpID0gMDsgaSA8IGNoa19ieC5sZW5ndGg7IGkrKykgewoJCQlpZiAodHlwZW9mKGNoa19ieFtpXSkgIT0gJ3VuZGVmaW5lZCcgJiYgY2hrX2J4W2ldLnR5cGUudG9Mb3dlckNhc2UoKSA9PSAnY2hlY2tib3gnKSB7CgkJCQl0aGlzLmltcGxlbWVudChjaGtfYnhbaV0pOwoJCQl9CgkJfQoKCQl0aGlzLmdvQnV0dG9uID0gJCgnZ29CdXR0b24nKTsKCQlpZiAoIWlzX251bGwodGhpcy5nb0J1dHRvbikpIHsKCQkJYWRkTGlzdGVuZXIodGhpcy5nb0J1dHRvbiwgJ2NsaWNrJywgdGhpcy5zdWJtaXRHby5iaW5kQXNFdmVudExpc3RlbmVyKHRoaXMpLCBmYWxzZSk7CgkJfQoJCXRoaXMuc2V0R28oKTsKCX0sCgoJaW1wbGVtZW50OiBmdW5jdGlvbihvYmopIHsKCQl2YXIgb2JqX25hbWUgPSBvYmoubmFtZS5zcGxpdCgnWycpWzBdOwoKCQlpZiAodHlwZW9mKHRoaXMuY2hrYm94ZXNbb2JqX25hbWVdKSA9PSAndW5kZWZpbmVkJykgewoJCQl0aGlzLmNoa2JveGVzW29ial9uYW1lXSA9IFtdOwoJCX0KCQl0aGlzLmNoa2JveGVzW29ial9uYW1lXS5wdXNoKG9iaik7CgoJCWFkZExpc3RlbmVyKG9iaiwgJ2NsaWNrJywgdGhpcy5jaGVjay5iaW5kQXNFdmVudExpc3RlbmVyKHRoaXMpLCBmYWxzZSk7CgoJCWlmIChvYmpfbmFtZSA9PSB0aGlzLnBhZ2VHb05hbWUpIHsKCQkJdmFyIG9ial9pZCAgPSBvYmoubmFtZS5zcGxpdCgnWycpWzFdOwoJCQlvYmpfaWQgPSBvYmpfaWQuc3Vic3RyaW5nKDAsIG9ial9pZC5sYXN0SW5kZXhPZignXScpKTsKCgkJCWlmIChpc3NldChvYmpfaWQsIHRoaXMuc2VsZWN0ZWRfaWRzKSkgewoJCQkJb2JqLmNoZWNrZWQgPSB0cnVlOwoJCQl9CgkJfQoJfSwKCgljaGVjazogZnVuY3Rpb24oZSkgewoJCWUgPSBlIHx8IHdpbmRvdy5ldmVudDsKCQl2YXIgb2JqID0gRXZlbnQuZWxlbWVudChlKTsKCgkJUGFnZVJlZnJlc2gucmVzdGFydCgpOwoKCQlpZiAodHlwZW9mKG9iaikgPT0gJ3VuZGVmaW5lZCcgfHwgb2JqLnR5cGUudG9Mb3dlckNhc2UoKSAhPSAnY2hlY2tib3gnKSB7CgkJCXJldHVybiB0cnVlOwoJCX0KCgkJdGhpcy5zZXRHbygpOwoKCQlpZiAob2JqLm5hbWUuaW5kZXhPZignYWxsXycpID4gLTEgfHwgb2JqLm5hbWUuaW5kZXhPZignX3NpbmdsZScpID4gLTEpIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoJCXZhciBvYmpfbmFtZSA9IG9iai5uYW1lLnNwbGl0KCdbJylbMF07CgoJCS8vIGNoZWNrIHJhbmdlIHNlbGVjdGlvbgoJCWlmIChlLmN0cmxLZXkgfHwgZS5zaGlmdEtleSkgewoJCQlpZiAoIWlzX251bGwodGhpcy5zdGFydGJveCkgJiYgdGhpcy5zdGFydGJveF9uYW1lID09IG9ial9uYW1lICYmIG9iai5uYW1lICE9IHRoaXMuc3RhcnRib3gubmFtZSkgewoJCQkJdmFyIGNoa2J4X2xpc3QgPSB0aGlzLmNoa2JveGVzW29ial9uYW1lXTsKCQkJCXZhciBmbGFnID0gZmFsc2U7CgoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBjaGtieF9saXN0Lmxlbmd0aDsgaSsrKSB7CgkJCQkJaWYgKHR5cGVvZihjaGtieF9saXN0W2ldKSAhPSAndW5kZWZpbmVkJykgewoJCQkJCQlpZiAoZmxhZykgewoJCQkJCQkJY2hrYnhfbGlzdFtpXS5jaGVja2VkID0gdGhpcy5zdGFydGJveC5jaGVja2VkOwoJCQkJCQl9CgkJCQkJCWlmIChvYmoubmFtZSA9PSBjaGtieF9saXN0W2ldLm5hbWUpIHsKCQkJCQkJCWJyZWFrOwoJCQkJCQl9CgkJCQkJCWlmICh0aGlzLnN0YXJ0Ym94Lm5hbWUgPT0gY2hrYnhfbGlzdFtpXS5uYW1lKSB7CgkJCQkJCQlmbGFnID0gdHJ1ZTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCgkJCQlpZiAoZmxhZykgewoJCQkJCXRoaXMuc2V0R28oKTsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCWZvciAodmFyIGkgPSBjaGtieF9saXN0Lmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CgkJCQkJCWlmICh0eXBlb2YoY2hrYnhfbGlzdFtpXSkgIT0gJ3VuZGVmaW5lZCcpIHsKCQkJCQkJCWlmIChmbGFnKSB7CgkJCQkJCQkJY2hrYnhfbGlzdFtpXS5jaGVja2VkID0gdGhpcy5zdGFydGJveC5jaGVja2VkOwoJCQkJCQkJfQoKCQkJCQkJCWlmIChvYmoubmFtZSA9PSBjaGtieF9saXN0W2ldLm5hbWUpIHsKCQkJCQkJCQl0aGlzLnNldEdvKCk7CgkJCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJCQl9CgoJCQkJCQkJaWYgKHRoaXMuc3RhcnRib3gubmFtZSA9PSBjaGtieF9saXN0W2ldLm5hbWUpIHsKCQkJCQkJCQlmbGFnID0gdHJ1ZTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCQl0aGlzLnNldEdvKCk7CgkJfQoJCXRoaXMuc3RhcnRib3ggPSBvYmo7CgkJdGhpcy5zdGFydGJveF9uYW1lID0gb2JqX25hbWU7Cgl9LAoKCWNoZWNrQWxsOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewoJCWlmICh0eXBlb2YodGhpcy5jaGtib3hlc1tuYW1lXSkgPT0gJ3VuZGVmaW5lZCcpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJdmFyIGNoa19ieCA9IHRoaXMuY2hrYm94ZXNbbmFtZV07CgkJZm9yICh2YXIgaSA9IDA7IGkgPCBjaGtfYngubGVuZ3RoOyBpKyspIHsKCQkJaWYgKHR5cGVvZihjaGtfYnhbaV0pICE9ICd1bmRlZmluZWQnICYmIGNoa19ieFtpXS5kaXNhYmxlZCAhPSB0cnVlKSB7CgkJCQl2YXIgb2JqX25hbWUgPSBjaGtfYnhbaV0ubmFtZS5zcGxpdCgnWycpWzBdOwoJCQkJaWYgKG9ial9uYW1lID09IG5hbWUpIHsKCQkJCQljaGtfYnhbaV0uY2hlY2tlZCA9IHZhbHVlOwoJCQkJfQoJCQl9CgkJfQoJfSwKCglzZXRHbzogZnVuY3Rpb24oKSB7CgkJaWYgKCFpc19udWxsKHRoaXMucGFnZUdvTmFtZSkpIHsKCQkJaWYgKHR5cGVvZih0aGlzLmNoa2JveGVzW3RoaXMucGFnZUdvTmFtZV0pID09ICd1bmRlZmluZWQnKSB7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCgkJCXZhciBjaGtfYnggPSB0aGlzLmNoa2JveGVzW3RoaXMucGFnZUdvTmFtZV07CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgY2hrX2J4Lmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAodHlwZW9mKGNoa19ieFtpXSkgIT0gJ3VuZGVmaW5lZCcpIHsKCQkJCQl2YXIgYm94ID0gY2hrX2J4W2ldOwoJCQkJCXZhciBvYmpfbmFtZSA9IGJveC5uYW1lLnNwbGl0KCdbJylbMF07CgkJCQkJdmFyIG9ial9pZCAgPSBib3gubmFtZS5zcGxpdCgnWycpWzFdOwoJCQkJCW9ial9pZCA9IG9ial9pZC5zdWJzdHJpbmcoMCwgb2JqX2lkLmxhc3RJbmRleE9mKCddJykpOwoJCQkJCXZhciBjcm93ID0gZ2V0UGFyZW50KGJveCwgJ3RyJyk7CgoJCQkJCWlmIChib3guY2hlY2tlZCkgewoJCQkJCQlpZiAoIWlzX251bGwoY3JvdykpIHsKCQkJCQkJCXZhciBvcmlnQ2xhc3MgPSBjcm93LmdldEF0dHJpYnV0ZSgnb3JpZ0NsYXNzJyk7CgkJCQkJCQlpZiAoaXNfbnVsbChvcmlnQ2xhc3MpKSB7CgkJCQkJCQkJY3Jvdy5zZXRBdHRyaWJ1dGUoJ29yaWdDbGFzcycsIGNyb3cuY2xhc3NOYW1lKTsKCQkJCQkJCX0KCQkJCQkJCWNyb3cuY2xhc3NOYW1lID0gJ3NlbGVjdGVkJzsKCQkJCQkJfQoJCQkJCQlpZiAob2JqX25hbWUgPT0gdGhpcy5wYWdlR29OYW1lKSB7CgkJCQkJCQl0aGlzLnNlbGVjdGVkX2lkc1tvYmpfaWRdID0gb2JqX2lkOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWVsc2UgewoJCQkJCQlpZiAoIWlzX251bGwoY3JvdykpIHsKCQkJCQkJCXZhciBvcmlnQ2xhc3MgPSBjcm93LmdldEF0dHJpYnV0ZSgnb3JpZ0NsYXNzJyk7CgoJCQkJCQkJaWYgKCFpc19udWxsKG9yaWdDbGFzcykpIHsKCQkJCQkJCQljcm93LmNsYXNzTmFtZSA9IG9yaWdDbGFzczsKCQkJCQkJCQljcm93LnJlbW92ZUF0dHJpYnV0ZSgnb3JpZ0NsYXNzJyk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJaWYgKG9ial9uYW1lID09IHRoaXMucGFnZUdvTmFtZSkgewoJCQkJCQkJZGVsZXRlKHRoaXMuc2VsZWN0ZWRfaWRzW29ial9pZF0pOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgoJCQl2YXIgY291bnRDaGVja2VkID0gMDsKCQkJZm9yICh2YXIga2V5IGluIHRoaXMuc2VsZWN0ZWRfaWRzKSB7CgkJCQlpZiAoIWVtcHR5KHRoaXMuc2VsZWN0ZWRfaWRzW2tleV0pKSB7CgkJCQkJY291bnRDaGVja2VkKys7CgkJCQl9CgkJCX0KCgkJCWlmICghaXNfbnVsbCh0aGlzLmdvQnV0dG9uKSkgewoJCQkJdmFyIHRtcF92YWwgPSB0aGlzLmdvQnV0dG9uLnZhbHVlLnNwbGl0KCcgJyk7CgkJCQl0aGlzLmdvQnV0dG9uLnZhbHVlID0gdG1wX3ZhbFswXSArICcgKCcgKyBjb3VudENoZWNrZWQgKyAnKSc7CgkJCX0KCgkJCWNvb2tpZS5jcmVhdGVKU09OKCdjYl8nICsgdGhpcy5wYWdlLCB0aGlzLnNlbGVjdGVkX2lkcyk7CgoJCQl0aGlzLnBhZ2VHb0NvdW50ID0gY291bnRDaGVja2VkOwoJCX0KCX0sCgoJc3VibWl0R286IGZ1bmN0aW9uKGUpIHsKCQllID0gZSB8fCB3aW5kb3cuZXZlbnQ7CgoJCWlmICh0aGlzLnBhZ2VHb0NvdW50ID4gMCkgewoJCQl2YXIgZ29TZWxlY3QgPSAkKCdnbycpOwoJCQl2YXIgY29uZmlybVRleHQgPSBnb1NlbGVjdC5vcHRpb25zW2dvU2VsZWN0LnNlbGVjdGVkSW5kZXhdLmdldEF0dHJpYnV0ZSgnY29uZmlybScpOwoKCQkJaWYgKCFpc19udWxsKGNvbmZpcm1UZXh0KSAmJiAhY29uZmlybShjb25maXJtVGV4dCkpIHsKCQkJCUV2ZW50LnN0b3AoZSk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCgkJCXZhciBmb3JtID0gZ2V0UGFyZW50KHRoaXMuZ29CdXR0b24sICdmb3JtJyk7CgkJCWZvciAodmFyIGtleSBpbiB0aGlzLnNlbGVjdGVkX2lkcykgewoJCQkJaWYgKCFlbXB0eSh0aGlzLnNlbGVjdGVkX2lkc1trZXldKSkgewoJCQkJCWNyZWF0ZV92YXIoZm9ybS5uYW1lLCB0aGlzLnBhZ2VHb05hbWUgKyAnWycgKyBrZXkgKyAnXScsIGtleSwgZmFsc2UpOwoJCQkJfQoJCQl9CgkJCXJldHVybiB0cnVlOwoJCX0KCQllbHNlIHsKCQkJYWxlcnQobG9jYWxlWydTX05PX0VMRU1FTlRTX1NFTEVDVEVEJ10pOwoJCQlFdmVudC5zdG9wKGUpOwoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJfQp9OwoKLyoKICogQXVkaW8gQ29udHJvbCBTeXN0ZW0KICovCnZhciBBdWRpb0xpc3QgPSB7CglsaXN0OgkJe30sIC8vIGF1ZGlvIGZpbGVzIG9wdGlvbnMKCWRvbToJCXt9LCAvLyBkb20gb2JqZWN0cyBsaW5rcwoJc3RhbmRhcnQ6CXsKCQknZW1iZWQnOiB7CgkJCSdlbmFibGVqYXZhc2NyaXB0JzogJ3RydWUnLAoJCQknYXV0b3N0YXJ0JzogJ2ZhbHNlJywKCQkJJ2xvb3AnOiAwCgkJfSwKCQknYXVkaW8nOiB7CgkJCSdhdXRvYnVmZmVyJzogJ2F1dG9idWZmZXInLAoJCQknYXV0b3BsYXknOiBudWxsLAoJCQknY29udHJvbHMnOiBudWxsCgkJfQoJfSwKCglwbGF5OiBmdW5jdGlvbihhdWRpb2ZpbGUpIHsKCQlpZiAoIXRoaXMuY3JlYXRlKGF1ZGlvZmlsZSkpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCQlpZiAoSUUpIHsKCQkJdHJ5IHsKCQkJCXRoaXMuZG9tW2F1ZGlvZmlsZV0uUGxheSgpOwoJCQl9CgkJCWNhdGNoKGUpIHsKCQkJCXNldFRpbWVvdXQodGhpcy5wbGF5LmJpbmQodGhpcywgYXVkaW9maWxlKSwgNTAwKTsKCQkJfQoJCX0KCQllbHNlIHsKCQkJdGhpcy5kb21bYXVkaW9maWxlXS5wbGF5KCk7CgkJfQoJfSwKCglwYXVzZTogZnVuY3Rpb24oYXVkaW9maWxlKSB7CgkJaWYgKCF0aGlzLmNyZWF0ZShhdWRpb2ZpbGUpKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgkJaWYgKElFKSB7CgkJCXRyeSB7CgkJCQl0aGlzLmRvbVthdWRpb2ZpbGVdLlN0b3AoKTsKCQkJfQoJCQljYXRjaChlKSB7CgkJCQlzZXRUaW1lb3V0KHRoaXMucGF1c2UuYmluZCh0aGlzLCBhdWRpb2ZpbGUpLCAxMDAwKTsKCQkJfQoJCX0KCQllbHNlIHsKCQkJdGhpcy5kb21bYXVkaW9maWxlXS5wYXVzZSgpOwoJCX0KCX0sCgoJc3RvcDogZnVuY3Rpb24oYXVkaW9maWxlKSB7CgkJaWYgKCF0aGlzLmNyZWF0ZShhdWRpb2ZpbGUpKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCWlmIChJRSkgewoJCQl0aGlzLmRvbVthdWRpb2ZpbGVdLnNldEF0dHJpYnV0ZSgnbG9vcCcsICcwJyk7CgkJfQoJCWVsc2UgewoJCQl0aGlzLmRvbVthdWRpb2ZpbGVdLnJlbW92ZUF0dHJpYnV0ZSgnbG9vcCcpOwoJCX0KCgkJaWYgKCFJRSkgewoJCQl0cnkgewoJCQkJaWYgKCF0aGlzLmRvbVthdWRpb2ZpbGVdLnBhdXNlZCkgewoJCQkJCXRoaXMuZG9tW2F1ZGlvZmlsZV0uY3VycmVudFRpbWUgPSAwOwoJCQkJfQoJCQkJZWxzZSBpZiAodGhpcy5kb21bYXVkaW9maWxlXS5jdXJyZW50VGltZSA+IDApIHsKCQkJCQl0aGlzLmRvbVthdWRpb2ZpbGVdLnBsYXkoKTsKCQkJCQl0aGlzLmRvbVthdWRpb2ZpbGVdLmN1cnJlbnRUaW1lID0gMDsKCQkJCQl0aGlzLmRvbVthdWRpb2ZpbGVdLnBhdXNlKCk7CgkJCQl9CgkJCX0KCQkJY2F0Y2goZSkgewoJCQl9CgkJfQoKCQlpZiAoIWlzX251bGwodGhpcy5saXN0W2F1ZGlvZmlsZV0udGltZW91dCkpIHsKCQkJY2xlYXJUaW1lb3V0KHRoaXMubGlzdFthdWRpb2ZpbGVdLnRpbWVvdXQpOwoJCQl0aGlzLmxpc3RbYXVkaW9maWxlXS50aW1lb3V0ID0gbnVsbDsKCQl9CgoJCXRoaXMucGF1c2UoYXVkaW9maWxlKTsKCQl0aGlzLmVuZExvb3AoYXVkaW9maWxlKTsKCX0sCgoJc3RvcEFsbDogZnVuY3Rpb24oZSkgewoJCWZvciAodmFyIG5hbWUgaW4gdGhpcy5saXN0KSB7CgkJCWlmIChlbXB0eSh0aGlzLmRvbVtuYW1lXSkpIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgkJCXRoaXMuc3RvcChuYW1lKTsKCQl9Cgl9LAoKCXZvbHVtZTogZnVuY3Rpb24oYXVkaW9maWxlLCB2b2wpIHsKCQlpZiAoIXRoaXMuY3JlYXRlKGF1ZGlvZmlsZSkpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCX0sCgoJbG9vcDogZnVuY3Rpb24oYXVkaW9maWxlLCBwYXJhbXMpIHsKCQlpZiAoIXRoaXMuY3JlYXRlKGF1ZGlvZmlsZSkpIHsKCQkJcmV0dXJuIGZhbHNlOwoJCX0KCgkJaWYgKGlzc2V0KCdyZXBlYXQnLCBwYXJhbXMpKSB7CgkJCWlmIChJRSkgewoJCQkJdGhpcy5wbGF5KGF1ZGlvZmlsZSk7CgkJCX0KCQkJZWxzZSB7CgkJCQlpZiAodGhpcy5saXN0W2F1ZGlvZmlsZV0ubG9vcCA9PSAwKSB7CgkJCQkJaWYgKHBhcmFtcy5yZXBlYXQgIT0gMCkgewoJCQkJCQl0aGlzLnN0YXJ0TG9vcChhdWRpb2ZpbGUsIHBhcmFtcy5yZXBlYXQpOwoJCQkJCX0KCQkJCQllbHNlIHsKCQkJCQkJdGhpcy5lbmRMb29wKGF1ZGlvZmlsZSk7CgkJCQkJfQoJCQkJfQoJCQkJaWYgKHRoaXMubGlzdFthdWRpb2ZpbGVdLmxvb3AgIT0gMCkgewoJCQkJCXRoaXMubGlzdFthdWRpb2ZpbGVdLmxvb3AtLTsKCQkJCQl0aGlzLnBsYXkoYXVkaW9maWxlKTsKCQkJCX0KCQkJfQoJCX0KCQllbHNlIGlmIChpc3NldCgnc2Vjb25kcycsIHBhcmFtcykpIHsKCQkJaWYgKElFKSB7CgkJCQl0aGlzLmRvbVthdWRpb2ZpbGVdLnNldEF0dHJpYnV0ZSgnbG9vcCcsICcxJyk7CgkJCX0KCQkJZWxzZSB7CgkJCQl0aGlzLnN0YXJ0TG9vcChhdWRpb2ZpbGUsIDk5OTk5OTkpOwoJCQkJdGhpcy5saXN0W2F1ZGlvZmlsZV0ubG9vcC0tOwoJCQl9CgkJCXRoaXMucGxheShhdWRpb2ZpbGUpOwoJCQl0aGlzLmxpc3RbYXVkaW9maWxlXS50aW1lb3V0ID0gc2V0VGltZW91dChBdWRpb0xpc3Quc3RvcC5iaW5kKEF1ZGlvTGlzdCwgYXVkaW9maWxlKSwgMTAwMCAqIHBhcnNlSW50KHBhcmFtcy5zZWNvbmRzLCAxMCkpOwoJCX0KCX0sCgoJc3RhcnRMb29wOiBmdW5jdGlvbihhdWRpb2ZpbGUsIGxvb3ApIHsKCQlpZiAoIWlzc2V0KGF1ZGlvZmlsZSwgdGhpcy5saXN0KSkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCWlmIChpc3NldCgnb25FbmRlZCcsIHRoaXMubGlzdFthdWRpb2ZpbGVdKSkgewoJCQl0aGlzLmVuZExvb3AoYXVkaW9maWxlKTsKCQl9CgkJdGhpcy5saXN0W2F1ZGlvZmlsZV0ubG9vcCA9IHBhcnNlSW50KGxvb3AsIDEwKTsKCQl0aGlzLmxpc3RbYXVkaW9maWxlXS5vbkVuZGVkID0gdGhpcy5sb29wLmJpbmQodGhpcywgYXVkaW9maWxlLCB7J3JlcGVhdCcgOiAwfSk7CgkJYWRkTGlzdGVuZXIodGhpcy5kb21bYXVkaW9maWxlXSwgJ2VuZGVkJywgdGhpcy5saXN0W2F1ZGlvZmlsZV0ub25FbmRlZCk7Cgl9LAoKCWVuZExvb3A6IGZ1bmN0aW9uKGF1ZGlvZmlsZSkgewoJCWlmICghaXNzZXQoYXVkaW9maWxlLCB0aGlzLmxpc3QpKSB7CgkJCXJldHVybiB0cnVlOwoJCX0KCQl0aGlzLmxpc3RbYXVkaW9maWxlXS5sb29wID0gMDsKCgkJaWYgKGlzc2V0KCdvbkVuZGVkJywgdGhpcy5saXN0W2F1ZGlvZmlsZV0pKSB7CgkJCXJlbW92ZUxpc3RlbmVyKHRoaXMuZG9tW2F1ZGlvZmlsZV0sICdlbmRlZCcsIHRoaXMubGlzdFthdWRpb2ZpbGVdLm9uRW5kZWQpOwoJCQl0aGlzLmxpc3RbYXVkaW9maWxlXS5vbkVuZGVkID0gbnVsbDsKCQkJZGVsZXRlKHRoaXMubGlzdFthdWRpb2ZpbGVdLm9uRW5kZWQpOwoJCX0KCX0sCgoJY3JlYXRlOiBmdW5jdGlvbihhdWRpb2ZpbGUsIHBhcmFtcykgewoJCWlmICh0eXBlb2YoYXVkaW9maWxlKSA9PSAndW5kZWZpbmVkJykgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCWlmIChpc3NldChhdWRpb2ZpbGUsIHRoaXMubGlzdCkpIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoJCWlmICh0eXBlb2YocGFyYW1zKSA9PSAndW5kZWZpbmVkJykgewoJCQlwYXJhbXMgPSB7fTsKCQl9CgkJaWYgKCFpc3NldCgnYXVkaW9MaXN0JywgdGhpcy5kb20pKSB7CgkJCXRoaXMuZG9tLmF1ZGlvTGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQlkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdLmFwcGVuZENoaWxkKHRoaXMuZG9tLmF1ZGlvTGlzdCk7CgkJCXRoaXMuZG9tLmF1ZGlvTGlzdC5zZXRBdHRyaWJ1dGUoJ2lkJywgJ2F1ZGlvbGlzdCcpOwoJCX0KCgkJaWYgKElFKSB7CgkJCXRoaXMuZG9tW2F1ZGlvZmlsZV0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdlbWJlZCcpOwoJCQl0aGlzLmRvbS5hdWRpb0xpc3QuYXBwZW5kQ2hpbGQodGhpcy5kb21bYXVkaW9maWxlXSk7CgkJCXRoaXMuZG9tW2F1ZGlvZmlsZV0uc2V0QXR0cmlidXRlKCduYW1lJywgYXVkaW9maWxlKTsKCQkJdGhpcy5kb21bYXVkaW9maWxlXS5zZXRBdHRyaWJ1dGUoJ3NyYycsICdhdWRpby8nICsgYXVkaW9maWxlKTsKCQkJdGhpcy5kb21bYXVkaW9maWxlXS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoKCQkJZm9yICh2YXIga2V5IGluIHRoaXMuc3RhbmRhcnQuZW1iZWQpIHsKCQkJCWlmIChpc3NldChrZXksIHBhcmFtcykpIHsKCQkJCQl0aGlzLmRvbVthdWRpb2ZpbGVdLnNldEF0dHJpYnV0ZShrZXksIHBhcmFtc1trZXldKTsKCQkJCX0KCQkJCWVsc2UgaWYgKCFpc19udWxsKHRoaXMuc3RhbmRhcnQuZW1iZWRba2V5XSkpIHsKCQkJCQl0aGlzLmRvbVthdWRpb2ZpbGVdLnNldEF0dHJpYnV0ZShrZXksIHRoaXMuc3RhbmRhcnQuZW1iZWRba2V5XSk7CgkJCQl9CgkJCX0KCQl9CgkJZWxzZSB7CgkJCXRoaXMuZG9tW2F1ZGlvZmlsZV0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhdWRpbycpOwoJCQl0aGlzLmRvbS5hdWRpb0xpc3QuYXBwZW5kQ2hpbGQodGhpcy5kb21bYXVkaW9maWxlXSk7CgkJCXRoaXMuZG9tW2F1ZGlvZmlsZV0uc2V0QXR0cmlidXRlKCdpZCcsIGF1ZGlvZmlsZSk7CgkJCXRoaXMuZG9tW2F1ZGlvZmlsZV0uc2V0QXR0cmlidXRlKCdzcmMnLCAnYXVkaW8vJyArIGF1ZGlvZmlsZSk7CgoJCQlmb3IgKHZhciBrZXkgaW4gdGhpcy5zdGFuZGFydC5hdWRpbykgewoJCQkJaWYgKGlzc2V0KGtleSwgcGFyYW1zKSkgewoJCQkJCXRoaXMuZG9tW2F1ZGlvZmlsZV0uc2V0QXR0cmlidXRlKGtleSwgcGFyYW1zW2tleV0pOwoJCQkJfQoJCQkJZWxzZSBpZiAoIWlzX251bGwodGhpcy5zdGFuZGFydC5hdWRpb1trZXldKSkgewoJCQkJCXRoaXMuZG9tW2F1ZGlvZmlsZV0uc2V0QXR0cmlidXRlKGtleSwgdGhpcy5zdGFuZGFydC5hdWRpb1trZXldKTsKCQkJCX0KCQkJfQoJCQl0aGlzLmRvbVthdWRpb2ZpbGVdLmxvYWQoKTsKCQl9CgkJdGhpcy5saXN0W2F1ZGlvZmlsZV0gPSBwYXJhbXM7CgkJdGhpcy5saXN0W2F1ZGlvZmlsZV0ubG9vcCA9IDA7CgkJdGhpcy5saXN0W2F1ZGlvZmlsZV0udGltZW91dCA9IG51bGw7CgkJcmV0dXJuIHRydWU7Cgl9LAoKCXJlbW92ZTogZnVuY3Rpb24oYXVkaW9maWxlKSB7CgkJaWYgKCFpc3NldChhdWRpb2ZpbGUsIHRoaXMuZG9tKSkgewoJCQlyZXR1cm4gdHJ1ZTsKCQl9CgkJJCh0aGlzLmRvbVthdWRpb2ZpbGVdKS5yZW1vdmUoKTsKCgkJZGVsZXRlKHRoaXMuZG9tW2F1ZGlvZmlsZV0pOwoJCWRlbGV0ZSh0aGlzLmxpc3RbYXVkaW9maWxlXSk7Cgl9Cn07CgovKgogKiBSZXBsYWNlIHN0YW5kYXJkIGJsaW5rIGZ1bmN0aW9uYWxpdHkKICovCi8qKgogKiBTZXRzIEhUTUwgZWxlbWVudHMgdG8gYmxpbmsuCiAqIEV4YW1wbGUgb2YgdXNhZ2U6CiAqICAgICAgPHNwYW4gY2xhc3M9ImJsaW5rIiBkYXRhLXRpbWUtdG8tYmxpbms9IjYwIj50ZXN0IDE8L3NwYW4+CiAqICAgICAgPHNwYW4gY2xhc3M9ImJsaW5rIiBkYXRhLXRpbWUtdG8tYmxpbms9IjMwIj50ZXN0IDI8L3NwYW4+CiAqICAgICAgPHNwYW4gY2xhc3M9ImJsaW5rIj50ZXN0IDM8L3NwYW4+CiAqICAgICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgogKiAgICAgICAgICBqUXVlcnkoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKAogKiAgICAgICAgICAgICAganFCbGluay5ibGluaygpOwogKiAgICAgICAgICApKTsKICogICAgICA8L3NjcmlwdD4KICogRWxlbWVudHMgd2l0aCBjbGFzcyAnYmxpbmsnIHdpbGwgYmxpbmsgZm9yICdkYXRhLXNlY29uZHMtdG8tYmxpbmsnIHNlY29uZHMKICogSWYgJ2RhdGEtc2Vjb25kcy10by1ibGluaycgaXMgb21pdHRlZCwgZWxlbWVudCB3aWxsIGJsaW5rIGZvcmV2ZXIuCiAqIEBhdXRob3IgS29uc3RhbnRpbiBCdXJhdmNvdgogKi8KdmFyIGpxQmxpbmsgPSB7CglzaG93bjogZmFsc2UsIC8vIGFyZSBvYmplY3RzIGN1cnJlbnRseSBzaG93biBvciBoaWRkZW4/CglibGlua0ludGVydmFsOiAxMDAwLCAvLyBob3cgZmFzdCB3aWxsIHRoZXkgYmxpbmsgKG1zKQoJc2Vjb25kc1NpbmNlSW5pdDogMCwKCgkvKioKCSAqIFNob3dzL2hpZGVzIHRoZSBlbGVtZW50cyBhbmQgcmVwZWF0cyBpdCBzZWxmIGFmdGVyICd0aGlzLmJsaW5rSW50ZXJ2YWwnIG1zCgkgKi8KCWJsaW5rOiBmdW5jdGlvbigpIHsKCQl2YXIgb2JqZWN0cyA9IGpRdWVyeSgnLmJsaW5rJyk7CgoJCS8vIG1heWJlIHNvbWUgb2YgdGhlIG9iamVjdHMgc2hvdWxkIG5vdCBibGluayBhbnkgbW9yZT8KCQlvYmplY3RzID0gdGhpcy5maWx0ZXJPdXROb25CbGlua2luZyhvYmplY3RzKTsKCgkJLy8gY2hhbmdpbmcgdmlzaWJpbGl0eSBzdGF0ZQoJCW9iamVjdHMuY3NzKCd2aXNpYmlsaXR5JywgdGhpcy5zaG93biA/ICdoaWRkZW4nIDogJ3Zpc2libGUnKTsKCgkJLy8gcmV2ZXJzaW5nIHRoZSB2YWx1ZSBvZiBpbmRpY2F0b3IgYXR0cmlidXRlCgkJdGhpcy5zaG93biA9ICF0aGlzLnNob3duOwoKCQkvLyBJIGNsb3NlIG15IGV5ZXMgb25seSBmb3IgYSBtb21lbnQsIGFuZCBhIG1vbWVudCdzIGdvbmUKCQl0aGlzLnNlY29uZHNTaW5jZUluaXQgKz0gdGhpcy5ibGlua0ludGVydmFsIC8gMTAwMDsKCgkJLy8gcmVwZWF0aW5nIHRoaXMgZnVuY3Rpb24gd2l0aCBkZWxheQoJCXNldFRpbWVvdXQoalF1ZXJ5LnByb3h5KHRoaXMuYmxpbmssIHRoaXMpLCB0aGlzLmJsaW5rSW50ZXJ2YWwpOwoJfSwKCgkvKioKCSAqIENoZWNrIGFsbCBjdXJyZW50bHkgZm91bmQgb2JqZWN0cyBhbmQgZXhjbHVkZSBvbmVzIHRoYXQgc2hvdWxkIHN0b3AgYmxpbmtpbmcgYnkgbm93CgkgKi8KCWZpbHRlck91dE5vbkJsaW5raW5nOiBmdW5jdGlvbihvYmplY3RzKSB7CgkJdmFyIHRoYXQgPSB0aGlzOwoKCQlyZXR1cm4gb2JqZWN0cy5maWx0ZXIoZnVuY3Rpb24oKSB7CgkJCXZhciBvYmogPSBqUXVlcnkodGhpcyk7CgkJCWlmICh0eXBlb2Ygb2JqLmRhdGEoJ3RpbWVUb0JsaW5rJykgIT09ICd1bmRlZmluZWQnKSB7CgkJCQl2YXIgc2hvdWxkQmxpbmsgPSBwYXJzZUludChvYmouZGF0YSgndGltZVRvQmxpbmsnKSwgMTApID4gdGhhdC5zZWNvbmRzU2luY2VJbml0OwoKCQkJCS8vIGlmIG9iamVjdCBzdG9wcyBibGlua2luZywgaXQgc2hvdWxkIGJlIGxlZnQgdmlzaWJsZQoJCQkJaWYgKCFzaG91bGRCbGluayAmJiAhdGhhdC5zaG93bikgewoJCQkJCW9iai5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpOwoJCQkJfQoJCQkJcmV0dXJuIHNob3VsZEJsaW5rOwoJCQl9CgkJCWVsc2UgewoJCQkJLy8gbm8gdGltZS10by1ibGluayBhdHRyaWJ1dGUsIHNob3VsZCBibGluayBmb3JldmVyCgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCX0pOwoJfQp9OwoKLyoKICogSGludEJveCBjbGFzcy4KICovCnZhciBoaW50Qm94ID0gewoKCWNyZWF0ZUJveDogZnVuY3Rpb24oZSwgdGFyZ2V0LCBoaW50VGV4dCwgd2lkdGgsIGNsYXNzTmFtZSwgaXNTdGF0aWMpIHsKCQl2YXIgYm94ID0galF1ZXJ5KCc8ZGl2PjwvZGl2PicpLmFkZENsYXNzKCdoaW50Ym94Jyk7CgoJCWlmICh0eXBlb2YgaGludFRleHQgPT09ICdzdHJpbmcnKSB7CgkJCWhpbnRUZXh0ID0gaGludFRleHQucmVwbGFjZSgvXG4vZywgJzxiciAvPicpOwoJCX0KCgkJaWYgKCFlbXB0eShjbGFzc05hbWUpKSB7CgkJCWJveC5hcHBlbmQoalF1ZXJ5KCc8c3Bhbj48L3NwYW4+JykuYWRkQ2xhc3MoY2xhc3NOYW1lKS5odG1sKGhpbnRUZXh0KSk7CgkJfQoJCWVsc2UgewoJCQlib3guaHRtbChoaW50VGV4dCk7CgkJfQoKCQlpZiAoIWVtcHR5KHdpZHRoKSkgewoJCQlib3guY3NzKCd3aWR0aCcsIHdpZHRoICsgJ3B4Jyk7CgkJfQoKCQlpZiAoaXNTdGF0aWMpIHsKCQkJdmFyIGNsb3NlX2xpbmsgPSBqUXVlcnkoJzxkaXY+JyArIGxvY2FsZVsnU19DTE9TRSddICsgJzwvZGl2PicpCgkJCQkuYWRkQ2xhc3MoJ2xpbmsnKQoJCQkJLmNzcyh7CgkJCQkJJ3RleHQtYWxpZ24nOiAncmlnaHQnLAoJCQkJCSdib3JkZXItYm90dG9tJzogJzFweCAjMzMzIHNvbGlkJwoJCQkJfSkuY2xpY2soZnVuY3Rpb24oKSB7CgkJCQkJaGludEJveC5oaWRlSGludChlLCB0YXJnZXQsIHRydWUpOwoJCQkJfSk7CgkJCWJveC5wcmVwZW5kKGNsb3NlX2xpbmspOwoJCX0KCgkJalF1ZXJ5KCdib2R5JykuYXBwZW5kKGJveCk7CgoJCXJldHVybiBib3g7Cgl9LAoKCUhpbnRXcmFwZXI6IGZ1bmN0aW9uKGUsIHRhcmdldCwgaGludFRleHQsIHdpZHRoLCBjbGFzc05hbWUpIHsKCQl0YXJnZXQuaXNTdGF0aWMgPSBmYWxzZTsKCgkJalF1ZXJ5KHRhcmdldCkub24oJ21vdXNlZW50ZXInLCBmdW5jdGlvbihlLCBkKSB7CgkJCWlmIChkKSB7CgkJCQllID0gZDsKCQkJfQoJCQloaW50Qm94LnNob3dIaW50KGUsIHRhcmdldCwgaGludFRleHQsIHdpZHRoLCBjbGFzc05hbWUsIGZhbHNlKTsKCgkJfSkub24oJ21vdXNlbGVhdmUnLCBmdW5jdGlvbihlKSB7CgkJCWhpbnRCb3guaGlkZUhpbnQoZSwgdGFyZ2V0KTsKCgkJfSkub24oJ3JlbW92ZScsIGZ1bmN0aW9uKGUpIHsKCQkJaGludEJveC5kZWxldGVIaW50KHRhcmdldCk7CgkJfSk7CgoJCWpRdWVyeSh0YXJnZXQpLnJlbW92ZUF0dHIoJ29ubW91c2VvdmVyJyk7CgkJalF1ZXJ5KHRhcmdldCkudHJpZ2dlcignbW91c2VlbnRlcicsIGUpOwoJfSwKCglzaG93U3RhdGljSGludDogZnVuY3Rpb24oZSwgdGFyZ2V0LCBoaW50LCB3aWR0aCwgY2xhc3NOYW1lLCByZXNpemVBZnRlckxvYWQpIHsKCQl2YXIgaXNTdGF0aWMgPSB0YXJnZXQuaXNTdGF0aWM7CgkJaGludEJveC5oaWRlSGludChlLCB0YXJnZXQsIHRydWUpOwoKCQlpZiAoIWlzU3RhdGljKSB7CgkJCXRhcmdldC5pc1N0YXRpYyA9IHRydWU7CgkJCWhpbnRCb3guc2hvd0hpbnQoZSwgdGFyZ2V0LCBoaW50LCB3aWR0aCwgY2xhc3NOYW1lLCB0cnVlKTsKCgkJCWlmIChyZXNpemVBZnRlckxvYWQpIHsKCQkJCWhpbnQub25lKCdsb2FkJywgZnVuY3Rpb24oZSkgewoJCQkJCWhpbnRCb3gucG9zaXRpb25IaW50KGUsIHRhcmdldCk7CgkJCQl9KTsKCQkJfQoJCX0KCX0sCgoJc2hvd0hpbnQ6IGZ1bmN0aW9uKGUsIHRhcmdldCwgaGludFRleHQsIHdpZHRoLCBjbGFzc05hbWUsIGlzU3RhdGljKSB7CgkJaWYgKHRhcmdldC5oaW50Qm94SXRlbSkgewoJCQlyZXR1cm47CgkJfQoKCQl0YXJnZXQuaGludEJveEl0ZW0gPSBoaW50Qm94LmNyZWF0ZUJveChlLCB0YXJnZXQsIGhpbnRUZXh0LCB3aWR0aCwgY2xhc3NOYW1lLCBpc1N0YXRpYyk7CgkJaGludEJveC5wb3NpdGlvbkhpbnQoZSwgdGFyZ2V0KTsKCQl0YXJnZXQuaGludEJveEl0ZW0uc2hvdygpOwoJfSwKCglwb3NpdGlvbkhpbnQ6IGZ1bmN0aW9uKGUsIHRhcmdldCkgewoJCXZhciB3V2lkdGggPSBqUXVlcnkod2luZG93KS53aWR0aCgpLAoJCQl3SGVpZ2h0ID0galF1ZXJ5KHdpbmRvdykuaGVpZ2h0KCksCgkJCXNjcm9sbFRvcCA9IGpRdWVyeSh3aW5kb3cpLnNjcm9sbFRvcCgpLAoJCQlzY3JvbGxMZWZ0ID0galF1ZXJ5KHdpbmRvdykuc2Nyb2xsTGVmdCgpLAoJCQl0b3AsIGxlZnQ7CgoJCS8vIHVzZXMgc3RvcmVkIGNsaWVudFggb24gYWZ0ZXJsb2FkIHBvc2l0aW9uaW5nIHdoZW4gdGhlcmUgaXMgbm8gZXZlbnQKCQlpZiAoZS5jbGllbnRYKSB7CgkJCXRhcmdldC5jbGllbnRYID0gZS5jbGllbnRYOwoJCQl0YXJnZXQuY2xpZW50WSA9IGUuY2xpZW50WTsKCQl9CgoJCS8vIGRvZXNuJ3QgZml0IGluIHRoZSBzY3JlZW4gaG9yaXpvbnRhbHkKCQlpZiAodGFyZ2V0LmhpbnRCb3hJdGVtLndpZHRoKCkgKyAxMCA+IHdXaWR0aCkgewoJCQlsZWZ0ID0gc2Nyb2xsTGVmdCArIDI7CgkJfQoJCS8vIDEwcHggdG8gcmlnaHQgaWYgZml0CgkJZWxzZSBpZiAod1dpZHRoIC0gdGFyZ2V0LmNsaWVudFggLSAxMCA+IHRhcmdldC5oaW50Qm94SXRlbS53aWR0aCgpKSB7CgkJCWxlZnQgPSBzY3JvbGxMZWZ0ICsgdGFyZ2V0LmNsaWVudFggKyAxMDsKCQl9CgkJLy8gMTBweCBmcm9tIHNjcmVlbiByaWdodCBzaWRlCgkJZWxzZSB7CgkJCWxlZnQgPSBzY3JvbGxMZWZ0ICsgd1dpZHRoIC0gMTAgLSB0YXJnZXQuaGludEJveEl0ZW0ud2lkdGgoKTsKCQl9CgoJCS8vIDEwcHggYmVsb3cgaWYgZml0CgkJaWYgKHdIZWlnaHQgLSB0YXJnZXQuY2xpZW50WSAtIHRhcmdldC5oaW50Qm94SXRlbS5oZWlnaHQoKSAtIDEwID4gMCkgewoJCQl0b3AgPSBzY3JvbGxUb3AgKyB0YXJnZXQuY2xpZW50WSArIDEwOwoJCX0KCQkvLyAxMHB4IGFib3ZlIGlmIGZpdAoJCWVsc2UgaWYgKHRhcmdldC5jbGllbnRZIC0gdGFyZ2V0LmhpbnRCb3hJdGVtLmhlaWdodCgpIC0gMTAgPiAwKSB7CgkJCXRvcCA9IHNjcm9sbFRvcCArIHRhcmdldC5jbGllbnRZIC0gdGFyZ2V0LmhpbnRCb3hJdGVtLmhlaWdodCgpIC0gMTA7CgkJfQoJCS8vIDEwcHggYmVsb3cgYXMgZmFsbGJhY2sKCQllbHNlIHsKCQkJdG9wID0gc2Nyb2xsVG9wICsgdGFyZ2V0LmNsaWVudFkgKyAxMDsKCQl9CgoJCS8vIGZhbGxiYWNrIGlmIGRvZXNudCd0IGZpdCB2ZXJ0aWNhbHkgYnV0IGNvdWxkIGZpdCBpZiBhbGlnbmVkIHRvIHJpZ2h0IG9yIGxlZnQKCQlpZiAoKHRvcCAtIHNjcm9sbFRvcCArIHRhcmdldC5oaW50Qm94SXRlbS5oZWlnaHQoKSA+IHdIZWlnaHQpCgkJCQkmJiAodGFyZ2V0LmNsaWVudFggLSAxMCA+IHRhcmdldC5oaW50Qm94SXRlbS53aWR0aCgpIHx8IHdXaWR0aCAtIHRhcmdldC5jbGllbnRYIC0gMTAgPiB0YXJnZXQuaGludEJveEl0ZW0ud2lkdGgoKSkpIHsKCgkJCS8vIGFsaWduIHRvIGxlZnQgaWYgZml0CgkJCWlmICh3V2lkdGggLSB0YXJnZXQuY2xpZW50WCAtIDEwID4gdGFyZ2V0LmhpbnRCb3hJdGVtLndpZHRoKCkpIHsKCQkJCWxlZnQgPSBzY3JvbGxMZWZ0ICsgdGFyZ2V0LmNsaWVudFggKyAxMDsKCQkJfQoJCQkvLyBhbGlnbiB0byByaWdodAoJCQllbHNlIHsKCQkJCWxlZnQgPSBzY3JvbGxMZWZ0ICsgdGFyZ2V0LmNsaWVudFggLSB0YXJnZXQuaGludEJveEl0ZW0ud2lkdGgoKSAtIDEwOwoJCQl9CgoJCQkvLyAxMHB4IGZyb20gYm90dG9tIGlmIGZpdAoJCQlpZiAod0hlaWdodCAtIDEwID4gdGFyZ2V0LmhpbnRCb3hJdGVtLmhlaWdodCgpKSB7CgkJCQl0b3AgPSBzY3JvbGxUb3AgKyB3SGVpZ2h0IC0gdGFyZ2V0LmhpbnRCb3hJdGVtLmhlaWdodCgpIC0gMTA7CgkJCX0KCQkJLy8gMTBweCBmcm9tIHRvcAoJCQllbHNlIHsKCQkJCXRvcCA9IHNjcm9sbFRvcCArIDEwOwoJCQl9CgkJfQoKCQl0YXJnZXQuaGludEJveEl0ZW0uY3NzKHsKCQkJdG9wOiB0b3AgKyAncHgnLAoJCQlsZWZ0OiBsZWZ0ICsgJ3B4JywKCQkJekluZGV4OiAxMDAKCQl9KTsKCX0sCgoJaGlkZUhpbnQ6IGZ1bmN0aW9uKGUsIHRhcmdldCwgaGlkZVN0YXRpYykgewoJCWlmICh0YXJnZXQuaXNTdGF0aWMgJiYgIWhpZGVTdGF0aWMpIHsKCQkJcmV0dXJuOwoJCX0KCgkJaGludEJveC5kZWxldGVIaW50KHRhcmdldCk7Cgl9LAoKCWRlbGV0ZUhpbnQ6IGZ1bmN0aW9uKHRhcmdldCkgewoJCWlmICh0YXJnZXQuaGludEJveEl0ZW0pIHsKCQkJdGFyZ2V0LmhpbnRCb3hJdGVtLnJlbW92ZSgpOwoJCQlkZWxldGUgdGFyZ2V0LmhpbnRCb3hJdGVtOwoKCQkJaWYgKHRhcmdldC5pc1N0YXRpYykgewoJCQkJZGVsZXRlIHRhcmdldC5pc1N0YXRpYzsKCQkJfQoJCX0KCX0KfTsKCi8qCiAqIENvbG9yIHBpY2tlcgogKi8KZnVuY3Rpb24gaGlkZV9jb2xvcl9waWNrZXIoKSB7CglpZiAoIWNvbG9yX3BpY2tlcikgewoJCXJldHVybjsKCX0KCgljb2xvcl9waWNrZXIuc3R5bGUuekluZGV4ID0gMTAwMDsKCWNvbG9yX3BpY2tlci5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7Cgljb2xvcl9waWNrZXIuc3R5bGUubGVmdCA9ICctJyArICgoY29sb3JfcGlja2VyLnN0eWxlLndpZHRoKSA/IGNvbG9yX3BpY2tlci5zdHlsZS53aWR0aCA6IDEwMCkgKyAncHgnOwoJY3Vycl9sYmwgPSBudWxsOwoJY3Vycl90eHQgPSBudWxsOwp9CgpmdW5jdGlvbiBzaG93X2NvbG9yX3BpY2tlcihpZCkgewoJaWYgKCFjb2xvcl9waWNrZXIpIHsKCQlyZXR1cm47Cgl9CgoJY3Vycl9sYmwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGJsXycgKyBpZCk7CgljdXJyX3R4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKCXZhciBwb3MgPSBnZXRQb3NpdGlvbihjdXJyX2xibCk7Cgljb2xvcl9waWNrZXIueCA9IHBvcy5sZWZ0OwoJY29sb3JfcGlja2VyLnkgPSBwb3MudG9wOwoJY29sb3JfcGlja2VyLnN0eWxlLmxlZnQgPSAoY29sb3JfcGlja2VyLnggKyAyMCkgKyAncHgnOwoJY29sb3JfcGlja2VyLnN0eWxlLnRvcCA9IGNvbG9yX3BpY2tlci55ICsgJ3B4JzsKCWNvbG9yX3BpY2tlci5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnOwp9CgpmdW5jdGlvbiBjcmVhdGVfY29sb3JfcGlja2VyKCkgewoJaWYgKGNvbG9yX3BpY2tlcikgewoJCXJldHVybjsKCX0KCgljb2xvcl9waWNrZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCWNvbG9yX3BpY2tlci5zZXRBdHRyaWJ1dGUoJ2lkJywgJ2NvbG9yX3BpY2tlcicpOwoJY29sb3JfcGlja2VyLmlubmVySFRNTCA9IGNvbG9yX3RhYmxlOwoJZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb2xvcl9waWNrZXIpOwoJaGlkZV9jb2xvcl9waWNrZXIoKTsKfQoKZnVuY3Rpb24gc2V0X2NvbG9yKGNvbG9yKSB7CglpZiAoY3Vycl9sYmwpIHsKCQljdXJyX2xibC5zdHlsZS5iYWNrZ3JvdW5kID0gY3Vycl9sYmwuc3R5bGUuY29sb3IgPSAnIycgKyBjb2xvcjsKCQljdXJyX2xibC50aXRsZSA9ICcjJyArIGNvbG9yOwoJfQoJaWYgKGN1cnJfdHh0KSB7CgkJY3Vycl90eHQudmFsdWUgPSBjb2xvci50b1N0cmluZygpLnRvVXBwZXJDYXNlKCk7Cgl9CgloaWRlX2NvbG9yX3BpY2tlcigpOwp9CgpmdW5jdGlvbiBzZXRfY29sb3JfYnlfbmFtZShpZCwgY29sb3IpIHsKCWN1cnJfbGJsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xibF8nICsgaWQpOwoJY3Vycl90eHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CglzZXRfY29sb3IoY29sb3IpOwp9CgovKgogKiBaYWJiaXggYWpheCByZXF1ZXN0cwogKi8KZnVuY3Rpb24gYWRkMmZhdm9yaXRlcyhmYXZvYmosIGZhdmlkKSB7CglpZiAoJ3VuZGVmaW5lZCcgPT0gdHlwZW9mKEFqYXgpKSB7CgkJdGhyb3coJ1Byb3RvdHlwZS5qcyBsaWIgaXMgcmVxdWlyZWQhJyk7Cgl9CgoJaWYgKHR5cGVvZihmYXZpZCkgPT0gJ3VuZGVmaW5lZCcgfHwgZW1wdHkoZmF2aWQpKSB7CgkJcmV0dXJuOwoJfQoKCXZhciBwYXJhbXMgPSB7CgkJJ2Zhdm9iaic6IGZhdm9iaiwKCQknZmF2aWQnOiBmYXZpZCwKCQknZmF2YWN0aW9uJzogJ2FkZCcKCX07CgoJc2VuZF9wYXJhbXMocGFyYW1zKTsKfQoKZnVuY3Rpb24gcm00ZmF2b3JpdGVzKGZhdm9iaiwgZmF2aWQsIG1lbnVfcm93aWQpIHsKCWlmICgndW5kZWZpbmVkJyA9PSB0eXBlb2YoQWpheCkpIHsKCQl0aHJvdygnUHJvdG90eXBlLmpzIGxpYiBpcyByZXF1aXJlZCEnKTsKCX0KCglpZiAodHlwZW9mKGZhdm9iaikgPT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mKGZhdmlkKSA9PSAndW5kZWZpbmVkJykgewoJCXRocm93ICdObyBhZ3J1bWVudHMgc2VudCB0byBmdW5jdGlvbiBbcm00ZmF2b3JpdGVzKCldLic7Cgl9CgoJdmFyIHBhcmFtcyA9IHsKCQknZmF2b2JqJzogZmF2b2JqLAoJCSdmYXZpZCc6IGZhdmlkLAoJCSdmYXZjbnQnOiBtZW51X3Jvd2lkLAoJCSdmYXZhY3Rpb24nOiAncmVtb3ZlJwoJfTsKCglzZW5kX3BhcmFtcyhwYXJhbXMpOwp9CgpmdW5jdGlvbiBjaGFuZ2VfZmxpY2tlcl9zdGF0ZShkaXZpZCkgewoJZGVzZWxlY3RBbGwoKTsKCgl2YXIgc3dpdGNoQXJyb3dzID0gZnVuY3Rpb24oKSB7CgkJc3dpdGNoRWxlbWVudHNDbGFzcygkKCdmbGlja2VyX2ljb25fbCcpLCAnZGJsX2Fycm93X3VwJywgJ2RibF9hcnJvd19kb3duJyk7CgkJc3dpdGNoRWxlbWVudHNDbGFzcygkKCdmbGlja2VyX2ljb25fcicpLCAnZGJsX2Fycm93X3VwJywgJ2RibF9hcnJvd19kb3duJyk7Cgl9OwoKCXZhciBmaWx0ZXJfc3RhdGUgPSBzaG93SGlkZShkaXZpZCk7Cglzd2l0Y2hBcnJvd3MoKTsKCglpZiAoZmFsc2UgPT09IGZpbHRlcl9zdGF0ZSkgewoJCXJldHVybiBmYWxzZTsKCX0KCgl2YXIgcGFyYW1zID0gewoJCSdmYXZhY3Rpb24nOiAnZmxvcCcsCgkJJ2Zhdm9iaic6ICdmaWx0ZXInLAoJCSdmYXZyZWYnOiBkaXZpZCwKCQknZmF2c3RhdGUnOiBmaWx0ZXJfc3RhdGUKCX07CglzZW5kX3BhcmFtcyhwYXJhbXMpOwoKCS8vIHNlbGVjdGlvbiBib3ggcG9zaXRpb24KCWlmICh0eXBlb2YobW92ZVNCb3hlcykgIT0gJ3VuZGVmaW5lZCcpIHsKCQltb3ZlU0JveGVzKCk7Cgl9Cn0KCmZ1bmN0aW9uIGNoYW5nZUhhdFN0YXRlVUkoaWNvbiwgZGl2aWQpIHsKCWRlc2VsZWN0QWxsKCk7CgoJdmFyIHN3aXRjaEljb24gPSBmdW5jdGlvbigpIHsKCQlzd2l0Y2hFbGVtZW50c0NsYXNzKGljb24sICdhcnJvd3VwJywgJ2Fycm93ZG93bicpOwoJfTsKCglqUXVlcnkoJChkaXZpZCkucGFyZW50Tm9kZSkuCgkJZmluZCgnLmJvZHknKS50b2dnbGUoKS5lbmQoKS4KCQlmaW5kKCcuZm9vdGVyJykudG9nZ2xlKCkuZW5kKCk7CgoJc3dpdGNoSWNvbigpOwoKCXZhciBoYXRfc3RhdGUgPSBqUXVlcnkoaWNvbikuaGFzQ2xhc3MoJ2Fycm93dXAnKSA/IDEgOiAwOwoJaWYgKGZhbHNlID09PSBoYXRfc3RhdGUpIHsKCQlyZXR1cm4gZmFsc2U7Cgl9CgoJdmFyIHBhcmFtcyA9IHsKCQknZmF2YWN0aW9uJzogJ2Zsb3AnLAoJCSdmYXZvYmonOiAnaGF0JywKCQknZmF2cmVmJzogZGl2aWQsCgkJJ2ZhdnN0YXRlJzogaGF0X3N0YXRlCgl9OwoKCXNlbmRfcGFyYW1zKHBhcmFtcyk7Cn0KCmZ1bmN0aW9uIGNoYW5nZV9oYXRfc3RhdGUoaWNvbiwgZGl2aWQpIHsKCWRlc2VsZWN0QWxsKCk7CgoJdmFyIHN3aXRjaEljb24gPSBmdW5jdGlvbigpIHsKCQlzd2l0Y2hFbGVtZW50c0NsYXNzKGljb24sICdhcnJvd3VwJywgJ2Fycm93ZG93bicpOwoJfTsKCgl2YXIgaGF0X3N0YXRlID0gc2hvd0hpZGUoZGl2aWQpOwoJc3dpdGNoSWNvbigpOwoKCWlmIChmYWxzZSA9PT0gaGF0X3N0YXRlKSB7CgkJcmV0dXJuIGZhbHNlOwoJfQoKCXZhciBwYXJhbXMgPSB7CgkJJ2ZhdmFjdGlvbic6ICdmbG9wJywKCQknZmF2b2JqJzogJ2hhdCcsCgkJJ2ZhdnJlZic6IGRpdmlkLAoJCSdmYXZzdGF0ZSc6IGhhdF9zdGF0ZQoJfTsKCglzZW5kX3BhcmFtcyhwYXJhbXMpOwp9CgpmdW5jdGlvbiBzZW5kX3BhcmFtcyhwYXJhbXMpIHsKCWlmICh0eXBlb2YocGFyYW1zKSA9PT0gJ3VuZGVmaW5lZCcpIHsKCQlwYXJhbXMgPSBbXTsKCX0KCgl2YXIgdXJsID0gbmV3IEN1cmwobG9jYXRpb24uaHJlZik7Cgl1cmwuc2V0UXVlcnkoJz9vdXRwdXQ9YWpheCcpOwoKCW5ldyBBamF4LlJlcXVlc3QodXJsLmdldFVybCgpLCB7CgkJCSdtZXRob2QnOiAncG9zdCcsCgkJCSdwYXJhbWV0ZXJzJzogcGFyYW1zLAoJCQknb25TdWNjZXNzJzogZnVuY3Rpb24oKSB7IH0sCgkJCSdvbkZhaWx1cmUnOiBmdW5jdGlvbigpIHsKCQkJCWRvY3VtZW50LmxvY2F0aW9uID0gdXJsLmdldFBhdGgoKSArICc/JyArIE9iamVjdC50b1F1ZXJ5U3RyaW5nKHBhcmFtcyk7CgkJCX0KCQl9CgkpOwp9CgpmdW5jdGlvbiBzZXRSZWZyZXNoUmF0ZShwbWFzdGVyaWQsIGRvbGxpZCwgaW50ZXJ2YWwsIHBhcmFtcykgewoJaWYgKHR5cGVvZihBamF4KSA9PSAndW5kZWZpbmVkJykgewoJCXRocm93KCdQcm90b3R5cGUuanMgbGliIGlzIHJlcXVpcmVkIScpOwoJfQoKCWlmICh0eXBlb2YocGFyYW1zKSA9PSAndW5kZWZpbmVkJyB8fCBpc19udWxsKHBhcmFtcykpIHsKCQlwYXJhbXMgPSB7fTsKCX0KCXBhcmFtc1sncG1hc3RlcmlkJ10gPSBwbWFzdGVyaWQ7CglwYXJhbXNbJ2Zhdm9iaiddID0gJ3NldF9yZl9yYXRlJzsKCXBhcmFtc1snZmF2cmVmJ10gPSBkb2xsaWQ7CglwYXJhbXNbJ2ZhdmNudCddID0gaW50ZXJ2YWw7CgoJc2VuZF9wYXJhbXMocGFyYW1zKTsKfQoKZnVuY3Rpb24gc3dpdGNoX211dGUoaWNvbikgewoJZGVzZWxlY3RBbGwoKTsKCXZhciBzb3VuZF9zdGF0ZSA9IHN3aXRjaEVsZW1lbnRzQ2xhc3MoaWNvbiwgJ2ljb25tdXRlJywgJ2ljb25zb3VuZCcpOwoKCWlmIChmYWxzZSA9PT0gc291bmRfc3RhdGUpIHsKCQlyZXR1cm4gZmFsc2U7Cgl9Cglzb3VuZF9zdGF0ZSA9IChzb3VuZF9zdGF0ZSA9PSAnaWNvbm11dGUnKSA/IDEgOiAwOwoKCXZhciBwYXJhbXMgPSB7CgkJJ2Zhdm9iaic6ICdzb3VuZCcsCgkJJ2ZhdnJlZic6ICdzb3VuZCcsCgkJJ2ZhdnN0YXRlJzogc291bmRfc3RhdGUKCX07CgoJc2VuZF9wYXJhbXMocGFyYW1zKTsKfQoKZnVuY3Rpb24gY3JlYXRlUGxhY2Vob2xkZXJzKCkgewoJaWYgKElFKSB7CgkJalF1ZXJ5KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHsKCQkJJ3VzZSBzdHJpY3QnOwoKCQkJalF1ZXJ5KCdbcGxhY2Vob2xkZXJdJykuZm9jdXMoZnVuY3Rpb24oKSB7CgkJCQlpZiAoalF1ZXJ5KHRoaXMpLnZhbCgpID09IGpRdWVyeSh0aGlzKS5hdHRyKCdwbGFjZWhvbGRlcicpKSB7CgkJCQkJalF1ZXJ5KHRoaXMpLnZhbCgnJyk7CgkJCQkJalF1ZXJ5KHRoaXMpLnJlbW92ZUNsYXNzKCdwbGFjZWhvbGRlcicpOwoJCQkJfQoJCQl9KS5ibHVyKGZ1bmN0aW9uKCkgewoJCQkJaWYgKGpRdWVyeSh0aGlzKS52YWwoKSA9PSAnJyB8fCBqUXVlcnkodGhpcykudmFsKCkgPT0galF1ZXJ5KHRoaXMpLmF0dHIoJ3BsYWNlaG9sZGVyJykpIHsKCQkJCQlqUXVlcnkodGhpcykuYWRkQ2xhc3MoJ3BsYWNlaG9sZGVyJyk7CgkJCQkJalF1ZXJ5KHRoaXMpLnZhbChqUXVlcnkodGhpcykuYXR0cigncGxhY2Vob2xkZXInKSk7CgkJCQl9CgkJCX0pLmJsdXIoKTsKCQl9KTsKCX0KfQoKLyoKKiogWmFiYml4CioqIENvcHlyaWdodCAoQykgMjAwMC0yMDExIFphYmJpeCBTSUEKKioKKiogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKKiogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnkKKiogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMiBvZiB0aGUgTGljZW5zZSwgb3IKKiogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KKioKKiogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsCioqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCioqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGUKKiogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKioKKiogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKKiogYWxvbmcgd2l0aCB0aGlzIHByb2dyYW07IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKKiogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAgMDIxMTAtMTMwMSwgVVNBLgoqKi8KCi8vIHRyaWdnZXIgbG9nIGV4cHJlc3Npb24KdmFyIGxvZ2V4cHJfY291bnQgPSAwOwp2YXIga2V5X2NvdW50ID0gMDsKCmZ1bmN0aW9uIG5leHRPYmplY3QobikgewoJdmFyIHQgPSBuLnBhcmVudE5vZGUudGFnTmFtZTsKCWRvIHsKCQluID0gbi5uZXh0U2libGluZzsKCX0gd2hpbGUgKG4gJiYgbi5ub2RlVHlwZSAhPSAxICYmIG4ucGFyZW50Tm9kZS50YWdOYW1lID09IHQpOwoKCXJldHVybiBuOwp9CgpmdW5jdGlvbiBwcmV2aW91c09iamVjdChwKSB7Cgl2YXIgdCA9IHAucGFyZW50Tm9kZS50YWdOYW1lOwoJZG8gewoJCXAgPSBwLnByZXZpb3VzU2libGluZzsKCX0gd2hpbGUgKHAgJiYgcC5ub2RlVHlwZSAhPSAxICYmIHAucGFyZW50Tm9kZS50YWdOYW1lID09IHQpOwoKCXJldHVybiBwOwp9CgpmdW5jdGlvbiBjYWxsX2luc19tYWNyb19tZW51KGV2KSB7CglzaG93X3BvcHVwX21lbnUoZXYsCgkJWwoJCQlbbG9jYWxlWydTX0lOU0VSVF9NQUNSTyddLCBudWxsLCBudWxsLCB7J291dGVyJyA6IFsncHVtX29oZWFkZXInXSwgJ2lubmVyJyA6IFsncHVtX2loZWFkZXInXX1dLAoJCQlbJ1RSSUdHRVIuVkFMVUU9MCcsIGZ1bmN0aW9uKCkgeyBzZXRfbWFjcm8oMCk7IH0sCgkJCW51bGwsIHsnb3V0ZXInIDogWydwdW1fb19pdGVtJ10sICdpbm5lcicgOiBbJ3B1bV9pX2l0ZW0nXX1dLAoJCQlbJ1RSSUdHRVIuVkFMVUU9MScsIGZ1bmN0aW9uKCkgeyBzZXRfbWFjcm8oMSk7IH0sCgkJCW51bGwsIHsnb3V0ZXInIDogWydwdW1fb19pdGVtJ10sICdpbm5lcicgOiBbJ3B1bV9pX2l0ZW0nXX1dLAoJCQlbJ1RSSUdHRVIuVkFMVUU9MicsIGZ1bmN0aW9uKCkgeyBzZXRfbWFjcm8oMik7IH0sCgkJCW51bGwsIHsnb3V0ZXInIDogWydwdW1fb19pdGVtJ10sICdpbm5lcicgOiBbJ3B1bV9pX2l0ZW0nXX1dLAoJCQlbJ1RSSUdHRVIuVkFMVUUjMCcsIGZ1bmN0aW9uKCkgeyBzZXRfbWFjcm8oMTApOyB9LAoJCQludWxsLCB7J291dGVyJyA6IFsncHVtX29faXRlbSddLCAnaW5uZXInIDogWydwdW1faV9pdGVtJ119XSwKCQkJWydUUklHR0VSLlZBTFVFIzEnLCBmdW5jdGlvbigpIHsgc2V0X21hY3JvKDExKTsgfSwKCQkJbnVsbCwgeydvdXRlcicgOiBbJ3B1bV9vX2l0ZW0nXSwgJ2lubmVyJyA6IFsncHVtX2lfaXRlbSddfV0sCgkJCVsnVFJJR0dFUi5WQUxVRSMyJywgZnVuY3Rpb24oKSB7IHNldF9tYWNybygxMik7IH0sCgkJCW51bGwsIHsnb3V0ZXInIDogWydwdW1fb19pdGVtJ10sICdpbm5lcicgOiBbJ3B1bV9pX2l0ZW0nXX1dCgkJXSwgMTUwKTsKCglyZXR1cm4gZmFsc2U7Cn0KCmZ1bmN0aW9uIGNhbGxfdHJpZ2dlcmxvZ19tZW51KGV2bnQsIGlkLCBuYW1lLCBtZW51X29wdGlvbnMpIHsKCXZhciB0bmFtZSA9IGxvY2FsZVsnU19DUkVBVEVfTE9HX1RSSUdHRVInXTsKCglpZiAodHlwZW9mKG1lbnVfb3B0aW9ucykgIT0gJ3VuZGVmaW5lZCcpIHsKCQlzaG93X3BvcHVwX21lbnUoZXZudCwKCQkJWwoJCQkJW25hbWUsIG51bGwsIG51bGwsIHsnb3V0ZXInIDogWydwdW1fb2hlYWRlciddLCAnaW5uZXInIDogWydwdW1faWhlYWRlciddfV0sCgkJCQlbdG5hbWUsICJqYXZhc2NyaXB0OiBvcGVuV2luQ2VudGVyZWQoJ3RyX2xvZ2Zvcm0ucGhwP3Nmb3JtPTEmaXRlbWlkPSIgKyBpZCArICInLCAnVHJpZ2dlckxvZycsIDc2MCwgNTQwLCAndGl0bGViYXI9bm8sIHJlc2l6YWJsZT15ZXMsIHNjcm9sbGJhcnM9eWVzLCBkaWFsb2c9bm8nKTsiLCB7J291dGVyJyA6IFsncHVtX29faXRlbSddLCAnaW5uZXInIDogWydwdW1faV9pdGVtJ119XSwKCQkJCW1lbnVfb3B0aW9ucwoJCQldLCAyNDApOwoJfQoJZWxzZSB7CgkJc2hvd19wb3B1cF9tZW51KGV2bnQsCgkJCVsKCQkJCVtuYW1lLCBudWxsLCBudWxsLCB7J291dGVyJyA6IFsncHVtX29oZWFkZXInXSwgJ2lubmVyJyA6IFsncHVtX2loZWFkZXInXX1dLAoJCQkJW3RuYW1lLCAiamF2YXNjcmlwdDogb3BlbldpbkNlbnRlcmVkKCd0cl9sb2dmb3JtLnBocD9zZm9ybT0xJml0ZW1pZD0iICsgaWQgKyAiJywgJ1NlcnZpY2VGb3JtJywgNzYwLCA1NDAsICd0aXRsZWJhcj1ubywgcmVzaXphYmxlPXllcywgc2Nyb2xsYmFycz15ZXMsIGRpYWxvZz1ubycpOyIsIHsnb3V0ZXInIDogWydwdW1fb19pdGVtJ10sICdpbm5lcicgOiBbJ3B1bV9pX2l0ZW0nXX1dCgkJCV0sIDE0MCk7Cgl9CglyZXR1cm4gZmFsc2U7Cn0KCmZ1bmN0aW9uIGFkZF9sb2dleHByKCkgewoJdmFyIFJFR0VYUF9FWENMVURFID0gMTsKCXRyeSB7CgkJdmFyIGV4cHIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9nZXhwcicpOwoJCXZhciBleHByX3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwcl90eXBlJyk7CgkJdmFyIGJ0X2FuZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRfa2V5X2FuZCcpOwoJCXZhciBidF9vciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRfa2V5X29yJyk7CgkJdmFyIGlyZWdleHAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXJlZ2V4cCcpOwoJfQoJY2F0Y2goZSkgewoJCXRocm93KCdFcnJvcjogJyArIChJRSA/IGUuZGVzY3JpcHRpb24gOiBlKSk7Cgl9CgoJdmFyIGV4ID0gYnRfYW5kLmRpc2FibGVkID8gJ3wnIDogJyYnOwoJdmFyIGV4X3YgPSBidF9hbmQuZGlzYWJsZWQgPyAnIE9SICcgOiAnIEFORCAnOwoJaWYgKGV4cHJfdC52YWx1ZSA9PSBSRUdFWFBfRVhDTFVERSkgewoJCWV4ID0gYnRfYW5kLmRpc2FibGVkID8gJyYnIDogJ3wnOwoJfQoKCXZhciBleHByZXNzaW9uID0gJyc7Cgl2YXIgZXhwcl92ID0gJyc7Cgl2YXIgbHA7Cglmb3IgKGxwID0gMDsgbHAgPCBrZXlfY291bnQ7IGxwKyspIHsKCQl2YXIga2V5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeU5hbWUoJ2tleXNbJyArIGxwICsgJ11bdmFsdWVdJylbMF07CgkJdmFyIHR5cCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKCdrZXlzWycgKyBscCArICddW3R5cGVdJylbMF07CgkJaWYgKHR5cGVvZihrZXkpICE9ICd1bmRlZmluZWQnICYmIHR5cGVvZih0eXApICE9ICd1bmRlZmluZWQnKSB7CgkJCWlmIChleHByZXNzaW9uICE9ICcnKSB7CgkJCQlleHByZXNzaW9uICs9IGV4OwoJCQkJZXhwcl92ICs9IGV4X3Y7CgkJCX0KCQkJZXhwcmVzc2lvbiArPSB0eXAudmFsdWUgKyAnKCcgKyBrZXkudmFsdWUgKyAnKSc7CgkJCWV4cHJfdiArPSB0eXAudmFsdWUgKyAnKCcgKyBrZXkudmFsdWUgKyAnKSc7CgkJCXJlbW92ZV9rZXl3b3JkKCdrZXl0cicgKyBscCk7CgkJfQoJfQoKCWlmICh0eXBlb2YoZXhwci52YWx1ZSkgIT0gJ3VuZGVmaW5lZCcgJiYgZXhwci52YWx1ZSAhPSAnJykgewoJCWlmIChleHByZXNzaW9uICE9ICcnKSB7CgkJCWV4cHJlc3Npb24gKz0gZXg7CgkJCWV4cHJfdiArPSBleF92OwoJCX0KCQlleHByZXNzaW9uICs9IGlyZWdleHAuY2hlY2tlZCA/ICdpcmVnZXhwJyA6ICdyZWdleHAnOwoJCWV4cHJlc3Npb24gKz0gJygnICsgZXhwci52YWx1ZSArICcpJzsKCQlleHByX3YgKz0gaXJlZ2V4cC5jaGVja2VkID8gJ2lyZWdleHAnIDogJ3JlZ2V4cCc7CgkJZXhwcl92ICs9ICcoJyArIGV4cHIudmFsdWUgKyAnKSc7Cgl9CgoJaWYgKGV4cHJlc3Npb24gPT0gJycpIHsKCQlyZXR1cm4gZmFsc2U7Cgl9CgoJdmFyIGNsYXNzYXR0ciA9IElFID8gJ2NsYXNzTmFtZScgOiAnY2xhc3MnOwoKCXZhciB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7Cglkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXhwX2xpc3QnKS5maXJzdENoaWxkLmFwcGVuZENoaWxkKHRyKTsKCgl0ci5zZXRBdHRyaWJ1dGUoY2xhc3NhdHRyLCAnZXZlbl9yb3cnKTsKCXRyLnNldEF0dHJpYnV0ZSgnaWQnLCAnbG9ndHInICsgbG9nZXhwcl9jb3VudCk7CgoJdmFyIHRkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKCXRyLmFwcGVuZENoaWxkKHRkKTsKCXRkLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGV4cHJfdikpOwoKCXZhciBpbnB1dCA9IElFID8gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnPGlucHV0IG5hbWU9ImV4cHJlc3Npb25zWycgKyBsb2dleHByX2NvdW50ICsgJ11bdmFsdWVdIiAvPicpIDogZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgndHlwZScsICdoaWRkZW4nKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgndmFsdWUnLCBleHByZXNzaW9uKTsKCSFJRSA/IGlucHV0LnNldEF0dHJpYnV0ZSgnbmFtZScsICdleHByZXNzaW9uc1snICsgbG9nZXhwcl9jb3VudCArICddW3ZhbHVlXScpIDogJyc7CgoJdGQuYXBwZW5kQ2hpbGQoaW5wdXQpOwoKCXZhciBpbnB1dCA9IElFID8gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnPGlucHV0IG5hbWU9ImV4cHJlc3Npb25zWycgKyBsb2dleHByX2NvdW50ICsgJ11bdmlld10iIC8+JykgOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ2hpZGRlbicpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCd2YWx1ZScsIGV4cHJfdik7CgkhSUUgPyBpbnB1dC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCAnZXhwcmVzc2lvbnNbJyArIGxvZ2V4cHJfY291bnQgKyAnXVt2aWV3XScpIDogJyc7CgoJdGQuYXBwZW5kQ2hpbGQoaW5wdXQpOwoKCXZhciB0ZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7Cgl0ci5hcHBlbmRDaGlsZCh0ZCk7CgoJdGQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZXhwcl90Lm9wdGlvbnNbZXhwcl90LnNlbGVjdGVkSW5kZXhdLnRleHQpKTsKCgl2YXIgaW5wdXQgPSBJRSA/IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJzxpbnB1dCBuYW1lPSJleHByZXNzaW9uc1snICsgbG9nZXhwcl9jb3VudCArICddW3R5cGVdIiAvPicpIDogZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgndHlwZScsICdoaWRkZW4nKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgndmFsdWUnLCBleHByX3QudmFsdWUpOwoJIUlFID8gaW5wdXQuc2V0QXR0cmlidXRlKCduYW1lJywgJ2V4cHJlc3Npb25zWycgKyBsb2dleHByX2NvdW50ICsgJ11bdHlwZV0nKSA6ICcnOwoKCXRkLmFwcGVuZENoaWxkKGlucHV0KTsKCgkvLyBvcHRpb25hbAoJdmFyIHRkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKCXRyLmFwcGVuZENoaWxkKHRkKTsKCgl0ZC5zZXRBdHRyaWJ1dGUoSUUgPyAnY3NzVGV4dCcgOiAnc3R5bGUnLCAnd2hpdGUtc3BhY2U6IG5vd3JhcDsnKTsKCgl2YXIgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7CglpbWcuc2V0QXR0cmlidXRlKCdzcmMnLCAnaW1hZ2VzL2dlbmVyYWwvYXJyb3dfdXAucG5nJyk7CglpbWcuc2V0QXR0cmlidXRlKCdib3JkZXInLCAnMCcpOwoJaW1nLnNldEF0dHJpYnV0ZSgnYWx0JywgJ3VwJyk7CgoJdmFyIHVybCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKCXVybC5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCAnamF2YXNjcmlwdDogZWxlbWVudF91cCgibG9ndHInICsgbG9nZXhwcl9jb3VudCArICciKTsnKTsKCXVybC5zZXRBdHRyaWJ1dGUoY2xhc3NhdHRyLCAnYWN0aW9uJyk7Cgl1cmwuYXBwZW5kQ2hpbGQoaW1nKTsKCgl0ZC5hcHBlbmRDaGlsZCh1cmwpOwoJdGQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJyAnKSk7CgoJdmFyIGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpOwoJaW1nLnNldEF0dHJpYnV0ZSgnc3JjJywgJ2ltYWdlcy9nZW5lcmFsL2Fycm93X2Rvd24ucG5nJyk7CglpbWcuc2V0QXR0cmlidXRlKCdib3JkZXInLCAnMCcpOwoJaW1nLnNldEF0dHJpYnV0ZSgnYWx0JywgJ2Rvd24nKTsKCgl2YXIgdXJsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwoJdXJsLnNldEF0dHJpYnV0ZSgnaHJlZicsICdqYXZhc2NyaXB0OiBlbGVtZW50X2Rvd24oImxvZ3RyJyArIGxvZ2V4cHJfY291bnQgKyAnIik7Jyk7Cgl1cmwuc2V0QXR0cmlidXRlKGNsYXNzYXR0ciwgJ2FjdGlvbicpOwoJdXJsLmFwcGVuZENoaWxkKGltZyk7CgoJdGQuYXBwZW5kQ2hpbGQodXJsKTsKCgl2YXIgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwoJdHIuYXBwZW5kQ2hpbGQodGQpOwoKCXZhciB1cmwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7Cgl1cmwuc2V0QXR0cmlidXRlKCdocmVmJywgJ2phdmFzY3JpcHQ6IGlmIChjb25maXJtKCInICsgbG9jYWxlWydTX0RFTEVURV9FWFBSRVNTSU9OX1EnXSArICciKSkgeyByZW1vdmVfZXhwcmVzc2lvbigibG9ndHInICsgbG9nZXhwcl9jb3VudCArICciKTsgfScpOwoJdXJsLnNldEF0dHJpYnV0ZShjbGFzc2F0dHIsICdhY3Rpb24nKTsKCXVybC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShsb2NhbGVbJ1NfREVMRVRFJ10pKTsKCgl0ZC5hcHBlbmRDaGlsZCh1cmwpOwoKCWxvZ2V4cHJfY291bnQrKzsKCWV4cHIudmFsdWUgPSAnJzsKCWV4cHJfdC5zZWxlY3RlZEluZGV4PTA7CglidF9hbmQuZGlzYWJsZWQgPSBmYWxzZTsKCWJ0X29yLmRpc2FibGVkID0gZmFsc2U7Cn0KCmZ1bmN0aW9uIHJlbW92ZV9leHByZXNzaW9uKGV4cHJfaWQpIHsKCXZhciBleHByX3RyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZXhwcl9pZCk7Cgl2YXIgaWQgPSBnZXRJZEZyb21Ob2RlSWQoZXhwcl9pZCk7CglpZiAoaXNfbnVtYmVyKGlkKSkgewoJCXZhciBlbG1fdiA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKCdleHByZXNzaW9uc1snICsgaWQgKyAnXVt2YWx1ZV0nKVswXTsKCQl2YXIgZWxtX3QgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZSgnZXhwcmVzc2lvbnNbJyArIGlkICsgJ11bdHlwZV0nKVswXTsKCQl2YXIgZWxtX3MgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZSgnZXhwcmVzc2lvbnNbJyArIGlkICsgJ11bdmlld10nKVswXTsKCgkJaWYgKHR5cGVvZihlbG1fdikgIT0gJ3VuZGVmaW5lZCcpIHsKCQkJZWxtX3YucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbG1fdik7CgkJfQoJCWlmICh0eXBlb2YoZWxtX3QpICE9ICd1bmRlZmluZWQnKSB7CgkJCWVsbV90LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWxtX3QpOwoJCX0KCQlpZiAodHlwZW9mKGVsbV9zKSAhPSAndW5kZWZpbmVkJykgewoJCQllbG1fcy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsbV9zKTsKCQl9Cgl9CglpZiAodHlwZW9mKGV4cHJfdHIpICE9ICd1bmRlZmluZWQnKSB7CgkJZXhwcl90ci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGV4cHJfdHIpOwoJfQp9CgpmdW5jdGlvbiBnZXRJZEZyb21Ob2RlSWQoaWQpIHsKCWlmICh0eXBlb2YoaWQpID09ICdzdHJpbmcnKSB7CgkJdmFyIHJlZyA9IC9sb2d0cihbMC05XSkvaTsKCQlpZCA9IHBhcnNlSW50KGlkLnJlcGxhY2UocmVnLCAnJDEnKSk7Cgl9CglpZiAodHlwZW9mKGlkKSA9PSAnbnVtYmVyJykgewoJCXJldHVybiBpZDsKCX0KCXJldHVybiBudWxsOwp9CgpmdW5jdGlvbiBlbGVtZW50X3VwKGVsZW1lbnRpZCkgewoJdmFyIGNfb2JqID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudGlkKTsKCXZhciBwX29iaiA9IGNfb2JqLnBhcmVudE5vZGU7CgoJaWYgKHR5cGVvZihwX29iaikgPT0gJ3VuZGVmaW5lZCcpIHsKCQlyZXR1cm4gbnVsbDsKCX0KCgl2YXIgYzJfb2JqID0gcHJldmlvdXNPYmplY3QoY19vYmopOwoJaWYgKGMyX29iaiAmJiBjMl9vYmouaWQubGVuZ3RoID4gMCkgewoJCXN3YXBOb2RlcyhjMl9vYmosIGNfb2JqKTsKCQlzd2FwTm9kZXNOYW1lcyhjMl9vYmosIGNfb2JqKTsKCX0KfQoKZnVuY3Rpb24gZWxlbWVudF9kb3duKGVsZW1lbnRpZCkgewoJdmFyIGNfb2JqID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudGlkKTsKCXZhciBwX29iaiA9IGNfb2JqLnBhcmVudE5vZGU7CgoJaWYgKHR5cGVvZihwX29iaikgPT0gJ3VuZGVmaW5lZCcpIHsKCQlyZXR1cm4gbnVsbDsKCX0KCgl2YXIgYzJfb2JqID0gbmV4dE9iamVjdChjX29iaik7CglpZiAoYzJfb2JqICYmIGMyX29iai5pZC5sZW5ndGggPiAwKSB7CgkJc3dhcE5vZGVzKGNfb2JqLCBjMl9vYmopOwoJCXN3YXBOb2Rlc05hbWVzKGNfb2JqLCBjMl9vYmopOwoJfQp9CgpmdW5jdGlvbiBzd2FwTm9kZXMobjEsIG4yKSB7Cgl2YXIgcDEsIHAyLCBiOwoKCWlmICgocDEgPSBuMS5wYXJlbnROb2RlKSAmJiAocDIgPSBuMi5wYXJlbnROb2RlKSkgewoJCWIgPSBuZXh0T2JqZWN0KG4yKTsKCQlpZiAobjEgPT0gYikgewoJCQlyZXR1cm47CgkJfQoKCQlwMS5yZXBsYWNlQ2hpbGQobjIsIG4xKTsgLy8gbmV3LCBvbGQKCQlpZiAoYikgewoJCQkvLyBuMSAtIHRoZSBub2RlIHdoaWNoIHdlIGluc2VydAoJCQkvLyBiIC0gdGhlIG5vZGUgYmVmb3JlIHdoaWNoIHdlIGluc2VydAoJCQlwMi5pbnNlcnRCZWZvcmUobjEsIGIpOwoJCX0KCQllbHNlIHsKCQkJcDIuYXBwZW5kQ2hpbGQobjEpOwoJCX0KCX0KfQoKZnVuY3Rpb24gc3dhcE5vZGVzTmFtZXMobjEsIG4yKSB7Cgl2YXIgaWQxID0gbjEuaWQ7Cgl2YXIgaWQyID0gbjIuaWQ7CglpZiAoaXNfc3RyaW5nKGlkMSkgJiYgaXNfc3RyaW5nKGlkMikpIHsKCQl2YXIgcmVnID0gL2xvZ3RyKFswLTldKS9pOwoJCWlkMSA9IHBhcnNlSW50KGlkMS5yZXBsYWNlKHJlZywgJyQxJykpOwoJCWlkMiA9IHBhcnNlSW50KGlkMi5yZXBsYWNlKHJlZywgJyQxJykpOwoJfQoKCWlmIChpc19udW1iZXIoaWQxKSAmJiBpc19udW1iZXIoaWQyKSkgewoJCXZhciBlbG0gPSBbXTsKCQllbG1bMF0gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZSgnZXhwcmVzc2lvbnNbJyArIGlkMSArICddW3ZhbHVlXScpWzBdOwoJCWVsbVsxXSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKCdleHByZXNzaW9uc1snICsgaWQxICsgJ11bdHlwZV0nKVswXTsKCQllbG1bMl0gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZSgnZXhwcmVzc2lvbnNbJyArIGlkMSArICddW3ZpZXddJylbMF07CgkJZWxtWzNdID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeU5hbWUoJ2V4cHJlc3Npb25zWycgKyBpZDIgKyAnXVt2YWx1ZV0nKVswXTsKCQllbG1bNF0gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZSgnZXhwcmVzc2lvbnNbJyArIGlkMiArICddW3R5cGVdJylbMF07CgkJZWxtWzVdID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeU5hbWUoJ2V4cHJlc3Npb25zWycgKyBpZDIgKyAnXVt2aWV3XScpWzBdOwoKCQlzd2FwTm9kZXMoZWxtWzBdLCBlbG1bM10pOwoJCXN3YXBOb2RlcyhlbG1bMV0sIGVsbVs0XSk7CgkJc3dhcE5vZGVzKGVsbVsyXSwgZWxtWzVdKTsKCgkJcmV0dXJuIHRydWU7Cgl9CglyZXR1cm4gZmFsc2U7Cn0KCmZ1bmN0aW9uIGNsb3NlRm9ybShwYWdlKSB7Cgl0cnkgewoJCS8vIHNldCBoZWFkZXIgY29uZmlybWF0aW9uIG1lc3NhZ2UgdG8gb3BlbmVyCgkJdmFyIG1zZyA9IElFID8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhZ2VfbXNnJykuaW5uZXJUZXh0IDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhZ2VfbXNnJykudGV4dENvbnRlbnQ7CgkJd2luZG93Lm9wZW5lci5sb2NhdGlvbi5yZXBsYWNlKHBhZ2UgKyAnP21zZz0nICsgZW5jb2RlVVJJKG1zZykpOwoJfQoJY2F0Y2goZSkgewoJCXpieF90aHJvdyhlKTsKCX0KCglpZiAoSUUpIHsKCQkvLyBjbG9zZSBjdXJyZW50IHBvcHVwIGFmdGVyIDFzLCB3YWl0IHdoZW4gb3BlbmVyIHdpbmRvdyBpcyByZWZyZXNoZWQgKElFNyBpc3N1ZSkKCQl3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHsgd2luZG93LnNlbGYuY2xvc2UoKSB9LCAxMDAwKTsKCX0KCWVsc2UgewoJCXdpbmRvdy5zZWxmLmNsb3NlKCk7Cgl9Cn0KCmZ1bmN0aW9uIGFkZF9rZXl3b3JkKGJ0X3R5cGUpIHsKCXRyeSB7CgkJdmFyIGV4cHIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9nZXhwcicpOwoJCXZhciBpcmVnZXhwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lyZWdleHAnKTsKCQl2YXIgY2IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChidF90eXBlID09ICdhbmQnID8gJ2FkZF9rZXlfb3InIDogJ2FkZF9rZXlfYW5kJyk7Cgl9CgljYXRjaChlKSB7CgkJdGhyb3coJ0Vycm9yOiAnICsgKElFID8gZS5kZXNjcmlwdGlvbiA6IGUpKTsKCX0KCglpZiAodHlwZW9mKGV4cHIudmFsdWUpID09ICd1bmRlZmluZWQnIHx8IGV4cHIudmFsdWUgPT0gJycpIHsKCQlyZXR1cm4gZmFsc2U7Cgl9CgoJY2IuZGlzYWJsZWQgPSB0cnVlOwoKCXZhciBjbGFzc2F0dHIgPSBJRSA/ICdjbGFzc05hbWUnIDogJ2NsYXNzJzsKCgl2YXIgdHIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpOwoJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2tleV9saXN0JykuZmlyc3RDaGlsZC5hcHBlbmRDaGlsZCh0cik7CgoJdHIuc2V0QXR0cmlidXRlKGNsYXNzYXR0ciwgJ2V2ZW5fcm93Jyk7Cgl0ci5zZXRBdHRyaWJ1dGUoJ2lkJywgJ2tleXRyJyArIGtleV9jb3VudCk7CgoJLy8ga2V5d29yZAoJdmFyIHRkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKCXRyLmFwcGVuZENoaWxkKHRkKTsKCgl0ZC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShleHByLnZhbHVlKSk7CgoJdmFyIGlucHV0ID0gSUUgPyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCc8aW5wdXQgbmFtZT0ia2V5c1snICsga2V5X2NvdW50ICsgJ11bdmFsdWVdIiAvPicpIDogZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgndHlwZScsICdoaWRkZW4nKTsKCWlucHV0LnNldEF0dHJpYnV0ZSgndmFsdWUnLCBleHByLnZhbHVlKTsKCSFJRSA/IGlucHV0LnNldEF0dHJpYnV0ZSgnbmFtZScsICdrZXlzWycgKyBrZXlfY291bnQgKyAnXVt2YWx1ZV0nKSA6ICcnOwoKCXRkLmFwcGVuZENoaWxkKGlucHV0KTsKCgkvLyB0eXBlCgl2YXIgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOwoJdHIuYXBwZW5kQ2hpbGQodGQpOwoKCXRkLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGlyZWdleHAuY2hlY2tlZCA/ICdpcmVnZXhwJyA6ICdyZWdleHAnKSk7CgoJdmFyIGlucHV0ID0gSUUgPyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCc8aW5wdXQgbmFtZT0ia2V5c1snICsga2V5X2NvdW50ICsgJ11bdHlwZV0iIC8+JykgOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ2hpZGRlbicpOwoJaW5wdXQuc2V0QXR0cmlidXRlKCd2YWx1ZScsIGlyZWdleHAuY2hlY2tlZCA/ICdpcmVnZXhwJyA6ICdyZWdleHAnKTsKCSFJRSA/IGlucHV0LnNldEF0dHJpYnV0ZSgnbmFtZScsICdrZXlzWycgKyBrZXlfY291bnQgKyAnXVt0eXBlXScpIDogJyc7CgoJdGQuYXBwZW5kQ2hpbGQoaW5wdXQpOwoKCS8vIGRlbGV0ZQoJdmFyIHRkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsKCXRyLmFwcGVuZENoaWxkKHRkKTsKCgl2YXIgdXJsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwoJdXJsLnNldEF0dHJpYnV0ZSgnaHJlZicsICdqYXZhc2NyaXB0OiBpZihjb25maXJtKCInICsgbG9jYWxlWydTX0RFTEVURV9LRVlXT1JEX1EnXSArICciKSkgcmVtb3ZlX2tleXdvcmQoImtleXRyJyArIGtleV9jb3VudCArICciKTsnKTsKCXVybC5zZXRBdHRyaWJ1dGUoY2xhc3NhdHRyLCAnYWN0aW9uJyk7Cgl1cmwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobG9jYWxlWydTX0RFTEVURSddKSk7CgoJdGQuYXBwZW5kQ2hpbGQodXJsKTsKCglrZXlfY291bnQrKzsKCWV4cHIudmFsdWUgPSAnJzsKfQoKZnVuY3Rpb24gYWRkX2tleXdvcmRfYW5kKCkgewoJYWRkX2tleXdvcmQoJ2FuZCcpOwp9CgpmdW5jdGlvbiBhZGRfa2V5d29yZF9vcigpIHsKCWFkZF9rZXl3b3JkKCdvcicpOwp9CgpmdW5jdGlvbiBnZXRJZEZyb21Ob2RlS2V5SWQoaWQpIHsKCWlmICh0eXBlb2YoaWQpID09ICdzdHJpbmcnKSB7CgkJdmFyIHJlZyA9IC9rZXl0cihbMC05XSkvaTsKCQlpZCA9IHBhcnNlSW50KGlkLnJlcGxhY2UocmVnLCAnJDEnKSk7Cgl9CglpZiAodHlwZW9mKGlkKSA9PSAnbnVtYmVyJykgewoJCXJldHVybiBpZDsKCX0KCXJldHVybiBudWxsOwp9CgpmdW5jdGlvbiByZW1vdmVfa2V5d29yZChrZXlfaWQpIHsKCXZhciBrZXlfdHIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChrZXlfaWQpOwoJdmFyIGlkID0gZ2V0SWRGcm9tTm9kZUtleUlkKGtleV9pZCk7CglpZiAoaXNfbnVtYmVyKGlkKSkgewoJCXZhciBlbG1fdiA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKCdrZXlzWycgKyBpZCArICddW3ZhbHVlXScpWzBdOwoJCXZhciBlbG1fdCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKCdrZXlzWycgKyBpZCArICddW3R5cGVdJylbMF07CgoJCWlmICh0eXBlb2YoZWxtX3YpID09ICd1bmRlZmluZWQnKSB7CgkJCWVsbV92LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWxtX3YpOwoJCX0KCQlpZiAodHlwZW9mKGVsbV90KSA9PSAndW5kZWZpbmVkJykgewoJCQllbG1fdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsbV90KTsKCQl9Cgl9CglpZiAodHlwZW9mKGtleV90cikgIT0gJ3VuZGVmaW5lZCcpIHsKCQlrZXlfdHIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChrZXlfdHIpOwoJfQoKCXZhciBscDsKCXZhciBiRGF0YSA9IGZhbHNlOwoJZm9yIChscCA9IDA7IGxwIDwga2V5X2NvdW50OyBscCsrKSB7CgkJdmFyIGVsbV92ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeU5hbWUoJ2tleXNbJyArIGxwICsgJ11bdmFsdWVdJylbMF07CgkJaWYgKHR5cGVvZihlbG1fdikgIT0gJ3VuZGVmaW5lZCcpIHsKCQkJYkRhdGEgPSB0cnVlOwoJCX0KCX0KCWlmICghYkRhdGEpIHsKCQl2YXIgYnRfYW5kID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZF9rZXlfYW5kJyk7CgkJdmFyIGJ0X29yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZF9rZXlfb3InKTsKCQlpZiAodHlwZW9mKGJ0X2FuZCkgIT0gJ3VuZGVmaW5lZCcpIHsKCQkJYnRfYW5kLmRpc2FibGVkID0gZmFsc2U7CgkJfQoJCWlmICh0eXBlb2YoYnRfb3IpICE9ICd1bmRlZmluZWQnKSB7CgkJCWJ0X29yLmRpc2FibGVkID0gZmFsc2U7CgkJfQoJfQp9CgpmdW5jdGlvbiBjaGVja190YXJnZXQoZSkgewoJdmFyIHRhcmdldHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5TmFtZSgnZXhwcl90YXJnZXRfc2luZ2xlJyk7Cglmb3IgKHZhciBpID0gMDsgaSA8IHRhcmdldHMubGVuZ3RoOyArK2kpIHsKCQl0YXJnZXRzW2ldLmNoZWNrZWQgPSB0YXJnZXRzW2ldID09IGU7Cgl9Cn0KCmZ1bmN0aW9uIGRlbGV0ZV9leHByZXNzaW9uKGV4cHJfaWQpIHsKCWRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKCdyZW1vdmVfZXhwcmVzc2lvbicpWzBdLnZhbHVlID0gZXhwcl9pZDsKfQoKZnVuY3Rpb24gY29weV9leHByZXNzaW9uKGlkKSB7Cgl2YXIgZXhwcl90ZW1wID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeU5hbWUoJ2V4cHJfdGVtcCcpWzBdOwoJaWYgKGV4cHJfdGVtcC52YWx1ZS5sZW5ndGggPiAwICYmICFjb25maXJtKGxvY2FsZVsnRE9fWU9VX1JFUExBQ0VfQ09ORElUSU9OQUxfRVhQUkVTU0lPTl9RJ10pKSB7CgkJcmV0dXJuIG51bGw7Cgl9CgoJdmFyIHNyYyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKCWlmICh0eXBlb2Ygc3JjLnRleHRDb250ZW50ICE9ICd1bmRlZmluZWQnKSB7CgkJZXhwcl90ZW1wLnZhbHVlID0gc3JjLnRleHRDb250ZW50OwoJfQoJZWxzZSB7CgkJZXhwcl90ZW1wLnZhbHVlID0gc3JjLmlubmVyVGV4dDsKCX0KfQoKZnVuY3Rpb24gc2V0X21hY3JvKHYpIHsKCXZhciBleHByX3RlbXAgPSBqUXVlcnkoJyNleHByX3RlbXAnKTsKCWlmIChleHByX3RlbXAudmFsKCkubGVuZ3RoID4gMCAmJiAhY29uZmlybShsb2NhbGVbJ0RPX1lPVV9SRVBMQUNFX0NPTkRJVElPTkFMX0VYUFJFU1NJT05fUSddKSkgewoJCXJldHVybiBmYWxzZTsKCX0KCgl2YXIgc2lnbiA9ICc9JzsKCWlmICh2ID49IDEwKSB7CgkJdiAlPSAxMDsKCQlzaWduID0gJyMnOwoJfQoJZXhwcl90ZW1wLnZhbCgne1RSSUdHRVIuVkFMVUV9JyArIHNpZ24gKyB2KTsKCglyZXR1cm4gdHJ1ZTsKfQoKLyoKICogR3JhcGggcmVsYXRlZCBzdHVmZgogKi8KdmFyIGdyYXBocyA9IHsKCWdyYXBodHlwZSA6IDAsCgoJc3VibWl0IDogZnVuY3Rpb24ob2JqKSB7CgkJaWYgKG9iai5uYW1lID09ICdncmFwaHR5cGUnKSB7CgkJCWlmICgob2JqLnNlbGVjdGVkSW5kZXggPiAxICYmIHRoaXMuZ3JhcGh0eXBlIDwgMikgfHwgKG9iai5zZWxlY3RlZEluZGV4IDwgMiAmJiB0aGlzLmdyYXBodHlwZSA+IDEpKSB7CgkJCQl2YXIgcmVmciA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKCdmb3JtX3JlZnJlc2gnKTsKCQkJCXJlZnJbMF0udmFsdWUgPSAwOwoJCQl9CgkJfQoJCWRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKCdmcm1fZ3JhcGgnKVswXS5zdWJtaXQoKTsKCX0KfTsKCmZ1bmN0aW9uIGNsb25lUm93KGVsZW1lbnRpZCwgY291bnQpIHsKCWlmICh0eXBlb2YoY2xvbmVSb3cuY291bnQpID09ICd1bmRlZmluZWQnKSB7CgkJY2xvbmVSb3cuY291bnQgPSBjb3VudDsKCX0KCWNsb25lUm93LmNvdW50Kys7CgoJdmFyIHRwbCA9IG5ldyBUZW1wbGF0ZSgkKGVsZW1lbnRpZCkuY2xvbmVOb2RlKHRydWUpLndyYXAoJ2RpdicpLmlubmVySFRNTCk7CgoJdmFyIGVtcHR5RW50cnkgPSB0cGwuZXZhbHVhdGUoeydpZCcgOiBjbG9uZVJvdy5jb3VudH0pOwoKCXZhciBuZXdFbnRyeSA9ICQoZWxlbWVudGlkKS5pbnNlcnQoeydiZWZvcmUnIDogZW1wdHlFbnRyeX0pLnByZXZpb3VzU2libGluZzsKCgkkKG5ld0VudHJ5KS5kZXNjZW5kYW50cygpLmVhY2goZnVuY3Rpb24oZSkgewoJCWUucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpOwoJfSk7CgluZXdFbnRyeS5zZXRBdHRyaWJ1dGUoJ2lkJywgJ2VudHJ5XycgKyBjbG9uZVJvdy5jb3VudCk7CgluZXdFbnRyeS5zdHlsZS5kaXNwbGF5ID0gJyc7Cn0KCi8vIGRhc2hib2FyZCBqcyBtZW51CmZ1bmN0aW9uIGNyZWF0ZV9wYWdlX21lbnUoZSwgaWQpIHsKCWlmICghZSkgewoJCWUgPSB3aW5kb3cuZXZlbnQ7Cgl9CglpZCA9ICdtZW51XycgKyBpZDsKCgl2YXIgZGJyZF9tZW51ID0gW107CgoJLy8gdG8gY3JlYXRlIGEgY29weSBvZiBhcnJheSwgYnV0IG5vdCByZWZlcmVuY2VzISEhIQoJZm9yICh2YXIgaT0wOyBpIDwgcGFnZV9tZW51W2lkXS5sZW5ndGg7IGkrKykgewoJCWlmICh0eXBlb2YocGFnZV9tZW51W2lkXVtpXSkgIT0gJ3VuZGVmaW5lZCcgJiYgIWVtcHR5KHBhZ2VfbWVudVtpZF1baV0pKSB7CgkJCWRicmRfbWVudVtpXSA9IHBhZ2VfbWVudVtpZF1baV0uY2xvbmUoKTsKCQl9Cgl9CgoJZm9yICh2YXIgaSA9IDA7IGkgPCBwYWdlX3N1Ym1lbnVbaWRdLmxlbmd0aDsgaSsrKSB7CgkJaWYgKHR5cGVvZihwYWdlX3N1Ym1lbnVbaWRdW2ldKSAhPSAndW5kZWZpbmVkJyAmJiAhZW1wdHkocGFnZV9zdWJtZW51W2lkXVtpXSkpIHsKCQkJdmFyIHJvdyA9IHBhZ2Vfc3VibWVudVtpZF1baV07CgkJCXZhciBtZW51X3JvdyA9IFtyb3cubmFtZSwgImphdmFzY3JpcHQ6IHJtNGZhdm9yaXRlcygnIiArIHJvdy5mYXZvYmogKyAiJywgJyIgKyByb3cuZmF2aWQgKyAiJywgJyIgKyBpICsgIicpOyJdOwoJCQlkYnJkX21lbnVbZGJyZF9tZW51Lmxlbmd0aC0xXS5wdXNoKG1lbnVfcm93KTsKCQl9Cgl9CglzaG93X3BvcHVwX21lbnUoZSwgZGJyZF9tZW51KTsKfQoKLy8gdHJpZ2dlcnMganMgbWVudQpmdW5jdGlvbiBjcmVhdGVfbW9uX3RyaWdnZXJfbWVudShlLCBhcmdzLCBpdGVtcykgewoJdmFyIHRyX21lbnUgPSBbW3QoJ1RyaWdnZXJzJyksIG51bGwsIG51bGwsIHsnb3V0ZXInIDogWydwdW1fb2hlYWRlciddLCAnaW5uZXInIDogWydwdW1faWhlYWRlciddfV0sIFt0KCdFdmVudHMnKSwgJ2V2ZW50cy5waHA/dHJpZ2dlcmlkPScgKyBhcmdzWzBdLnRyaWdnZXJpZCArICcmbmF2X3RpbWU9JyArIGFyZ3NbMF0ubGFzdGNoYW5nZSwgbnVsbF1dOwoJaWYgKGFyZ3MubGVuZ3RoID4gMSAmJiAhaXNfbnVsbChhcmdzWzFdKSkgewoJCXRyX21lbnUucHVzaChhcmdzWzFdKTsKCX0KCWlmIChhcmdzLmxlbmd0aCA+IDEgJiYgIWlzX251bGwoYXJnc1syXSkpIHsKCQl0cl9tZW51LnB1c2goYXJnc1syXSk7Cgl9CgoJLy8gZ2V0dGluZyBpbmZvIGFib3V0IHR5cGVzIG9mIGl0ZW1zIHRoYXQgd2UgaGF2ZQoJdmFyIGhhc19jaGFyX2l0ZW1zID0gZmFsc2U7Cgl2YXIgaGFzX2ludF9pdGVtcyA9IGZhbHNlOwoKCS8vIGNoZWNraW5nIGV2ZXJ5IGl0ZW0KCWZvciAodmFyIGl0ZW1pZCBpbiBpdGVtcykgewoJCS8vIGlmIG5vIGluZm8gYWJvdXQgdHlwZSBpcyBnaXZlbgoJCWlmICghaXNzZXQoaXRlbWlkLCBpdGVtcykpIHsKCQkJY29udGludWU7CgkJfQoJCWlmICghaXNzZXQoJ3ZhbHVlX3R5cGUnLCBpdGVtc1tpdGVtaWRdKSkgewoJCQljb250aW51ZTsKCQl9CgoJCS8vIDEsIDIsIDQgLSBjaGFyYWN0ZXIgdHlwZXMKCQlpZiAoaXRlbXNbaXRlbWlkXS52YWx1ZV90eXBlID09ICcxJyB8fCBpdGVtc1tpdGVtaWRdLnZhbHVlX3R5cGUgPT0gJzInIHx8IGl0ZW1zW2l0ZW1pZF0udmFsdWVfdHlwZSA9PSAnNCcpIHsKCQkJaGFzX2NoYXJfaXRlbXMgPSB0cnVlOwoJCX0KCQkvLyAwLCAzIC0gbnVtZXJpYyB0eXBlcwoJCWlmIChpdGVtc1tpdGVtaWRdLnZhbHVlX3R5cGUgPT0gJzAnIHx8IGl0ZW1zW2l0ZW1pZF0udmFsdWVfdHlwZSA9PSAnMycpIHsKCQkJaGFzX2ludF9pdGVtcyA9IHRydWU7CgkJfQoJfQoKCXZhciBoaXN0b3J5X3NlY3Rpb25fY2FwdGlvbiA9ICcnOwoJLy8gd2UgaGF2ZSBjaGFycyBhbmQgbnVtYmVycywgb3Igd2UgaGF2ZSBub25lIChwcm9iYWJseSAndmFsdWVfdHlwZScga2V5IHdhcyBub3Qgc2V0KQoJaWYgKGhhc19jaGFyX2l0ZW1zID09IGhhc19pbnRfaXRlbXMpIHsKCQloaXN0b3J5X3NlY3Rpb25fY2FwdGlvbiA9IHQoJ0hpc3RvcnkgYW5kIHNpbXBsZSBncmFwaHMnKTsKCX0KCS8vIHdlIGhhdmUgb25seSBjaGFyYWN0ZXIgaXRlbXMsIHNvICdoaXN0b3J5JyBzaG91bGQgYmUgc2hvd24KCWVsc2UgaWYgKGhhc19jaGFyX2l0ZW1zKSB7CgkJaGlzdG9yeV9zZWN0aW9uX2NhcHRpb24gPSB0KCdIaXN0b3J5Jyk7Cgl9CgkvLyB3ZSBoYXZlIG9ubHkgbnVtZXJpYyBpdGVtcywgc28gJ3NpbXBsZSBncmFwaHMnIHNob3VsZCBiZSBzaG93bgoJZWxzZSB7CgkJaGlzdG9yeV9zZWN0aW9uX2NhcHRpb24gPSB0KCdTaW1wbGUgZ3JhcGhzJyk7Cgl9CgoJdHJfbWVudS5wdXNoKFtoaXN0b3J5X3NlY3Rpb25fY2FwdGlvbiwgbnVsbCwgbnVsbCwgeydvdXRlcicgOiBbJ3B1bV9vaGVhZGVyJ10sICdpbm5lcicgOiBbJ3B1bV9paGVhZGVyJ119XSk7CgoJZm9yICh2YXIgaXRlbWlkIGluIGl0ZW1zKSB7CgkJaWYgKCFpc3NldChpdGVtaWQsIGl0ZW1zKSkgewoJCQljb250aW51ZTsKCQl9CgkJdHJfbWVudS5wdXNoKFtpdGVtc1tpdGVtaWRdLm5hbWUsICdoaXN0b3J5LnBocD9hY3Rpb249JyArIGl0ZW1zW2l0ZW1pZF0uYWN0aW9uICsgJyZpdGVtaWQ9JyArIGl0ZW1zW2l0ZW1pZF0uaXRlbWlkLCBudWxsXSk7Cgl9CglzaG93X3BvcHVwX21lbnUoZSwgdHJfbWVudSwgMjgwKTsKfQoKZnVuY3Rpb24gdGVzdFVzZXJTb3VuZChpZHgpIHsKCXZhciBzb3VuZCA9ICQoaWR4KS5vcHRpb25zWyQoaWR4KS5zZWxlY3RlZEluZGV4XS52YWx1ZTsKCXZhciByZXBlYXQgPSAkKCdtZXNzYWdlc19zb3VuZHMucmVwZWF0Jykub3B0aW9uc1skKCdtZXNzYWdlc19zb3VuZHMucmVwZWF0Jykuc2VsZWN0ZWRJbmRleF0udmFsdWU7CgoJaWYgKHJlcGVhdCA9PSAxKSB7CgkJQXVkaW9MaXN0LnBsYXkoc291bmQpOwoJfQoJZWxzZSBpZiAocmVwZWF0ID4gMSkgewoJCUF1ZGlvTGlzdC5sb29wKHNvdW5kLCB7J3NlY29uZHMnOiByZXBlYXR9KTsKCX0KCWVsc2UgewoJCUF1ZGlvTGlzdC5sb29wKHNvdW5kLCB7J3NlY29uZHMnOiAkKCdtZXNzYWdlc190aW1lb3V0JykudmFsdWV9KTsKCX0KfQoKZnVuY3Rpb24gcmVtb3ZlT2JqZWN0QnlJZChpZCkgewoJdmFyIG9iaiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKCWlmIChvYmogIT0gbnVsbCAmJiB0eXBlb2Yob2JqKSA9PSAnb2JqZWN0JykgewoJCW9iai5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG9iaik7Cgl9Cn0KCi8qKgogKiBDb252ZXJ0cyBhbGwgSFRNTCBlbnRpdGllcyBpbnRvIHRoZSBjb3JyZXNwb25kaW5nIHN5bWJvbHMuCiAqLwpqUXVlcnkudW5lc2NhcGVIdG1sID0gZnVuY3Rpb24oaHRtbCkgewoJcmV0dXJuIGpRdWVyeSgnPGRpdiAvPicpLmh0bWwoaHRtbCkudGV4dCgpOwp9CgovKioKICogQ29udmVydHMgYWxsIEhUTUwgc3ltYm9scyBpbnRvIEhUTUwgZW50aXRpZXMuCiAqLwpqUXVlcnkuZXNjYXBlSHRtbCA9IGZ1bmN0aW9uKGh0bWwpIHsKCXJldHVybiBqUXVlcnkoJzxkaXYgLz4nKS50ZXh0KGh0bWwpLmh0bWwoKTsKfQoKZnVuY3Rpb24gdmFsaWRhdGVOdW1lcmljQm94KG9iaiwgYWxsb3dlbXB0eSwgYWxsb3duZWdhdGl2ZSkgewoJaWYgKG9iaiAhPSBudWxsKSB7CgkJaWYgKGFsbG93ZW1wdHkpIHsKCQkJaWYgKG9iai52YWx1ZS5sZW5ndGggPT0gMCB8fCBvYmoudmFsdWUgPT0gbnVsbCkgewoJCQkJb2JqLnZhbHVlID0gJyc7CgkJCX0KCQkJZWxzZSB7CgkJCQlpZiAoaXNOYU4ocGFyc2VJbnQob2JqLnZhbHVlLCAxMCkpKSB7CgkJCQkJb2JqLnZhbHVlID0gMDsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCW9iai52YWx1ZSA9IHBhcnNlSW50KG9iai52YWx1ZSwgMTApOwoJCQkJfQoJCQl9CgkJfQoJCWVsc2UgewoJCQlpZiAoaXNOYU4ocGFyc2VJbnQob2JqLnZhbHVlLCAxMCkpKSB7CgkJCQlvYmoudmFsdWUgPSAwOwoJCQl9CgkJCWVsc2UgewoJCQkJb2JqLnZhbHVlID0gcGFyc2VJbnQob2JqLnZhbHVlLCAxMCk7CgkJCX0KCQl9Cgl9CglpZiAoIWFsbG93bmVnYXRpdmUpIHsKCQlpZiAob2JqLnZhbHVlIDwgMCkgewoJCQlvYmoudmFsdWUgPSBvYmoudmFsdWUgKiAtMTsKCQl9Cgl9Cn0KCi8qKgogKiBUcmFuc2xhdGVzIHRoZSBnaXZlbiBzdHJpbmcuCiAqCiAqIEBwYXJhbSB7U3RyaW5nfSBzdHIKICovCmZ1bmN0aW9uIHQoc3RyKSB7CglyZXR1cm4gKCEhbG9jYWxlW3N0cl0pID8gbG9jYWxlW3N0cl0gOiBzdHI7Cn0KCi8qKgogKiBHZW5lcmF0ZXMgdW5pcXVlIGlkIHdpdGggcHJlZml4ICduZXcnLgogKiBpZCBzdGFydHMgZnJvbSAwIGluIGVhY2ggSlMgc2Vzc2lvbi4KICoKICogQHJldHVybiBzdHJpbmcKICovCmZ1bmN0aW9uIGdldFVuaXF1ZUlkKCkgewoJaWYgKHR5cGVvZiBnZXRVbmlxdWVJZC5pZCA9PT0gJ3VuZGVmaW5lZCcpIHsKCQlnZXRVbmlxdWVJZC5pZCA9IDA7Cgl9CglyZXR1cm4gJ25ldycgKyAoZ2V0VW5pcXVlSWQuaWQrKykudG9TdHJpbmcoKTsKfQoKLyoqCiAqIENvbG9yIHBhbGV0dGUsIChpbXBsZW1lbnRhdGlvbiBmcm9tIFBIUCkKICovCnZhciBwcmV2Q29sb3IgPSB7J2NvbG9yJzogMCwgJ2dyYWRpZW50JzogMH07CgpmdW5jdGlvbiBpbmNyZW1lbnROZXh0Q29sb3IoKSB7CglwcmV2Q29sb3JbJ2NvbG9yJ10rKzsKCWlmIChwcmV2Q29sb3JbJ2NvbG9yJ10gPT0gNykgewoJCXByZXZDb2xvclsnY29sb3InXSA9IDA7CgoJCXByZXZDb2xvclsnZ3JhZGllbnQnXSsrOwoJCWlmIChwcmV2Q29sb3JbJ2dyYWRpZW50J10gPT0gMykgewoJCQlwcmV2Q29sb3JbJ2dyYWRpZW50J10gPSAwOwoJCX0KCX0KfQoKZnVuY3Rpb24gZ2V0TmV4dENvbG9yKHBhbGV0dGVUeXBlKSB7Cgl2YXIgcGFsZXR0ZSwgZ3JhZGllbnQsIGhleENvbG9yLCByLCBnLCBiOwoKCXN3aXRjaCAocGFsZXR0ZVR5cGUpIHsKCQljYXNlIDE6CgkJCXBhbGV0dGUgPSBbMjAwLCAxNTAsIDI1NSwgMTAwLCA1MCwgMF07CgkJCWJyZWFrOwoJCWNhc2UgMjoKCQkJcGFsZXR0ZSA9IFsxMDAsIDUwLCAyMDAsIDE1MCwgMjUwLCAwXTsKCQkJYnJlYWs7CgkJY2FzZSAwOgoJCWRlZmF1bHQ6CgkJCXBhbGV0dGUgPSBbMjU1LCAyMDAsIDE1MCwgMTAwLCA1MCwgMF07CgkJCWJyZWFrOwoJfQoKCWdyYWRpZW50ID0gcGFsZXR0ZVtwcmV2Q29sb3JbJ2dyYWRpZW50J11dOwoJciA9ICgxMDAgPCBncmFkaWVudCkgPyAwIDogMjU1OwoJZyA9IHI7CgliID0gcjsKCglzd2l0Y2ggKHByZXZDb2xvclsnY29sb3InXSkgewoJCWNhc2UgMDoKCQkJciA9IGdyYWRpZW50OwoJCQlicmVhazsKCQljYXNlIDE6CgkJCWcgPSBncmFkaWVudDsKCQkJYnJlYWs7CgkJY2FzZSAyOgoJCQliID0gZ3JhZGllbnQ7CgkJCWJyZWFrOwoJCWNhc2UgMzoKCQkJYiA9IGdyYWRpZW50OwoJCQlyID0gYjsKCQkJYnJlYWs7CgkJY2FzZSA0OgoJCQliID0gZ3JhZGllbnQ7CgkJCWcgPSBiOwoJCQlicmVhazsKCQljYXNlIDU6CgkJCWcgPSBncmFkaWVudDsKCQkJciA9IGc7CgkJCWJyZWFrOwoJCWNhc2UgNjoKCQkJYiA9IGdyYWRpZW50OwoJCQlnID0gYjsKCQkJciA9IGI7CgkJCWJyZWFrOwoJfQoKCWluY3JlbWVudE5leHRDb2xvcigpOwoKCWhleENvbG9yID0gKCcwJyArIHBhcnNlSW50KHIsIDEwKS50b1N0cmluZygxNikpLnNsaWNlKC0yKQoJCQkJKyAoJzAnICsgcGFyc2VJbnQoZywgMTApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpCgkJCQkrICgnMCcgKyBwYXJzZUludChiLCAxMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtMik7CgoJcmV0dXJuIGhleENvbG9yLnRvVXBwZXJDYXNlKCk7Cn0KCi8qKgogKiBVc2VkIGZvciBwaHAgY3R3ZWVuYm94IG9iamVjdC4KICogTW92ZXMgaXRlbSBmcm9tICdmcm9tJyBzZWxlY3QgdG8gJ3RvJyBzZWxlY3QgYW5kIGFkZHMgb3IgcmVtb3ZlcyBoaWRkZW4gZmllbGRzIHRvICdmb3JtbmFtZScgZm9yIHBvc3RpbmcgZGF0YS4KICogTW92aW5nIHBlcnNlcnZlcyBhbHBoYWJldGljYWwgb3JkZXIuCiAqCiAqIEBmb3JtbmFtZSBzdHJpbmcJZm9ybSBuYW1lIHdoZXJlIGhpZGRlbiBmaWVsZHMgd2lsbCBiZSBhZGRlZAogKiBAb2JqbmFtZSBzdHJpbmcJdW5pcXVlIG5hbWUgZm9yIGhpZGRlbiBmaWVsZCBuYW1pbmcKICogQGZyb20gc3RyaW5nCQlmcm9tIHNlbGVjdCBpZAogKiBAdG8gc3RyaW5nCQl0byBzZWxlY3QgaWQKICogQGFjdGlvbiBzdHJpbmcJYWN0aW9uIHRvIHBlcmZvcm0gd2l0aCBoaWRkZW4gZmllbGQKICoKICogQHJldHVybiB0cnVlCiAqLwpmdW5jdGlvbiBtb3ZlTGlzdEJveFNlbGVjdGVkSXRlbShmb3JtbmFtZSwgb2JqbmFtZSwgZnJvbSwgdG8sIGFjdGlvbikgewoJdG8gPSBqUXVlcnkoJyMnICsgdG8pOwoKCWpRdWVyeSgnIycgKyBmcm9tKS5maW5kKCdvcHRpb246c2VsZWN0ZWQnKS5lYWNoKGZ1bmN0aW9uKGksIGZyb21lbCkgewoJCXZhciBub3RBcHAgPSB0cnVlOwoJCXRvLmZpbmQoJ29wdGlvbicpLmVhY2goZnVuY3Rpb24oaiwgdG9lbCkgewoJCQlpZiAodG9lbC5pbm5lckhUTUwudG9Mb3dlckNhc2UoKSA+IGZyb21lbC5pbm5lckhUTUwudG9Mb3dlckNhc2UoKSkgewoJCQkJalF1ZXJ5KHRvZWwpLmJlZm9yZShmcm9tZWwpOwoJCQkJbm90QXBwID0gZmFsc2U7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX0KCQl9KTsKCQlpZiAobm90QXBwKSB7CgkJCXRvLmFwcGVuZChmcm9tZWwpOwoJCX0KCQlmcm9tZWwgPSBqUXVlcnkoZnJvbWVsKTsKCQlpZiAoYWN0aW9uLnRvTG93ZXJDYXNlKCkgPT0gJ2FkZCcpIHsKCQkJalF1ZXJ5KGRvY3VtZW50LmZvcm1zW2Zvcm1uYW1lXSkuYXBwZW5kKCI8aW5wdXQgbmFtZT0nIiArIG9iam5hbWUgKyAnWycgKyBmcm9tZWwudmFsKCkgKyAnXScKCQkJCSsgIicgaWQ9JyIgKyBvYmpuYW1lICsgJ18nICsgZnJvbWVsLnZhbCgpICsgIicgdmFsdWU9JyIgKyBmcm9tZWwudmFsKCkgKyAiJyBoaWRkZW4+Iik7CgkJfQoJCWVsc2UgaWYgKGFjdGlvbi50b0xvd2VyQ2FzZSgpID09ICdybXYnKSB7CgkJCWpRdWVyeSgnIycgKyBvYmpuYW1lICsgJ18nICsgZnJvbWVsLnZhbCgpKS5yZW1vdmUoKTsKCQl9Cgl9KTsKCglyZXR1cm4gdHJ1ZTsKfQoKLyoqCiAqIFJldHVybnMgdGhlIG51bWJlciBvZiBwcm9wZXJ0aWVzIG9mIGFuIG9iamVjdC4KICoKICogQHBhcmFtIG9iagogKgogKiBAcmV0dXJuIGludAogKi8KZnVuY3Rpb24gb2JqZWN0U2l6ZShvYmopIHsKCXZhciBzaXplID0gMCwga2V5OwoKCWZvciAoa2V5IGluIG9iaikgewoJCWlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkgewoJCQlzaXplKys7CgkJfQoJfQoKCXJldHVybiBzaXplOwp9CgovKioKICogT3B0aW1pemF0aW9uOgogKgogKiA4NjQwMCA9IDI0ICogNjAgKiA2MAogKiAzMTUzNjAwMCA9IDM2NSAqIDg2NDAwCiAqIDI1OTIwMDAgPSAzMCAqIDg2NDAwCiAqIDYwNDgwMCA9IDcgKiA4NjQwMAogKgogKiBAcGFyYW0gaW50IHRpbWVzdGFtcAogKiBAcGFyYW0gYm9vbGVhbiBpc1RzRG91YmxlCiAqIEBwYXJhbSBib29sZWFuIGlzRXh0ZW5kCiAqCiAqIEByZXR1cm4gc3RyaW5nCiAqLwpmdW5jdGlvbiBmb3JtYXRUaW1lc3RhbXAodGltZXN0YW1wLCBpc1RzRG91YmxlLCBpc0V4dGVuZCkgewoJdGltZXN0YW1wID0gdGltZXN0YW1wIHx8IDA7Cgl2YXIgeWVhcnMgPSAwLAoJCW1vbnRocyA9IDAsCgkJd2Vla3MgPSAwOwoKCWlmIChpc0V4dGVuZCkgewoJCXllYXJzID0gcGFyc2VJbnQodGltZXN0YW1wIC8gMzE1MzYwMDApOwoJCW1vbnRocyA9IHBhcnNlSW50KCh0aW1lc3RhbXAgLSB5ZWFycyAqIDMxNTM2MDAwKSAvIDI1OTIwMDApOwoJCS8vd2Vla3MgPSBwYXJzZUludCgodGltZXN0YW1wIC0geWVhcnMgKiAzMTUzNjAwMCAtIG1vbnRocyAqIDI1OTIwMDApIC8gNjA0ODAwKTsKCX0KCgl2YXIgZGF5cyA9IHBhcnNlSW50KCh0aW1lc3RhbXAgLSB5ZWFycyAqIDMxNTM2MDAwIC0gbW9udGhzICogMjU5MjAwMCAtIHdlZWtzICogNjA0ODAwKSAvIDg2NDAwKTsKCXZhciBob3VycyA9IHBhcnNlSW50KCh0aW1lc3RhbXAgLSB5ZWFycyAqIDMxNTM2MDAwIC0gbW9udGhzICogMjU5MjAwMCAtIHdlZWtzICogNjA0ODAwIC0gZGF5cyAqIDg2NDAwKSAvIDM2MDApOwoJLy92YXIgbWludXRlcyA9IHBhcnNlSW50KCh0aW1lc3RhbXAgLSB5ZWFycyAqIDMxNTM2MDAwIC0gbW9udGhzICogMjU5MjAwMCAtIHdlZWtzICogNjA0ODAwIC0gZGF5cyAqIDg2NDAwIC0gaG91cnMgKiAzNjAwKSAvIDYwKTsKCglpZiAoaXNUc0RvdWJsZSkgewoJCWlmIChtb250aHMudG9TdHJpbmcoKS5sZW5ndGggPT0gMSkgewoJCQltb250aHMgPSAnMCcgKyBtb250aHM7CgkJfQoJCWlmICh3ZWVrcy50b1N0cmluZygpLmxlbmd0aCA9PSAxKSB7CgkJCXdlZWtzID0gJzAnICsgd2Vla3M7CgkJfQoJCWlmIChkYXlzLnRvU3RyaW5nKCkubGVuZ3RoID09IDEpIHsKCQkJZGF5cyA9ICcwJyArIGRheXM7CgkJfQoJCWlmIChob3Vycy50b1N0cmluZygpLmxlbmd0aCA9PSAxKSB7CgkJCWhvdXJzID0gJzAnICsgaG91cnM7CgkJfQoJCS8qaWYgKG1pbnV0ZXMudG9TdHJpbmcoKS5sZW5ndGggPT0gMSkgewoJCQltaW51dGVzID0gJzAnICsgbWludXRlczsKCQl9Ki8KCX0KCgl2YXIgc3RyID0gKHllYXJzID09IDApID8gJycgOiB5ZWFycyArIGxvY2FsZVsnU19ZRUFSX1NIT1JUJ10gKyAnICc7CglzdHIgKz0gKG1vbnRocyA9PSAwKSA/ICcnIDogbW9udGhzICsgbG9jYWxlWydTX01PTlRIX1NIT1JUJ10gKyAnICc7CglzdHIgKz0gKHdlZWtzID09IDApID8gJycgOiB3ZWVrcyArIGxvY2FsZVsnU19XRUVLX1NIT1JUJ10gKyAnICc7CglzdHIgKz0gKGlzRXh0ZW5kICYmIGlzVHNEb3VibGUpCgkJPyBkYXlzICsgbG9jYWxlWydTX0RBWV9TSE9SVCddICsgJyAnCgkJOiAoZGF5cyA9PSAwKQoJCQk/ICcnCgkJCTogZGF5cyArIGxvY2FsZVsnU19EQVlfU0hPUlQnXSArICcgJzsKCXN0ciArPSAoaG91cnMgPT0gMCkgPyAnJyA6IGhvdXJzICsgbG9jYWxlWydTX0hPVVJfU0hPUlQnXSArICcgJzsKCS8vc3RyICs9IChtaW51dGVzID09IDApID8gJycgOiBtaW51dGVzICsgbG9jYWxlWydTX01JTlVURV9TSE9SVCddICsgJyAnOwoKCXJldHVybiBzdHI7Cn0KCi8qCioqIFphYmJpeAoqKiBDb3B5cmlnaHQgKEMpIDIwMDAtMjAxMiBaYWJiaXggU0lBCioqCioqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5CioqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CioqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlciB2ZXJzaW9uIDIgb2YgdGhlIExpY2Vuc2UsIG9yCioqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uCioqCioqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLAoqKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZgoqKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuIFNlZSB0aGUKKiogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4KKioKKiogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UKKiogYWxvbmcgd2l0aCB0aGlzIHByb2dyYW07IGlmIG5vdCwgd3JpdGUgdG8gdGhlIEZyZWUgU29mdHdhcmUKKiogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAwMjExMC0xMzAxLCBVU0EuCioqLwoKLyoqCiAqIFRpdGxlOiB0aWdyYSBtZW51CiAqCiAqIERlc2NyaXB0aW9uOiBTZWUgdGhlIGRlbW8gYXQgdXJsCiAqIFVSTDogaHR0cDovL3d3dy5zb2Z0Y29tcGxleC5jb20vcHJvZHVjdHMvdGlncmFfbWVudS8KICogVmVyc2lvbjogMi4wIChjb21tZW50ZWQgc291cmNlKQogKiBEYXRlOiAwNC0wNS0yMDAzIChtbS1kZC15eXl5KQogKiBUZWNoLiBTdXBwb3J0OiBodHRwOi8vd3d3LnNvZnRjb21wbGV4LmNvbS9mb3J1bS9mb3J1bWRpc3BsYXkucGhwP2ZpZD00MAogKiBOb3RlczogVGhpcyBzY3JpcHQgaXMgZnJlZS4gVmlzaXQgb2ZmaWNpYWwgc2l0ZSBmb3IgZnVydGhlciBkZXRhaWxzLgogKi8KZnVuY3Rpb24gZ2V0X3N0eWxlKGVsLCBzdHlsZVByb3ApIHsKCXZhciB5ID0gbnVsbDsKCglpZiAoZWwuY3VycmVudFN0eWxlKSB7CgkJeSA9IGVsLmN1cnJlbnRTdHlsZVtzdHlsZVByb3BdOwoJfQoJZWxzZSBpZiAod2luZG93LmdldENvbXB1dGVkU3R5bGUpIHsKCQl5ID0gZG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShlbCwgbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShzdHlsZVByb3ApOwoJfQoKCXJldHVybiB5Owp9CgpmdW5jdGlvbiBnZXRfcmVhbF90ZXh0X3dpZHRoKHRleHQsIGlkKSB7Cgl2YXIgaXRlbV90eXBlID0gJ3B1bV9vX3N1Ym1lbnUnOwoJaWYgKGlkID09IDApIHsKCQlpdGVtX3R5cGUgPSAncHVtX2loZWFkZXInOwoJfQoKCXZhciB0ZXN0X2VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCXRlc3RfZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgaXRlbV90eXBlKTsKCXRlc3RfZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ3Zpc2liaWxpdHk6IGhpZGRlbicpOwoJZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0ZXN0X2VsZW1lbnQpOwoKCXZhciBmb250X3NpemVfdGV4dCA9IGdldF9zdHlsZSh0ZXN0X2VsZW1lbnQsICdmb250LXNpemUnKTsKCWlmICghZm9udF9zaXplX3RleHQpIHsKCQlmb250X3NpemVfdGV4dCA9IGdldF9zdHlsZSh0ZXN0X2VsZW1lbnQsICdmb250U2l6ZScpOwoJfQoKCXZhciBmb250X3NpemUgPSBwYXJzZUludChmb250X3NpemVfdGV4dCk7Cglmb250X3NpemUgKz0gMjsKCgl2YXIgbWFyZ2luX2xlZnRfdGV4dCA9IGdldF9zdHlsZSh0ZXN0X2VsZW1lbnQsICdtYXJnaW4tbGVmdCcpOwoJaWYgKCFtYXJnaW5fbGVmdF90ZXh0KSB7CgkJbWFyZ2luX2xlZnRfdGV4dCA9IGdldF9zdHlsZSh0ZXN0X2VsZW1lbnQsICdtYXJnaW5MZWZ0Jyk7Cgl9CgoJdmFyIG1hcmdpbl9sZWZ0ID0gcGFyc2VJbnQobWFyZ2luX2xlZnRfdGV4dCk7CgoJZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0ZXN0X2VsZW1lbnQpOwoKCXRlc3RfZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKCXRlc3RfZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgaXRlbV90eXBlKTsKCXRlc3RfZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ2ZvbnQtc2l6ZTogJyArIGZvbnRfc2l6ZSArICdweDsgdmlzaWJpbGl0eTogaGlkZGVuJyk7Cgl0ZXN0X2VsZW1lbnQuaW5uZXJIVE1MID0gdGV4dDsKCglkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRlc3RfZWxlbWVudCk7CgoJdmFyIHRtcF9sZW4gPSB0ZXN0X2VsZW1lbnQub2Zmc2V0V2lkdGggKyBtYXJnaW5fbGVmdCArIDU7CgoJZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0ZXN0X2VsZW1lbnQpOwoJdGVzdF9lbGVtZW50ID0gbnVsbDsKCglyZXR1cm4gdG1wX2xlbjsKfQoKZnVuY3Rpb24gdHJ1bmNhdGVUZXh0KHRleHQsIGxlbikgewoJcmV0dXJuICh0ZXh0Lmxlbmd0aCA+IGxlbikgPyB0ZXh0LnN1YnN0cmluZygwLCBsZW4pICsgJy4uLicgOiB0ZXh0Owp9CgpmdW5jdGlvbiBzaG93X3BvcHVwX21lbnUoZSwgY29udGVudCwgd2lkdGgpIHsKCWlmIChBX01FTlVTWzBdICE9PSB1bmRlZmluZWQpIHsKCQlBX01FTlVTWzBdLmNvbGxhcHNlKCk7Cgl9CgoJdmFyIGN1cnNvciA9IGdldF9jdXJzb3JfcG9zaXRpb24oZSk7Cgl2YXIgdG1wX3dpZHRoID0gMDsKCXZhciBtYXhfd2lkdGggPSAwOwoJdmFyIG1lbnVUZXh0TGVuZ3RoID0gMzU7CgoJZm9yICh2YXIgaSA9IDA7IGkgPCBjb250ZW50Lmxlbmd0aDsgaSsrKSB7CgkJaWYgKGNvbnRlbnRbaV0ubGVuZ3RoKSB7CgkJCWNvbnRlbnRbaV1bMF0gPSB0cnVuY2F0ZVRleHQoY29udGVudFtpXVswXSwgbWVudVRleHRMZW5ndGgpOwoJCQl0bXBfd2lkdGggPSBnZXRfcmVhbF90ZXh0X3dpZHRoKGNvbnRlbnRbaV1bMF0sIGkpOwoKCQkJaWYgKG1heF93aWR0aCA8IHRtcF93aWR0aCkgewoJCQkJbWF4X3dpZHRoID0gdG1wX3dpZHRoOwoJCQl9CgkJfQoKCQkvLyB0cnVuY2F0ZSBzdWIgbWVudSB0ZXh0CgkJaWYgKGNvbnRlbnRbaV0ubGVuZ3RoID4gNCkgewoJCQlmb3IgKHZhciBqID0gNDsgaiA8IGNvbnRlbnRbaV0ubGVuZ3RoOyBqKyspIHsKCQkJCWNvbnRlbnRbaV1bal1bMF0gPSB0cnVuY2F0ZVRleHQoY29udGVudFtpXVtqXVswXSwgbWVudVRleHRMZW5ndGgpOwoJCQkJdG1wX3dpZHRoID0gZ2V0X3JlYWxfdGV4dF93aWR0aChjb250ZW50W2ldW2pdWzBdLCBpKTsKCgkJCQlpZiAobWF4X3dpZHRoIDwgdG1wX3dpZHRoKSB7CgkJCQkJbWF4X3dpZHRoID0gdG1wX3dpZHRoOwoJCQkJfQoJCQl9CgkJfQoJfQoKCWlmICh3aWR0aCA9PSBudWxsIHx8IHdpZHRoIDwgbWF4X3dpZHRoKSB7CgkJd2lkdGggPSBtYXhfd2lkdGg7Cgl9CgoJaWYgKHdpZHRoID09IDApIHsKCQl3aWR0aCA9IDIyMDsKCX0KCgl2YXIgcG9zID0gWwoJCXtibG9ja190b3A6IC0xMiwgYmxvY2tfbGVmdDogLTUsIHdpZHRoOiB3aWR0aH0sCgkJe2Jsb2NrX3RvcDogNSwgYmxvY2tfbGVmdDogd2lkdGggLSA1LCB3aWR0aDogd2lkdGh9CgldOwoKCW5ldyBwb3B1cF9tZW51IChjb250ZW50LCBwb3MsIGN1cnNvci54LCBjdXJzb3IueSk7CgoJcmV0dXJuIGZhbHNlOwp9CgovLyBnbG9iYWwgY29sbGVjdGlvbiBjb250YWluaW5nIGFsbCBtZW51cyBvbiBjdXJyZW50IHBhZ2UKdmFyIEFfTUVOVVMgPSBbXTsKCmZ1bmN0aW9uIHBvcHVwX21lbnUoYV9pdGVtcywgYV90cGwsIHgsIHkpIHsKCS8vIGJyb3dzZXIgY2hlY2sKCWlmICghZG9jdW1lbnQuYm9keSB8fCAhZG9jdW1lbnQuYm9keS5zdHlsZSkgewoJCXJldHVybiBudWxsOwoJfQoKCXRoaXMubl9zY3JvbGxfbGVmdCA9IGdldF9zY3JvbGxfcG9zKClbMF07Cgl0aGlzLm5fc2NyX3dpZHRoID0gKGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGgpCgkJPyBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoCgkJOiBkb2N1bWVudC53aWR0aDsKCgkvLyBzdG9yZSBpdGVtcyBzdHJ1Y3R1cmUKCXRoaXMuYV9jb25maWcgPSBhX2l0ZW1zOwoKCS8vIHN0b3JlIHRlbXBsYXRlIHN0cnVjdHVyZQoJdGhpcy5hX3RwbCA9IGFfdHBsOwoKCS8vIGdldCBtZW51IGlkCgl0aGlzLm5faWQgPSBBX01FTlVTLmxlbmd0aDsKCgkvLyBkZWNsYXJlIGNvbGxlY3Rpb25zCgl0aGlzLmFfaW5kZXggPSBbXTsKCXRoaXMuYV9jaGlsZHJlbiA9IFtdOwoKCS8vIGFzc2lnbiBtZXRob2RzIGFuZCBldmVudCBoYW5kbGVycwoJdGhpcy5leHBhbmQgPSBtZW51X2V4cGFuZDsKCXRoaXMuY29sbGFwc2UgPSBtZW51X2NvbGxhcHNlOwoJdGhpcy5vbmNsaWNrID0gbWVudV9vbmNsaWNrOwoJdGhpcy5vbm1vdXNlb3V0ID0gbWVudV9vbm1vdXNlb3V0OwoJdGhpcy5vbm1vdXNlb3ZlciA9IG1lbnVfb25tb3VzZW92ZXI7Cgl0aGlzLm9ubW91c2Vkb3duID0gbWVudV9vbm1vdXNlZG93bjsKCXRoaXMuZ2V0c3R5bGUgPSBtaXRlbV9nZXRzdHlsZTsKCXRoaXMuc2V0X3hfZGlyZWN0aW9uID0gbWl0ZW1fc2V0X3hfZGlyZWN0aW9uOwoJdGhpcy5nZXRfeF9kaXJlY3Rpb24gPSBtaXRlbV9nZXRfeF9kaXJlY3Rpb247Cgl0aGlzLnNldF95X2RpcmVjdGlvbiA9IG1pdGVtX3NldF95X2RpcmVjdGlvbjsKCXRoaXMuZ2V0X3lfZGlyZWN0aW9uID0gbWl0ZW1fZ2V0X3lfZGlyZWN0aW9uOwoKCS8vIGRlZmF1bHQgbGV2ZWwgc2NvcGUgZGVzY3JpcHRpb24gc3RydWN0dXJlCgl0aGlzLmFfdHBsX2RlZiA9IHsKCQlibG9ja190b3A6IDAsCgkJYmxvY2tfbGVmdDogMCwKCQl0b3A6IDIzLAoJCWxlZnQ6IDAsCgkJd2lkdGg6IDE3MCwKCQloZWlnaHQ6IDI0LAoJCWhpZGVfZGVsYXk6IDIwMCwKCQlleHBkX2RlbGF5OiAyMDAsCgkJInotaW5kZXgiOiA5MDAKCX07CgoJLy8gZGVmYXVsdCBjc3MKCXRoaXMuYV9jc3NfZGVmID0gewoJCW91dGVyOiBbJ3B1bV9vX2l0ZW0nXSwKCQlpbm5lcjogWydwdW1faV9pdGVtJ10KCX07CgoJLy8gYXNzaWduIG1ldGhvZHMgYW5kIHByb3BlcnRpZXMgcmVxdWlyZWQgdG8gZW11bGF0ZSBwYXJlbnQgaXRlbQoJdGhpcy5nZXRwcm9wID0gZnVuY3Rpb24oc19rZXkpIHsKCQlyZXR1cm4gdGhpcy5hX3RwbF9kZWZbc19rZXldOwoJfTsKCgl0aGlzLm9fcm9vdCA9IHRoaXM7Cgl0aGlzLm5fZGVwdGggPSAtMTsKCXRoaXMubl94ID0geDsKCXRoaXMubl95ID0geTsKCgkvLyAJaW5pdCBpdGVtcyByZWN1cnNpdmVseQoJZm9yIChuX29yZGVyID0gMDsgbl9vcmRlciA8IGFfaXRlbXMubGVuZ3RoOyBuX29yZGVyKyspIHsKCQluZXcgbWVudV9pdGVtKHRoaXMsIG5fb3JkZXIpOwoJfQoKCS8vIHJlZ2lzdGVyIHNlbGYgaW4gZ2xvYmFsIGNvbGxlY3Rpb24KCUFfTUVOVVNbdGhpcy5uX2lkXSA9IHRoaXM7CgoJLy8gbWFrZSByb290IGxldmVsIHZpc2libGUKCWZvciAodmFyIG5fb3JkZXIgPSAwOyBuX29yZGVyIDwgdGhpcy5hX2NoaWxkcmVuLmxlbmd0aDsgbl9vcmRlcisrKSB7CgkJdGhpcy5hX2NoaWxkcmVuW25fb3JkZXJdLmVfb2VsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsKCX0KfQoKZnVuY3Rpb24gbWl0ZW1fc2V0X3hfZGlyZWN0aW9uKG5fdmFsKSB7Cgl0aGlzLm5feF9kaXJlY3Rpb24gPSBuX3ZhbDsKfQoKZnVuY3Rpb24gbWl0ZW1fZ2V0X3hfZGlyZWN0aW9uKCkgewoJcmV0dXJuIHRoaXMubl94X2RpcmVjdGlvbiA/IHRoaXMubl94X2RpcmVjdGlvbiA6IG51bGw7Cn0KCmZ1bmN0aW9uIG1pdGVtX3NldF95X2RpcmVjdGlvbihuX3ZhbCkgewoJdGhpcy5uX3lfZGlyZWN0aW9uID0gbl92YWw7Cn0KCmZ1bmN0aW9uIG1pdGVtX2dldF95X2RpcmVjdGlvbigpIHsKCXJldHVybiB0aGlzLm5feV9kaXJlY3Rpb24gPyB0aGlzLm5feV9kaXJlY3Rpb24gOiBudWxsOwp9CgpmdW5jdGlvbiBtZW51X2NvbGxhcHNlKG5faWQpIHsKCS8vIGNhbmNlbCBpdGVtIG9wZW4gZGVsYXkKCWNsZWFyVGltZW91dCh0aGlzLm9fc2hvd3RpbWVyKTsKCgkvLyBieSBkZWZhdWx0IGNvbGxhcHNlIGFsbCBsZXZlbHMKCXZhciBuX3RvbGV2ZWwgPSAobl9pZCA/IHRoaXMuYV9pbmRleFtuX2lkXS5uX2RlcHRoIDogLTEpOwoJaWYgKC0xID09IG5fdG9sZXZlbCkgewoJCWZvciAobl9pZCA9IDA7IG5faWQgPCB0aGlzLmFfaW5kZXgubGVuZ3RoOyBuX2lkKyspIHsKCQkJdmFyIG9fY3Vycml0ZW0gPSB0aGlzLmFfaW5kZXhbbl9pZF07CgkJCWlmIChvX2N1cnJpdGVtKSB7CgkJCQl2YXIgZV9vZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG9fY3Vycml0ZW0uZV9vZWxlbWVudC5pZCk7CgkJCQlpZiAoZV9vZWxlbWVudCAhPSBudWxsKSB7CgkJCQkJZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlX29lbGVtZW50KTsKCQkJCX0KCQkJfQoJCX0KCQlBX01FTlVTLnNwbGljZSh0aGlzLm9fcm9vdC5uX2lkKTsKCX0KCWVsc2UgewoJCS8vIGhpZGUgYWxsIGl0ZW1zIG92ZXIgdGhlIGxldmVsIHNwZWNpZmllZAoJCWZvciAobl9pZCA9IDA7IG5faWQgPCB0aGlzLmFfaW5kZXgubGVuZ3RoOyBuX2lkKyspIHsKCQkJdmFyIG9fY3Vycml0ZW0gPSB0aGlzLmFfaW5kZXhbbl9pZF07CgkJCWlmIChvX2N1cnJpdGVtICYmIG9fY3Vycml0ZW0ubl9kZXB0aCA+IG5fdG9sZXZlbCAmJiBvX2N1cnJpdGVtLmJfdmlzaWJsZSkgewoJCQkJb19jdXJyaXRlbS5lX29lbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsKCQkJCW9fY3Vycml0ZW0uYl92aXNpYmxlID0gZmFsc2U7CgkJCX0KCQl9Cgl9CgoJLy8gcmVzZXQgY3VycmVudCBpdGVtIGlmIG1vdXNlIGhhcyBnb25lIG91dCBvZiBpdGVtcwoJaWYgKCFuX2lkKSB7CgkJdGhpcy5vX2N1cnJlbnQgPSBudWxsOwoJfQp9CgpmdW5jdGlvbiBtZW51X2V4cGFuZChuX2lkKSB7CgkvLyBleHBhbmQgb25seSB3aGVuIG1vdXNlIGlzIG92ZXIgc29tZSBtZW51IGl0ZW0KCWlmICh0aGlzLm9faGlkZXRpbWVyKSB7CgkJcmV0dXJuIG51bGw7Cgl9CgoJLy8gbG9va3VwIGN1cnJlbnQgaXRlbQoJdmFyIG9faXRlbSA9IHRoaXMuYV9pbmRleFtuX2lkXTsKCgkvLyBjbG9zZSBwcmV2aW91c2x5IG9wZW5lZCBpdGVtcwoJaWYgKHRoaXMub19jdXJyZW50ICYmIHRoaXMub19jdXJyZW50Lm5fZGVwdGggPj0gb19pdGVtLm5fZGVwdGgpIHsKCQl0aGlzLmNvbGxhcHNlKG9faXRlbS5uX2lkKTsKCX0KCXRoaXMub19jdXJyZW50ID0gb19pdGVtOwoKCS8vIGV4aXQgaWYgdGhlcmUgYXJlIG5vIGNoaWxkcmVuIHRvIG9wZW4KCWlmICghb19pdGVtLmFfY2hpbGRyZW4pIHsKCQlyZXR1cm4gbnVsbDsKCX0KCgkvLyBzaG93IGRpcmVjdCBjaGlsZCBpdGVtcwoJZm9yICh2YXIgbl9vcmRlciA9IDA7IG5fb3JkZXIgPCBvX2l0ZW0uYV9jaGlsZHJlbi5sZW5ndGg7IG5fb3JkZXIrKykgewoJCXZhciBvX2N1cnJpdGVtID0gb19pdGVtLmFfY2hpbGRyZW5bbl9vcmRlcl07CgkJb19jdXJyaXRlbS5lX29lbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7CgkJb19jdXJyaXRlbS5iX3Zpc2libGUgPSB0cnVlOwoJfQp9CgpmdW5jdGlvbiBtZW51X29uY2xpY2sobl9pZCkgewoJLy8gZG9uJ3QgZ28gYW55d2hlcmUgaWYgaXRlbSBoYXMgbm8gbGluayBkZWZpbmVkCgkvLyBsb29rdXAgbmV3IGl0ZW0ncyBvYmplY3QKCWlmIChCb29sZWFuKHRoaXMuYV9pbmRleFtuX2lkXS5hX2NvbmZpZ1sxXSkpIHsKCQkvLyBsb29rdXAgbmV3IGl0ZW0ncyBvYmplY3QKCQl2YXIgb19pdGVtID0gdGhpcy5hX2luZGV4W25faWRdOwoKCQkvLyBhcHBseSByb2xsb3V0CgkJb19pdGVtLmVfb2VsZW1lbnQuY2xhc3NOYW1lID0gb19pdGVtLmdldHN0eWxlKDAsIDApOwoJCW9faXRlbS5lX2llbGVtZW50LmNsYXNzTmFtZSA9IG9faXRlbS5nZXRzdHlsZSgxLCAwKTsKCgkJdGhpcy5vX2hpZGV0aW1lciA9IHNldFRpbWVvdXQoJ2lmICh0eXBlb2YoQV9NRU5VU1snICsgdGhpcy5uX2lkICsgJ10pICE9ICJ1bmRlZmluZWQiKSB7IEFfTUVOVVNbJyArIHRoaXMubl9pZCArICddLmNvbGxhcHNlKCk7IH0nLCAxMDApOwoJCXJldHVybiB0cnVlOwoJfQoJcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBtZW51X29ubW91c2VvdXQobl9pZCkgewoJLy8gbG9va3VwIG5ldyBpdGVtJ3Mgb2JqZWN0Cgl2YXIgb19pdGVtID0gdGhpcy5hX2luZGV4W25faWRdOwoKCS8vIGFwcGx5IHJvbGxvdXQKCW9faXRlbS5lX29lbGVtZW50LmNsYXNzTmFtZSA9IG9faXRlbS5nZXRzdHlsZSgwLCAwKTsKCW9faXRlbS5lX2llbGVtZW50LmNsYXNzTmFtZSA9IG9faXRlbS5nZXRzdHlsZSgxLCAwKTsKCgkvLyBydW4gbW91c2VvdmVyIHRpbWVyCgl0aGlzLm9faGlkZXRpbWVyID0gc2V0VGltZW91dCgnaWYgKHR5cGVvZihBX01FTlVTWycgKyB0aGlzLm5faWQgKyAnXSkgIT0gInVuZGVmaW5lZCIpIHsgQV9NRU5VU1snICsgdGhpcy5uX2lkICsgJ10uY29sbGFwc2UoKTsgfScsIG9faXRlbS5nZXRwcm9wKCdoaWRlX2RlbGF5JykpOwp9CgpmdW5jdGlvbiBtZW51X29ubW91c2VvdmVyKG5faWQpIHsKCS8vIGNhbmNlbCBtb3VzZW91dGUgbWVudSBjbG9zZSBhbmQgaXRlbSBvcGVuIGRlbGF5CgljbGVhclRpbWVvdXQodGhpcy5vX2hpZGV0aW1lcik7Cgl0aGlzLm9faGlkZXRpbWVyID0gbnVsbDsKCWNsZWFyVGltZW91dCh0aGlzLm9fc2hvd3RpbWVyKTsKCgkvLyBsb29rdXAgbmV3IGl0ZW0ncyBvYmplY3QKCXZhciBvX2l0ZW0gPSB0aGlzLmFfaW5kZXhbbl9pZF07CgoJLy8gYXBwbHkgcm9sbG92ZXIKCW9faXRlbS5lX29lbGVtZW50LmNsYXNzTmFtZSA9IG9faXRlbS5nZXRzdHlsZSgwLCAxKTsKCW9faXRlbS5lX2llbGVtZW50LmNsYXNzTmFtZSA9IG9faXRlbS5nZXRzdHlsZSgxLCAxKTsKCgkvLyBpZiBvbmNsaWNrIG9wZW4gaXMgc2V0IHRoZW4gbm8gbW9yZSBhY3Rpb25zIHJlcXVpcmVkCglpZiAob19pdGVtLmdldHByb3AoJ2V4cGRfZGVsYXknKSA8IDApIHsKCQlyZXR1cm4gbnVsbDsKCX0KCgkvLyBydW4gZXhwYW5kIHRpbWVyCgl0aGlzLm9fc2hvd3RpbWVyID0gc2V0VGltZW91dCgnQV9NRU5VU1snICsgdGhpcy5uX2lkICsgJ10uZXhwYW5kKCcgKyBuX2lkICsgJyk7Jywgb19pdGVtLmdldHByb3AoJ2V4cGRfZGVsYXknKSk7Cgp9CgovLyBjYWxsZWQgd2hlbiBtb3VzZSBidXR0b24gaXMgcHJlc3NlZCBvbiBtZW51IGl0ZW0KZnVuY3Rpb24gbWVudV9vbm1vdXNlZG93bihuX2lkKSB7CgkvLyBsb29rdXAgbmV3IGl0ZW0ncyBvYmplY3QKCXZhciBvX2l0ZW0gPSB0aGlzLmFfaW5kZXhbbl9pZF07CgoJLy8gYXBwbHkgbW91c2UgZG93biBzdHlsZQoJb19pdGVtLmVfb2VsZW1lbnQuY2xhc3NOYW1lID0gb19pdGVtLmdldHN0eWxlKDAsIDIpOwoJb19pdGVtLmVfaWVsZW1lbnQuY2xhc3NOYW1lID0gb19pdGVtLmdldHN0eWxlKDEsIDIpOwoKCXRoaXMuZXhwYW5kKG5faWQpOwp9CgovLyBtZW51IGl0ZW0gQ2xhc3MKZnVuY3Rpb24gbWVudV9pdGVtKG9fcGFyZW50LCBuX29yZGVyKSB7CgkvLyBzdG9yZSBwYXJhbWV0ZXJzIHBhc3NlZCB0byB0aGUgY29uc3RydWN0b3IKCXRoaXMubl9kZXB0aCAgPSBvX3BhcmVudC5uX2RlcHRoICsgMTsKCgl2YXIgaXRlbV9vZmZzZXQgPSB0aGlzLm5fZGVwdGggPyA0IDogMDsKCXRoaXMuYV9jb25maWcgPSBvX3BhcmVudC5hX2NvbmZpZ1tuX29yZGVyICsgaXRlbV9vZmZzZXRdOwoKCS8vIHJldHVybiBpZiByZXF1aXJlZCBwYXJhbWV0ZXJzIGFyZSBtaXNzaW5nCglpZiAoIXRoaXMuYV9jb25maWcgfHwgIXRoaXMuYV9jb25maWdbMF0pIHsKCQlyZXR1cm47Cgl9CgoJLy8gc3RvcmUgaW5mbyBmcm9tIHBhcmVudCBpdGVtCgl0aGlzLm9fcm9vdCA9IG9fcGFyZW50Lm9fcm9vdDsKCXRoaXMub19wYXJlbnQgPSBvX3BhcmVudDsKCXRoaXMubl9vcmRlciA9IG5fb3JkZXI7CgoJLy8gcmVnaXN0ZXIgaW4gZ2xvYmFsIGFuZCBwYXJlbnQncyBjb2xsZWN0aW9ucwoJdGhpcy5uX2lkID0gdGhpcy5vX3Jvb3QuYV9pbmRleC5sZW5ndGggKyAxOwoJdGhpcy5vX3Jvb3QuYV9pbmRleFt0aGlzLm5faWRdID0gdGhpczsKCW9fcGFyZW50LmFfY2hpbGRyZW5bbl9vcmRlcl0gPSB0aGlzOwoKCS8vIGNhbGN1bGF0ZSBpdGVtJ3MgY29vcmRpbmF0ZXMKCXZhciBvX3Jvb3QgPSB0aGlzLm9fcm9vdCwKCQlhX3RwbCAgPSB0aGlzLm9fcm9vdC5hX3RwbDsKCgl0aGlzLmFfY3NzID0gdGhpcy5hX2NvbmZpZ1szXSA/IHRoaXMuYV9jb25maWdbM10gOiBudWxsOwoKCS8vIGFzc2lnbiBtZXRob2RzCgl0aGlzLmdldHByb3AgID0gbWl0ZW1fZ2V0cHJvcDsKCXRoaXMuZ2V0c3R5bGUgPSBtaXRlbV9nZXRzdHlsZTsKCgl0aGlzLnNldF94X2RpcmVjdGlvbiA9IG1pdGVtX3NldF94X2RpcmVjdGlvbjsKCXRoaXMuZ2V0X3hfZGlyZWN0aW9uID0gbWl0ZW1fZ2V0X3hfZGlyZWN0aW9uOwoJdGhpcy5zZXRfeV9kaXJlY3Rpb24gPSBtaXRlbV9zZXRfeV9kaXJlY3Rpb247Cgl0aGlzLmdldF95X2RpcmVjdGlvbiA9IG1pdGVtX2dldF95X2RpcmVjdGlvbjsKCglpZiAoIW9fcGFyZW50Lm5feF9kaXJlY3Rpb24gJiYgIW5fb3JkZXIpIHsKCQkvLyBjYWxjdWxhdGUgbWVudSBkaXJlY3Rpb24gaW4gZmlyc3QgZWxlbWVudAoJCW9fcGFyZW50LnNldF94X2RpcmVjdGlvbigKCQkJdGhpcy5nZXRwcm9wKCd3aWR0aCcpICsgb19wYXJlbnQubl94ICsgdGhpcy5nZXRwcm9wKCdibG9ja19sZWZ0JykgPiBvX3Jvb3Qubl9zY3Jfd2lkdGggKyBvX3Jvb3Qubl9zY3JvbGxfbGVmdCA/IC0xIDogMQoJCSk7Cgl9CgoJdGhpcy5uX3ggPSBuX29yZGVyCgkJPyBvX3BhcmVudC5hX2NoaWxkcmVuW25fb3JkZXIgLSAxXS5uX3ggKyB0aGlzLmdldHByb3AoJ2xlZnQnKSAqIG9fcGFyZW50LmdldF94X2RpcmVjdGlvbigpCgkJOiBvX3BhcmVudC5uX3ggKyB0aGlzLmdldHByb3AoJ2Jsb2NrX2xlZnQnKSAqIG9fcGFyZW50LmdldF94X2RpcmVjdGlvbigpOwoKCWlmICgtMSA9PSAgb19wYXJlbnQuZ2V0X3hfZGlyZWN0aW9uKCkgJiYgb19wYXJlbnQgPT0gb19yb290ICYmICFuX29yZGVyKSB7CgkJdGhpcy5uX3ggLT0gdGhpcy5nZXRwcm9wKCd3aWR0aCcpOwoJfQoKCWlmICghb19wYXJlbnQubl95X2RpcmVjdGlvbiAmJiAhbl9vcmRlcikgewoJCW9fcGFyZW50LnNldF95X2RpcmVjdGlvbihqUXVlcnkod2luZG93KS5oZWlnaHQoKSArIGpRdWVyeSh3aW5kb3cpLnNjcm9sbFRvcCgpIC0gb19wYXJlbnQubl95IC0gdGhpcy5nZXRwcm9wKCdoZWlnaHQnKSAqIG9fcGFyZW50LmFfY29uZmlnLmxlbmd0aCA8IDAgPyAtMSA6IDEpOwoJfQoKCS8vIHRvcAoJdGhpcy5uX3kgPSBuX29yZGVyCgkJPyBvX3BhcmVudC5hX2NoaWxkcmVuW25fb3JkZXIgLSAxXS5uX3kgKyB0aGlzLmdldHByb3AoJ3RvcCcpCgkJOiBvX3BhcmVudC5uX3kgKyB0aGlzLmdldHByb3AoJ2Jsb2NrX3RvcCcpICogKG9fcGFyZW50ID09IG9fcm9vdCA/IG9fcGFyZW50LmdldF95X2RpcmVjdGlvbigpIDogMSk7CgoJaWYgKC0xID09IG9fcGFyZW50LmdldF95X2RpcmVjdGlvbigpICYmICFuX29yZGVyKSB7CgkJdGhpcy5uX3kgPSBqUXVlcnkod2luZG93KS5oZWlnaHQoKSArIGpRdWVyeSh3aW5kb3cpLnNjcm9sbFRvcCgpIC0gdGhpcy5nZXRwcm9wKCdoZWlnaHQnKSAqIChvX3BhcmVudC5hX2NvbmZpZy5sZW5ndGggLSBpdGVtX29mZnNldCk7Cgl9CgoJLy8gZ2VuZXJhdGUgaXRlbSdzIEhNVEwKCXZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKCXZhciBtZW51SXRlbUlkID0gJ2UnICsgb19yb290Lm5faWQgKyAnXycgKyB0aGlzLm5faWQgKyAnbyc7CgllbC5zZXRBdHRyaWJ1dGUoJ2lkJywgbWVudUl0ZW1JZCk7CgoJLy8ganMgY2FsbGJhY2sgYWN0aW9uCglpZiAoalF1ZXJ5LmlzRnVuY3Rpb24odGhpcy5hX2NvbmZpZ1sxXSkpIHsKCQlqUXVlcnkoZWwpLmNsaWNrKHRoaXMuYV9jb25maWdbMV0pOwoJfQoJLy8gdXJsIGFjdGlvbgoJZWxzZSB7CgkJaWYgKCFpc19udWxsKHRoaXMuYV9jb25maWdbMV0pICYmICh0aGlzLmFfY29uZmlnWzFdLmluZGV4T2YoJ2phdmFzY3JpcHQnKSA9PSAtMSkKCQkJCSYmICEoIWlzX251bGwodGhpcy5hX2NvbmZpZ1syXSkgfHwgdGhpcy5hX2NvbmZpZ1syXSA9PSAnbm9zaWQnKSkgewoJCQl2YXIgdXJsID0gbmV3IEN1cmwodGhpcy5hX2NvbmZpZ1sxXSk7CgkJCXRoaXMuYV9jb25maWdbMV0gPSB1cmwuZ2V0VXJsKCk7CgkJfQoKCQllbC5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCB0aGlzLmFfY29uZmlnWzFdKTsKCQlpZiAodGhpcy5hX2NvbmZpZ1syXSAmJiB0aGlzLmFfY29uZmlnWzJdWyd0dyddKSB7CgkJCWVsLnNldEF0dHJpYnV0ZSgndGFyZ2V0JywgdGhpcy5hX2NvbmZpZ1syXVsndHcnXSk7CgkJfQoJfQoKCWVsLmNsYXNzTmFtZSA9IHRoaXMuZ2V0c3R5bGUoMCwgMCk7CgllbC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CgllbC5zdHlsZS50b3AgPSB0aGlzLm5feSArICdweCc7CgllbC5zdHlsZS5sZWZ0ID0gdGhpcy5uX3ggKyAncHgnOwoJZWwuc3R5bGUud2lkdGggPSB0aGlzLmdldHByb3AoJ3dpZHRoJykgKyAncHgnOwoJZWwuc3R5bGUuaGVpZ2h0ID0gdGhpcy5nZXRwcm9wKCdoZWlnaHQnKSArICdweCc7CgllbC5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7CgllbC5zdHlsZS56SW5kZXggPSBwYXJzZUludCh0aGlzLm5fZGVwdGgsIDEwKSArIDEwMDsKCWVsLm9fcm9vdF9uX2lkID0gb19yb290Lm5faWQ7CgllbC50aGlzX25faWQgPSB0aGlzLm5faWQ7CgllbC5vbmNsaWNrID0gQV9NRU5VU19vbmNsaWNrOwoJZWwub25tb3VzZW91dCA9IEFfTUVOVVNfb25tb3VzZW91dDsKCWVsLm9ubW91c2VvdmVyID0gQV9NRU5VU19vbm1vdXNlb3ZlcjsKCWVsLm9ubW91c2Vkb3duID0gQV9NRU5VU19vbm1vdXNlZG93bjsKCgl2YXIgZWxkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCWVsZGl2LnNldEF0dHJpYnV0ZSgnaWQnLCAnZScgKyBvX3Jvb3Qubl9pZCArICdfJyArIHRoaXMubl9pZCArJ2knKTsKCWVsZGl2LmNsYXNzTmFtZSA9IHRoaXMuZ2V0c3R5bGUoMSwgMCk7CgoJLy8gdHJ1bmNhdGluZyBsb25nIHN0cmluZ3MgLSB0aGV5IGRvbid0IGZpdCBpbiB0aGUgcG9wdXAgbWVudScKCWlmICh0eXBlb2YodGhpcy5hX2NvbmZpZ1swXSkgPT0gJ3N0cmluZycgJiYgdGhpcy5hX2NvbmZpZ1swXS5sZW5ndGggPiAzNSkgewoJCWVsZGl2LnNldEF0dHJpYnV0ZSgndGl0bGUnLCB0aGlzLmFfY29uZmlnWzBdKTsKCX0KCgllbGRpdi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0aGlzLmFfY29uZmlnWzBdKSk7CgoJZWwuYXBwZW5kQ2hpbGQoZWxkaXYpOwoKCWRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWwpOwoKCXRoaXMuZV9pZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlJyArIG9fcm9vdC5uX2lkICsgJ18nICsgdGhpcy5uX2lkICsgJ2knKTsKCXRoaXMuZV9vZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlJyArIG9fcm9vdC5uX2lkICsgJ18nICsgdGhpcy5uX2lkICsgJ28nKTsKCgl0aGlzLmJfdmlzaWJsZSA9ICF0aGlzLm5fZGVwdGg7CgoJdmFyIG5ld1Jlc3VsdCA9IDA7Cgl2YXIgblRleHQgPSAnJzsKCgluZXdSZXN1bHQgPSB0aGlzLmVfaWVsZW1lbnQuc2Nyb2xsV2lkdGggLSB0aGlzLmdldHByb3AoJ3dpZHRoJyk7CglpZiAobmV3UmVzdWx0ID4gMCkgewoJCS8vIGFudGkgZG93bgoJCXZhciB4ID0gNTAwOwoJCXdoaWxlICh4KSB7CgkJCW5ld1Jlc3VsdCA9IHRoaXMuZV9pZWxlbWVudC5zY3JvbGxXaWR0aCAtIHRoaXMuZ2V0cHJvcCgnd2lkdGgnKTsKCQkJblRleHQgPSBqUXVlcnkudW5lc2NhcGVIdG1sKHRoaXMuZV9pZWxlbWVudC5pbm5lckhUTUwpOwoJCQl0aGlzLmVfaWVsZW1lbnQuaW5uZXJIVE1MID0galF1ZXJ5LmVzY2FwZUh0bWwoblRleHQuc3Vic3RyaW5nKDAsIG5UZXh0Lmxlbmd0aCAtIDEwKSk7CgkJCXgtLTsKCQkJaWYgKG5ld1Jlc3VsdCA8IDEpIHsKCQkJCXRoaXMuZV9pZWxlbWVudC5pbm5lckhUTUwgKz0gJy4uLic7CgkJCQl4ID0gMDsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJfQoKCS8vIG5vIG1vcmUgaW5pdGlhbGl6YXRpb24gaWYgbGVhZgoJaWYgKHRoaXMuYV9jb25maWcubGVuZ3RoIDwgaXRlbV9vZmZzZXQpIHsKCQlyZXR1cm4gbnVsbDsKCX0KCgkvLyBub2RlIHNwZWNpZmljIG1ldGhvZHMgYW5kIHByb3BlcnRpZXMKCXRoaXMuYV9jaGlsZHJlbiA9IFtdOwoKCS8vIGluaXQgZG93bmxpbmUgcmVjdXJzaXZlbHkKCWZvciAodmFyIG5fb3JkZXIgPSAwOyBuX29yZGVyIDwgdGhpcy5hX2NvbmZpZy5sZW5ndGggLSBpdGVtX29mZnNldDsgbl9vcmRlcisrKSB7CgkJbmV3IG1lbnVfaXRlbSh0aGlzLCBuX29yZGVyKTsKCX0KfQoKZnVuY3Rpb24gQV9NRU5VU19vbmNsaWNrKCkgewoJaWYgKCFpc19udWxsKEFfTUVOVVNbdGhpcy5vX3Jvb3Rfbl9pZF0pKSB7CgkJcmV0dXJuIEFfTUVOVVNbdGhpcy5vX3Jvb3Rfbl9pZF0ub25jbGljayh0aGlzLnRoaXNfbl9pZCk7Cgl9Cn0KCmZ1bmN0aW9uIEFfTUVOVVNfb25tb3VzZW91dCgpIHsKCXJldHVybiBBX01FTlVTW3RoaXMub19yb290X25faWRdLm9ubW91c2VvdXQodGhpcy50aGlzX25faWQpOwp9CgpmdW5jdGlvbiBBX01FTlVTX29ubW91c2VvdmVyKCkgewoJcmV0dXJuIEFfTUVOVVNbdGhpcy5vX3Jvb3Rfbl9pZF0ub25tb3VzZW92ZXIodGhpcy50aGlzX25faWQpOwp9CgpmdW5jdGlvbiBBX01FTlVTX29ubW91c2Vkb3duKCkgewoJcmV0dXJuIEFfTUVOVVNbdGhpcy5vX3Jvb3Rfbl9pZF0ub25tb3VzZWRvd24odGhpcy50aGlzX25faWQpOwp9CgovLyByZWFkcyBwcm9wZXJ0eSBmcm9tIHRlbXBsYXRlIGZpbGUsIGluaGVyaXRzIGZyb20gcGFyZW50IGxldmVsIGlmIG5vdCBmb3VuZApmdW5jdGlvbiBtaXRlbV9nZXRwcm9wKHNfa2V5KSB7CgkvLyBjaGVjayBpZiB2YWx1ZSBpcyBkZWZpbmVkIGZvciBjdXJyZW50IGxldmVsCgl2YXIgc192YWx1ZSA9IG51bGwsCgkJYV9sZXZlbCA9IHRoaXMub19yb290LmFfdHBsW3RoaXMubl9kZXB0aF07CgoJLy8gcmV0dXJuIHZhbHVlIGlmIGV4cGxpY2l0bHkgZGVmaW5lZAoJaWYgKGFfbGV2ZWwpIHsKCQlzX3ZhbHVlID0gYV9sZXZlbFtzX2tleV07Cgl9CgoJLy8gcmVxdWVzdCByZWN1cnNpdmVseSBmcm9tIHBhcmVudCBsZXZlbHMgaWYgbm90IGRlZmluZWQKCXJldHVybiBzX3ZhbHVlID09IG51bGwgPyB0aGlzLm9fcGFyZW50LmdldHByb3Aoc19rZXkpIDogc192YWx1ZTsKfQoKLy8gcmVhZHMgcHJvcGVydHkgZnJvbSB0ZW1wbGF0ZSBmaWxlLCBpbmhlcml0cyBmcm9tIHBhcmVudCBsZXZlbCBpZiBub3QgZm91bmQKZnVuY3Rpb24gbWl0ZW1fZ2V0c3R5bGUobl9wb3MsIG5fc3RhdGUpIHsKCXZhciBhX2NzcyA9IHRoaXMuYV9jc3M7CgoJLy8gcmVxdWVzdCByZWN1cnNpdmVseSBmcm9tIHBhcmVudCBsZXZlbHMgaWYgbm90IGRlZmluZWQKCWlmICghYV9jc3MpIHsKCQlhX2NzcyA9IHRoaXMub19yb290LmFfY3NzX2RlZjsKCX0KCgl2YXIgYV9vY2xhc3MgPSBhX2Nzc1tuX3BvcyA/ICdpbm5lcicgOiAnb3V0ZXInXTsKCgkvLyBzYW1lIGNsYXNzIGZvciBhbGwgc3RhdGVzCglpZiAodHlwZW9mKGFfb2NsYXNzKSA9PSAnc3RyaW5nJykgewoJCXJldHVybiBhX29jbGFzczsKCX0KCgkvLyBpbmhlcml0IGNsYXNzIGZyb20gcHJldmlvdXMgc3RhdGUgaWYgbm90IGV4cGxpY2l0bHkgZGVmaW5lZAoJZm9yICh2YXIgbl9jdXJyc3QgPSBuX3N0YXRlOyBuX2N1cnJzdCA+PSAwOyBuX2N1cnJzdC0tKSB7CgkJaWYgKGFfb2NsYXNzW25fY3VycnN0XSkgewoJCQlyZXR1cm4gYV9vY2xhc3Nbbl9jdXJyc3RdOwoJCX0KCX0KfQoKLyoqCiAqIENyZWF0ZXMgYSBoZWFkZXIgb2JqZWN0IGZvciB0aGUgbWVudS4KICoKICogQHBhcmFtIGxhYmVsCiAqCiAqIEByZXR1cm4ge0FycmF5fQogKi8KZnVuY3Rpb24gY3JlYXRlTWVudUhlYWRlcihsYWJlbCkgewoJcmV0dXJuIFtsYWJlbCwgbnVsbCwgbnVsbCwge291dGVyOiAncHVtX29oZWFkZXInLCBpbm5lcjogJ3B1bV9paGVhZGVyJ31dOwp9CgovKioKICogQ3JlYXRlcyBhIG1lbnUgbGluayBvYmplY3QgZm9yIHRoZSBtZW51LgogKgogKiBTdXBwb3J0ZWQgY29uZmlnIHZhbHVlczoKICogLSBub3NpZCAtIGV4Y2x1ZGUgdGhlIFNJRCBwYXJhbWV0ZXIgZnJvbSB0aGUgVVJMLgogKgogKiBAcGFyYW0gbGFiZWwKICogQHBhcmFtIGFjdGlvbiAgICB0aGUgdGFyZ2V0IFVSTAogKiBAcGFyYW0gY29uZmlnICAgIGFkZGl0aW9uYWwgY29uZmlndXJhdGlvbiBwYXJhbWV0ZXIKICoKICogQHJldHVybiB7QXJyYXl9CiAqLwpmdW5jdGlvbiBjcmVhdGVNZW51SXRlbShsYWJlbCwgYWN0aW9uLCBjb25maWcpIHsKCXJldHVybiBbbGFiZWwsIGFjdGlvbiwgY29uZmlnLCB7b3V0ZXI6ICdwdW1fb19pdGVtJywgaW5uZXI6ICdwdW1faV9pdGVtJ31dOwp9CgovKgogKiogWmFiYml4CiAqKiBDb3B5cmlnaHQgKEMpIDIwMDAtMjAxMiBaYWJiaXggU0lBCiAqKgogKiogVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU7IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkKICoqIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5CiAqKiB0aGUgRnJlZSBTb2Z0d2FyZSBGb3VuZGF0aW9uOyBlaXRoZXIgdmVyc2lvbiAyIG9mIHRoZSBMaWNlbnNlLCBvcgogKiogKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4KICoqCiAqKiBUaGlzIHByb2dyYW0gaXMgZGlzdHJpYnV0ZWQgaW4gdGhlIGhvcGUgdGhhdCBpdCB3aWxsIGJlIHVzZWZ1bCwKICoqIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mCiAqKiBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlCiAqKiBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBmb3IgbW9yZSBkZXRhaWxzLgogKioKICoqIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlCiAqKiBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbTsgaWYgbm90LCB3cml0ZSB0byB0aGUgRnJlZSBTb2Z0d2FyZQogKiogRm91bmRhdGlvbiwgSW5jLiwgNTEgRnJhbmtsaW4gU3RyZWV0LCBGaWZ0aCBGbG9vciwgQm9zdG9uLCBNQSAgMDIxMTAtMTMwMSwgVVNBLgogKiovCgoKalF1ZXJ5KGZ1bmN0aW9uKCkgewoKCWNvb2tpZS5pbml0KCk7CgoJLy8gc2VhcmNoCglpZiAoalF1ZXJ5KCcjc2VhcmNoJykubGVuZ3RoKSB7CgkJY3JlYXRlU3VnZ2VzdCgnc2VhcmNoJyk7Cgl9CgoJLyoqCgkgKiBIYW5kbGVzIGhvc3QgcG9wIHVwIG1lbnVzLgoJICovCglqUXVlcnkoZG9jdW1lbnQpLm9uKCdjbGljaycsICcubWVudS1ob3N0JywgZnVuY3Rpb24oZXZlbnQpIHsKCQl2YXIgbWVudURhdGEgPSBqUXVlcnkodGhpcykuZGF0YSgnbWVudScpOwoJCXZhciBtZW51ID0gW107CgoJCS8vIGFkZCBzY3JpcHRzCgkJaWYgKG1lbnVEYXRhLnNjcmlwdHMubGVuZ3RoKSB7CgkJCW1lbnUucHVzaChjcmVhdGVNZW51SGVhZGVyKHQoJ1NjcmlwdHMnKSkpOwoJCQlqUXVlcnkuZWFjaChtZW51RGF0YS5zY3JpcHRzLCBmdW5jdGlvbihpLCBzY3JpcHQpIHsKCQkJCW1lbnUucHVzaChjcmVhdGVNZW51SXRlbShzY3JpcHQubmFtZSwgZnVuY3Rpb24gKCkgewoJCQkJCWV4ZWN1dGVTY3JpcHQobWVudURhdGEuaG9zdGlkLCBzY3JpcHQuc2NyaXB0aWQsIHNjcmlwdC5jb25maXJtYXRpb24pOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0pKTsKCQkJfSk7CgkJfQoKCQkvLyBhZGQgZ28gdG8gbGlua3MKCQltZW51LnB1c2goY3JlYXRlTWVudUhlYWRlcih0KCdHbyB0bycpKSk7CgkJbWVudS5wdXNoKGNyZWF0ZU1lbnVJdGVtKHQoJ0xhdGVzdCBkYXRhJyksICdsYXRlc3QucGhwP2hvc3RpZD0nICsgbWVudURhdGEuaG9zdGlkKSk7CgkJaWYgKG1lbnVEYXRhLmhhc0ludmVudG9yeSkgewoJCQltZW51LnB1c2goY3JlYXRlTWVudUl0ZW0odCgnSG9zdCBpbnZlbnRvcmllcycpLCAnaG9zdGludmVudG9yaWVzLnBocD9ob3N0aWQ9JyArIG1lbnVEYXRhLmhvc3RpZCkpOwoJCX0KCQlpZiAobWVudURhdGEuaGFzU2NyZWVucykgewoJCQltZW51LnB1c2goY3JlYXRlTWVudUl0ZW0odCgnSG9zdCBzY3JlZW5zJyksICdob3N0X3NjcmVlbi5waHA/aG9zdGlkPScgKyBtZW51RGF0YS5ob3N0aWQpKTsKCQl9CgoJCS8vIHJlbmRlciB0aGUgbWVudQoJCXNob3dfcG9wdXBfbWVudShldmVudCwgbWVudSwgMTgwKTsKCgkJcmV0dXJuIGZhbHNlOwoJfSk7Cn0pOwoK" type="text/javascript"></script><!--URL:jsLoader.php?ver=2.0.4&lang=en_GB&isMenu=0-->
<script type="text/javascript">
	if (jQuery(window).width() < 1024) {
		document.write('<link rel="stylesheet" type="text/css" href="styles/handheld.css" />');
	}
</script>
</head>
<body class="originalblue">
<div id="message-global-wrap"><div id="message-global"></div></div>
<form action="index.php" method="post">
<input class="input hidden" name="request" type="hidden" value=""/>
<div style="display: table; position: absolute; height: 99%; width: 99%;">
<div class="vertical-middle">
<div class="loginForm">
<div style="position: relative; color: #F0F0F0; height: 100%;">
<!-- Help & Support -->
<div style="position: absolute; top: 0px; right: 10px;">
<a class="highlight" href="http://www.zabbix.com/documentation">Help</a>
			|
			<a class="highlight" href="https://support.zabbix.com">Support</a>
</div>
<!-- Copyright -->
<div style="float: left; width: 250px; height: 100%;">
<div class="loginLogo" style="position: absolute; top: 39%; left: 2%;"></div>
<div style="position: absolute; bottom: 2px;">
<span class="bold textwhite" style="margin: 0 0 4px 4px; font-size: 0.9em; opacity: 0.7;">
					Zabbix 2.0.4 Copyright 2001-2012 by Zabbix SIA				</span>
</div>
</div>
<!-- Login Form -->
<div style="height: 100%; padding-top: 58px; padding-right: 40px; margin-left: 275px;">
<div style="float: right;">
<ul style="list-style-type: none;">
<li style="padding-right: 6px; height: 22px;">
<div class="ui-corner-all textwhite bold" style="padding: 2px 4px; float: right; background-color: #CC3333; visibility: visible">
<span class="nowrap">Not authorized</span>
</div>
</li>
<li style="margin-top: 10px; padding-top: 1px; height: 22px; width: 265px; background-image: url(images/general/login/username_pass_field.png); background-repeat: no-repeat; white-space: nowrap;">
<div class="bold" style="display: inline-block; zoom: 1; *display: inline; *margin-right: 2px; font-size: 1.1em; width: 70px; padding-left: 10px; line-height: 22px;">Username</div>
<input class="input bold transparent" id="name" name="name" style="color: #5f5f5f; height: 16px; line-height: 16px; width: 170px;" type="text"/>
</li>
<li style="margin-top: 10px; padding-top: 1px; height: 22px; width: 265px; background-image: url(images/general/login/username_pass_field.png); background-repeat: no-repeat; white-space: nowrap;">
<div class="bold" style="display: inline-block; zoom: 1; *display: inline; *margin-right: 2px; font-size: 1.1em; width: 70px; padding-left: 10px; line-height: 22px;">Password</div>
<input class="input bold transparent" id="password" name="password" style="color: #5f5f5f; height: 16px; line-height: 16px; width: 170px;" type="password"/>
</li>
<li style="margin-top: 8px; margin-left: 64px;">
<input checked="checked" id="autologin" name="autologin" type="checkbox" value="1"/>
<label class="bold" for="autologin" style="line-height: 20px; vertical-align: top;">
						Remember me for 30 days					</label>
<div style="height: 8px;"></div>
<input class="input" id="enter" name="enter" type="submit" value="Sign in"/>
<span style="margin-left: 14px;">
<a class="highlight underline" href="dashboard.php">Login as Guest</a>
</span>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</form>
<script type="text/javascript">
	jQuery(document).ready(function() {
		jQuery(document.body).addClass('loginBG');
		jQuery('#enter').button();
		jQuery('#name').focus();
	});
</script>
<script type="text/javascript">// <![CDATA[
var page_refresh = null;
jQuery(function() {
chkbxRange.init();
});

// ]]></script></body>
</html><!--Generated by HTMLArk 2021-05-23 17:49:36.070860. Original URL http://201.220.24.212/zabbix/index.php?reconnect=1-->
